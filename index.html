<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="https://images-kkblog.oss-cn-hangzhou.aliyuncs.com/bonbon-16%C3%9716.png?v=2.8.0" type="image/png" sizes="16x16"><link rel="icon" href="https://images-kkblog.oss-cn-hangzhou.aliyuncs.com/bonbon-32%C3%9732.png?v=2.8.0" type="image/png" sizes="32x32"><meta property="og:type" content="website">
<meta property="og:title" content="KkkerAn&#39;s Blog">
<meta property="og:url" content="https://username.github.io/index.html">
<meta property="og:site_name" content="KkkerAn&#39;s Blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="KkkerAn">
<meta name="twitter:card" content="summary"><title>KkkerAn's Blog</title><link ref="canonical" href="https://username.github.io/index.html"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.8.0"><link rel="stylesheet" href="css/custom.css"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  assistSearch: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: {"enable":true,"showOnPost":true,"scrollDownIcon":false},
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"default","highlight":"light","wordWrap":false},
  reward: false,
  fancybox: false,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: true,
  pjax: undefined,
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"复制","copySuccess":"复制成功","copyError":"复制失败"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 6.3.0"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">首页</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">归档</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/categories/"><span class="header-nav-menu-item__icon"><i class="fas fa-layer-group"></i></span><span class="header-nav-menu-item__text">分类</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/tags/"><span class="header-nav-menu-item__icon"><i class="fas fa-tags"></i></span><span class="header-nav-menu-item__text">标签</span></a></div></div><div class="header-nav-search"><span class="header-nav-search__icon"><i class="fas fa-search"></i></span><span class="header-nav-search__text">搜索</span></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">WelCome to My Blog</div><div class="header-banner-info__subtitle">回忆像一块彩色橡皮糖,被拉长了,颜色淡了,但还是甜</div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content content-home" id="content"><section class="postlist"><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2023/10/13/%E6%AD%BB%E4%B9%8B%E5%89%8D%E8%A6%81%E5%81%9A%E5%AE%8C%E7%9A%84%E7%AE%97%E6%B3%95%E6%89%8B%E5%86%8C-%5B9.%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%5D/">死之前要做完的算法手册-[9.动态规划]</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2023-10-13</span></span><span class="post-meta-item post-meta-item--wordcount"><span class="post-meta-item__icon"><i class="far fa-file-word"></i></span><span class="post-meta-item__info">字数统计</span><span class="post-meta-item__value">2.3k</span></span><span class="post-meta-item post-meta-item--readtime"><span class="post-meta-item__icon"><i class="far fa-clock"></i></span><span class="post-meta-item__info">阅读时长</span><span class="post-meta-item__value">16分</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h1 id="动态规划"   >
          <a href="#动态规划" class="heading-link"><i class="fas fa-link"></i></a><a href="#动态规划" class="headerlink" title="动态规划"></a>动态规划</h1>
      <p>动态规划的问题，通常是有多个重叠子问题构成，类似于背包问题，于是可以用动态规划来解决。</p>
<blockquote>
<p>动态规划中每一个状态一定是由上一个状态推导出来的</p>
</blockquote>
<p><strong>动态规划</strong>与<strong>贪心算法</strong>的区别：</p>
<ul>
<li>动态规划的每一个状态都是由上一个确定的状态推导出</li>
<li>贪心算法的每一个状态都是局部最优解，来从局部最优解中选出全局最优解</li>
</ul>
<p>通过卡哥的视频学习，我们首先要学习一个做动态规划的一个思路，也即公式：动态规划五部曲</p>
<p><strong>动态规划五部曲</strong></p>
<ul>
<li>确认dp数组以及下标的含义</li>
<li>确定递推公式：</li>
<li>dp数组如何初始化</li>
<li>确认遍历顺序</li>
<li>打印dp数组值，确保推导正确</li>
</ul>

        <h2 id="基本问题"   >
          <a href="#基本问题" class="heading-link"><i class="fas fa-link"></i></a><a href="#基本问题" class="headerlink" title="基本问题"></a>基本问题</h2>
      
        <h3 id="509-斐波那契数"   >
          <a href="#509-斐波那契数" class="heading-link"><i class="fas fa-link"></i></a><a href="#509-斐波那契数" class="headerlink" title="509.斐波那契数"></a>509.斐波那契数</h3>
      <p><strong>斐波那契数</strong> （通常用 <code>F(n)</code> 表示）形成的序列称为 <strong>斐波那契数列</strong> 。该数列由 <code>0</code> 和 <code>1</code> 开始，后面的每一项数字都是前面两项数字的和。也就是：</p>
<blockquote>
<p>F(0) &#x3D; 0，F(1) &#x3D; 1<br>F(n) &#x3D; F(n - 1) + F(n - 2)，其中 n &gt; 1</p>
</blockquote>
<p>给定 <code>n</code> ，请计算 <code>F(n)</code> 。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/fibonacci-number/" >Leetcode.509(easy)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h4 id="第一次做"   >
          <a href="#第一次做" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做" class="headerlink" title="第一次做"></a>第一次做</h4>
      <p>第一次做于23&#x2F;10&#x2F;13</p>

        <h5 id="第一次代码"   >
          <a href="#第一次代码" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码" class="headerlink" title="第一次代码"></a>第一次代码</h5>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">fib</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(n&lt;=<span class="number">1</span>) <span class="keyword">return</span> n;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span>[] dp=<span class="keyword">new</span> <span class="title class_">int</span>[n+<span class="number">1</span>];</span><br><span class="line">        dp[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">        dp[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            dp[i]=dp[i-<span class="number">1</span>]+dp[i-<span class="number">2</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n];</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h6 id="提交成功"   >
          <a href="#提交成功" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功" class="headerlink" title="提交成功"></a>提交成功</h6>
      
        <h4 id="题解"   >
          <a href="#题解" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解" class="headerlink" title="题解"></a>题解</h4>
      <p>思路：我们求这个题可以用动态规划也能用递归函数，但是这里我们主要用的是动态规划来做这道题目，因为这道题目给出了递推公式，也提供了初始化数值，所以这道题很容易就能ac</p>
<p><strong>实现</strong></p>
<ul>
<li><p>动态规划五部曲</p>
<ul>
<li><p>确认dp数组以及下标的含义：dp数组用于记录每一个斐波那契数值，下标i就是对应的n</p>
</li>
<li><p>确定递推公式：<br>$$<br>F(n)&#x3D;Fn(n-1)+Fn(n-2)<br>$$</p>
</li>
<li><p>dp数组如何初始化:<code>F(0)=0,F(1)=1</code></p>
</li>
<li><p>确认遍历顺序:从前向后</p>
</li>
<li><p>打印dp数组值，确保推导正确：当出现错误的时候Debug，通过递推公式以及遍历顺序确定dp数组的数值</p>
</li>
</ul>
</li>
<li><p>检验n的有效性，当n小于2的时候数值已经确定，直接返回n：<code>return n</code></p>
</li>
<li><p>维护一个dp数组，由递推公式从前向后给dp数组赋值</p>
</li>
<li><p>返回n对应下标dp[n]：<code>return dp[n]</code></p>
</li>
</ul>
<p><strong>未压缩状态代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">fib</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="comment">//当n为0和1的时候数值都已经确定，直接返回</span></span><br><span class="line">    	<span class="keyword">if</span>(n&lt;=<span class="number">1</span>) <span class="keyword">return</span> n;</span><br><span class="line">		</span><br><span class="line">    	<span class="comment">//维护一个dp数组，后一个数字是前两个数字的和，初始化数组</span></span><br><span class="line">        <span class="type">int</span>[] dp=<span class="keyword">new</span> <span class="title class_">int</span>[n+<span class="number">1</span>];</span><br><span class="line">        dp[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">        dp[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    	</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            dp[i]=dp[i-<span class="number">1</span>]+dp[i-<span class="number">2</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    	<span class="comment">//返回对应的数据</span></span><br><span class="line">        <span class="keyword">return</span> dp[n];</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>



<p>因此我们可以知道，这个结果后一个数字由前两个数字确定，所以其实不用维护一个dp数组，我们只要知道前两个数的大小就能推出最后一个数是多少，也即：<strong>我们只需知道前两个数字数值就能推出下一个数字数值</strong></p>
<p><strong>压缩状态后代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">fib</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(n&lt;<span class="number">2</span>) <span class="keyword">return</span> n;</span><br><span class="line">        <span class="type">int</span> dp0=<span class="number">0</span>; <span class="comment">//第一个数字</span></span><br><span class="line">        <span class="type">int</span> dp1=<span class="number">1</span>; <span class="comment">//第二个数字</span></span><br><span class="line">        <span class="type">int</span> sum=<span class="number">0</span>; <span class="comment">//要求的值</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            sum=dp0+dp1; <span class="comment">//当前数值是前两个数字之和</span></span><br><span class="line">            dp0=dp1; <span class="comment">//将第一个数字数值更新成第二个数字数值</span></span><br><span class="line">            dp1=sum; <span class="comment">//将第二个数字数值更新成当前数字值，更新数据用于求下一个数值</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>






        <h3 id="70-爬楼梯"   >
          <a href="#70-爬楼梯" class="heading-link"><i class="fas fa-link"></i></a><a href="#70-爬楼梯" class="headerlink" title="70.爬楼梯"></a>70.爬楼梯</h3>
      <p>假设你正在爬楼梯。需要 <code>n</code> 阶你才能到达楼顶。</p>
<p>每次你可以爬 <code>1</code> 或 <code>2</code> 个台阶。你有多少种不同的方法可以爬到楼顶呢？</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/climbing-stairs/description/" >Leetcode.70题(easy)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h4 id="第一次做-1"   >
          <a href="#第一次做-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-1" class="headerlink" title="第一次做"></a>第一次做</h4>
      <p>第一次做于23&#x2F;10&#x2F;14</p>

        <h5 id="第一次代码-1"   >
          <a href="#第一次代码-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-1" class="headerlink" title="第一次代码"></a>第一次代码</h5>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">climbStairs</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(n&lt;<span class="number">2</span>) <span class="keyword">return</span> n;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> dp0=<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> dp1=<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            sum=dp0+dp1;</span><br><span class="line">            dp0=dp1;</span><br><span class="line">            dp1=sum;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h6 id="提交成功-1"   >
          <a href="#提交成功-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-1" class="headerlink" title="提交成功"></a>提交成功</h6>
      
        <h4 id="题解-1"   >
          <a href="#题解-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-1" class="headerlink" title="题解"></a>题解</h4>
      <p>思想：这道题和斐波那契数本质上是一样的，只是在分析这道题的题意的时候要推导出<strong>递推公式</strong></p>
<p><strong>实现</strong></p>
<ul>
<li><p>动态规划五部曲</p>
<ul>
<li><p>确定dp数组以及下标的含义：dp[i]是走到第i个台阶有几种方法，下标i对应第n个台阶</p>
</li>
<li><p>确定递推公式</p>
<p>第i阶台阶的走法由第i-1阶台阶以及第i-2阶台阶方法之和：</p>
<ul>
<li>达到第i阶台阶：第i-1阶台阶只走一步，第i-2阶台阶只走两步</li>
<li>也即第i阶台阶&#x3D;第i-1阶台阶方法×（1）+第i-2阶台阶方法× （1），例如i&#x3D;3，那么到达第三阶台阶只有第二阶台阶方法再走一步以及第一阶台阶走两步</li>
</ul>
<p>也即递推公式：<br>$$<br>F(n)&#x3D;F(n-1)+F(n-2)<br>$$</p>
</li>
<li><p>dp数组如何初始化：第一阶台阶只有一种方法dp1&#x3D;1，第二阶台阶只有两种方法dp2&#x3D;2</p>
</li>
<li><p>遍历顺序：从前向后，因为后一阶台阶都由前面两阶台阶方法确定</p>
</li>
<li><p>打印dp数组</p>
</li>
</ul>
</li>
<li><p>检验台阶n的有效性：n&lt;&#x3D;2的时候直接返回n：<code>if(n&lt;=2) return n;</code></p>
</li>
<li><p>初始化dp数组：因为第0阶台阶毫无意义，所以我们只要初始化第一阶和第二阶台阶数值：<code>dp1=1;dp2=2;</code></p>
</li>
<li><p>从第三阶台阶开始遍历，维护dp数组</p>
</li>
<li><p>返回第n阶台阶dp[n]</p>
</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">climbStairs</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(n&lt;=<span class="number">2</span>) <span class="keyword">return</span> n;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> dp1=<span class="number">1</span>; <span class="comment">//第一阶一种方法</span></span><br><span class="line">        <span class="type">int</span> dp2=<span class="number">2</span>; <span class="comment">//第二阶两种方法</span></span><br><span class="line">        <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    	<span class="comment">//从第三阶开始</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">3</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            sum=dp1+dp2;</span><br><span class="line">            dp1=dp2;</span><br><span class="line">            dp2=sum;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>




        <h3 id="746-使用最小花费爬楼梯"   >
          <a href="#746-使用最小花费爬楼梯" class="heading-link"><i class="fas fa-link"></i></a><a href="#746-使用最小花费爬楼梯" class="headerlink" title="746.使用最小花费爬楼梯"></a>746.使用最小花费爬楼梯</h3>
      <p>给你一个整数数组 <code>cost</code> ，其中 <code>cost[i]</code> 是从楼梯第 <code>i</code> 个台阶向上爬需要支付的费用。一旦你支付此费用，即可选择向上爬一个或者两个台阶。</p>
<p>你可以选择从下标为 <code>0</code> 或下标为 <code>1</code> 的台阶开始爬楼梯。</p>
<p>请你计算并返回达到楼梯顶部的最低花费。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/min-cost-climbing-stairs/description/" >Leetcode.746题(easy)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h4 id="第一次做-2"   >
          <a href="#第一次做-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-2" class="headerlink" title="第一次做"></a>第一次做</h4>
      <p>第一次做于23&#x2F;10&#x2F;14</p>

        <h5 id="第一次代码-2"   >
          <a href="#第一次代码-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-2" class="headerlink" title="第一次代码"></a>第一次代码</h5>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minCostClimbingStairs</span><span class="params">(<span class="type">int</span>[] cost)</span> &#123;</span><br><span class="line">        <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=cost.length;i&gt;=<span class="number">2</span>;)&#123;</span><br><span class="line">            <span class="keyword">if</span>(cost[i-<span class="number">1</span>]&lt;cost[i-<span class="number">2</span>])&#123;</span><br><span class="line">                sum+=cost[i-<span class="number">1</span>];</span><br><span class="line">                i--;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                sum+=cost[i-<span class="number">2</span>];</span><br><span class="line">                i=i-<span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h6 id="提交失败"   >
          <a href="#提交失败" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败" class="headerlink" title="提交失败"></a>提交失败</h6>
      <p>CASE:</p>
<p>cost&#x3D;[0,2,2,1]</p>
<p>输出：3</p>
<p>预期输出：2</p>

        <h5 id="第二次代码"   >
          <a href="#第二次代码" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码" class="headerlink" title="第二次代码"></a>第二次代码</h5>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minCostClimbingStairs</span><span class="params">(<span class="type">int</span>[] cost)</span> &#123;</span><br><span class="line">        </span><br><span class="line">    	<span class="comment">//维护Cost[i]表示跳到当前位置i所需的最小花费之和</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;cost.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(cost[i-<span class="number">1</span>]&lt;cost[i-<span class="number">2</span>])&#123;</span><br><span class="line">                cost[i]=cost[i]+cost[i-<span class="number">1</span>];</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                cost[i]=cost[i]+cost[i-<span class="number">2</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    	</span><br><span class="line">    	<span class="comment">//因为顶楼可以由倒数第一阶台阶跳一格和倒数第二阶跳两格，所以从两者花费较少的一个达到</span></span><br><span class="line">        <span class="keyword">if</span>(cost[cost.length-<span class="number">2</span>]&lt;cost[cost.length-<span class="number">1</span>])&#123;</span><br><span class="line">            <span class="keyword">return</span> cost[cost.length-<span class="number">2</span>];</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> cost[cost.length-<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h6 id="提交成功-2"   >
          <a href="#提交成功-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-2" class="headerlink" title="提交成功"></a>提交成功</h6>
      
        <h4 id="题解-2"   >
          <a href="#题解-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-2" class="headerlink" title="题解"></a>题解</h4>
      <p>思路：这道题由前面爬楼梯题目结合了体力值，本质上还是爬楼梯那道题目，但是这里的区别还有在于楼顶在于多少，例如cost&#x3D;{10,15,20}，cost.length&#x3D;&#x3D;3,那么楼顶在下标为3的位置，也即[10,15,20,楼顶]</p>
<p><strong>实现</strong></p>
<ul>
<li><p>动态规划五部曲</p>
<ul>
<li><p>确定dp数组以及下标的含义：dp[i]是对应下标i的<strong>最小体力耗费</strong>，i对应台阶位置</p>
</li>
<li><p>确定递推公式</p>
<p>第i个台阶的最小花费在dp[i-1]+cost[i-1]和dp[i-2]+cost[i-2]之间的最小值<br>$$<br>F(n)&#x3D;Math.min(F(n-1)+cost[n-1],F(n-2)+cost[n-2])<br>$$</p>
</li>
<li><p>初始化dp数组：dp[0]&#x3D;0，dp[1]&#x3D;0，因为可以选择从0或者1台阶开始跳，所以选择的时候花费为0，也即站在0台阶或者1台阶的时候不需要体力消耗</p>
</li>
<li><p>遍历顺序：从前向后，后面的台阶一定是前两个台阶走上来的，所以后一个状态一定能从前两个台阶状态确定</p>
</li>
<li><p>打印dp数组</p>
</li>
</ul>
</li>
<li><p>初始化dp数组，dp&#x3D;0，dp1&#x3D;0，dpi&#x3D;0</p>
</li>
<li><p>遍历cost数组，到达第i个台阶体力消耗是前两个台阶的最小体力消耗加上对应的跳跃消耗：</p>
<p><code>dpi=Math.min(dp0+cost[i-2],dp1+cost[i-1])</code></p>
<p>更新dp0和dp1，<code>dp0=dp1;dp1=dpi;</code></p>
</li>
</ul>
<p>因为顶楼在数组外面，所以达到顶楼之后不需要花费，直接返回dpI</p>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minCostClimbingStairs</span><span class="params">(<span class="type">int</span>[] cost)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> dp0=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> dp1=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> dpi=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=cost.length;i++)&#123;</span><br><span class="line">            dpi=Math.min(dp0+cost[i-<span class="number">2</span>],dp1+cost[i-<span class="number">1</span>]);</span><br><span class="line">            dp0=dp1;</span><br><span class="line">            dp1=dpi;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp1;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>




        <h1 id="总结"   >
          <a href="#总结" class="heading-link"><i class="fas fa-link"></i></a><a href="#总结" class="headerlink" title="总结"></a>总结</h1>
      </div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2023/09/29/%E7%9F%A5%E5%85%B6%E7%84%B6,%E7%9F%A5%E5%85%B6%E6%89%80%E4%BB%A5%E7%84%B6%E4%B9%8BJAVA%E8%99%9A%E6%8B%9F%E6%9C%BA-JVM%E7%AF%87%5B1%5D/">知其然,知其所以然之JAVA虚拟机-JVM篇[1]</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2023-09-29</span></span><span class="post-meta-item post-meta-item--wordcount"><span class="post-meta-item__icon"><i class="far fa-file-word"></i></span><span class="post-meta-item__info">字数统计</span><span class="post-meta-item__value">63</span></span><span class="post-meta-item post-meta-item--readtime"><span class="post-meta-item__icon"><i class="far fa-clock"></i></span><span class="post-meta-item__info">阅读时长</span><span class="post-meta-item__value">1分</span></span></div></header><div class="post-body"><div class="post-excerpt"><h1 id=""><a href="#" class="headerlink" title="&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;"></a>&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</h1>
        <h2 id="字节码篇"   >
          <a href="#字节码篇" class="heading-link"><i class="fas fa-link"></i></a><a href="#字节码篇" class="headerlink" title="字节码篇"></a>字节码篇</h2>
      <p>说说JVM的生命周期？</p>
<p>什么是JAVA虚拟机?</p>
<p>jvm的组成-》尽量手能画出来</p>
<p>为什么要使用JVM虚拟机？</p>
<p>说说Java虚拟机的体系结构？  </p>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2023/09/29/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B-JUC%E7%AF%87%5B6-%E5%B9%B6%E5%8F%91%E5%AE%B9%E5%99%A8%5D/">深入剖析并发编程-JUC篇[6.并发容器]</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2023-09-29</span></span><span class="post-meta-item post-meta-item--wordcount"><span class="post-meta-item__icon"><i class="far fa-file-word"></i></span><span class="post-meta-item__info">字数统计</span><span class="post-meta-item__value">0</span></span><span class="post-meta-item post-meta-item--readtime"><span class="post-meta-item__icon"><i class="far fa-clock"></i></span><span class="post-meta-item__info">阅读时长</span><span class="post-meta-item__value">1分</span></span></div></header><div class="post-body"><div class="post-excerpt"></div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2023/09/26/%E6%AD%BB%E4%B9%8B%E5%89%8D%E8%A6%81%E5%81%9A%E5%AE%8C%E7%9A%84%E7%AE%97%E6%B3%95%E6%89%8B%E5%86%8C-%5B8.%E8%B4%AA%E5%BF%83%E7%AE%97%E6%B3%95%5D/">死之前要做完的算法手册-[8.贪心算法]</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2023-09-26</span></span><span class="post-meta-item post-meta-item--wordcount"><span class="post-meta-item__icon"><i class="far fa-file-word"></i></span><span class="post-meta-item__info">字数统计</span><span class="post-meta-item__value">17.3k</span></span><span class="post-meta-item post-meta-item--readtime"><span class="post-meta-item__icon"><i class="far fa-clock"></i></span><span class="post-meta-item__info">阅读时长</span><span class="post-meta-item__value">145分</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h1 id="贪心算法"   >
          <a href="#贪心算法" class="heading-link"><i class="fas fa-link"></i></a><a href="#贪心算法" class="headerlink" title="贪心算法"></a>贪心算法</h1>
      
        <h2 id="贪心算法理论基础"   >
          <a href="#贪心算法理论基础" class="heading-link"><i class="fas fa-link"></i></a><a href="#贪心算法理论基础" class="headerlink" title="贪心算法理论基础"></a>贪心算法理论基础</h2>
      <p>贪心算法就是由<strong>局部最优解推出全局最优解</strong>，并且没有反例。</p>
<p>比如取钞票取十张，那么怎么样才能取到总数最大的呢？</p>
<p>也即每次都取最大面额(100)的钞票，那么一共取十张就是一个总数最大的一个结果</p>
<p>贪心也类似于我们的常识性的解决方案，所以实际上没有一个必然的套路，我们从题目开始做起学习</p>

        <h2 id="455-分发饼干"   >
          <a href="#455-分发饼干" class="heading-link"><i class="fas fa-link"></i></a><a href="#455-分发饼干" class="headerlink" title="455.分发饼干"></a>455.分发饼干</h2>
      <p>假设你是一位很棒的家长，想要给你的孩子们一些小饼干。但是，每个孩子最多只能给一块饼干。</p>
<p>对每个孩子 <code>i</code>，都有一个胃口值 <code>g[i]</code>，这是能让孩子们满足胃口的饼干的最小尺寸；并且每块饼干 <code>j</code>，都有一个尺寸 <code>s[j]</code> 。如果 <code>s[j] &gt;= g[i]</code>，我们可以将这个饼干 <code>j</code> 分配给孩子 <code>i</code> ，这个孩子会得到满足。你的目标是尽可能满足越多数量的孩子，并输出这个最大数值。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/assign-cookies/" >Leetcode.455(easy)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做"   >
          <a href="#第一次做" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;09&#x2F;27</p>

        <h4 id="第一次代码"   >
          <a href="#第一次代码" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findContentChildren</span><span class="params">(<span class="type">int</span>[] g, <span class="type">int</span>[] s)</span> &#123;</span><br><span class="line">        Arrays.sort(g);</span><br><span class="line">        Arrays.sort(s);</span><br><span class="line">        <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;g.length&amp;&amp;i&lt;s.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(g[i]&lt;=s[i])</span><br><span class="line">            sum++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败"   >
          <a href="#提交失败" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:g&#x3D;[10,9,8,7] s&#x3D;[5,6,7,8] 输出0 预期输出2</p>
<p>原因是这饼干小的时候没有发出饼干，然后直接把这个对应的小朋友i给丢弃了，而后面有符合胃口大小的饼干</p>

        <h4 id="第二次代码"   >
          <a href="#第二次代码" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findContentChildren</span><span class="params">(<span class="type">int</span>[] g, <span class="type">int</span>[] s)</span> &#123;</span><br><span class="line">        Arrays.sort(g);</span><br><span class="line">        Arrays.sort(s);</span><br><span class="line">        <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>,j=<span class="number">0</span>;i&lt;g.length &amp;&amp; j&lt;s.length;)&#123;</span><br><span class="line">            <span class="keyword">if</span>(g[i]&lt;=s[j])</span><br><span class="line">            &#123;</span><br><span class="line">                sum++;</span><br><span class="line">                i++;</span><br><span class="line">                j++;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功"   >
          <a href="#提交成功" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解"   >
          <a href="#题解" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解" class="headerlink" title="题解"></a>题解</h3>
      <p>思路：将小孩按胃口从小到大排序，饼干大小从大到小排序。然后喂小孩的时候就喂最小能满足胃口的饼干即可</p>
<blockquote>
<p>局部最优解：每个小孩只吃比自己胃口相等或者比胃口大的饼干，并且是从小胃口开始投喂，大胃口就一直饿着</p>
</blockquote>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findContentChildren</span><span class="params">(<span class="type">int</span>[] g, <span class="type">int</span>[] s)</span> &#123;</span><br><span class="line">     	<span class="comment">//小孩和饼干排序</span></span><br><span class="line">    	Arrays.sort(g);</span><br><span class="line">        Arrays.sort(s);</span><br><span class="line">        <span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    	<span class="comment">/**</span></span><br><span class="line"><span class="comment">    		循环</span></span><br><span class="line"><span class="comment">    			参数i控制的是小孩</span></span><br><span class="line"><span class="comment">    			参数j控制的是饼干</span></span><br><span class="line"><span class="comment">    	*/</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>,j=<span class="number">0</span>;i&lt;g.length &amp;&amp; j&lt;s.length;)&#123;</span><br><span class="line">            <span class="comment">//判断饼干大小是否满足小孩胃口</span></span><br><span class="line">            <span class="keyword">if</span>(g[i]&lt;=s[j])</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//满足胃口则投喂成功，指向下一个小孩</span></span><br><span class="line">                count++;</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//指向下一个饼干</span></span><br><span class="line">            j++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="376-摆动序列"   >
          <a href="#376-摆动序列" class="heading-link"><i class="fas fa-link"></i></a><a href="#376-摆动序列" class="headerlink" title="376.摆动序列"></a>376.摆动序列</h2>
      <p>如果连续数字之间的差严格地在正数和负数之间交替，则数字序列称为 <strong>摆动序列 。</strong>第一个差（如果存在的话）可能是正数或负数。仅有一个元素或者含两个不等元素的序列也视作摆动序列。</p>
<ul>
<li>例如， <code>[1, 7, 4, 9, 2, 5]</code> 是一个 <strong>摆动序列</strong> ，因为差值 <code>(6, -3, 5, -7, 3)</code> 是正负交替出现的。</li>
<li>相反，<code>[1, 4, 7, 2, 5]</code> 和 <code>[1, 7, 4, 5, 5]</code> 不是摆动序列，第一个序列是因为它的前两个差值都是正数，第二个序列是因为它的最后一个差值为零。</li>
</ul>
<p><strong>子序列</strong> 可以通过从原始序列中删除一些（也可以不删除）元素来获得，剩下的元素保持其原始顺序。</p>
<p>给你一个整数数组 <code>nums</code> ，返回 <code>nums</code> 中作为 <strong>摆动序列</strong> 的 <strong>最长子序列的长度</strong> 。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/wiggle-subsequence/" >Leetcode.376题(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-1"   >
          <a href="#第一次做-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-1" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;09&#x2F;27</p>

        <h4 id="第一次代码-1"   >
          <a href="#第一次代码-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-1" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">wiggleMaxLength</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line">       <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;nums.length;i++)&#123;</span><br><span class="line">           <span class="keyword">if</span>(i==<span class="number">0</span>)&#123;</span><br><span class="line">               count++;</span><br><span class="line">               <span class="keyword">continue</span>;</span><br><span class="line">           &#125;<span class="keyword">else</span> <span class="keyword">if</span>(i==nums.length-<span class="number">1</span>)&#123;</span><br><span class="line">               count++;</span><br><span class="line">               <span class="keyword">continue</span>;</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="keyword">if</span>( (nums[i]-nums[i-<span class="number">1</span>])*(nums[i+<span class="number">1</span>]-nums[i])&lt;<span class="number">0</span>  )&#123;</span><br><span class="line">               count++;</span><br><span class="line">           &#125; </span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-1"   >
          <a href="#提交失败-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-1" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:输入nums[0,0] ,输出2 预期输出1</p>

        <h4 id="第二次代码-1"   >
          <a href="#第二次代码-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码-1" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">wiggleMaxLength</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line">       <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;nums.length;i++)&#123;</span><br><span class="line">           <span class="keyword">if</span>(i==<span class="number">0</span>)&#123;</span><br><span class="line">               <span class="keyword">if</span>(nums.length!=<span class="number">1</span> &amp;&amp; nums[i+<span class="number">1</span>]-nums[i]==<span class="number">0</span>)&#123;</span><br><span class="line">                   <span class="keyword">continue</span>;</span><br><span class="line">               &#125;</span><br><span class="line">               count++;</span><br><span class="line">               <span class="keyword">continue</span>;</span><br><span class="line">           &#125;<span class="keyword">else</span> <span class="keyword">if</span>(i==nums.length-<span class="number">1</span>)&#123;</span><br><span class="line">               count++;</span><br><span class="line">               <span class="keyword">continue</span>;</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="keyword">if</span>( (nums[i]-nums[i-<span class="number">1</span>])*(nums[i+<span class="number">1</span>]-nums[i])&lt;<span class="number">0</span>  )&#123;</span><br><span class="line">               count++;</span><br><span class="line">           &#125; </span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-2"   >
          <a href="#提交失败-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-2" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:输出nums&#x3D;[3,3,3,2,5]，输出2，预期输出3</p>

        <h4 id="第三次代码"   >
          <a href="#第三次代码" class="heading-link"><i class="fas fa-link"></i></a><a href="#第三次代码" class="headerlink" title="第三次代码"></a>第三次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">wiggleMaxLength</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line">       <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;nums.length;i++)&#123;</span><br><span class="line">           <span class="keyword">if</span>(i==<span class="number">0</span>)&#123;</span><br><span class="line">               count++;</span><br><span class="line">               <span class="keyword">continue</span>;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">if</span>(nums[i]==nums[i-<span class="number">1</span>]) <span class="keyword">continue</span>;</span><br><span class="line">           <span class="keyword">if</span>(i==nums.length-<span class="number">1</span>)&#123;</span><br><span class="line">               count++;</span><br><span class="line">               <span class="keyword">continue</span>;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">if</span>( (nums[i]-nums[i-<span class="number">1</span>])*(nums[i+<span class="number">1</span>]-nums[i])&lt;<span class="number">0</span>  )&#123;</span><br><span class="line">               count++;</span><br><span class="line">           &#125; </span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-3"   >
          <a href="#提交失败-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-3" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:nums&#x3D;[51,226,208,165,202,286,190,212,219,271,36,245,20,238,238,89,105,66,73,9,254,206,221,237,203,33,249,253,150,102,57,249,203,10,123,178,85,203,35,276,129,116,37,163,99,142,187,249,134,77,217,298,29,127,174,115,122,178,12,80,122,76,16,41,115,84,104,121,127,40,287,129,9,172,112,51,40,135,205,53,259,196,248,5,123,184,209,130,271,42,18,143,24,101,10,273,252,50,173,80,119,129,45,257,299,78,278,78,190,215,284,129,200,232,103,97,167,120,49,298,141,146,154,233,214,196,244,50,110,48,152,82,226,26,254,276,292,286,215,56,128,122,82,241,222,12,272,192,224,136,116,70,39,207,295,49,194,90,210,123,271,18,276,87,177,240,276,33,155,200,51,6,212,36,149,202,48,114,58,91,83,221,175,148,278,300,284,86,191,95,77,215,113,257,153,135,217,76,85,269,126,194,199,195,20,204,194,50,220,228,90,221,256,87,157,246,74,156,9,196,16,259,234,79,31,206,148,12,223,151,96,229,165,9,144,26,255,201,33,89,145,155,1,204,37,107,80,212,88,186,254,9,158,180,24,45,158,100,52,131,71,174,229,236,296,299,184,168,41,45,76,68,122,85,292,238,293,179,143,128,47,87,267,53,187,76,292,0,160,70,172,292,9,64,156,153,26,145,196,222]</p>
<p>输出201 预期输出202</p>

        <h4 id="第四次代码"   >
          <a href="#第四次代码" class="heading-link"><i class="fas fa-link"></i></a><a href="#第四次代码" class="headerlink" title="第四次代码"></a>第四次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">wiggleMaxLength</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line">       <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;nums.length;i++)&#123;</span><br><span class="line">           <span class="keyword">if</span>(i==<span class="number">0</span>)&#123;</span><br><span class="line">               <span class="keyword">while</span>(i&lt;nums.length-<span class="number">1</span> &amp;&amp; nums[i+<span class="number">1</span>]==nums[i])&#123;</span><br><span class="line">                   i++;</span><br><span class="line">                   <span class="keyword">continue</span>;</span><br><span class="line">               &#125;</span><br><span class="line">               count++;</span><br><span class="line">               <span class="keyword">continue</span>;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">if</span>(i==nums.length-<span class="number">1</span>)&#123;</span><br><span class="line">               </span><br><span class="line">               count++;</span><br><span class="line">               <span class="keyword">continue</span>;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">if</span>( (nums[i]-nums[i-<span class="number">1</span>])*(nums[i+<span class="number">1</span>]-nums[i])&lt;<span class="number">0</span> )&#123;</span><br><span class="line">               count++;</span><br><span class="line">           &#125;<span class="keyword">else</span> <span class="keyword">if</span>(nums[i]==nums[i-<span class="number">1</span>] &amp;&amp; nums[i]!=nums[i+<span class="number">1</span>])&#123;</span><br><span class="line">               count++;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-4"   >
          <a href="#提交失败-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-4" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>没能自己做出来</p>

        <h3 id="题解-1"   >
          <a href="#题解-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-1" class="headerlink" title="题解"></a>题解</h3>
      <p>思路：我们只要手机前后坡度不一样的结点，也即波峰或者波谷，然后统计波峰波谷的个数，最后返回个数即可</p>
<blockquote>
<p>局部最优解：每次统计的结点都在波峰或者波谷</p>
</blockquote>
<ul>
<li>情形1：具有单调坡，比如[3,7,2,5,6,8,3]，那么本题解的个数也即5，在单调坡上的元素不能算在内</li>
</ul>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="https://images-kkblog.oss-cn-hangzhou.aliyuncs.com/image-20230927194251615.png"  alt="具有单调坡">
      </p>
<ul>
<li>情形2：只有两个元素，而这又分两种情况<ul>
<li>两个元素不同，如[3,4]，那么摆动序列的长度为2</li>
</ul>
</li>
</ul>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="https://images-kkblog.oss-cn-hangzhou.aliyuncs.com/image-20230927194627710.png"  alt="两个元素不同">
      </p>
<ul>
<li><ul>
<li>两个元素相同，如[3,3]，那么摆动序列的长度为1</li>
</ul>
</li>
</ul>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="https://images-kkblog.oss-cn-hangzhou.aliyuncs.com/image-20230927194906277.png"  alt="两个元素相同">
      </p>
<p>也即我们当<strong>碰到坡度为0的元素的时候只要处理最后一个元素即可</strong></p>
<ul>
<li><p>情况3：单调坡有平坡的情况</p>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="https://images-kkblog.oss-cn-hangzhou.aliyuncs.com/image-20230927195612985.png"  alt="单调坡有平坡">
      </p>
<p>我们在更新prediff的时候一定要在拐点更新，这样我们后面再统计的时候才不会将5统计进去</p>
</li>
</ul>
<p><strong>实现</strong></p>
<ul>
<li>设置长度count&#x3D;1，也即nums最后一个元素默认算一个长度</li>
<li>设置前坡度prediff&#x3D;0，假设第一个元素之前坡度为0</li>
<li>循环遍历(i,nums.length-1)，因为最后一个元素默认算一个长度<ul>
<li>计算当前坡度culdiff&#x3D;nums[i+1]-nums[i]</li>
<li>当峰值的时候统计个数，并且将前坡度更新成当前坡度<ul>
<li>prediff&lt;&#x3D;0 &amp;&amp; culdiff&gt;0 也即前面是下坡或者平坡后面是上坡，也即峰谷</li>
<li>prediff&gt;&#x3D;0 &amp;&amp; culdiff&lt;0 也即前面是上坡或者平坡后面是下坡，也即峰顶</li>
</ul>
</li>
</ul>
</li>
<li>返回count</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">wiggleMaxLength</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> count=<span class="number">1</span>; <span class="comment">//默认最后一个元素也算一个</span></span><br><span class="line">      	<span class="comment">//默认前面坡度为0</span></span><br><span class="line">    	<span class="type">int</span> prediff=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(nums.length==<span class="number">1</span>) <span class="keyword">return</span> count;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;nums.length-<span class="number">1</span>;i++)&#123;</span><br><span class="line">            <span class="comment">//计算当前结点后面坡度</span></span><br><span class="line">            <span class="type">int</span> culdiff=nums[i+<span class="number">1</span>]-nums[i];</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//满足峰值的结点</span></span><br><span class="line">            <span class="keyword">if</span>((prediff&lt;=<span class="number">0</span> &amp;&amp; culdiff&gt;<span class="number">0</span>) ||(prediff&gt;=<span class="number">0</span> &amp;&amp; culdiff&lt;<span class="number">0</span>) )&#123;</span><br><span class="line">                count++;</span><br><span class="line">   				<span class="comment">//将当前坡度更新到前面坡度</span></span><br><span class="line">                prediff=culdiff;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="53-最大子数组和"   >
          <a href="#53-最大子数组和" class="heading-link"><i class="fas fa-link"></i></a><a href="#53-最大子数组和" class="headerlink" title="53.最大子数组和"></a>53.最大子数组和</h2>
      <p>给你一个整数数组 <code>nums</code> ，请你找出一个具有最大和的连续子数组（子数组最少包含一个元素），返回其最大和。</p>
<p><strong>子数组</strong> 是数组中的一个连续部分。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/maximum-subarray/" >Leetcode.53(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-2"   >
          <a href="#第一次做-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-2" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;09&#x2F;28</p>

        <h4 id="第一次代码-2"   >
          <a href="#第一次代码-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-2" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxSubArray</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(nums.length==<span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> max=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> prediff=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;nums.length-<span class="number">1</span>;i++)&#123;</span><br><span class="line">            <span class="type">int</span> culdiff=nums[i+<span class="number">1</span>]-nums[i];</span><br><span class="line">            <span class="keyword">if</span>(prediff&gt;=<span class="number">0</span> &amp;&amp; nums[i]&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                sum+=nums[i];</span><br><span class="line">                <span class="keyword">if</span>(sum&gt;max)&#123;</span><br><span class="line">                    max=sum;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(culdiff&lt;<span class="number">0</span>)&#123;</span><br><span class="line">                sum=<span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            prediff=culdiff;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(nums[nums.length-<span class="number">1</span>]&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            sum+=nums[nums.length-<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Math.max(sum,max);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-5"   >
          <a href="#提交失败-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-5" class="headerlink" title="提交失败"></a>提交失败</h5>
      
        <h4 id="第二次代码-2"   >
          <a href="#第二次代码-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码-2" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxSubArray</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(nums.length==<span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> max=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;nums.length-<span class="number">1</span>;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[i]&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                sum+=nums[i];</span><br><span class="line">                <span class="keyword">if</span>(sum&gt;max)&#123;</span><br><span class="line">                    max=sum;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(nums[i+<span class="number">1</span>]&lt;<span class="number">0</span>)&#123;</span><br><span class="line">                sum=<span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(nums[nums.length-<span class="number">1</span>]&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            sum+=nums[nums.length-<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Math.max(sum,max);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>




        <h5 id="提交失败-6"   >
          <a href="#提交失败-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-6" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>题意理解错误，这道题是连续子数组，也即可以是负数算在内</p>

        <h4 id="第三次代码-1"   >
          <a href="#第三次代码-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#第三次代码-1" class="headerlink" title="第三次代码"></a>第三次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxSubArray</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(nums.length==<span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> max=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;nums.length-<span class="number">1</span>;i++)&#123;</span><br><span class="line">            sum+=nums[i];</span><br><span class="line">            <span class="keyword">if</span>(sum&lt;<span class="number">0</span>)&#123;</span><br><span class="line">                sum=<span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(nums[nums.length-<span class="number">1</span>]&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            sum+=nums[nums.length-<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Math.max(sum,max);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-7"   >
          <a href="#提交失败-7" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-7" class="headerlink" title="提交失败"></a>提交失败</h5>
      
        <h4 id="第四次代码-1"   >
          <a href="#第四次代码-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#第四次代码-1" class="headerlink" title="第四次代码"></a>第四次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxSubArray</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(nums.length==<span class="number">1</span>) <span class="keyword">return</span> nums[<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> max=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> Nmax=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>,j=<span class="number">0</span>;i&lt;nums.length-<span class="number">1</span>;)&#123;</span><br><span class="line">            sum+=nums[i];</span><br><span class="line">            <span class="keyword">if</span>(sum&lt;<span class="number">0</span>)&#123;</span><br><span class="line">                sum=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">if</span>(i!=j&amp;&amp;Nmax+nums[i]&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                    i=j;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(nums[i]&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(nums[i]&gt;Nmax)&#123;</span><br><span class="line">                    j=i;</span><br><span class="line">                    Nmax=nums[i];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(sum&gt;max)&#123;</span><br><span class="line">                    max=sum;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(nums[nums.length-<span class="number">1</span>]&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            sum+=nums[nums.length-<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Math.max(sum,max);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-8"   >
          <a href="#提交失败-8" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-8" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:nums[-2，-1]，输出0，预期输出-1</p>
<p>没做出来</p>

        <h3 id="题解-2"   >
          <a href="#题解-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-2" class="headerlink" title="题解"></a>题解</h3>
      <p>这道题在第一次做的第三次代码中差一点写出来了，只是还差了一些思路上的问题，也许当时不该看2023年杭州亚运会的英雄联盟项目</p>
<p>思路：当我们在获取连续和为负数的情况，我们不妨让连续和置零，让下一个数成为我们连续子数组和的起始位置，也即<strong>当连续和已经小于0了那么无论怎么样它都会拖累我们后面的数，只能让后面的数字变小</strong>，所以我们当连续和为负数的时候不妨直接丢弃，取下一个数的数值成为连续和</p>
<blockquote>
<p>局部最优解：当连续和为正数的时候继续积累，当连续和为负数的时候丢弃</p>
</blockquote>
<p><strong>实现</strong></p>
<ul>
<li><p>定义变量sum：用于统计当前连续和</p>
</li>
<li><p>定义变量max：用于记录连续和的最大值，注意：<strong>这里max初始化为Integer.MIN_VALUE，当最大连续和是负数的时候也会统计</strong></p>
</li>
<li><p>循环遍历数组</p>
<ul>
<li>取得当前连续和sum+&#x3D;num[i]</li>
<li>如果sum&gt;max，也即是当前连续和最大，将max&#x3D;sum</li>
<li>如果sum&lt;0，说明sum会拖累以后的元素，让后面的连续和变小，所以直接丢弃，sum&#x3D;0</li>
</ul>
</li>
<li><p>返回统计值max</p>
</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxSubArray</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">  </span><br><span class="line">        <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> max=Integer.MIN_VALUE;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;nums.length;i++)&#123;</span><br><span class="line">            sum+=nums[i];</span><br><span class="line">            <span class="comment">//记录最大的连续和</span></span><br><span class="line">            <span class="keyword">if</span>(sum&gt;max) max=sum;</span><br><span class="line">            <span class="comment">//当连续和为负数</span></span><br><span class="line">            <span class="keyword">if</span>(sum&lt;<span class="number">0</span>) sum=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> max;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="122-买卖股票的最佳时机-II"   >
          <a href="#122-买卖股票的最佳时机-II" class="heading-link"><i class="fas fa-link"></i></a><a href="#122-买卖股票的最佳时机-II" class="headerlink" title="122.买卖股票的最佳时机 II"></a>122.买卖股票的最佳时机 II</h2>
      <p>给你一个整数数组 <code>prices</code> ，其中 <code>prices[i]</code> 表示某支股票第 <code>i</code> 天的价格。</p>
<p>在每一天，你可以决定是否购买和&#x2F;或出售股票。你在任何时候 <strong>最多</strong> 只能持有 <strong>一股</strong> 股票。你也可以先购买，然后在 <strong>同一天</strong> 出售。</p>
<p>返回 <em>你能获得的 <strong>最大</strong> 利润</em> 。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/best-time-to-buy-and-sell-stock-ii/description/" >Leetcode.122题(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-3"   >
          <a href="#第一次做-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-3" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;09&#x2F;30，中秋节快乐！</p>

        <h4 id="第一次代码-3"   >
          <a href="#第一次代码-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-3" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxProfit</span><span class="params">(<span class="type">int</span>[] prices)</span> &#123;</span><br><span class="line">        <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> buy=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> sell=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;prices.length-<span class="number">1</span>;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(buy==<span class="number">0</span>)&#123;</span><br><span class="line">                buy=prices[i];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(prices[i+<span class="number">1</span>]&gt;prices[i])&#123;</span><br><span class="line">                sell=prices[i+<span class="number">1</span>];</span><br><span class="line">                sum+=sell-buy;</span><br><span class="line">                buy=<span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-9"   >
          <a href="#提交失败-9" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-9" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:prices:[7,1,5,3,6,4],输出-1，预期输出7</p>
<p>我每次卖股票的时候都是卖掉了当天的，而实际上理论应该是下一天减去这一天，所以我当下一天贵的时候应该卖掉下一天的价格。如果下一天低的时候卖掉当天的价钱</p>

        <h4 id="第二次代码-3"   >
          <a href="#第二次代码-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码-3" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxProfit</span><span class="params">(<span class="type">int</span>[] prices)</span> &#123;</span><br><span class="line">        <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> buy=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> sell=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;prices.length-<span class="number">1</span>;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(buy==<span class="number">0</span>)&#123;</span><br><span class="line">                buy=prices[i];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(prices[i+<span class="number">1</span>]&gt;prices[i])&#123;</span><br><span class="line">                sell=prices[i+<span class="number">1</span>];</span><br><span class="line">                sum+=sell-buy;</span><br><span class="line">                buy=<span class="number">0</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                sell=prices[i];</span><br><span class="line">                buy=<span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-1"   >
          <a href="#提交成功-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-1" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-3"   >
          <a href="#题解-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-3" class="headerlink" title="题解"></a>题解</h3>
      <p>思路：我们可以假设每天都买卖股票，当下一天股票的价值超过当天价值，那么我们就卖出股票，然后记录下一天卖出股票的利润</p>
<p>如果下一天的股票没有超过当天的价值，那么我们当天就卖出当天购买的股票，也即利润为0，当利润大于0的时候我们记录利润，于是我们的最大利润就是每一天大于0的利润之和</p>
<blockquote>
<p>局部最优解：我们每一天利润大于0的时候统计利润，那么利润最大就是所有利润大于0的总和</p>
</blockquote>
<p><strong>实现</strong></p>
<p>我们获取每一天的股票价格和下一天的股票价格进行比较</p>
<ul>
<li>price[i+1]&gt;price[i]：说明利润大于0，我们要下一天卖出股票并且记录在总利润和之中</li>
<li>price[i+1]&lt;&#x3D;price[i]：说明利润小于等于0，我们每一天就卖出当天自己的股票即可</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxProfit</span><span class="params">(<span class="type">int</span>[] prices)</span> &#123;</span><br><span class="line">        <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> buy=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> sell=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;prices.length-<span class="number">1</span>;i++)&#123;</span><br><span class="line">            <span class="comment">//每一天买股票</span></span><br><span class="line">            buy=prices[i];</span><br><span class="line">            <span class="keyword">if</span>(prices[i+<span class="number">1</span>]&gt;prices[i])&#123;</span><br><span class="line">                <span class="comment">//卖出价为下一天的股票价格，统计利润</span></span><br><span class="line">                sell=prices[i+<span class="number">1</span>];</span><br><span class="line">                sum+=sell-buy;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//卖出价为当天的股票价格</span></span><br><span class="line">                sell=prices[i];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//卖出股票</span></span><br><span class="line">            buy=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>

<p><strong>简化之后</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxProfit</span><span class="params">(<span class="type">int</span>[] prices)</span> &#123;</span><br><span class="line">        <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">    	<span class="comment">//从第二天开始每天都卖前一天股票，当利润大于0的时候就记录</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;prices.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(prices[i]-prices[i-<span class="number">1</span>]&gt;<span class="number">0</span>) sum+=prices[i]-prices[i-<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>




        <h2 id="55-跳跃游戏"   >
          <a href="#55-跳跃游戏" class="heading-link"><i class="fas fa-link"></i></a><a href="#55-跳跃游戏" class="headerlink" title="55.跳跃游戏"></a>55.跳跃游戏</h2>
      <p>给你一个非负整数数组 <code>nums</code> ，你最初位于数组的 <strong>第一个下标</strong> 。数组中的每个元素代表你在该位置可以跳跃的最大长度。</p>
<p>判断你是否能够到达最后一个下标，如果可以，返回 <code>true</code> ；否则，返回 <code>false</code> 。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/jump-game/description/" >Leetcode.55题(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-4"   >
          <a href="#第一次做-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-4" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;09&#x2F;30</p>

        <h4 id="第一次代码-4"   >
          <a href="#第一次代码-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-4" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">canJump</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;nums.length;)&#123;</span><br><span class="line">            <span class="keyword">if</span>(sum+nums[i]&gt;=nums.length-<span class="number">1</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            <span class="type">int</span> step=nums[i];</span><br><span class="line">            <span class="keyword">if</span>(step==<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(--i==<span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                sum--;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            sum+=step;</span><br><span class="line">            i+=step;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-10"   >
          <a href="#提交失败-10" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-10" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>超过时间限制</p>

        <h4 id="第二次代码-4"   >
          <a href="#第二次代码-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码-4" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">canJump</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> step=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;nums.length;)&#123;</span><br><span class="line">            <span class="comment">//剪枝</span></span><br><span class="line">            <span class="keyword">if</span>(sum+nums[i]&gt;=nums.length-<span class="number">1</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            <span class="comment">//记录最大可以跳跃数</span></span><br><span class="line">            <span class="keyword">if</span>(nums[i]&gt;step)&#123;</span><br><span class="line">                step=nums[i];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//如果跳跃数为0且值为0那么就说明最大能到达的位置就是这里</span></span><br><span class="line">            <span class="keyword">if</span>(nums[i]==<span class="number">0</span> &amp;&amp; step==<span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">           	</span><br><span class="line">            <span class="comment">//向后跳一格，sum++ , step--，i++</span></span><br><span class="line">            sum++;</span><br><span class="line">            step--;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-2"   >
          <a href="#提交成功-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-2" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-4"   >
          <a href="#题解-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-4" class="headerlink" title="题解"></a>题解</h3>
      <p>思路：我们可以用一个step记录我们能跳的范围，然后我们一步一步跳，如果当前值大于step我们就更新我们的最大跳跃次数，如果我们跳到0的位置并且不能往后跳了就说明最大只能跳到0的位置</p>
<blockquote>
<p>局部最优解：我们每一次获取最大跳跃次数，如果能跳到最后就说明为true</p>
</blockquote>
<p><strong>实现</strong></p>
<ul>
<li>定义变量sum:用于记录跳跃了总范围</li>
<li>定义变量step：用于还可以跳几步</li>
<li>循环<ul>
<li>当sum+nums[i]&gt;nums.length-1也即一定能跳到最后位置，返回true</li>
<li>当nums[i]&gt;step:更新最大跳跃次数</li>
<li>当step&#x3D;&#x3D;0&amp;&amp;nums[i]&#x3D;&#x3D;0,也即跳到0的位置也没能力继续往后跳则返回false</li>
<li>sum++,step–,i++:一次跳一格，确保不遗漏</li>
</ul>
</li>
<li>循环结束还没跳到返回false</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">canJump</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> step=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;nums.length;)&#123;</span><br><span class="line">            <span class="comment">//剪枝</span></span><br><span class="line">            <span class="keyword">if</span>(sum+nums[i]&gt;=nums.length-<span class="number">1</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            <span class="comment">//记录最大可以跳跃数</span></span><br><span class="line">            <span class="keyword">if</span>(nums[i]&gt;step)&#123;</span><br><span class="line">                step=nums[i];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//如果跳跃数为0且值为0那么就说明最大能到达的位置就是这里</span></span><br><span class="line">            <span class="keyword">if</span>(nums[i]==<span class="number">0</span> &amp;&amp; step==<span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">           	</span><br><span class="line">            <span class="comment">//向后跳一格，sum++ , step--，i++</span></span><br><span class="line">            sum++;</span><br><span class="line">            step--;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>




        <h2 id="45-跳跃游戏II"   >
          <a href="#45-跳跃游戏II" class="heading-link"><i class="fas fa-link"></i></a><a href="#45-跳跃游戏II" class="headerlink" title="45.跳跃游戏II"></a>45.跳跃游戏II</h2>
      <p>给定一个长度为 <code>n</code> 的 <strong>0 索引</strong>整数数组 <code>nums</code>。初始位置为 <code>nums[0]</code>。</p>
<p>每个元素 <code>nums[i]</code> 表示从索引 <code>i</code> 向前跳转的最大长度。换句话说，如果你在 <code>nums[i]</code> 处，你可以跳转到任意 <code>nums[i + j]</code> 处:</p>
<ul>
<li><code>0 &lt;= j &lt;= nums[i]</code> </li>
<li><code>i + j &lt; n</code></li>
</ul>
<p>返回到达 <code>nums[n - 1]</code> 的最小跳跃次数。生成的测试用例可以到达 <code>nums[n - 1]</code>。</p>

        <h3 id="第一次做-5"   >
          <a href="#第一次做-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-5" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;10&#x2F;01</p>

        <h4 id="第一次代码-5"   >
          <a href="#第一次代码-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-5" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">jump</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> dept=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;nums.length;)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i+dept&gt;=nums.length-<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> count;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(nums[i]&gt;dept)&#123;</span><br><span class="line">                count++;</span><br><span class="line">                dept=nums[i];</span><br><span class="line">            &#125;</span><br><span class="line">            dept--;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-11"   >
          <a href="#提交失败-11" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-11" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:nums&#x3D;[7,0,9,6,9,6,1,7,9,0,1,2,9,0,3],输出4，预期输出2</p>

        <h4 id="第二次代码-5"   >
          <a href="#第二次代码-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码-5" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">jump</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;nums.length;)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i+nums[i]&gt;=nums.length-<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> count;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span>(nums[i]==<span class="number">0</span>)&#123;</span><br><span class="line">                i--;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            i+=nums[i];</span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>




        <h5 id="提交失败-12"   >
          <a href="#提交失败-12" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-12" class="headerlink" title="提交失败"></a>提交失败</h5>
      
        <h4 id="第三次代码-2"   >
          <a href="#第三次代码-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#第三次代码-2" class="headerlink" title="第三次代码"></a>第三次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">jump</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;nums.length;)&#123;</span><br><span class="line">            <span class="type">int</span> cover=nums[i];</span><br><span class="line">            <span class="keyword">if</span>(i&gt;=nums.length-<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> count;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">int</span> max=i;</span><br><span class="line">            <span class="type">int</span> index=i;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=i;j&lt;cover;j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(j+nums[cover]&gt;max)&#123;</span><br><span class="line">                    max=j+nums[cover];</span><br><span class="line">                    index=j;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            count++;</span><br><span class="line">            i=i+index;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-13"   >
          <a href="#提交失败-13" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-13" class="headerlink" title="提交失败"></a>提交失败</h5>
      
        <h4 id="第四次代码-2"   >
          <a href="#第四次代码-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#第四次代码-2" class="headerlink" title="第四次代码"></a>第四次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">jump</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(nums.length==<span class="number">1</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;nums.length;)&#123;</span><br><span class="line">            <span class="type">int</span> cover=nums[i];</span><br><span class="line">            <span class="keyword">if</span>(i+cover&gt;=nums.length-<span class="number">1</span>)&#123;</span><br><span class="line">                count++;</span><br><span class="line">                <span class="keyword">return</span> count;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">int</span> max=i;</span><br><span class="line">            <span class="type">int</span> index=i;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=i;j&lt;=cover;j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(j+nums[j]&gt;max)&#123;</span><br><span class="line">                    max=j+nums[j];</span><br><span class="line">                    index=j;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            count++;</span><br><span class="line">            i=index;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-14"   >
          <a href="#提交失败-14" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-14" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>超出时间限制</p>
<p>CASE:nums[1,1,1,1] </p>

        <h3 id="题解-5"   >
          <a href="#题解-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-5" class="headerlink" title="题解"></a>题解</h3>
      <p>思路：我们用两个覆盖范围，cul来代表当前一跳能到达的位置，next代表下一跳能达到的最大位置，在当前跳的范围中记录下一跳最大位置，如果当前跳能跳到数组的末尾，直接break返回result结果即可，如果当前跳跳不到末尾，那么就启动下一跳的最大位置</p>
<p><strong>实现</strong></p>
<ul>
<li>定义变量<ul>
<li>result：用于记录一共跳了几次</li>
<li>cul：用于表示当前跳的最大覆盖范围</li>
<li>next：用于表示下一跳的最大覆盖范围</li>
</ul>
</li>
<li>当nums.length&#x3D;&#x3D;1，也即只有一个元素，那么不用跳就能跳到末尾，return 0;</li>
<li>循环<ul>
<li>统计当前跳中下一跳能达到的最大覆盖位置next&#x3D;Math.max(i+nums[i],next)<ul>
<li>i+nums[i]表示当前i位置下的最大覆盖范围，和next比较，也即更新最大的覆盖范围给next</li>
</ul>
</li>
<li>如果i&#x3D;&#x3D;cul，也即跳到了当前跳的末尾<ul>
<li>如果cul!&#x3D;nums.length-1，也即当前跳跃跳不到数组的末尾，那么就启动下一跳<ul>
<li>cul&#x3D;next，更新cul为下一跳的最大覆盖范围</li>
<li>result++，表示多跳了一次</li>
<li>判断next是否能跳到数组末尾，如果是则break即可</li>
</ul>
</li>
<li>如果cul&#x3D;&#x3D;nums.length,也即当前跳跃能跳到数组的末尾，break</li>
</ul>
</li>
</ul>
</li>
<li>返回result</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">jump</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    	<span class="comment">//如果数组只有一个元素，那么不用跳</span></span><br><span class="line">        <span class="keyword">if</span>(nums.length==<span class="number">1</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    	<span class="comment">//result用于统计跳跃次数，cul用于当前覆盖范围，next表示下一跳覆盖范围</span></span><br><span class="line">        <span class="type">int</span> result=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> cul=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> next=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;nums.length;i++)&#123;</span><br><span class="line">            <span class="comment">//统计当前跳中最大的覆盖范围，作为下一跳的覆盖范围</span></span><br><span class="line">            next=Math.max(i+nums[i],next);</span><br><span class="line">            <span class="keyword">if</span>(i==cul)&#123;</span><br><span class="line">                <span class="comment">//没有覆盖数组的最后一个元素，也即当前一跳跳不到末尾</span></span><br><span class="line">                <span class="keyword">if</span>(cul!=nums.length-<span class="number">1</span>)&#123;</span><br><span class="line">                    cul=next;</span><br><span class="line">                    result++;</span><br><span class="line">                    <span class="comment">//如果下一跳跳到了break;</span></span><br><span class="line">                    <span class="keyword">if</span>(next&gt;=nums.length-<span class="number">1</span>) <span class="keyword">break</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="comment">//如果当前跳跳到了就break;</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>




        <h2 id="1005-K次取反后最大化的数组和"   >
          <a href="#1005-K次取反后最大化的数组和" class="heading-link"><i class="fas fa-link"></i></a><a href="#1005-K次取反后最大化的数组和" class="headerlink" title="1005.K次取反后最大化的数组和"></a>1005.K次取反后最大化的数组和</h2>
      <p>给你一个整数数组 <code>nums</code> 和一个整数 <code>k</code> ，按以下方法修改该数组：</p>
<ul>
<li>选择某个下标 <code>i</code> 并将 <code>nums[i]</code> 替换为 <code>-nums[i]</code> 。</li>
</ul>
<p>重复这个过程恰好 <code>k</code> 次。可以多次选择同一个下标 <code>i</code> 。</p>
<p>以这种方式修改数组后，返回数组 <strong>可能的最大和</strong> 。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/maximize-sum-of-array-after-k-negations/description/" >Leetcode.1005题(easy)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-6"   >
          <a href="#第一次做-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-6" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;10&#x2F;02</p>

        <h4 id="第一次代码-6"   >
          <a href="#第一次代码-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-6" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">largestSumAfterKNegations</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        Arrays.sort(nums);</span><br><span class="line">        <span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i:nums)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i&lt;<span class="number">0</span>) count++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;nums.length;i++)&#123;</span><br><span class="line">            <span class="keyword">while</span>(count==<span class="number">0</span> &amp;&amp; k!=<span class="number">0</span>)&#123;</span><br><span class="line">                nums[i]=-<span class="number">1</span> * nums[i];</span><br><span class="line">                k--;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(count&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(k&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                    k--;</span><br><span class="line">                    count--;</span><br><span class="line">                    nums[i]=-<span class="number">1</span> *nums[i];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            sum+=nums[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交错误"   >
          <a href="#提交错误" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交错误" class="headerlink" title="提交错误"></a>提交错误</h5>
      <p>CASE:nums &#x3D;[-8,3,-5,-3,-5,-2],k&#x3D;6，输出20，预期输出22</p>

        <h4 id="第二次代码-6"   >
          <a href="#第二次代码-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码-6" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">largestSumAfterKNegations</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        Arrays.sort(nums);</span><br><span class="line">        <span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i:nums)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i&lt;<span class="number">0</span>) count++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(count==<span class="number">0</span> &amp;&amp;k%<span class="number">2</span>==<span class="number">1</span>)&#123;</span><br><span class="line">            nums[<span class="number">0</span>]=-<span class="number">1</span>*nums[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i:nums)&#123;</span><br><span class="line">                sum+=i;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> sum;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;nums.length;i++)&#123;</span><br><span class="line">            <span class="keyword">while</span>(count==<span class="number">0</span> &amp;&amp; k!=<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(k%<span class="number">2</span>==<span class="number">0</span>)&#123;</span><br><span class="line">                    k=<span class="number">0</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    k=<span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">if</span>(nums[i]==<span class="number">0</span>)&#123;</span><br><span class="line">                        k=<span class="number">0</span>;</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        nums[i-<span class="number">1</span>]=-<span class="number">1</span>*nums[i-<span class="number">1</span>];</span><br><span class="line">                        sum+=<span class="number">2</span>*nums[i-<span class="number">1</span>];</span><br><span class="line">                        k--;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(count&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(k&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                    k--;</span><br><span class="line">                    count--;</span><br><span class="line">                    nums[i]=-<span class="number">1</span> *nums[i];         </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            sum+=nums[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-15"   >
          <a href="#提交失败-15" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-15" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:nums &#x3D;[8,-7,-3,-9,1,9,-6,-9,3],k&#x3D;8，输出49，预期输出53</p>

        <h4 id="第三次代码-3"   >
          <a href="#第三次代码-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#第三次代码-3" class="headerlink" title="第三次代码"></a>第三次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">largestSumAfterKNegations</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        Arrays.sort(nums);</span><br><span class="line">        <span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i:nums)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i&lt;<span class="number">0</span>)</span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">    	<span class="comment">//如果count&gt;=k,说明不能反转完所有负数</span></span><br><span class="line">        <span class="keyword">if</span>(count&gt;=k)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;nums.length;i++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(k&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                    nums[i]=-<span class="number">1</span>*nums[i];</span><br><span class="line">                    count--;</span><br><span class="line">                    k--;</span><br><span class="line">                &#125;</span><br><span class="line">                sum+=nums[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//说明能反转完所有负数</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;nums.length;i++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(count&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                    nums[i]=-<span class="number">1</span>*nums[i];</span><br><span class="line">                    count--;</span><br><span class="line">                    k--;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            Arrays.sort(nums);</span><br><span class="line">            <span class="comment">//如果还有奇数次要反转，那么就反转正数第一个</span></span><br><span class="line">            <span class="keyword">if</span>(k%<span class="number">2</span>==<span class="number">1</span>)&#123;</span><br><span class="line">                nums[<span class="number">0</span>]=-<span class="number">1</span>*nums[<span class="number">0</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//相加</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i:nums)&#123;</span><br><span class="line">                sum+=i;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-3"   >
          <a href="#提交成功-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-3" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-6"   >
          <a href="#题解-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-6" class="headerlink" title="题解"></a>题解</h3>
      <p>思路：我们这里的贪心就是，我们尝试将nums数组的所有负数都反转，并且是从绝对值大的负数开始反转，然后反转之后再排序，判断反转次数有没有用完，如果反转次数还没有用完，那么就反转第一个元素，最后统计元素之和</p>
<p><strong>实现</strong></p>
<ul>
<li><p>第一次排序，使数组从小到大排序，例如[-3,-1,0,1,3],那么绝对值越大就越小，<strong>保证反转从绝对值大的负数开始</strong></p>
</li>
<li><p>统计负数个数count，for循环，一旦nums[i]&lt;0，那么count++</p>
</li>
<li><p>尝试将所有负数反转，有两种可能：</p>
<ul>
<li><p>count&gt;k，那么也即所有负数不能反转完，那么我们保证绝对值大的负数先反转</p>
</li>
<li><p>count&lt;k，那么当所有负数反转完毕之后，还有反转次数k没能用完</p>
<p>也即count&#x3D;&#x3D;0 ||k&#x3D;&#x3D;0，那么就反转结束</p>
<p><strong>count&#x3D;&#x3D;0，说明全部负数反转完,break;</strong></p>
<p><strong>k&#x3D;&#x3D;0，说明反转次数用完,break;</strong></p>
<p><em><em>k&gt;0 &amp;&amp; count&gt;0，说明还有负数可以反转,count–,k–,nums</em>&#x3D;-1</em>*</p>
</li>
</ul>
</li>
<li><p>反转完之后再将数组排序，保证从小到大</p>
</li>
<li><p>判断反转次数是否用完</p>
<ul>
<li><p>k%2&#x3D;&#x3D;1,说明还有奇数次，那么只要反转第一个元素即可</p>
</li>
<li><p>k%2&#x3D;&#x3D;0,说明还有偶数次(也可能是0次)，那么不做处理即可</p>
</li>
</ul>
</li>
<li><p>统计数组和sum，for循环遍历nums</p>
</li>
<li><p>返回sum</p>
</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">largestSumAfterKNegations</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        <span class="comment">//对数组排序，统计小于0的元素个数</span></span><br><span class="line">    	Arrays.sort(nums);</span><br><span class="line">        <span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i:nums)&#123;</span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">    	<span class="comment">//尝试将所有负数反转</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;nums.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(count==<span class="number">0</span>||k==<span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(k&gt;<span class="number">0</span>&amp;&amp;count&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                count--;</span><br><span class="line">                k--;</span><br><span class="line">                nums[i] *=-<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    	<span class="comment">//对反转之后的数组再排序</span></span><br><span class="line">        Arrays.sort(nums);</span><br><span class="line">        <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">    	<span class="comment">//说明k大于count，全部反转完还有奇数次未反转</span></span><br><span class="line">        <span class="keyword">if</span>(k%<span class="number">2</span>==<span class="number">1</span>) nums[<span class="number">0</span>]*=-<span class="number">1</span>;</span><br><span class="line">    	<span class="comment">//统计之和</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i:nums)&#123;</span><br><span class="line">            sum+=i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="134-加油站"   >
          <a href="#134-加油站" class="heading-link"><i class="fas fa-link"></i></a><a href="#134-加油站" class="headerlink" title="134.加油站"></a>134.加油站</h2>
      <p>在一条环路上有 <code>n</code> 个加油站，其中第 <code>i</code> 个加油站有汽油 <code>gas[i]</code> 升。</p>
<p>你有一辆油箱容量无限的的汽车，从第 <code>i</code> 个加油站开往第 <code>i+1</code> 个加油站需要消耗汽油 <code>cost[i]</code> 升。你从其中的一个加油站出发，开始时油箱为空。</p>
<p>给定两个整数数组 <code>gas</code> 和 <code>cost</code> ，如果你可以按顺序绕环路行驶一周，则返回出发时加油站的编号，否则返回 <code>-1</code> 。如果存在解，则 <strong>保证</strong> 它是 <strong>唯一</strong> 的。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/gas-station/description/" >Leetcode.134题(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-7"   >
          <a href="#第一次做-7" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-7" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;10&#x2F;03</p>

        <h4 id="第一次代码-7"   >
          <a href="#第一次代码-7" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-7" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">canCompleteCircuit</span><span class="params">(<span class="type">int</span>[] gas, <span class="type">int</span>[] cost)</span> &#123;</span><br><span class="line">        <span class="type">int</span> gap=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> n=gas.length;</span><br><span class="line">        <span class="type">int</span> length=gas.length;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;gas.length;i++)&#123;</span><br><span class="line">            <span class="type">int</span> index=i;</span><br><span class="line">            <span class="keyword">if</span>(gap+gas[index]&gt;cost[index])&#123;</span><br><span class="line">                <span class="type">boolean</span> flag=<span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">while</span>(n&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                    gap+=gas[index%length];</span><br><span class="line">                    <span class="keyword">if</span>(gap-cost[index%length]&lt;<span class="number">0</span>)&#123;</span><br><span class="line">                        flag=<span class="literal">false</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    gap-=cost[index%length];</span><br><span class="line">                    n--;</span><br><span class="line">                    index++;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">                    <span class="keyword">return</span> i;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-16"   >
          <a href="#提交失败-16" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-16" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:gas&#x3D;[5,1,2,3,4] cost&#x3D;[4,4,1,5,1] 输出2 预期输出4</p>

        <h4 id="第二次代码-7"   >
          <a href="#第二次代码-7" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码-7" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">canCompleteCircuit</span><span class="params">(<span class="type">int</span>[] gas, <span class="type">int</span>[] cost)</span> &#123;</span><br><span class="line">        <span class="type">int</span> length=gas.length;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;gas.length;i++)&#123;</span><br><span class="line">            <span class="type">int</span> gap=<span class="number">0</span>;</span><br><span class="line">            <span class="type">int</span> n=gas.length;</span><br><span class="line">            <span class="type">int</span> index=i;</span><br><span class="line">            <span class="keyword">if</span>(gap+gas[index]&gt;cost[index])&#123;</span><br><span class="line">                <span class="type">boolean</span> flag=<span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">while</span>(n&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                    gap+=gas[index%length];</span><br><span class="line">                    <span class="keyword">if</span>(gap-cost[index%length]&lt;<span class="number">0</span>)&#123;</span><br><span class="line">                        flag=<span class="literal">false</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    gap-=cost[index%length];</span><br><span class="line">                    n--;</span><br><span class="line">                    index++;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">                    <span class="keyword">return</span> i;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-17"   >
          <a href="#提交失败-17" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-17" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:gas&#x3D;[2],cost&#x3D;[2],输出2,预期输出0</p>

        <h4 id="第三次代码-4"   >
          <a href="#第三次代码-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#第三次代码-4" class="headerlink" title="第三次代码"></a>第三次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">canCompleteCircuit</span><span class="params">(<span class="type">int</span>[] gas, <span class="type">int</span>[] cost)</span> &#123;</span><br><span class="line">        <span class="type">int</span> length=gas.length;</span><br><span class="line">        <span class="keyword">if</span>(length==<span class="number">1</span>) <span class="keyword">return</span> gas[<span class="number">0</span>]-cost[<span class="number">0</span>]&gt;=<span class="number">0</span> ? <span class="number">0</span>: -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;gas.length;i++)&#123;</span><br><span class="line">            <span class="type">int</span> gap=<span class="number">0</span>;</span><br><span class="line">            <span class="type">int</span> n=gas.length;</span><br><span class="line">            <span class="type">int</span> index=i;</span><br><span class="line">            <span class="keyword">if</span>(gap+gas[index]&gt;cost[index])&#123;</span><br><span class="line">                <span class="type">boolean</span> flag=<span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">while</span>(n&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                    gap+=gas[index%length];</span><br><span class="line">                    <span class="keyword">if</span>(gap-cost[index%length]&lt;<span class="number">0</span>)&#123;</span><br><span class="line">                        flag=<span class="literal">false</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    gap-=cost[index%length];</span><br><span class="line">                    n--;</span><br><span class="line">                    index++;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">                    <span class="keyword">return</span> i;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-4"   >
          <a href="#提交成功-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-4" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-7"   >
          <a href="#题解-7" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-7" class="headerlink" title="题解"></a>题解</h3>
      <p><strong>暴力法</strong></p>
<p>思想：每遇到一个站就搜索能不能加够油，然后如果能转一圈到达i，那么就返回i</p>
<p>这里主要是说<strong>贪心算法</strong>的做法，所以这个暴力法只是提一嘴</p>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">canCompleteCircuit</span><span class="params">(<span class="type">int</span>[] gas, <span class="type">int</span>[] cost)</span> &#123;</span><br><span class="line">        <span class="comment">//记录总站数</span></span><br><span class="line">    	<span class="type">int</span> length=gas.length;</span><br><span class="line">    	<span class="comment">//如果只有一站判断能不能出发</span></span><br><span class="line">        <span class="keyword">if</span>(length==<span class="number">1</span>) <span class="keyword">return</span> gas[<span class="number">0</span>]-cost[<span class="number">0</span>]&gt;=<span class="number">0</span> ? <span class="number">0</span>: -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;gas.length;i++)&#123;</span><br><span class="line">            <span class="comment">//记录总油数，当前指向站index，需要走的总站数n</span></span><br><span class="line">            <span class="type">int</span> gap=<span class="number">0</span>;</span><br><span class="line">            <span class="type">int</span> n=gas.length;</span><br><span class="line">            <span class="type">int</span> index=i;</span><br><span class="line">            <span class="comment">//如果当前站能走到下一站</span></span><br><span class="line">            <span class="keyword">if</span>(gap+gas[index]&gt;cost[index])&#123;</span><br><span class="line">                <span class="type">boolean</span> flag=<span class="literal">true</span>;</span><br><span class="line">                <span class="comment">//尝试走n站，n为总站数长度</span></span><br><span class="line">                <span class="keyword">while</span>(n&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                    gap+=gas[index%length];</span><br><span class="line">                    <span class="comment">//如果走不到下一站</span></span><br><span class="line">                    <span class="keyword">if</span>(gap-cost[index%length]&lt;<span class="number">0</span>)&#123;</span><br><span class="line">                        flag=<span class="literal">false</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    gap-=cost[index%length];</span><br><span class="line">                    n--;</span><br><span class="line">                    index++;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">                    <span class="keyword">return</span> i;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>

<p><strong>贪心算法</strong></p>
<p>思路：我们判断一个站的存量和耗油量做一个宏观上的判断，如果gas&gt;cost那么就是增油，如果gas&lt;cost就是耗油，然后当存油量小于0的时候那么就一定不可能重来一遍</p>
<blockquote>
<p>局部最优解：如果油量走到某个位置i小于0，说明要从这个位置之后(i+1)才可能使其能重新跑一遍</p>
</blockquote>
<p>也即我们宏观的判断这个站点是加油还是少油</p>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="https://images-kkblog.oss-cn-hangzhou.aliyuncs.com/image-20231003194034342.png"  alt="加油站">
      </p>
<p><strong>实现</strong></p>
<ul>
<li><p>定义变量start：用于记录第一个站的位置</p>
</li>
<li><p>定义变量cul：用于记录当前油量</p>
</li>
<li><p>定义变量totalCost：用于记录全程旅程总共的油耗量，如果totalCost&lt;0说明怎么走都不可能从头到尾走一遍</p>
</li>
<li><p>循环统计totalCost，如果totalCost小于0则直接返回-1</p>
</li>
<li><p>循环</p>
<ul>
<li>统计总油量cul+&#x3D;gas[i]-cost[i]</li>
<li>如果cul小于0说明到这一站之后不可能继续往后走了<ul>
<li>所以将cul置为0，并且将起始位置start更新成i之后也即start&#x3D;i+1</li>
</ul>
</li>
</ul>
</li>
<li><p>循环之后返回start</p>
</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">canCompleteCircuit</span><span class="params">(<span class="type">int</span>[] gas, <span class="type">int</span>[] cost)</span> &#123;</span><br><span class="line">        <span class="type">int</span> start=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> cul=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> totalCost=<span class="number">0</span>;</span><br><span class="line">        <span class="comment">//如果总耗油量大于存油量那么就不可能重来一遍</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;gas.length;i++)&#123;</span><br><span class="line">            totalCost+=gas[i]-cost[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(totalCost&lt;<span class="number">0</span>) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;gas.length;i++)&#123;</span><br><span class="line">            cul+=gas[i]-cost[i];</span><br><span class="line">            <span class="comment">//如果当前油量小于0，说明无法从i位置走回i</span></span><br><span class="line">            <span class="keyword">if</span>(cul&lt;<span class="number">0</span>)&#123;</span><br><span class="line">                start=i+<span class="number">1</span>;</span><br><span class="line">                cul=<span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> start;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>




        <h2 id="135-分发糖果"   >
          <a href="#135-分发糖果" class="heading-link"><i class="fas fa-link"></i></a><a href="#135-分发糖果" class="headerlink" title="135.分发糖果"></a>135.分发糖果</h2>
      <p><code>n</code> 个孩子站成一排。给你一个整数数组 <code>ratings</code> 表示每个孩子的评分。</p>
<p>你需要按照以下要求，给这些孩子分发糖果：</p>
<ul>
<li>每个孩子至少分配到 <code>1</code> 个糖果。</li>
<li>相邻两个孩子评分更高的孩子会获得更多的糖果。</li>
</ul>
<p>请你给每个孩子分发糖果，计算并返回需要准备的 <strong>最少糖果数目</strong> 。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/candy/description/" >Leetcode.135题(hard)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-8"   >
          <a href="#第一次做-8" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-8" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;10&#x2F;04</p>

        <h4 id="第一次代码-8"   >
          <a href="#第一次代码-8" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-8" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">candy</span><span class="params">(<span class="type">int</span>[] ratings)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(ratings.length==<span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> give=<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> total=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;ratings.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i==<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(ratings[<span class="number">0</span>]&gt;ratings[<span class="number">1</span>])&#123;</span><br><span class="line">                    give++;</span><br><span class="line">                &#125;</span><br><span class="line">                total+=give;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(ratings[i]&gt;ratings[i-<span class="number">1</span>])&#123;</span><br><span class="line">                give++;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                give=<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            total+=give;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> total;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-18"   >
          <a href="#提交失败-18" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-18" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>输入ratings&#x3D;[1,3,2,2,1] 输出6，预期输出7</p>

        <h4 id="第二次代码-8"   >
          <a href="#第二次代码-8" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码-8" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">candy</span><span class="params">(<span class="type">int</span>[] ratings)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(ratings.length==<span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> give=<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> total=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;ratings.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i==<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(ratings[<span class="number">0</span>]&gt;ratings[<span class="number">1</span>])&#123;</span><br><span class="line">                    give++;</span><br><span class="line">                &#125;</span><br><span class="line">                total+=give;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(i==ratings.length-<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(ratings[i]&gt;ratings[i-<span class="number">1</span>])&#123;</span><br><span class="line">                    give++;</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(ratings[i]==ratings[i-<span class="number">1</span>])&#123;</span><br><span class="line">                    give=<span class="number">1</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(ratings[i]&lt;ratings[i-<span class="number">1</span>])&#123;</span><br><span class="line">                    give= give==<span class="number">1</span> ? <span class="number">2</span> : <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                total+=give;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(ratings[i]&gt;ratings[i-<span class="number">1</span>])&#123;</span><br><span class="line">                give++;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                give=<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            total+=give;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> total;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-19"   >
          <a href="#提交失败-19" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-19" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:nums&#x3D;[1,2,87,87,87,2,1],输出11，预期输出13</p>

        <h4 id="第三次代码-5"   >
          <a href="#第三次代码-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#第三次代码-5" class="headerlink" title="第三次代码"></a>第三次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">candy</span><span class="params">(<span class="type">int</span>[] ratings)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(ratings.length==<span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> give=<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> total=<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;ratings.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(ratings[i]&gt;ratings[i-<span class="number">1</span>])&#123;</span><br><span class="line">                give++;</span><br><span class="line">                <span class="keyword">if</span>(count!=<span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=count;j++)&#123;</span><br><span class="line">                        total+=j;</span><br><span class="line">                    &#125;</span><br><span class="line">                    count=<span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(ratings[i]==ratings[i-<span class="number">1</span>])&#123;</span><br><span class="line">                give=<span class="number">1</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(ratings[i]&lt;ratings[i-<span class="number">1</span>])&#123;</span><br><span class="line">                <span class="keyword">if</span>(give-<span class="number">1</span>==<span class="number">0</span>)&#123;</span><br><span class="line">                    count++;</span><br><span class="line">                &#125;</span><br><span class="line">                give= give-<span class="number">1</span>==<span class="number">0</span>? <span class="number">1</span>: give-<span class="number">1</span>;</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            total+=give;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(count!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=count;i++)&#123;</span><br><span class="line">                total+=i;</span><br><span class="line">            &#125;</span><br><span class="line">            count=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> total;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-20"   >
          <a href="#提交失败-20" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-20" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:ratings&#x3D;[1,3,4,5,2]，输出13，预期输出11</p>

        <h4 id="第四次代码-3"   >
          <a href="#第四次代码-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#第四次代码-3" class="headerlink" title="第四次代码"></a>第四次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">candy</span><span class="params">(<span class="type">int</span>[] ratings)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(ratings.length==<span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> give=<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> max=<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> total=<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;ratings.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(ratings[i]&gt;ratings[i-<span class="number">1</span>])&#123;</span><br><span class="line">                give++;</span><br><span class="line">                <span class="keyword">if</span>(give&gt;max) max=give;</span><br><span class="line">                <span class="keyword">if</span>(count!=<span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=count;j++)&#123;</span><br><span class="line">                        total+=j;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span>(<span class="number">1</span>+count&gt;=max &amp;&amp; max!=<span class="number">2</span>) &#123;</span><br><span class="line">                        max=<span class="number">1</span>+count-max+<span class="number">1</span>;</span><br><span class="line">                        total+=<span class="number">1</span>+count-max+<span class="number">1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    count=<span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(ratings[i]==ratings[i-<span class="number">1</span>])&#123;</span><br><span class="line">                give=<span class="number">1</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(ratings[i]&lt;ratings[i-<span class="number">1</span>])&#123;</span><br><span class="line">                <span class="keyword">if</span>(give-<span class="number">1</span>==<span class="number">0</span>)&#123;</span><br><span class="line">                    count++;</span><br><span class="line">                &#125;</span><br><span class="line">                give=<span class="number">1</span>;</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            total+=give;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(count!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=count;i++)&#123;</span><br><span class="line">                total+=i;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(<span class="number">1</span>+count&gt;=max &amp;&amp; max!=<span class="number">2</span>) total+=<span class="number">1</span>+count-max+<span class="number">1</span>;</span><br><span class="line">            count=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> total;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-21"   >
          <a href="#提交失败-21" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-21" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>没能做出来</p>

        <h3 id="题解-8"   >
          <a href="#题解-8" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-8" class="headerlink" title="题解"></a>题解</h3>
      <p>思路：我们每个小孩最少要有一颗糖，我们可以定义一个candys数组来模拟要分发的小孩糖果个数，并将其初始化为1.</p>
<p>然后我们<strong>从左向右判断</strong>，当右孩子比左孩子大的时候那么右孩子糖果个数应该是左孩子糖果个数+1</p>
<p>不仅如此我们还要<strong>从右向左判断</strong>，当左孩子比右孩子大的时候那么左孩子糖果个数应该是右孩子糖果个数+1</p>
<blockquote>
<p>局部最优解:</p>
<p>当我们第一次从左向右获取了右孩子比左孩子大情况下的最小糖果个数分发情况</p>
<p>当我们第二次从右向左获取了左孩子比右孩子大情况下的最小糖果个数分发情况</p>
<p>我们将这两种情况合并，就是我们的最小糖果分发情况</p>
</blockquote>
<p><strong>实现</strong></p>
<ul>
<li><p>初始化数组candys，初始化数值为1，表示每个小孩最小能分发一颗糖果</p>
</li>
<li><p>遍历，从前往后遍历(i&#x3D;1;i&lt;candys.length;i++)</p>
<p>当右孩子比左孩子大，那么右孩子应该比左孩子多一个糖果也即(ratings[i]&gt;ratings[i-1]时，candys[i]&#x3D;candys[i-1]+1)</p>
<p><em>我们这样就获取了右孩子比左孩子大的分发糖果情况</em></p>
</li>
<li><p>遍历，从后往前遍历(i&#x3D;candys.length-2;i&gt;&#x3D;0;i–)</p>
<p>当左孩子比右孩子大的时候，那么左孩子要比右孩子多一个糖果也即(ratings[i]&gt;rating[i+1])时</p>
<p>candys&#x3D;Math.max(<strong>candys[i],candys[i+1]+1</strong>)，我们在第一次循环获取的分发个数和右孩子糖果个数+1之间取最大值。这样保证了这个糖果个数必然考虑了右孩子比左孩子大也考虑了左孩子比右孩子大的情况</p>
</li>
<li><p>遍历candys数组，获取最终个数result</p>
</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">candy</span><span class="params">(<span class="type">int</span>[] ratings)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] candys=<span class="keyword">new</span> <span class="title class_">int</span>[ratings.length];</span><br><span class="line">        <span class="comment">//初始化数组，每个小孩至少一颗糖</span></span><br><span class="line">    	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;candys.length;i++)&#123;</span><br><span class="line">            candys[i]=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="comment">//右孩子比左孩子大</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;ratings.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(ratings[i]&gt;ratings[i-<span class="number">1</span>])&#123;</span><br><span class="line">                candys[i]=candys[i-<span class="number">1</span>]+<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="comment">//左孩子比右孩子大</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=ratings.length-<span class="number">2</span>;i&gt;=<span class="number">0</span>;i--)&#123;</span><br><span class="line">            <span class="keyword">if</span>(ratings[i]&gt;ratings[i+<span class="number">1</span>])&#123;</span><br><span class="line">                <span class="comment">//取原来candys的数量与右孩子数量+1的最大值</span></span><br><span class="line">                candys[i]=Math.max(candys[i],candys[i+<span class="number">1</span>]+<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="comment">//统计总数</span></span><br><span class="line">        <span class="type">int</span> result=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i:candys)&#123;</span><br><span class="line">            result+=i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="860-柠檬水找零"   >
          <a href="#860-柠檬水找零" class="heading-link"><i class="fas fa-link"></i></a><a href="#860-柠檬水找零" class="headerlink" title="860.柠檬水找零"></a>860.柠檬水找零</h2>
      <p>在柠檬水摊上，每一杯柠檬水的售价为 <code>5</code> 美元。顾客排队购买你的产品，（按账单 <code>bills</code> 支付的顺序）一次购买一杯。</p>
<p>每位顾客只买一杯柠檬水，然后向你付 <code>5</code> 美元、<code>10</code> 美元或 <code>20</code> 美元。你必须给每个顾客正确找零，也就是说净交易是每位顾客向你支付 <code>5</code> 美元。</p>
<p>注意，一开始你手头没有任何零钱。</p>
<p>给你一个整数数组 <code>bills</code> ，其中 <code>bills[i]</code> 是第 <code>i</code> 位顾客付的账。如果你能给每位顾客正确找零，返回 <code>true</code> ，否则返回 <code>false</code> 。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/lemonade-change/description/" >Leetcode.860题(easy)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-9"   >
          <a href="#第一次做-9" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-9" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;10&#x2F;05</p>

        <h4 id="第一次代码-9"   >
          <a href="#第一次代码-9" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-9" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">lemonadeChange</span><span class="params">(<span class="type">int</span>[] bills)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] billsCount=<span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">3</span>];</span><br><span class="line">        <span class="keyword">if</span>(bills[<span class="number">0</span>]!=<span class="number">5</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;bills.length;i++)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> (bills[i]-<span class="number">5</span>) / <span class="number">5</span> ;</span><br><span class="line">            <span class="keyword">if</span>( result == <span class="number">0</span> )&#123;</span><br><span class="line">                <span class="comment">//支付5 则直接收下</span></span><br><span class="line">                billsCount[<span class="number">0</span>]++;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>( result ==<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="comment">//支付10 则要返回一张5</span></span><br><span class="line">                <span class="keyword">if</span>(billsCount[<span class="number">0</span>]==<span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                billsCount[<span class="number">0</span>]--;</span><br><span class="line">                billsCount[<span class="number">1</span>]++;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>( result ==<span class="number">3</span>)&#123;</span><br><span class="line">                <span class="comment">//支付20则要返回一张10一张5，或者三张5</span></span><br><span class="line">                <span class="keyword">if</span>(billsCount[<span class="number">1</span>]!=<span class="number">0</span> &amp;&amp; billsCount[<span class="number">0</span>] !=<span class="number">0</span>)&#123;</span><br><span class="line">                    billsCount[<span class="number">1</span>]--;</span><br><span class="line">                    billsCount[<span class="number">0</span>]--;</span><br><span class="line">                    billsCount[<span class="number">2</span>]++;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(billsCount[<span class="number">0</span>]&gt;=<span class="number">3</span>)&#123;</span><br><span class="line">                    billsCount[<span class="number">0</span>]-=<span class="number">3</span>;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-5"   >
          <a href="#提交成功-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-5" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-9"   >
          <a href="#题解-9" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-9" class="headerlink" title="题解"></a>题解</h3>
      <p>思路：这道题的情形其实一下子就能想明白，我们只要做好找零的规划就可以解出这道题，支付5元则直接收下，支付10元则找一张5元，支付20元则找一张10元一张五元或者三张五元，而在取舍先找10元还是直接付3张五元的时候要先将面额大的10元支付出去</p>
<blockquote>
<p>局部最优解：在客户支付20的时候优先支付10+5的组合，因为5元更为通用</p>
</blockquote>
<p><strong>实现</strong></p>
<ul>
<li>变量five：记录五元钞票的张数，用于找零</li>
<li>变量ten：记录十元钞票的张数，用于找零</li>
<li>遍历接待客人<ul>
<li>如果客人支付五元，直接收下</li>
<li>如果客人支付十元，则找一张五块，如果找不出来则return false</li>
<li>如果客人支付二十元，则优先找10+5元，如果不行再找三张5元，如果都找不出来则return false</li>
</ul>
</li>
<li>遍历结束，说明客人都接待成功了，return true</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">lemonadeChange</span><span class="params">(<span class="type">int</span>[] bills)</span> &#123;</span><br><span class="line">        <span class="type">int</span> five=<span class="number">0</span>; <span class="type">int</span> ten=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;bills.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(bills[i]==<span class="number">5</span>)&#123;</span><br><span class="line">                five++;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(bills[i]==<span class="number">10</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(five==<span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                five--;</span><br><span class="line">                ten++;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(bills[i]==<span class="number">20</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(five != <span class="number">0</span> &amp;&amp; ten != <span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="comment">//找一张五块一张10块</span></span><br><span class="line">                    five--;</span><br><span class="line">                    ten--;</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(five&gt;=<span class="number">3</span>)&#123;</span><br><span class="line">                    <span class="comment">//找三张五块</span></span><br><span class="line">                    five-=<span class="number">3</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="comment">//找不出钱</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>




        <h2 id="406-根据身高重建队列"   >
          <a href="#406-根据身高重建队列" class="heading-link"><i class="fas fa-link"></i></a><a href="#406-根据身高重建队列" class="headerlink" title="406.根据身高重建队列"></a>406.根据身高重建队列</h2>
      <p>假设有打乱顺序的一群人站成一个队列，数组 <code>people</code> 表示队列中一些人的属性（不一定按顺序）。每个 <code>people[i] = [hi, ki]</code> 表示第 <code>i</code> 个人的身高为 <code>hi</code> ，前面 <strong>正好</strong> 有 <code>ki</code> 个身高大于或等于 <code>hi</code> 的人。</p>
<p>请你重新构造并返回输入数组 <code>people</code> 所表示的队列。返回的队列应该格式化为数组 <code>queue</code> ，其中 <code>queue[j] = [hj, kj]</code> 是队列中第 <code>j</code> 个人的属性（<code>queue[0]</code> 是排在队列前面的人）。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/queue-reconstruction-by-height/description/" >Leetcode.406(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-10"   >
          <a href="#第一次做-10" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-10" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;10&#x2F;06</p>

        <h4 id="第一次代码-10"   >
          <a href="#第一次代码-10" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-10" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span>[][] reconstructQueue(<span class="type">int</span>[][] people) &#123;</span><br><span class="line"></span><br><span class="line">       <span class="type">int</span>[][] result=<span class="keyword">new</span> <span class="title class_">int</span>[people.length][<span class="number">2</span>];</span><br><span class="line">       </span><br><span class="line">       <span class="comment">//排序</span></span><br><span class="line">       <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;people.length;i++)&#123;</span><br><span class="line">           <span class="keyword">for</span>(<span class="type">int</span> j=i+<span class="number">1</span>;j&lt;people.length;j++)&#123;</span><br><span class="line">               <span class="type">int</span> oldNum=people[i][<span class="number">0</span>];</span><br><span class="line">               <span class="type">int</span> newNum=people[j][<span class="number">0</span>];</span><br><span class="line">               <span class="keyword">if</span>(newNum&lt;oldNum)&#123;</span><br><span class="line">                   <span class="type">int</span>[] temp=people[i];</span><br><span class="line">                   people[i]=people[j];</span><br><span class="line">                   people[j]=temp;</span><br><span class="line">               &#125;<span class="keyword">else</span> <span class="keyword">if</span>(newNum==oldNum)&#123;</span><br><span class="line">                   <span class="type">int</span>[] temp=people[i];</span><br><span class="line">                   <span class="keyword">if</span>(people[i][<span class="number">1</span>]&gt;people[j][<span class="number">1</span>])&#123;</span><br><span class="line">                       people[i]=people[j];</span><br><span class="line">                       people[j]=temp;</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       </span><br><span class="line">       <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;people.length;i++)&#123;</span><br><span class="line">           <span class="type">int</span>[] arr=people[i];</span><br><span class="line">           <span class="type">int</span> prev=arr[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">           <span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line">           <span class="type">int</span> j=<span class="number">0</span>;</span><br><span class="line">           <span class="keyword">while</span>(count!=prev &amp;&amp; j&lt;people.length)&#123;</span><br><span class="line">               <span class="keyword">if</span>(result[j][<span class="number">0</span>]==<span class="number">0</span> &amp;&amp; result[j][<span class="number">1</span>]==<span class="number">0</span>)</span><br><span class="line">               count++;</span><br><span class="line">               <span class="keyword">else</span> <span class="keyword">if</span>(result[j][<span class="number">0</span>]&gt;=arr[<span class="number">0</span>])</span><br><span class="line">               count++;</span><br><span class="line">               j++;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">while</span>(j&lt;people.length &amp;&amp;(result[j][<span class="number">0</span>]!=<span class="number">0</span> || result[j][<span class="number">1</span>]!=<span class="number">0</span>))&#123;</span><br><span class="line">               j++;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">if</span>(j==people.length)&#123;</span><br><span class="line">               j--;</span><br><span class="line">           &#125;</span><br><span class="line">           result[j]=arr;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> result;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-22"   >
          <a href="#提交失败-22" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-22" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:people：[[0,0],[6,2],[5,5],[4,3],[5,2],[1,1],[6,0],[6,3],[7,0],[5,1]]</p>
<p>输出[[6,0],[1,1],[5,1],[5,2],[4,3],[7,0],[6,2],[5,5],[6,3],[0,0]]</p>
<p>预期输出[[0,0],[6,0],[1,1],[5,1],[5,2],[4,3],[7,0],[6,2],[5,5],[6,3]]</p>

        <h4 id="第二次代码-9"   >
          <a href="#第二次代码-9" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码-9" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span>[][] reconstructQueue(<span class="type">int</span>[][] people) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span>[][] result=<span class="keyword">new</span> <span class="title class_">int</span>[people.length][<span class="number">2</span>];</span><br><span class="line">        <span class="type">int</span> zeroCount=<span class="number">0</span>;</span><br><span class="line">        <span class="comment">//排序</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;people.length;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=i+<span class="number">1</span>;j&lt;people.length;j++)&#123;</span><br><span class="line">                <span class="type">int</span> oldNum=people[i][<span class="number">0</span>];</span><br><span class="line">                <span class="type">int</span> newNum=people[j][<span class="number">0</span>];</span><br><span class="line">                <span class="keyword">if</span>(newNum&lt;oldNum)&#123;</span><br><span class="line">                    <span class="type">int</span>[] temp=people[i];</span><br><span class="line">                    people[i]=people[j];</span><br><span class="line">                    people[j]=temp;</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(newNum==oldNum)&#123;</span><br><span class="line">                    <span class="type">int</span>[] temp=people[i];</span><br><span class="line">                    <span class="keyword">if</span>(people[i][<span class="number">1</span>]&gt;people[j][<span class="number">1</span>])&#123;</span><br><span class="line">                        people[i]=people[j];</span><br><span class="line">                        people[j]=temp;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;people.length;i++)&#123;</span><br><span class="line">            <span class="type">int</span>[] arr=people[i];</span><br><span class="line">            <span class="comment">//统计身高为0并且序号为0的元素个数</span></span><br><span class="line">            <span class="keyword">if</span>(arr[<span class="number">0</span>]==<span class="number">0</span> &amp;&amp; arr[<span class="number">1</span>]==<span class="number">0</span>) zeroCount++;</span><br><span class="line">            <span class="type">int</span> prev=arr[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">            <span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line">            <span class="type">int</span> j=<span class="number">0</span>;</span><br><span class="line">            <span class="comment">//统计一共有多少个位置</span></span><br><span class="line">            <span class="keyword">while</span>(count!=prev &amp;&amp; j&lt;people.length)&#123;</span><br><span class="line">                <span class="keyword">if</span>(result[j][<span class="number">0</span>]==<span class="number">0</span> &amp;&amp; result[j][<span class="number">1</span>]==<span class="number">0</span>)</span><br><span class="line">                count++;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(result[j][<span class="number">0</span>]&gt;=arr[<span class="number">0</span>])</span><br><span class="line">                count++;</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//当所在位置j不为空</span></span><br><span class="line">            <span class="keyword">while</span>(j&lt;people.length &amp;&amp;(result[j][<span class="number">0</span>]!=<span class="number">0</span> || result[j][<span class="number">1</span>]!=<span class="number">0</span>))&#123;</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(j==people.length)&#123;</span><br><span class="line">                j--;</span><br><span class="line">            &#125;</span><br><span class="line">            result[j]=arr;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//当身高为0并且排名为0的个数不为1，则将最末尾的元素移到前面</span></span><br><span class="line">        <span class="keyword">if</span>(zeroCount!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="type">int</span>[][] copyResult=<span class="keyword">new</span> <span class="title class_">int</span>[result.length][<span class="number">2</span>];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;result.length-zeroCount;i++)&#123;</span><br><span class="line">                copyResult[zeroCount+i]=result[i];</span><br><span class="line">            &#125;</span><br><span class="line">            result=copyResult;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-6"   >
          <a href="#提交成功-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-6" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-10"   >
          <a href="#题解-10" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-10" class="headerlink" title="题解"></a>题解</h3>
      <p>思路：这道题也是要考虑两个维度，一个是身高另一个是排在其前面人数，我们不妨确认一个维度身高，身高相同的根据Kj从小到大排序，因为这样就能保证最大身高顺序不会错，然后从小的身高中不断插入到大的队列中</p>
<blockquote>
<p>局部最优解：当身高顺序保证了的时候，矮的插入到高的并不会对原有顺序造成影响</p>
</blockquote>
<p><strong>实现</strong></p>
<ul>
<li><p>先对排队队列排序</p>
<p>排列规则：</p>
<ul>
<li>身高由高到低排序</li>
<li>身高相同的按照kj由小到大排序</li>
</ul>
</li>
<li><p>定义一个集合，用于存放之后正确顺序的身高队形</p>
</li>
<li><p>遍历数组</p>
<ul>
<li>获取index，也即kj代表的是将要插入的位置</li>
<li>插入到集合中</li>
</ul>
</li>
<li><p>将集合变成二维数组返回</p>
</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span>[][] reconstructQueue(<span class="type">int</span>[][] people) &#123;</span><br><span class="line">        <span class="comment">//排序</span></span><br><span class="line">    	sortQueue(people);</span><br><span class="line"></span><br><span class="line">        ArrayList&lt;<span class="type">int</span>[]&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;people.length;i++)&#123;</span><br><span class="line">            <span class="type">int</span> index=people[i][<span class="number">1</span>];</span><br><span class="line">            <span class="comment">//插入到集合中</span></span><br><span class="line">            list.add(index,people[i]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> list.toArray(people);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//排序</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sortQueue</span><span class="params">(<span class="type">int</span>[][]people)</span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;people.length;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=i;j&lt;people.length;j++)&#123;</span><br><span class="line">                <span class="type">int</span> oldNum=people[i][<span class="number">0</span>];</span><br><span class="line">                <span class="type">int</span> newNum=people[j][<span class="number">0</span>];</span><br><span class="line">                <span class="keyword">if</span>(oldNum&lt;newNum)&#123;</span><br><span class="line">                    <span class="type">int</span>[] temp=people[i];</span><br><span class="line">                    people[i]=people[j];</span><br><span class="line">                    people[j]=temp;</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(oldNum==newNum)&#123;</span><br><span class="line">                    <span class="type">int</span> oldQ=people[i][<span class="number">1</span>];</span><br><span class="line">                    <span class="type">int</span> newQ=people[j][<span class="number">1</span>];</span><br><span class="line">                    <span class="keyword">if</span>(oldQ&gt;newQ)&#123;</span><br><span class="line">                        <span class="type">int</span>[] temp=people[i];</span><br><span class="line">                        people[i]=people[j];</span><br><span class="line">                        people[j]=temp;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h3 id="图解"   >
          <a href="#图解" class="heading-link"><i class="fas fa-link"></i></a><a href="#图解" class="headerlink" title="图解"></a>图解</h3>
      <p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="https://images-kkblog.oss-cn-hangzhou.aliyuncs.com/image-20231006215439956.png"  alt="根据身高重建队列">
      </p>

        <h2 id="452-用最少数量的箭引爆气球"   >
          <a href="#452-用最少数量的箭引爆气球" class="heading-link"><i class="fas fa-link"></i></a><a href="#452-用最少数量的箭引爆气球" class="headerlink" title="452.用最少数量的箭引爆气球"></a>452.用最少数量的箭引爆气球</h2>
      <p>有一些球形气球贴在一堵用 XY 平面表示的墙面上。墙面上的气球记录在整数数组 <code>points</code> ，其中<code>points[i] = [xstart, xend]</code> 表示水平直径在 <code>xstart</code> 和 <code>xend</code>之间的气球。你不知道气球的确切 y 坐标。</p>
<p>一支弓箭可以沿着 x 轴从不同点 <strong>完全垂直</strong> 地射出。在坐标 <code>x</code> 处射出一支箭，若有一个气球的直径的开始和结束坐标为 <code>x``start</code>，<code>x``end</code>， 且满足  <code>xstart ≤ x ≤ x``end</code>，则该气球会被 <strong>引爆</strong> 。可以射出的弓箭的数量 <strong>没有限制</strong> 。 弓箭一旦被射出之后，可以无限地前进。</p>
<p>给你一个数组 <code>points</code> ，<em>返回引爆所有气球所必须射出的 <strong>最小</strong> 弓箭数</em> 。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/minimum-number-of-arrows-to-burst-balloons/description/" >Leetcode.452题(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-11"   >
          <a href="#第一次做-11" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-11" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;10&#x2F;07</p>

        <h4 id="第一次代码-11"   >
          <a href="#第一次代码-11" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-11" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findMinArrowShots</span><span class="params">(<span class="type">int</span>[][] points)</span> &#123;</span><br><span class="line">        sortShots(points);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> END=Integer.MIN_VALUE;</span><br><span class="line">        <span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;points.length;i++)&#123;</span><br><span class="line">            <span class="type">int</span>[] point=points[i];</span><br><span class="line">            <span class="type">int</span> shotStart=point[<span class="number">0</span>];</span><br><span class="line">            <span class="type">int</span> shotEnd=point[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">if</span>(shotStart&lt;=END||shotEnd&lt;=END) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(shotEnd&gt;END)&#123;</span><br><span class="line">                count++;</span><br><span class="line">                END=shotEnd;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sortShots</span><span class="params">(<span class="type">int</span>[][]points)</span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;points.length;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=i;j&lt;points.length;j++)&#123;</span><br><span class="line">                <span class="type">int</span> oldStart=points[i][<span class="number">0</span>];</span><br><span class="line">                <span class="type">int</span> newStart=points[j][<span class="number">0</span>];</span><br><span class="line">                <span class="keyword">if</span>(newStart&lt;oldStart)&#123;</span><br><span class="line">                    <span class="type">int</span>[] temp=points[i];</span><br><span class="line">                    points[i]=points[j];</span><br><span class="line">                    points[j]=temp;</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(oldStart==newStart)&#123;</span><br><span class="line">                    <span class="type">int</span> oldEnd=points[i][<span class="number">1</span>];</span><br><span class="line">                    <span class="type">int</span> newEnd=points[j][<span class="number">1</span>];</span><br><span class="line">                    <span class="keyword">if</span>(newEnd&lt;oldEnd)&#123;</span><br><span class="line">                        <span class="type">int</span>[] temp=points[i];</span><br><span class="line">                        points[i]=points[j];</span><br><span class="line">                        points[j]=temp;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-23"   >
          <a href="#提交失败-23" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-23" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:Points[[-2147483648,2147483647]]</p>
<p>输出：0</p>
<p>预期输出：1</p>

        <h4 id="第二次代码-10"   >
          <a href="#第二次代码-10" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码-10" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findMinArrowShots</span><span class="params">(<span class="type">int</span>[][] points)</span> &#123;</span><br><span class="line">       <span class="keyword">if</span>(points.length==<span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">       sortShots(points);</span><br><span class="line"></span><br><span class="line">       <span class="type">int</span> END=Integer.MIN_VALUE;</span><br><span class="line">       <span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line">       <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;points.length;i++)&#123;</span><br><span class="line">           <span class="type">int</span>[] point=points[i];</span><br><span class="line">           <span class="type">int</span> shotStart=point[<span class="number">0</span>];</span><br><span class="line">           <span class="type">int</span> shotEnd=point[<span class="number">1</span>];</span><br><span class="line">           <span class="keyword">if</span>(shotStart&lt;= END || shotEnd&lt;=END) <span class="keyword">continue</span>;</span><br><span class="line">           <span class="keyword">else</span> <span class="keyword">if</span>(shotEnd&gt;END)&#123;</span><br><span class="line">               count++;</span><br><span class="line">               END=shotEnd;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> count;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sortShots</span><span class="params">(<span class="type">int</span>[][]points)</span>&#123;</span><br><span class="line">       <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;points.length;i++)&#123;</span><br><span class="line">           <span class="keyword">for</span>(<span class="type">int</span> j=i;j&lt;points.length;j++)&#123;</span><br><span class="line">               <span class="type">int</span> oldStart=points[i][<span class="number">0</span>];</span><br><span class="line">               <span class="type">int</span> newStart=points[j][<span class="number">0</span>];</span><br><span class="line">               <span class="keyword">if</span>(newStart&lt;oldStart)&#123;</span><br><span class="line">                   <span class="type">int</span>[] temp=points[i];</span><br><span class="line">                   points[i]=points[j];</span><br><span class="line">                   points[j]=temp;</span><br><span class="line">               &#125;<span class="keyword">else</span> <span class="keyword">if</span>(oldStart==newStart)&#123;</span><br><span class="line">                   <span class="type">int</span> oldEnd=points[i][<span class="number">1</span>];</span><br><span class="line">                   <span class="type">int</span> newEnd=points[j][<span class="number">1</span>];</span><br><span class="line">                   <span class="keyword">if</span>(newEnd&lt;oldEnd)&#123;</span><br><span class="line">                       <span class="type">int</span>[] temp=points[i];</span><br><span class="line">                       points[i]=points[j];</span><br><span class="line">                       points[j]=temp;</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-24"   >
          <a href="#提交失败-24" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-24" class="headerlink" title="提交失败"></a>提交失败</h5>
      
        <h4 id="第三次代码-6"   >
          <a href="#第三次代码-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#第三次代码-6" class="headerlink" title="第三次代码"></a>第三次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findMinArrowShots</span><span class="params">(<span class="type">int</span>[][] points)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(points.length==<span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        sortShots(points);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> END=Integer.MIN_VALUE;</span><br><span class="line">        <span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;points.length;i++)&#123;</span><br><span class="line">            <span class="type">int</span>[] point=points[i];</span><br><span class="line">            <span class="type">int</span> shotStart=point[<span class="number">0</span>];</span><br><span class="line">            <span class="type">int</span> shotEnd=point[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">if</span>(shotStart&lt;=END &amp;&amp; shotEnd&gt;=END) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                count++;</span><br><span class="line">                <span class="keyword">if</span>(END==Integer.MIN_VALUE)&#123;</span><br><span class="line">                    END=shotEnd;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    END=shotStart;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sortShots</span><span class="params">(<span class="type">int</span>[][]points)</span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;points.length;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=i;j&lt;points.length;j++)&#123;</span><br><span class="line">                <span class="type">int</span> oldGap=points[i][<span class="number">1</span>]-points[i][<span class="number">0</span>];</span><br><span class="line">                <span class="type">int</span> newGap=points[j][<span class="number">1</span>]-points[j][<span class="number">0</span>];</span><br><span class="line">                <span class="keyword">if</span>(oldGap&gt;newGap)&#123;</span><br><span class="line">                    <span class="type">int</span>[] temp=points[i];</span><br><span class="line">                    points[i]=points[j];</span><br><span class="line">                    points[j]=temp;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-25"   >
          <a href="#提交失败-25" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-25" class="headerlink" title="提交失败"></a>提交失败</h5>
      
        <h4 id="第四次提交"   >
          <a href="#第四次提交" class="heading-link"><i class="fas fa-link"></i></a><a href="#第四次提交" class="headerlink" title="第四次提交"></a>第四次提交</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findMinArrowShots</span><span class="params">(<span class="type">int</span>[][] points)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(points.length==<span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        sortShots(points);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> END=Integer.MIN_VALUE;</span><br><span class="line">        <span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line">        HashSet&lt;Integer&gt; hasShot=<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;points.length;i++)&#123;</span><br><span class="line">            <span class="type">int</span>[] point=points[i];</span><br><span class="line">            <span class="type">int</span> shotStart=point[<span class="number">0</span>];</span><br><span class="line">            <span class="type">int</span> shotEnd=point[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">if</span>(hasShot.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="type">boolean</span> flag=<span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> x:hasShot)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(shotStart&lt;=x &amp;&amp; shotEnd&gt;=x )&#123;</span><br><span class="line">                        flag=<span class="literal">false</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(!flag) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">                count++;</span><br><span class="line">                hasShot.add((shotEnd-shotStart)/<span class="number">2</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                count++;</span><br><span class="line">                hasShot.add((shotEnd-shotStart)/<span class="number">2</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sortShots</span><span class="params">(<span class="type">int</span>[][]points)</span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;points.length;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=i;j&lt;points.length;j++)&#123;</span><br><span class="line">                <span class="type">int</span> oldNum=points[i][<span class="number">0</span>];</span><br><span class="line">                <span class="type">int</span> newNum=points[j][<span class="number">0</span>];</span><br><span class="line">                <span class="keyword">if</span>(oldNum&gt;newNum)&#123;</span><br><span class="line">                    <span class="type">int</span>[] temp=points[i];</span><br><span class="line">                    points[i]=points[j];</span><br><span class="line">                    points[j]=temp;</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(oldNum==newNum)&#123;</span><br><span class="line">                    <span class="type">int</span> oldGap=points[i][<span class="number">1</span>]-points[i][<span class="number">0</span>];</span><br><span class="line">                    <span class="type">int</span> newGap=points[j][<span class="number">1</span>]-points[j][<span class="number">0</span>];</span><br><span class="line">                    <span class="keyword">if</span>(oldGap&gt;newGap)&#123;</span><br><span class="line">                        <span class="type">int</span>[] temp=points[i];</span><br><span class="line">                        points[i]=points[j];</span><br><span class="line">                        points[j]=temp;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-26"   >
          <a href="#提交失败-26" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-26" class="headerlink" title="提交失败"></a>提交失败</h5>
      
        <h3 id="题解-11"   >
          <a href="#题解-11" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-11" class="headerlink" title="题解"></a>题解</h3>
      <p>思路：我们先对气球进行排序，我们就从左边界由小到大排序，进而我们比较的时候只需要将<strong>前一个气球的右边界和当前气球的左边界比较</strong>即可，当不重叠的时候射出一支箭，当重叠的时候则更新最小右边界，保证一支箭能射爆全部重叠气球</p>
<blockquote>
<p>局部最优解：尽量将气球重叠在一起射，这样可以获取最小射箭数</p>
</blockquote>
<p><strong>实现</strong></p>
<ul>
<li><p>排序，对气球数组的左边界从小到大排序</p>
</li>
<li><p>定义变量count用于记录射出的剪数</p>
</li>
<li><p>遍历气球数组</p>
<ul>
<li><p>如果i&#x3D;&#x3D;0，说明是第一个气球，那么必然需要射出一支箭</p>
</li>
<li><p>如果i!&#x3D;0，那么比较当前气球是否和上一个气球重合</p>
<ul>
<li><p>如果当前气球的左边界大于上一个气球的右边界，说明不重合</p>
<p>需要射出一箭</p>
</li>
<li><p>如果当前气球的左边界小于上一个气球的右边界，说明重合</p>
<p>更新当前气球的右边界，使其成为重叠气球中的<strong>最小右边界</strong></p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>返回count</p>
</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findMinArrowShots</span><span class="params">(<span class="type">int</span>[][] points)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(points.length==<span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    	<span class="comment">//用内置函数进行排序</span></span><br><span class="line">        Arrays.sort(points,(a,b)-&gt; Integer.compare(a[<span class="number">0</span>],b[<span class="number">0</span>]));</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;points.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i==<span class="number">0</span>)&#123;</span><br><span class="line">                count++;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">			<span class="comment">//如果左边界大于前一个右边界说明不重叠</span></span><br><span class="line">            <span class="keyword">if</span>(points[i][<span class="number">0</span>]&gt;points[i-<span class="number">1</span>][<span class="number">1</span>])&#123;</span><br><span class="line">                count++;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//更新右边界</span></span><br><span class="line">                points[i][<span class="number">1</span>]=Math.min(points[i-<span class="number">1</span>][<span class="number">1</span>],points[i][<span class="number">1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h3 id="图解-1"   >
          <a href="#图解-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#图解-1" class="headerlink" title="图解"></a>图解</h3>
      <p><strong>题意分析</strong></p>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="https://images-kkblog.oss-cn-hangzhou.aliyuncs.com/image-20231007045358730.png"  alt="题意分析">
      </p>
<p>我们再举出一个例子如【1,2】，【1,10】，【3,6】，【5,9】，【10,12】</p>
<p>进而来分析需要几支箭</p>
<p><strong>用例排序之后</strong></p>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="https://images-kkblog.oss-cn-hangzhou.aliyuncs.com/image-20231007045920353.png"  alt="用例排序之后">
      </p>
<p><strong>求得箭数量过程</strong></p>
<p>因此我们在比较当前气球和上一个气球是否重叠的时候，比较<strong>当前气球的左边界是否大于前一个气球右边界</strong></p>
<p>如果气球左边界大于前一个气球右边界，说明不重叠直接count++</p>
<p>如果气球左边界小于前一个气球右边界，<strong>更新重叠气球最小右边界</strong>，保证一支箭能射爆全部重叠气球</p>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="https://images-kkblog.oss-cn-hangzhou.aliyuncs.com/image-20231007050516435.png"  alt="求得箭数量过程">
      </p>

        <h3 id="踩坑点"   >
          <a href="#踩坑点" class="heading-link"><i class="fas fa-link"></i></a><a href="#踩坑点" class="headerlink" title="踩坑点"></a>踩坑点</h3>
      <p>1.在对气球数组的左边界进行排序的时候，如果自己写一个<strong>冒泡排序</strong>，那么就会导致<strong>时间超时！</strong>，所以需要用内置的函数，或者选择其它排序算法排序！</p>
<p>2.如果用内置的函数<code>Arrays.sort()</code>，那么直接用<code>Arrays.sort(points,(a,b)-&gt; a[0]-b[0])</code>在进行Integer边界的数据进行排序，会导致数据溢出而排序出错，所以我们要用内置的排序方式<code>Arrays.sort(points,(a,b)-&gt;Integer.compare(a[0],b[0]))</code></p>

        <h2 id="435-无重叠区间"   >
          <a href="#435-无重叠区间" class="heading-link"><i class="fas fa-link"></i></a><a href="#435-无重叠区间" class="headerlink" title="435.无重叠区间"></a>435.无重叠区间</h2>
      <p>给定一个区间的集合 <code>intervals</code> ，其中 <code>intervals[i] = [starti, endi]</code> 。返回 <em>需要移除区间的最小数量，使剩余区间互不重叠</em> 。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/non-overlapping-intervals/description/" >Leetcode.435题(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-12"   >
          <a href="#第一次做-12" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-12" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;10&#x2F;08</p>

        <h4 id="第一次代码-12"   >
          <a href="#第一次代码-12" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-12" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">eraseOverlapIntervals</span><span class="params">(<span class="type">int</span>[][] intervals)</span> &#123;</span><br><span class="line">        sortErea(intervals);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(intervals.length==<span class="number">1</span>) <span class="keyword">return</span> count;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;intervals.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(intervals[i][<span class="number">0</span>]&lt;intervals[i-<span class="number">1</span>][<span class="number">1</span>])&#123;</span><br><span class="line">                count++;</span><br><span class="line">                intervals[i][<span class="number">1</span>]=intervals[i-<span class="number">1</span>][<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sortErea</span><span class="params">(<span class="type">int</span>[][] arr)</span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;arr.length;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=i+<span class="number">1</span>;j&lt;arr.length;j++)&#123;</span><br><span class="line">                <span class="type">int</span> val=arr[i][<span class="number">0</span>];</span><br><span class="line">                <span class="type">int</span> newVal=arr[j][<span class="number">0</span>];</span><br><span class="line">                <span class="keyword">if</span>(val&gt;newVal)&#123;</span><br><span class="line">                    <span class="type">int</span>[] temp=arr[i];</span><br><span class="line">                    arr[i]=arr[j];</span><br><span class="line">                    arr[j]=temp;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-27"   >
          <a href="#提交失败-27" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-27" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:intervals &#x3D;[[1,100],[11,22],[1,11],[2,12]]，输出3，预期输出2</p>

        <h4 id="第二次代码-11"   >
          <a href="#第二次代码-11" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码-11" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">eraseOverlapIntervals</span><span class="params">(<span class="type">int</span>[][] intervals)</span> &#123;</span><br><span class="line">        sortErea(intervals);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(intervals.length==<span class="number">1</span>) <span class="keyword">return</span> count;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;intervals.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(intervals[i][<span class="number">0</span>]&lt;intervals[i-<span class="number">1</span>][<span class="number">1</span>])&#123;</span><br><span class="line">                count++;</span><br><span class="line">                intervals[i][<span class="number">1</span>]=intervals[i-<span class="number">1</span>][<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sortErea</span><span class="params">(<span class="type">int</span>[][] arr)</span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;arr.length;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=i+<span class="number">1</span>;j&lt;arr.length;j++)&#123;</span><br><span class="line">                <span class="type">int</span> val=arr[i][<span class="number">0</span>];</span><br><span class="line">                <span class="type">int</span> newVal=arr[j][<span class="number">0</span>];</span><br><span class="line">                <span class="keyword">if</span>(val&gt;newVal)&#123;</span><br><span class="line">                    <span class="type">int</span>[] temp=arr[i];</span><br><span class="line">                    arr[i]=arr[j];</span><br><span class="line">                    arr[j]=temp;</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(val==newVal)&#123;</span><br><span class="line">                    <span class="type">int</span> oldEnd=arr[i][<span class="number">1</span>];</span><br><span class="line">                    <span class="type">int</span> newEnd=arr[j][<span class="number">1</span>];</span><br><span class="line">                    <span class="keyword">if</span>(oldEnd&gt;newEnd)&#123;</span><br><span class="line">                        <span class="type">int</span>[] temp=arr[i];</span><br><span class="line">                        arr[i]=arr[j];</span><br><span class="line">                        arr[j]=temp;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-28"   >
          <a href="#提交失败-28" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-28" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:intervals&#x3D;[[-52,31],[-73,-26],[82,97],[-65,-11],[-62,-49],[95,99],[58,95],[-31,49],[66,98],[-63,2],[30,47],[-40,-26]]，输出8，预期输出7</p>
<p>没做出来</p>

        <h3 id="题解-12"   >
          <a href="#题解-12" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-12" class="headerlink" title="题解"></a>题解</h3>
      <p>思路：这道题和上一道用射爆气球的题目相似，都是求取相同重叠区间，所以这道题本质上和那个题一样，求取消除重叠区间个数，也即<strong>求取重叠区间个数</strong></p>
<blockquote>
<p>局部最优解：通过左区间排序，这样尽量让区间都重叠在一起，这样就能判断出重叠区间的个数也即消除重叠区间个数</p>
</blockquote>
<p><strong>实现</strong></p>
<ul>
<li><p>对区间排序，通过左区间排序</p>
</li>
<li><p>统计重叠区间个数count</p>
</li>
<li><p>遍历从1开始，和前一个区间比较。当前区间的左区间小于前一个区间的右区间，说明重叠，个数++，并且更新重叠区间的右区间(使其成为<strong>最小右区间</strong>)</p>
</li>
<li><p>返回count</p>
</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">eraseOverlapIntervals</span><span class="params">(<span class="type">int</span>[][] intervals)</span> &#123;</span><br><span class="line">       Arrays.sort(intervals,(a,b)-&gt;&#123; <span class="keyword">return</span> a[<span class="number">0</span>]-b[<span class="number">0</span>];&#125;);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(intervals.length==<span class="number">1</span>) <span class="keyword">return</span> count;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;intervals.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(intervals[i][<span class="number">0</span>]&lt;intervals[i-<span class="number">1</span>][<span class="number">1</span>])&#123;</span><br><span class="line">                count++;</span><br><span class="line">                <span class="comment">//更新重叠区间的最小右区间</span></span><br><span class="line">                intervals[i][<span class="number">1</span>]=Math.min(intervals[i][<span class="number">1</span>],intervals[i-<span class="number">1</span>][<span class="number">1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>






        <h2 id="763-划分字母区间"   >
          <a href="#763-划分字母区间" class="heading-link"><i class="fas fa-link"></i></a><a href="#763-划分字母区间" class="headerlink" title="763.划分字母区间"></a>763.划分字母区间</h2>
      <p>给你一个字符串 <code>s</code> 。我们要把这个字符串划分为尽可能多的片段，同一字母最多出现在一个片段中。</p>
<p>注意，划分结果需要满足：将所有划分结果按顺序连接，得到的字符串仍然是 <code>s</code> 。</p>
<p>返回一个表示每个字符串片段的长度的列表。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/partition-labels/" >Leetcode.763(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-13"   >
          <a href="#第一次做-13" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-13" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;10&#x2F;09</p>

        <h4 id="第一次代码-13"   >
          <a href="#第一次代码-13" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-13" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">partitionLabels</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] used=<span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">26</span>];</span><br><span class="line">        <span class="type">char</span>[] arr=s.toCharArray();</span><br><span class="line">        List&lt;Integer&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> usedCount=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;arr.length;i++)&#123;</span><br><span class="line">            <span class="type">char</span> c=arr[i];</span><br><span class="line">            <span class="keyword">if</span>(used[c-<span class="string">&#x27;a&#x27;</span>]==<span class="number">0</span>)&#123;</span><br><span class="line">                used[c-<span class="string">&#x27;a&#x27;</span>]=usedCount;</span><br><span class="line">                usedCount++;</span><br><span class="line">                list.add(i);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(used[c-<span class="string">&#x27;a&#x27;</span>]!=<span class="number">0</span>)&#123;</span><br><span class="line">                usedCount=used[c-<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;used.length;j++)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(used[j]&gt;usedCount)&#123;</span><br><span class="line">                        used[j]=usedCount;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="type">int</span> size=list.size()-usedCount+<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;size;j++)&#123;</span><br><span class="line">                    list.remove(list.size()-<span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                list.add(i);</span><br><span class="line">                usedCount++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        List&lt;Integer&gt; result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> prex=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i:list)&#123;</span><br><span class="line">            result.add(i-prex);</span><br><span class="line">            prex=i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-29"   >
          <a href="#提交失败-29" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-29" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:s&#x3D;”ababcbacadefegdehijhklij”，输出[8,7,8],预期输出[9,7,8]</p>

        <h4 id="第二次代码-12"   >
          <a href="#第二次代码-12" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码-12" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">partitionLabels</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] used=<span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">26</span>];</span><br><span class="line">        <span class="type">char</span>[] arr=s.toCharArray();</span><br><span class="line">        List&lt;Integer&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> usedCount=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;arr.length;i++)&#123;</span><br><span class="line">            <span class="type">char</span> c=arr[i];</span><br><span class="line">            <span class="keyword">if</span>(used[c-<span class="string">&#x27;a&#x27;</span>]==<span class="number">0</span>)&#123;</span><br><span class="line">                used[c-<span class="string">&#x27;a&#x27;</span>]=usedCount;</span><br><span class="line">                usedCount++;</span><br><span class="line">                list.add(i);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(used[c-<span class="string">&#x27;a&#x27;</span>]!=<span class="number">0</span>)&#123;</span><br><span class="line">                usedCount=used[c-<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;used.length;j++)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(used[j]&gt;usedCount)&#123;</span><br><span class="line">                        used[j]=usedCount;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="type">int</span> size=list.size()-usedCount+<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;size;j++)&#123;</span><br><span class="line">                    list.remove(list.size()-<span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                list.add(i);</span><br><span class="line">                usedCount++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        List&lt;Integer&gt; result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> prex=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i:list)&#123;</span><br><span class="line">            <span class="keyword">if</span>(prex==<span class="number">0</span>)</span><br><span class="line">            result.add(i-prex+<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">else</span> </span><br><span class="line">            result.add(i-prex);</span><br><span class="line">            prex=i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-30"   >
          <a href="#提交失败-30" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-30" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:s&#x3D;”caedbdedda”</p>
<p>输出[1,10]</p>
<p>预期输出[1,9]</p>

        <h4 id="第三次代码-7"   >
          <a href="#第三次代码-7" class="heading-link"><i class="fas fa-link"></i></a><a href="#第三次代码-7" class="headerlink" title="第三次代码"></a>第三次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">partitionLabels</span><span class="params">(String s)</span> &#123;</span><br><span class="line">    	<span class="comment">//used数组用于表示当前字母属于第几个字符串</span></span><br><span class="line">        <span class="type">int</span>[] used=<span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">26</span>];</span><br><span class="line">        <span class="type">char</span>[] arr=s.toCharArray();</span><br><span class="line">    	<span class="comment">//list用于表示每个字符串的结束索引</span></span><br><span class="line">        List&lt;Integer&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    	<span class="comment">//用于统计字符串个数</span></span><br><span class="line">        <span class="type">int</span> usedCount=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;arr.length;i++)&#123;</span><br><span class="line">            <span class="type">char</span> c=arr[i];</span><br><span class="line">            <span class="comment">//如果前面字符串没有包含这个字符，尝试成为新的字符串</span></span><br><span class="line">            <span class="keyword">if</span>(used[c-<span class="string">&#x27;a&#x27;</span>]==<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="comment">//更新字符所在字符串个数</span></span><br><span class="line">                used[c-<span class="string">&#x27;a&#x27;</span>]=usedCount;</span><br><span class="line">                <span class="comment">//字符串个数++</span></span><br><span class="line">                usedCount++;</span><br><span class="line">                <span class="comment">//记录结束索引</span></span><br><span class="line">                list.add(i);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(used[c-<span class="string">&#x27;a&#x27;</span>]!=<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="comment">//说明这个字符在前面字符串包括了，那么就要将这个字符串的所有出现字母包括在前一个字符串中</span></span><br><span class="line">                usedCount=used[c-<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;used.length;j++)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(used[j]&gt;usedCount)&#123;</span><br><span class="line">                        used[j]=usedCount;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="type">int</span> size=list.size()-usedCount+<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;size;j++)&#123;</span><br><span class="line">                    list.remove(list.size()-<span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//记录前一个字符串的结束索引</span></span><br><span class="line">                list.add(i);</span><br><span class="line">                usedCount++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//用于记录结果，从list中获取每一个字符串的结束位置，转换成字符串长度保存在result中</span></span><br><span class="line">        List&lt;Integer&gt; result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span>[] resultArr=<span class="keyword">new</span> <span class="title class_">int</span>[list.size()];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;resultArr.length;i++)&#123;</span><br><span class="line">            resultArr[i]=list.get(i)+<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;resultArr.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i==<span class="number">0</span>)&#123;</span><br><span class="line">                result.add(resultArr[i]-<span class="number">0</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                result.add(resultArr[i]-resultArr[i-<span class="number">1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-7"   >
          <a href="#提交成功-7" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-7" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-13"   >
          <a href="#题解-13" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-13" class="headerlink" title="题解"></a>题解</h3>
      <p>思路：我们可以用给一个哈希表来统计每个字母的<strong>最远出现位置</strong>，那么<strong>每个字符串维持每个字符的最远出现位置都小于等于该字符串的结束位置</strong>，这样我们可以划分出多个字符串</p>
<blockquote>
<p>局部最优解：我们取得的每个字符串的结束位置一定要大于等于每个字母的最远出现位置</p>
</blockquote>
<p><strong>实现</strong></p>
<ul>
<li><p>定义一个哈希表used，用于记录每个字母的最远结束位置</p>
</li>
<li><p>遍历第一遍字符数组，记录每一个字母的最远出现位置：<code>used[sArr[i]-&#39;a&#39;]=i</code></p>
</li>
<li><p>定义两个变量left和right，left用于表示字符串的起始位置，right用于表示字符串的结束位置</p>
</li>
<li><p>定义结果集result，用于记录每个字符串的长度</p>
</li>
<li><p>遍历第二遍字符数组</p>
<ul>
<li>维持<strong>字符串的结束位置一定大于等于每个字母的最远出现位置</strong>：<code>right=Math.max(right,used[sArr[i]-&#39;a&#39;])</code>，记录right要在right和当前字母最远出现位置的最大值</li>
<li>如果i&#x3D;&#x3D;right，说明遍历到字符的结束位置，那么就该收获字符串<ul>
<li>获取每个字符串的长度，收获到结果集中：<code>result.add(right-left+1)</code></li>
<li>更新下一个字符串的起始位置：left&#x3D;i+1</li>
</ul>
</li>
</ul>
</li>
<li><p>返回结果集result</p>
</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">partitionLabels</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] used=<span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">26</span>];</span><br><span class="line">        <span class="type">char</span>[] sArr=s.toCharArray();</span><br><span class="line">        <span class="comment">//记录每个字母出现的最远下标</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;sArr.length;i++)&#123;</span><br><span class="line">            used[sArr[i]-<span class="string">&#x27;a&#x27;</span>]=i;</span><br><span class="line">        &#125;</span><br><span class="line">    	<span class="comment">//定义结果集    </span></span><br><span class="line">        List&lt;Integer&gt; result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    	<span class="comment">//字符串起始位置left和结束位置right</span></span><br><span class="line">        <span class="type">int</span> left=<span class="number">0</span>;<span class="type">int</span> right=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;sArr.length;i++)&#123;</span><br><span class="line">            <span class="comment">//保证在字符串中每个字母的最远出现位置right</span></span><br><span class="line">            right=Math.max(right,used[sArr[i]-<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line">            <span class="keyword">if</span>(right==i)&#123;</span><br><span class="line">                <span class="comment">//如果搜索到最远位置，那么就说明这个字符串的所有字母不会出现再其他位置</span></span><br><span class="line">                <span class="comment">//记录字符串长度，更新下一个字符串的起始位置</span></span><br><span class="line">                result.add(right-left+<span class="number">1</span>);</span><br><span class="line">                left=i+<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>




        <h2 id="56-合并区间"   >
          <a href="#56-合并区间" class="heading-link"><i class="fas fa-link"></i></a><a href="#56-合并区间" class="headerlink" title="56.合并区间"></a>56.合并区间</h2>
      <p>以数组 <code>intervals</code> 表示若干个区间的集合，其中单个区间为 <code>intervals[i] = [starti, endi]</code> 。请你合并所有重叠的区间，并返回 <em>一个不重叠的区间数组，该数组需恰好覆盖输入中的所有区间</em> 。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/merge-intervals/" >Leetcode.56题(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-14"   >
          <a href="#第一次做-14" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-14" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;10&#x2F;11</p>

        <h4 id="第一次代码-14"   >
          <a href="#第一次代码-14" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-14" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span>[][] merge(<span class="type">int</span>[][] intervals) &#123;</span><br><span class="line">        sortMerge(intervals);</span><br><span class="line"></span><br><span class="line">        List&lt;<span class="type">int</span>[] &gt; result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span>(intervals.length==<span class="number">1</span>) <span class="keyword">return</span> intervals;</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;intervals.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(intervals[i][<span class="number">0</span>]&lt;=intervals[i-<span class="number">1</span>][<span class="number">1</span>])&#123;</span><br><span class="line">                intervals[i][<span class="number">0</span>]=Math.min(intervals[i-<span class="number">1</span>][<span class="number">0</span>],intervals[i][<span class="number">0</span>]);</span><br><span class="line">                intervals[i][<span class="number">1</span>]=Math.max(intervals[i-<span class="number">1</span>][<span class="number">1</span>],intervals[i][<span class="number">1</span>]);</span><br><span class="line">                </span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                result.add(intervals[i-<span class="number">1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(i==intervals.length-<span class="number">1</span>)&#123;</span><br><span class="line">                    result.add(intervals[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result.toArray(<span class="keyword">new</span> <span class="title class_">int</span>[result.size()][<span class="number">2</span>]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">	<span class="comment">//排序</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sortMerge</span><span class="params">(<span class="type">int</span>[][] arr)</span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;arr.length;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=i+<span class="number">1</span>;j&lt;arr.length;j++)&#123;</span><br><span class="line">                <span class="type">int</span> oldStart=arr[i][<span class="number">0</span>];</span><br><span class="line">                <span class="type">int</span> newStart=arr[j][<span class="number">0</span>];</span><br><span class="line">                <span class="keyword">if</span>(oldStart&gt;newStart)&#123;</span><br><span class="line">                    <span class="type">int</span>[] temp=arr[i];</span><br><span class="line">                    arr[i]=arr[j];</span><br><span class="line">                    arr[j]=temp;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-8"   >
          <a href="#提交成功-8" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-8" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-14"   >
          <a href="#题解-14" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-14" class="headerlink" title="题解"></a>题解</h3>
      <p>思路：这道题和452射爆气球以及435无重叠区间都是同一个解法，当遇到重叠区间的时候这里将重叠区间进行<strong>合并</strong></p>
<blockquote>
<p>局部最优解：按照左边界从小打大排序使其重叠区间放在一起，那么当遇到不重叠区间的时候添加到新的结果集即可</p>
</blockquote>
<p><strong>实现</strong></p>
<ul>
<li>对原数组进行排序，按照左区间从小打大排序</li>
<li>定义一个结果集合Result，用于接收单个区间(局部最大的重叠区间)</li>
<li>遍历数组，判断区间是否重叠，由<strong>下一个区间判断和前一个区间的状态</strong><ul>
<li>当前区间的左区间小于等于上个区间的右边界：<strong>重叠</strong>，更新重叠区间的左边界和最大右边界</li>
<li>当前区间的左边界大于上个区间的右边界：<strong>不重叠</strong>，将上个重叠区间添加到结果集result中</li>
<li>如果当前区间是最后一个区间，那么添加到结果集中:<code>if(i==intervals.length-1) result.add(intervals[i])</code></li>
</ul>
</li>
<li>将结果集result转为二维数组输出:<code>return result.toArray(new int[result.size()][2]);</code></li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span>[][] merge(<span class="type">int</span>[][] intervals) &#123;</span><br><span class="line">        sortMerge(intervals);</span><br><span class="line"></span><br><span class="line">        List&lt;<span class="type">int</span>[] &gt; result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span>(intervals.length==<span class="number">1</span>) <span class="keyword">return</span> intervals;</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;intervals.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(intervals[i][<span class="number">0</span>]&lt;=intervals[i-<span class="number">1</span>][<span class="number">1</span>])&#123;</span><br><span class="line">                <span class="comment">//当前区间和上一个区间重叠</span></span><br><span class="line">                intervals[i][<span class="number">0</span>]=intervals[i-<span class="number">1</span>][<span class="number">0</span>]; <span class="comment">//更新左边界(重叠区间的最左边界)</span></span><br><span class="line">                intervals[i][<span class="number">1</span>]=Math.max(intervals[i-<span class="number">1</span>][<span class="number">1</span>],intervals[i][<span class="number">1</span>]);<span class="comment">//更新右边界(重叠区间的最右边界)</span></span><br><span class="line">                </span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//当前区间不是上一个区间的重叠部分，将上一个区间添加到结果集中</span></span><br><span class="line">                result.add(intervals[i-<span class="number">1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//如果是最后一个区间那么就添加到结果集中</span></span><br><span class="line">            <span class="keyword">if</span>(i==intervals.length-<span class="number">1</span>)&#123;</span><br><span class="line">                    result.add(intervals[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result.toArray(<span class="keyword">new</span> <span class="title class_">int</span>[result.size()][<span class="number">2</span>]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">	<span class="comment">//左区间从小打大排序</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sortMerge</span><span class="params">(<span class="type">int</span>[][] arr)</span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;arr.length;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=i+<span class="number">1</span>;j&lt;arr.length;j++)&#123;</span><br><span class="line">                <span class="type">int</span> oldStart=arr[i][<span class="number">0</span>];</span><br><span class="line">                <span class="type">int</span> newStart=arr[j][<span class="number">0</span>];</span><br><span class="line">                <span class="keyword">if</span>(oldStart&gt;newStart)&#123;</span><br><span class="line">                    <span class="type">int</span>[] temp=arr[i];</span><br><span class="line">                    arr[i]=arr[j];</span><br><span class="line">                    arr[j]=temp;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>






        <h2 id="738-单调递增的数字"   >
          <a href="#738-单调递增的数字" class="heading-link"><i class="fas fa-link"></i></a><a href="#738-单调递增的数字" class="headerlink" title="738.单调递增的数字"></a>738.单调递增的数字</h2>
      <p>当且仅当每个相邻位数上的数字 <code>x</code> 和 <code>y</code> 满足 <code>x &lt;= y</code> 时，我们称这个整数是<strong>单调递增</strong>的。</p>
<p>给定一个整数 <code>n</code> ，返回 <em>小于或等于 <code>n</code> 的最大数字，且数字呈 <strong>单调递增</strong></em> 。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/monotone-increasing-digits/description/" >Leetcode.738题(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-15"   >
          <a href="#第一次做-15" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-15" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;10&#x2F;12</p>

        <h4 id="第一次代码-15"   >
          <a href="#第一次代码-15" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-15" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">monotoneIncreasingDigits</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">       <span class="type">int</span> result=n;</span><br><span class="line">       <span class="keyword">while</span>(!isValid(result))&#123;</span><br><span class="line">           result--;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> result;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValid</span><span class="params">(<span class="type">int</span> result)</span>&#123;</span><br><span class="line">       <span class="type">int</span> old=result%<span class="number">10</span>;</span><br><span class="line">       result/=<span class="number">10</span>;</span><br><span class="line">       <span class="keyword">while</span>(result&gt;<span class="number">0</span>)&#123;</span><br><span class="line">           <span class="type">int</span> newValue=result%<span class="number">10</span>;</span><br><span class="line">           <span class="keyword">if</span>(newValue&gt;old) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">           result/=<span class="number">10</span>;</span><br><span class="line">           old=newValue;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-31"   >
          <a href="#提交失败-31" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-31" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>BF法超出时间限制</p>
<p>CASE:输入n&#x3D;853567367</p>

        <h4 id="第二次代码-13"   >
          <a href="#第二次代码-13" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码-13" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">public int monotoneIncreasingDigits(int n) &#123;</span><br><span class="line">        int result=n;</span><br><span class="line">        if(Valid(result))&#123;</span><br><span class="line">            return result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        int temp=n;</span><br><span class="line">        int old=n%10;</span><br><span class="line">        int count=0;</span><br><span class="line">        while(temp&gt;0)&#123;</span><br><span class="line">            old=temp%10;</span><br><span class="line">            temp/=10;</span><br><span class="line">            count++;</span><br><span class="line">            if(temp==0) break;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        result=0;</span><br><span class="line">        for(int i=0;i&lt;count;i++)&#123;</span><br><span class="line">            result+=old;</span><br><span class="line">            result*=10;</span><br><span class="line">        &#125;</span><br><span class="line">        if(Valid(result) &amp;&amp;result&lt;=n) return result;</span><br><span class="line"></span><br><span class="line">        result=old-1;</span><br><span class="line"></span><br><span class="line">        for(int i=1;i&lt;count;i++)&#123;</span><br><span class="line">            result*=10;</span><br><span class="line">            result+=9;</span><br><span class="line">        &#125;</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public boolean Valid(int n)&#123;</span><br><span class="line">        int old=n%10;</span><br><span class="line">        n/=10;</span><br><span class="line">        while(n&gt;0)&#123;</span><br><span class="line">            int newValue=n%10;</span><br><span class="line">            if(newValue&gt;old) return false;</span><br><span class="line">            n/=10;</span><br><span class="line">            old=newValue;</span><br><span class="line">        &#125;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>




        <h5 id="提交失败-32"   >
          <a href="#提交失败-32" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-32" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE：n&#x3D;120，输出99，预期输出119</p>

        <h4 id="第三次代码-8"   >
          <a href="#第三次代码-8" class="heading-link"><i class="fas fa-link"></i></a><a href="#第三次代码-8" class="headerlink" title="第三次代码"></a>第三次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">monotoneIncreasingDigits</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="type">int</span> result=n;</span><br><span class="line">        <span class="keyword">if</span>(Valid(result))&#123;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> temp=n;</span><br><span class="line">        <span class="type">int</span> old=n%<span class="number">10</span>;</span><br><span class="line">        <span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(temp&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            old=temp%<span class="number">10</span>;</span><br><span class="line">            temp/=<span class="number">10</span>;</span><br><span class="line">            count++;</span><br><span class="line">            <span class="keyword">if</span>(temp==<span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        result=old;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;count;i++)&#123;</span><br><span class="line">            result*=<span class="number">10</span>;</span><br><span class="line">            result+=<span class="number">9</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(!Valid(result) || result&gt;n)&#123;</span><br><span class="line">            result--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(Valid(result)) <span class="keyword">return</span> result;</span><br><span class="line"></span><br><span class="line">        result=old-<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;count;i++)&#123;</span><br><span class="line">            result*=<span class="number">10</span>;</span><br><span class="line">            result+=<span class="number">9</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">Valid</span><span class="params">(<span class="type">int</span> n)</span>&#123;</span><br><span class="line">        <span class="type">int</span> old=n%<span class="number">10</span>;</span><br><span class="line">        n/=<span class="number">10</span>;</span><br><span class="line">        <span class="keyword">while</span>(n&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="type">int</span> newValue=n%<span class="number">10</span>;</span><br><span class="line">            <span class="keyword">if</span>(newValue&gt;old) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            n/=<span class="number">10</span>;</span><br><span class="line">            old=newValue;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-33"   >
          <a href="#提交失败-33" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-33" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>超出时间限制</p>
<p>输入n&#x3D;963856657</p>

        <h4 id="第四次代码-4"   >
          <a href="#第四次代码-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#第四次代码-4" class="headerlink" title="第四次代码"></a>第四次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">monotoneIncreasingDigits</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line"></span><br><span class="line">        String str=<span class="string">&quot;&quot;</span>+n;</span><br><span class="line">        <span class="type">char</span>[] arr=str.toCharArray();</span><br><span class="line">        <span class="type">int</span> diffValue=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> equalsValue=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;arr.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(arr[i]&gt;arr[i-<span class="number">1</span>])&#123;</span><br><span class="line">                diffValue=i;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(arr[i]==arr[i-<span class="number">1</span>])&#123;</span><br><span class="line">                equalsValue=i;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(arr[i]&lt;arr[i-<span class="number">1</span>])&#123;</span><br><span class="line">                <span class="keyword">if</span>(i-<span class="number">1</span>==equalsValue)&#123;</span><br><span class="line">                    arr[diffValue]--;</span><br><span class="line">                    <span class="keyword">while</span>(equalsValue&lt;=arr.length-<span class="number">1</span>)&#123;</span><br><span class="line">                        <span class="keyword">if</span>(equalsValue==<span class="number">0</span>)&#123;</span><br><span class="line">                            equalsValue++;</span><br><span class="line">                            <span class="keyword">continue</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        arr[equalsValue++]=<span class="string">&#x27;9&#x27;</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    arr[i-<span class="number">1</span>]--;</span><br><span class="line">                    arr[i]=<span class="string">&#x27;9&#x27;</span>;</span><br><span class="line">                    <span class="keyword">if</span>(arr[i]&gt;arr[i-<span class="number">1</span>])&#123;</span><br><span class="line">                        diffValue=i;</span><br><span class="line">                    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(arr[i]==arr[i-<span class="number">1</span>])&#123;</span><br><span class="line">                        equalsValue=i;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(arr[<span class="number">0</span>]==<span class="string">&#x27;0&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;arr.length;i++)&#123;</span><br><span class="line">                arr[i]=<span class="string">&#x27;9&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        StringBuilder sb=<span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">char</span> c:arr)&#123;</span><br><span class="line">            sb.append(c);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> result=Integer.parseInt(sb.toString());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-34"   >
          <a href="#提交失败-34" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-34" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:输入n&#x3D;89888</p>
<p>输出88889</p>
<p>预期输出88999</p>
<p>没做出来</p>

        <h3 id="题解-15"   >
          <a href="#题解-15" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-15" class="headerlink" title="题解"></a>题解</h3>
      <p>思路：这道题因为从<strong>后往前</strong>遍历，这样才能更新数据也不会导致前往后遍历多次频繁更新数据，以至于搞混大小关系</p>
<blockquote>
<p>局部最优解：当出现i位置数字小于i-1位置数字时，i-1位置数字减减，i位置数字更新成9</p>
<p>例如  72,i-1为7,i为2，那么要更新成 i-1为6,i为9 也即72&#x3D;&gt;69</p>
</blockquote>
<p><strong>实现</strong></p>
<ul>
<li><p>先将数字转成字符数组方便对每一位操作</p>
</li>
<li><p>定义一个flag，标记需要转换成9的起始下标，初始化为Integer.MAX_VALUE，如果flag没变动说明最初的n就符合单调递增数字要求</p>
<ul>
<li>例如1000，那么flag为1，也即1之后需要转成9也即1000&#x3D;&gt;0999</li>
</ul>
</li>
<li><p>从后往前遍历字符数组</p>
<ul>
<li>当位置i数字小于位置i-1数字时候，将i-1位置数字减减，更新flag标记为i：<code>arr[i-1]--;flag=i;</code></li>
</ul>
</li>
<li><p>当遍历完数组，则开始更新flag下标之后的数字变成9：<code>for(int i=flag;i&lt;arr.length;i++) arr[i]=&#39;9&#39;</code></p>
</li>
<li><p>将字符数组转换回数字返回：<code>Integer.parseInt(String.valueOf(arr))</code></p>
</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">monotoneIncreasingDigits</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line"></span><br><span class="line">        String s=<span class="string">&quot;&quot;</span>+n;</span><br><span class="line">        <span class="type">char</span>[] arr=s.toCharArray();</span><br><span class="line">		<span class="comment">//定义一个标记flag，初始化为一个最大值，表示需要更新成9的下标索引</span></span><br><span class="line">        <span class="type">int</span> flag=Integer.MAX_VALUE;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=arr.length-<span class="number">1</span>;i&gt;<span class="number">0</span>;i--)&#123;</span><br><span class="line">            <span class="keyword">if</span>(arr[i]&lt;arr[i-<span class="number">1</span>])&#123;</span><br><span class="line">                arr[i-<span class="number">1</span>]--;</span><br><span class="line">                <span class="comment">//将flag记录</span></span><br><span class="line">                flag=i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    	</span><br><span class="line">    	<span class="comment">//将需要更新的下标flag之后的数字都更新成9</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=flag;i&lt;arr.length;i++)&#123;</span><br><span class="line">            arr[i]=<span class="string">&#x27;9&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     	<span class="comment">//将char[]数组转成String然后转成Integer返回   </span></span><br><span class="line">        <span class="keyword">return</span> Integer.parseInt(String.valueOf(arr));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>




        <h2 id="968-监控二叉树"   >
          <a href="#968-监控二叉树" class="heading-link"><i class="fas fa-link"></i></a><a href="#968-监控二叉树" class="headerlink" title="968.监控二叉树"></a>968.监控二叉树</h2>
      <p>给定一个二叉树，我们在树的节点上安装摄像头。</p>
<p>节点上的每个摄影头都可以监视<strong>其父对象、自身及其直接子对象。</strong></p>
<p>计算监控树的所有节点所需的最小摄像头数量。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/binary-tree-cameras/description/" >Leetcode.968题(hard)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-16"   >
          <a href="#第一次做-16" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-16" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;10&#x2F;12</p>

        <h4 id="第一次代码-16"   >
          <a href="#第一次代码-16" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-16" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">	<span class="type">int</span> need=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minCameraCover</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        searchTree(root);</span><br><span class="line">        <span class="keyword">return</span> need;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">searchTree</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> leftResult=searchTree(root.left);</span><br><span class="line">        <span class="type">int</span> rightResult=searchTree(root.right);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//如果是子结点是叶子节点，那么本结点加入监控</span></span><br><span class="line">        <span class="keyword">if</span>(leftResult==<span class="number">0</span> || rightResult==<span class="number">0</span>)&#123;</span><br><span class="line">            root.val=<span class="number">1</span>;</span><br><span class="line">            need++;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> root.val;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;、</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-35"   >
          <a href="#提交失败-35" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-35" class="headerlink" title="提交失败"></a>提交失败</h5>
      
        <h4 id="第二次代码-14"   >
          <a href="#第二次代码-14" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码-14" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="comment">//需要监控器数量</span></span><br><span class="line">	<span class="type">int</span> need=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minCameraCover</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="type">int</span> result=searchTree(root);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//如果根节点没被监控，那么就将根节点监控</span></span><br><span class="line">        <span class="keyword">if</span>(result==<span class="number">0</span>) need++;</span><br><span class="line">        <span class="keyword">return</span> need;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">searchTree</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">        <span class="comment">//如果结点为空返回-1</span></span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> leftResult=searchTree(root.left);</span><br><span class="line">        <span class="type">int</span> rightResult=searchTree(root.right);</span><br><span class="line">		</span><br><span class="line">        <span class="comment">//如果子结点是叶子结点，那么添加本结点作为监控</span></span><br><span class="line">        <span class="keyword">if</span>(leftResult==<span class="number">0</span> || rightResult==<span class="number">0</span>)&#123;</span><br><span class="line">            root.val=<span class="number">2</span>;</span><br><span class="line">            need++;</span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line">        <span class="comment">//如果子结点是监控结点，并且当前结点不是监控结点，那么就更新成为被监控的父节点</span></span><br><span class="line">        <span class="keyword">if</span>(leftResult==<span class="number">2</span> || rightResult==<span class="number">2</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(root.val&lt;<span class="number">2</span>) root.val=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> root.val;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-9"   >
          <a href="#提交成功-9" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-9" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-16"   >
          <a href="#题解-16" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-16" class="headerlink" title="题解"></a>题解</h3>
      <p>思路：我们遍历二叉树的时候需要<strong>后序遍历</strong>，从叶子节点开始增加摄像头，尽量要隔两个结点放一个摄像头</p>
<blockquote>
<p>局部最优解：从叶子结点开始，让叶子结点的父节点持有摄像头，然后尽量每隔两个结点放置一个摄像头</p>
</blockquote>
<p><strong>实现</strong></p>
<ul>
<li><p>定义全局变量need：需要的监控器数量</p>
</li>
<li><p>递归函数的参数和返回值</p>
<ul>
<li>参数root：当前处理的根节点</li>
<li>返回值<ul>
<li>-1：说明是空节点，遍历到空节点向上返回即可目的是结束递归</li>
<li>0：说明是没有被监控的结点</li>
<li>1：说明是监控器结点的父节点(被监控)</li>
<li>2：说明是监控器结点</li>
</ul>
</li>
</ul>
</li>
<li><p>递归函数的结束条件</p>
<p>当root&#x3D;&#x3D;null，也即空结点时候返回-1</p>
</li>
<li><p>单层递归的逻辑</p>
<ul>
<li>向左搜索结果，记录返回值为leftResult</li>
<li>向右搜索结果，记录返回值为rightResult</li>
<li>左右子结点有一个结点是0，那么该节点就应该添加监控器，状态修改为2：<code>if(leftResult==0 || rightResult==0)&#123;root.val=2;need++;&#125;</code></li>
<li>左右子结点有一个结点是监视器，并且当前结点不是监视器那么就更新结点状态为1：<code>if(leftResult==2||rightResult==2)&#123;if(root.val&lt;2) root.val=1;&#125;</code></li>
<li>返回结点的状态值，如果没被监控那么应该返回的值是0</li>
</ul>
</li>
<li><p>递归函数结束，判断根节点返回值是多少，如果根节点为0也即未被监控，那么根节点应该添加一个监控器：</p>
<p><code>if(result==0) need++;</code></p>
</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="comment">//需要监控器数量</span></span><br><span class="line">	<span class="type">int</span> need=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minCameraCover</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="type">int</span> result=searchTree(root);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//如果根节点没被监控，那么就将根节点监控</span></span><br><span class="line">        <span class="keyword">if</span>(result==<span class="number">0</span>) need++;</span><br><span class="line">        <span class="keyword">return</span> need;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">searchTree</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">        <span class="comment">//如果结点为空返回-1</span></span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> leftResult=searchTree(root.left);  <span class="comment">//左</span></span><br><span class="line">        <span class="type">int</span> rightResult=searchTree(root.right);<span class="comment">//右</span></span><br><span class="line">		</span><br><span class="line">        <span class="comment">//如果子结点是叶子结点，那么添加本结点作为监控</span></span><br><span class="line">        <span class="keyword">if</span>(leftResult==<span class="number">0</span> || rightResult==<span class="number">0</span>)&#123;</span><br><span class="line">            root.val=<span class="number">2</span>;</span><br><span class="line">            need++;</span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line">        <span class="comment">//如果子结点是监控结点，并且当前结点不是监控结点，那么就更新成为被监控的父节点</span></span><br><span class="line">        <span class="keyword">if</span>(leftResult==<span class="number">2</span> || rightResult==<span class="number">2</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(root.val&lt;<span class="number">2</span>) root.val=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> root.val;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>






        <h1 id="总结"   >
          <a href="#总结" class="heading-link"><i class="fas fa-link"></i></a><a href="#总结" class="headerlink" title="总结"></a>总结</h1>
      <p>贪心算法也就是类似<strong>常识性</strong>的解题，从思考方向要从<strong>局部最优解</strong>出发，然后在局<strong>部最优解推出全局最优解的时候没有反例</strong>，那么就假设认为<strong>局部最优解往全局推出的全局解就是全局最优解</strong>，下一章节进入<strong>动态规划</strong></p>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2023/09/13/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B-JUC%E7%AF%87%5B5-AQS%5D/">深入剖析并发编程-JUC篇[5-AQS]</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2023-09-13</span></span><span class="post-meta-item post-meta-item--wordcount"><span class="post-meta-item__icon"><i class="far fa-file-word"></i></span><span class="post-meta-item__info">字数统计</span><span class="post-meta-item__value">8k</span></span><span class="post-meta-item post-meta-item--readtime"><span class="post-meta-item__icon"><i class="far fa-clock"></i></span><span class="post-meta-item__info">阅读时长</span><span class="post-meta-item__value">55分</span></span></div></header><div class="post-body"><div class="post-excerpt"><p>AQS、Reentrantlock、ReadAndWriterLock</p>
<hr>
<ul>
<li>第一篇是JUC并发编程基础</li>
<li>第二篇是JMM、Volatile关键字、synchronize锁详解</li>
<li>第三篇是CAS机制原理、Unsafe魔法类、LockSupport工具类、ThreadLocal线程变量</li>
<li>第四篇是Atomic原子包源码详解</li>
<li>第五篇是AQS源码以及机制详解</li>
</ul>
<hr>
<p><strong>本篇前言</strong></p>
<p>在并发编程中，我们学习到了JUC的并发编程基础，了解了变量在计算机中的存储方式以及内存一致性协议，然后引入了JMM内存模型，并且了解了Volatile关键字怎么将变量可见性，然后为了不加锁我们引入了CAS乐观锁机制，通过Unsafe实现CAS机制，同时有了Atomic原子操作包，而后面乐观锁之后还有Synchronized悲观锁，但是Synchronized悲观锁又是隐式锁，再加锁和释放锁都不需要我们自己手动操作。于是接下来的就是悲观锁中的显式锁Lock，需要我们自己手动加锁和释放锁流程。</p>
<p>但是在提显式锁之前我们先得提一个AQS机制，一个锁再竞争失败之后需要一个容器来接受等待锁的线程，而这个就是AQS</p>

        <h1 id="AQS"   >
          <a href="#AQS" class="heading-link"><i class="fas fa-link"></i></a><a href="#AQS" class="headerlink" title="AQS"></a>AQS</h1>
      <p>AQS：AbstractQueuedSynchronizer也即抽象队列同步器，它是Java并发包的核心组件</p>
<p>我们直接从源码开始看起</p>

        <h2 id="成员变量以及内部类"   >
          <a href="#成员变量以及内部类" class="heading-link"><i class="fas fa-link"></i></a><a href="#成员变量以及内部类" class="headerlink" title="成员变量以及内部类"></a>成员变量以及内部类</h2>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//序列化ID</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">7373984972572414691L</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//同步队列的头指针</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">volatile</span> Node head;</span><br><span class="line"></span><br><span class="line"><span class="comment">//同步队列的尾指针</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">volatile</span> Node tail;</span><br><span class="line"></span><br><span class="line"><span class="comment">//锁的状态</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">int</span> state;</span><br><span class="line"><span class="comment">//Unsafe类以及对应偏移量</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Unsafe</span> <span class="variable">unsafe</span> <span class="operator">=</span> Unsafe.getUnsafe();</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> stateOffset;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> headOffset;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> tailOffset;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> waitStatusOffset;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> nextOffset;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p>又因为AbstractQueuedSynchronizer继承了<strong>AbstractOwnableSynchronizer</strong>所以还有一个成员变量</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//持锁线程</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> Thread exclusiveOwnerThread;</span><br></pre></td></tr></table></div></figure>

<p>也即AQS成员变量有<strong>队列头指针、队列尾指针、锁的状态字以及持锁线程</strong></p>
<p>而内部类有<strong>Node</strong>以及<strong>ConditionObject</strong></p>

        <h3 id="Node"   >
          <a href="#Node" class="heading-link"><i class="fas fa-link"></i></a><a href="#Node" class="headerlink" title="Node"></a>Node</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="comment">//共享模式</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Node</span> <span class="variable">SHARED</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>();</span><br><span class="line"><span class="comment">//独占模式</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Node</span> <span class="variable">EXCLUSIVE</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//以下是四个信号量 </span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">CANCELLED</span> <span class="operator">=</span>  <span class="number">1</span>;	<span class="comment">//表示线程已经结束</span></span><br><span class="line">        </span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SIGNAL</span>    <span class="operator">=</span> -<span class="number">1</span>;	<span class="comment">//表示等待被唤醒</span></span><br><span class="line">       </span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">CONDITION</span> <span class="operator">=</span> -<span class="number">2</span>;	<span class="comment">//表示在条件队列中</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">PROPAGATE</span> <span class="operator">=</span> -<span class="number">3</span>;	<span class="comment">//表示共享模式下同步行为会被传播</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//前结点指针</span></span><br><span class="line"><span class="keyword">volatile</span> Node prev;</span><br><span class="line"></span><br><span class="line"><span class="comment">//尾结点指针</span></span><br><span class="line"><span class="keyword">volatile</span> Node next;</span><br><span class="line"></span><br><span class="line"><span class="comment">//线程</span></span><br><span class="line"><span class="keyword">volatile</span> Thread thread;</span><br><span class="line"></span><br><span class="line"><span class="comment">//锁的状态</span></span><br><span class="line"><span class="keyword">volatile</span> <span class="type">int</span> waitStatus;</span><br><span class="line"></span><br><span class="line">Node nextWaiter;</span><br><span class="line"></span><br><span class="line"><span class="comment">//空参构造用于创建队列的头或者共享标记</span></span><br><span class="line">Node() &#123;    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//用于添加Node</span></span><br><span class="line">Node(Thread thread, Node mode) &#123;     <span class="comment">// Used by addWaiter</span></span><br><span class="line">      <span class="built_in">this</span>.nextWaiter = mode;</span><br><span class="line">      <span class="built_in">this</span>.thread = thread;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//用于Condition创建Node</span></span><br><span class="line">Node(Thread thread, <span class="type">int</span> waitStatus) &#123; <span class="comment">// Used by Condition</span></span><br><span class="line">            <span class="built_in">this</span>.waitStatus = waitStatus;</span><br><span class="line">            <span class="built_in">this</span>.thread = thread;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>也即Node的成员变量有<strong>锁的模式、锁的状态字、锁的信号量、前一结点指针、下一结点指针、线程、nextWaiter</strong></p>
<p>而Node中的方法我们会具体碰到的时候再进行展开</p>

        <h3 id="ConditionObject"   >
          <a href="#ConditionObject" class="heading-link"><i class="fas fa-link"></i></a><a href="#ConditionObject" class="headerlink" title="ConditionObject"></a>ConditionObject</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//头结点指针 firstWaiter</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> Node firstWaiter;</span><br><span class="line"></span><br><span class="line"><span class="comment">//尾结点指针	lastWaiter</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> Node lastWaiter;</span><br><span class="line"></span><br><span class="line"><span class="comment">//下面是两个中断标志位</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">REINTERRUPT</span> <span class="operator">=</span>  <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">THROW_IE</span>    <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p>因此目前已知情报可公开的数据可能如图所示(<strong>假设</strong>)，我们带着这个假设的模型去进行学习也许可能会更简单一些</p>
<p><em>猜想模型有误，只是提供一个最初印象的模型图，仅供参考</em></p>
<p><strong>同步队列猜测模型</strong></p>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B-JUC%E7%AF%87%5B5-AQS%5D/image-20230928181044445.png"  alt="同步队列猜测模型">
      </p>
<p><strong>条件队列猜测模型</strong></p>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B-JUC%E7%AF%87%5B5-AQS%5D/image-20230928181742497.png"  alt="条件队列猜测模型">
      </p>
<p>又因为Reentrantlock中的加锁调用了acquire方法，而这个方法在AQS中声明，所以我们要了解加锁过程必然要从acquire方法入手</p>

        <h2 id="同步队列"   >
          <a href="#同步队列" class="heading-link"><i class="fas fa-link"></i></a><a href="#同步队列" class="headerlink" title="同步队列"></a>同步队列</h2>
      
        <h3 id="acquire方法"   >
          <a href="#acquire方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#acquire方法" class="headerlink" title="acquire方法"></a>acquire方法</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">acquire</span><span class="params">(<span class="type">int</span> arg)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!tryAcquire(arg) &amp;&amp;</span><br><span class="line">            acquireQueued(addWaiter(Node.EXCLUSIVE), arg))</span><br><span class="line">            selfInterrupt();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>

<p>我们按照总分总的顺序拆分一点点理解代码</p>
<p>1.先调用tryAcquire方法，返回结果为true的时候，直接判断为false也即不会进行逻辑与后面的方法</p>
<p>2.当调用tryAcquire方法，返回结果为false的时候，调用acquireQueued方法</p>
<p>也即：先调用tryAcquire，当tryAcquire不成功则进行acquireQueued方法</p>
<p>进入if语句的情况：</p>
<ul>
<li><strong>tryAcquire失败并且acquireQueued成功</strong></li>
</ul>

        <h3 id="tryAcquire方法"   >
          <a href="#tryAcquire方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#tryAcquire方法" class="headerlink" title="tryAcquire方法"></a>tryAcquire方法</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//尝试以独占模式获取锁，具体操作由对应子类实现</span></span><br><span class="line"><span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">tryAcquire</span><span class="params">(<span class="type">int</span> arg)</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>

<p>当tryAcquire失败，也即获取锁失败，那么说明锁被独占了，<strong>也即进入acquireQueued方法说明获取锁失败有线程竞争</strong></p>

        <h3 id="acquireQueued方法"   >
          <a href="#acquireQueued方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#acquireQueued方法" class="headerlink" title="acquireQueued方法"></a>acquireQueued方法</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这里传参中还调用了一个addWaiter(Node.EXCLUSIVE), arg)</span></span><br><span class="line">acquireQueued(addWaiter(Node.EXCLUSIVE), arg))</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">acquireQueued</span><span class="params">(<span class="keyword">final</span> Node node, <span class="type">int</span> arg)</span> &#123;</span><br><span class="line">        </span><br><span class="line">    	<span class="type">boolean</span> <span class="variable">failed</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//中断标志位为false</span></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">interrupted</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">                <span class="comment">//获取当前结点的前一个结点p</span></span><br><span class="line">                <span class="keyword">final</span> <span class="type">Node</span> <span class="variable">p</span> <span class="operator">=</span> node.predecessor();</span><br><span class="line">                <span class="comment">/**</span></span><br><span class="line"><span class="comment">                	第一个if语句中先判断前一个结点p是否是头结点</span></span><br><span class="line"><span class="comment">                	只有是头结点才会去尝试加锁</span></span><br><span class="line"><span class="comment">                */</span></span><br><span class="line">                <span class="keyword">if</span> (p == head &amp;&amp; tryAcquire(arg)) &#123;</span><br><span class="line">                    <span class="comment">//成功获取锁，更新AQS同步器头结点，移动同步队列，将failed置为false</span></span><br><span class="line">                    setHead(node);</span><br><span class="line">                    p.next = <span class="literal">null</span>; <span class="comment">// help GC</span></span><br><span class="line">                    failed = <span class="literal">false</span>;</span><br><span class="line">                    <span class="comment">//return 中断标志位</span></span><br><span class="line">                    <span class="keyword">return</span> interrupted;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">/**</span></span><br><span class="line"><span class="comment">                	第一个if语句判断为false就来到第二个if语句，而第一个if失败的可能有</span></span><br><span class="line"><span class="comment">                		1.前一个结点p不是头结点，所以没有资格获取锁</span></span><br><span class="line"><span class="comment">                		2.前一个结点是p但是没有获取锁成功</span></span><br><span class="line"><span class="comment">                */</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment">//失败获取锁之后阻塞，阻塞线程并检查中断位，如果中断位为true则更新中断标志位为true</span></span><br><span class="line">                <span class="keyword">if</span> (shouldParkAfterFailedAcquire(p, node) &amp;&amp;</span><br><span class="line">                    parkAndCheckInterrupt())</span><br><span class="line">                    interrupted = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">           	<span class="comment">/**</span></span><br><span class="line"><span class="comment">           		因为finally方法一定会执行，而acquireQueued方法什么时候会结束</span></span><br><span class="line"><span class="comment">           			1.当获取锁成功，failed==false</span></span><br><span class="line"><span class="comment">           			2.当try中的方法报错，而当try中的方法报错有什么情况</span></span><br><span class="line"><span class="comment">           				2-1.锁的状态state&gt;Integer.MAX_VALUE,也即可重入次数超过上限</span></span><br><span class="line"><span class="comment">           				2-2.当子类的tryAcquire方法报错</span></span><br><span class="line"><span class="comment">            	也即:情况1则说明正常结束，不会走 cancelAcquire方法</span></span><br><span class="line"><span class="comment">            		情况2则说明报错结束，会走 cancelAcquire方法</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">           </span><br><span class="line">            <span class="keyword">if</span> (failed)</span><br><span class="line">                <span class="comment">//怎么都获取不到锁，移除当前线程结点，唤醒之后的线程</span></span><br><span class="line">                cancelAcquire(node);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p>因为先调用了addWaiter方法所以我们先看向addWaiter方法，看完之后再来具体看acquireQueued方法做了什么事</p>

        <h3 id="addWaiter方法"   >
          <a href="#addWaiter方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#addWaiter方法" class="headerlink" title="addWaiter方法"></a>addWaiter方法</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Node <span class="title function_">addWaiter</span><span class="params">(Node mode)</span> &#123;</span><br><span class="line">    	<span class="comment">//new一个Node对象，传入参数有当前线程和锁的模式</span></span><br><span class="line">        <span class="type">Node</span> <span class="variable">node</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(Thread.currentThread(), mode);</span><br><span class="line">		<span class="comment">//将尾结点指针赋值给pred</span></span><br><span class="line">        <span class="type">Node</span> <span class="variable">pred</span> <span class="operator">=</span> tail;</span><br><span class="line">    	</span><br><span class="line">    	<span class="comment">//判断尾结点是否为空</span></span><br><span class="line">        <span class="keyword">if</span> (pred != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">//当尾结点不为空，说明有同步队列</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">//将new出来的对象的前驱结点指向pred</span></span><br><span class="line">            node.prev = pred;</span><br><span class="line">            <span class="comment">//CAS更新尾结点</span></span><br><span class="line">            <span class="keyword">if</span> (compareAndSetTail(pred, node)) &#123;</span><br><span class="line">                <span class="comment">//如果更新尾结点成功，将pred指向node结点</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment">//也即更新AQS尾指针，并且更新同步队列</span></span><br><span class="line">                pred.next = node;</span><br><span class="line">                <span class="keyword">return</span> node;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    	<span class="comment">/**</span></span><br><span class="line"><span class="comment">    	运行到这里有两个情况：</span></span><br><span class="line"><span class="comment">    		1.同步队列为空，调用enq方法</span></span><br><span class="line"><span class="comment">    		2.CAS更新尾结点失败，说明线程竞争入同步队列失败</span></span><br><span class="line"><span class="comment">    	*/</span></span><br><span class="line">        enq(node);</span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>

<p>那么我们接下来要看向enq方法，看看具体怎么入队</p>

        <h3 id="enq方法"   >
          <a href="#enq方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#enq方法" class="headerlink" title="enq方法"></a>enq方法</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Node <span class="title function_">enq</span><span class="params">(<span class="keyword">final</span> Node node)</span> &#123;</span><br><span class="line">        <span class="comment">//死循环不断尝试入队</span></span><br><span class="line">    	<span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            <span class="comment">//获取尾指针</span></span><br><span class="line">            <span class="type">Node</span> <span class="variable">t</span> <span class="operator">=</span> tail;</span><br><span class="line">            <span class="comment">//当尾指针为空说明队列为空，则需要对同步队列初始化</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (t == <span class="literal">null</span>) &#123; <span class="comment">// Must initialize</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment">//同步队列初始化，初始化成功之后tail！=null</span></span><br><span class="line">                <span class="keyword">if</span> (compareAndSetHead(<span class="keyword">new</span> <span class="title class_">Node</span>()))</span><br><span class="line">                    tail = head;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">//说明同步队列存在，将node入队</span></span><br><span class="line">                <span class="comment">//原先尾结点设置为当前结点的前驱结点</span></span><br><span class="line">                node.prev = t;</span><br><span class="line">                <span class="comment">//CAS设置尾指针，设置尾指针成功再更新队列</span></span><br><span class="line">                <span class="keyword">if</span> (compareAndSetTail(t, node)) &#123;</span><br><span class="line">                    t.next = node;</span><br><span class="line">                    <span class="comment">//返回t，尾结点的前一个结点(也即原先的尾结点)</span></span><br><span class="line">                    <span class="keyword">return</span> t;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>

<p>这个方法做了两件事</p>
<ul>
<li>1.当队列为空的时候，初始化队列，并且队列的头结点为新的node结点(空参构造)</li>
<li>2.当队列不为空的时候，将node结点入队，更新AQS同步器也更新同步队列</li>
</ul>
<p>返回了<strong>当前结点的前一个结点</strong></p>

        <h4 id="enq方法流程图"   >
          <a href="#enq方法流程图" class="heading-link"><i class="fas fa-link"></i></a><a href="#enq方法流程图" class="headerlink" title="enq方法流程图"></a>enq方法流程图</h4>
      <p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B-JUC%E7%AF%87%5B5-AQS%5D/image-20230929131807036.png"  alt="enq方法流程图">
      </p>
<p><strong>enq方法当同步队列为空时</strong></p>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B-JUC%E7%AF%87%5B5-AQS%5D/image-20230929132619749.png"  alt="同步队列初始化">
      </p>
<p><strong>enq方法当同步队列不为空时</strong></p>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B-JUC%E7%AF%87%5B5-AQS%5D/image-20230930202252236.png"  alt="当同步队列不为空">
      </p>
<p>也即同步队列如果存在，那么<strong>同步队列的第一个结点是空参构造的结点</strong>，可以把它看成当前持锁线程</p>
<p>enq方法将队列初始化或者将新结点添加到队尾，于是我们反过头来看<strong>acquireQueued</strong>方法做了什么事</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">acquireQueued</span><span class="params">(<span class="keyword">final</span> Node node, <span class="type">int</span> arg)</span> &#123;</span><br><span class="line">        </span><br><span class="line">    	<span class="type">boolean</span> <span class="variable">failed</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//中断标志位为false</span></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">interrupted</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">                <span class="comment">//获取当前结点的前一个结点p</span></span><br><span class="line">                <span class="keyword">final</span> <span class="type">Node</span> <span class="variable">p</span> <span class="operator">=</span> node.predecessor();</span><br><span class="line">                <span class="comment">/**</span></span><br><span class="line"><span class="comment">                	第一个if语句中先判断前一个结点p是否是头结点</span></span><br><span class="line"><span class="comment">                	只有是头结点才会去尝试加锁</span></span><br><span class="line"><span class="comment">                */</span></span><br><span class="line">                <span class="keyword">if</span> (p == head &amp;&amp; tryAcquire(arg)) &#123;</span><br><span class="line">                    <span class="comment">//成功获取锁，更新AQS同步器头结点，移动同步队列，将failed置为false</span></span><br><span class="line">                    setHead(node);</span><br><span class="line">                    p.next = <span class="literal">null</span>; <span class="comment">// help GC</span></span><br><span class="line">                    failed = <span class="literal">false</span>;</span><br><span class="line">                    <span class="comment">//return 中断标志位</span></span><br><span class="line">                    <span class="keyword">return</span> interrupted;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">/**</span></span><br><span class="line"><span class="comment">                	第一个if语句判断为false就来到第二个if语句，而第一个if失败的可能有</span></span><br><span class="line"><span class="comment">                		1.前一个结点p不是头结点，所以没有资格获取锁</span></span><br><span class="line"><span class="comment">                		2.前一个结点是p但是没有获取锁成功</span></span><br><span class="line"><span class="comment">                */</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment">//失败获取锁之后阻塞，阻塞线程并检查中断位，如果中断位为true则更新中断标志位为true</span></span><br><span class="line">                <span class="keyword">if</span> (shouldParkAfterFailedAcquire(p, node) &amp;&amp;</span><br><span class="line">                    parkAndCheckInterrupt())</span><br><span class="line">                    interrupted = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">           	<span class="comment">/**</span></span><br><span class="line"><span class="comment">           		因为finally方法一定会执行，而acquireQueued方法什么时候会结束</span></span><br><span class="line"><span class="comment">           			1.当获取锁成功，failed==false</span></span><br><span class="line"><span class="comment">           			2.当try中的方法报错，而当try中的方法报错有什么情况</span></span><br><span class="line"><span class="comment">           				2-1.锁的状态state&gt;Integer.MAX_VALUE,也即可重入次数超过上限</span></span><br><span class="line"><span class="comment">           				2-2.当子类的tryAcquire方法报错</span></span><br><span class="line"><span class="comment">            	也即:情况1则说明正常结束，不会走 cancelAcquire方法</span></span><br><span class="line"><span class="comment">            		情况2则说明报错结束，会走 cancelAcquire方法</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">           </span><br><span class="line">            <span class="keyword">if</span> (failed)</span><br><span class="line">                <span class="comment">//怎么都获取不到锁，移除当前线程结点，唤醒之后的线程</span></span><br><span class="line">                cancelAcquire(node);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Node中的方法，目的是获取当前结点的前一个结点</span></span><br><span class="line"><span class="keyword">final</span> Node <span class="title function_">predecessor</span><span class="params">()</span> <span class="keyword">throws</span> NullPointerException &#123;</span><br><span class="line">            <span class="comment">//获取当前结点的前一个结点</span></span><br><span class="line">    		<span class="type">Node</span> <span class="variable">p</span> <span class="operator">=</span> prev;</span><br><span class="line">            <span class="keyword">if</span> (p == <span class="literal">null</span>)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>();</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">return</span> p;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></div></figure>

<p><strong>当请求结点是头结点的下一个结点</strong></p>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B-JUC%E7%AF%87%5B5-AQS%5D/image-20230930202739393.png"  alt="更新结点前">
      </p>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B-JUC%E7%AF%87%5B5-AQS%5D/image-20230930202812518.png"  alt="更新结点后">
      </p>
<p><strong>当请求结点前一个结点不是头结点</strong></p>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B-JUC%E7%AF%87%5B5-AQS%5D/image-20230930203116496.png"  alt="请求结点前一个结点不是头结点">
      </p>

        <h3 id="shouldParkAfterFailedAcquire方法"   >
          <a href="#shouldParkAfterFailedAcquire方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#shouldParkAfterFailedAcquire方法" class="headerlink" title="shouldParkAfterFailedAcquire方法"></a>shouldParkAfterFailedAcquire方法</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">shouldParkAfterFailedAcquire</span><span class="params">(Node pred, Node node)</span> &#123;</span><br><span class="line">        <span class="comment">//获取pred中的锁的状态字</span></span><br><span class="line">    	<span class="type">int</span> <span class="variable">ws</span> <span class="operator">=</span> pred.waitStatus;</span><br><span class="line">    	</span><br><span class="line">        <span class="keyword">if</span> (ws == Node.SIGNAL)</span><br><span class="line">            <span class="comment">//当ws==Node.SIGNAL也即ws==-1，意思是当前结点已经阻塞</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (ws &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//当ws&gt;0 也即ws==Node.CANCELLED==1，也即这个结点无效需要退出同步队列</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">//将pred移除同步队列</span></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">            	将pred指向前一个结点，将node的前一个结点指向pred</span></span><br><span class="line"><span class="comment">            	也即删除同步队列的pred结点</span></span><br><span class="line"><span class="comment">            	直到pred.waitStatus&lt;=0 说明结点有效</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                node.prev = pred = pred.prev;</span><br><span class="line">            &#125; <span class="keyword">while</span> (pred.waitStatus &gt; <span class="number">0</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//找到有效结点，链接双向链表更新pred结点</span></span><br><span class="line">            pred.next = node;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//当ws==0 || ws==-2 || ws==-3</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">//说明pred结点是需要更新成SINGAL状态，也即将状态字置为-1表示阻塞</span></span><br><span class="line">            compareAndSetWaitStatus(pred, ws, Node.SIGNAL);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p>shouldParkAfterFailedAcquire方法就是更新waitStatus状态字</p>
<blockquote>
<p>ws&#x3D;pred.waitStatus</p>
<p>static final int CANCELLED &#x3D;  1;	&#x2F;&#x2F;表示线程已经结束</p>
<p>static final int SIGNAL    &#x3D; -1;	&#x2F;&#x2F;表示等待被唤醒</p>
<p>static final int CONDITION &#x3D; -2;	&#x2F;&#x2F;表示在条件队列中 </p>
<p>static final int PROPAGATE &#x3D; -3;	&#x2F;&#x2F;在共享状态表示同步状态会被传播</p>
</blockquote>
<ul>
<li><p>ws &#x3D;&#x3D; -1(ws &#x3D;&#x3D; Node.SIGNAL)</p>
<p>意思是当前已经在阻塞队列中，所以不用操作直接返回true</p>
</li>
<li><p>ws &gt; 0 (ws &#x3D;&#x3D; Node.CANCELLED)</p>
<p>意思是这个结点线程已经结束或者无效，所以需要删除这个结点，直到结点指向一个正常的结点</p>
</li>
<li><p>ws &#x3D;&#x3D; 0 || ws &#x3D;&#x3D; -2 ||ws&#x3D;&#x3D;-3</p>
<p>用CAS更新ws状态成-1</p>
<ul>
<li>ws &#x3D;&#x3D; 0 :表示线程在活跃中</li>
<li>ws &#x3D;&#x3D; -2:表示线程在条件队列中</li>
<li>ws &#x3D;&#x3D; -3:表示线程在共享模式下的同步状态会被传播</li>
</ul>
</li>
</ul>
<p>当更新状态字成功，要调用pardAndCheckInterrupt方法</p>

        <h3 id="parkAndCheckInterrupt方法"   >
          <a href="#parkAndCheckInterrupt方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#parkAndCheckInterrupt方法" class="headerlink" title="parkAndCheckInterrupt方法"></a>parkAndCheckInterrupt方法</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//调用LockSupport工具类下的park方法阻塞当前线程，然后返回线程的中断标志位</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">parkAndCheckInterrupt</span><span class="params">()</span> &#123;</span><br><span class="line">        LockSupport.park(<span class="built_in">this</span>);</span><br><span class="line">        <span class="keyword">return</span> Thread.interrupted();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h3 id="cancelAcquire方法"   >
          <a href="#cancelAcquire方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#cancelAcquire方法" class="headerlink" title="cancelAcquire方法"></a>cancelAcquire方法</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">cancelAcquire</span><span class="params">(Node node)</span> &#123;</span><br><span class="line">    <span class="comment">//如果node为空则结束，肯定不在同步队列中</span></span><br><span class="line">    <span class="keyword">if</span> (node == <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    </span><br><span class="line">	<span class="comment">//将node的线程置为空</span></span><br><span class="line">    node.thread = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取node的前一个结点</span></span><br><span class="line">    <span class="type">Node</span> <span class="variable">pred</span> <span class="operator">=</span> node.prev;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//将node的前驱结点指向一个有效的结点</span></span><br><span class="line">    <span class="keyword">while</span> (pred.waitStatus &gt; <span class="number">0</span>)</span><br><span class="line">        node.prev = pred = pred.prev;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//predNext记录移动后的pred指针的下一个结点</span></span><br><span class="line">    <span class="type">Node</span> <span class="variable">predNext</span> <span class="operator">=</span> pred.next;</span><br><span class="line"></span><br><span class="line">  	<span class="comment">//将node的ws设置成1</span></span><br><span class="line">    node.waitStatus = Node.CANCELLED;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">		如果node结点是尾结点，则进入if语句中移除尾结点</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">    <span class="keyword">if</span> (node == tail &amp;&amp; compareAndSetTail(node, pred)) &#123;</span><br><span class="line"></span><br><span class="line">        compareAndSetNext(pred, predNext, <span class="literal">null</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="comment">//node在中间结点</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">        	进入下方if语句有两种情况</span></span><br><span class="line"><span class="comment">        	1.pred不是头结点并且pred的线程存在以及ws==SIGNAL</span></span><br><span class="line"><span class="comment">        	2.pred不是头结点并且pred的线程存在以及ws被设置成SIGNAL</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="type">int</span> ws;</span><br><span class="line">        <span class="keyword">if</span> (pred != head &amp;&amp;</span><br><span class="line">           ((ws = pred.waitStatus) == Node.SIGNAL ||</span><br><span class="line">             (ws &lt;= <span class="number">0</span> &amp;&amp; compareAndSetWaitStatus(pred, ws, Node.SIGNAL))) &amp;&amp;</span><br><span class="line">            pred.thread != <span class="literal">null</span>) &#123;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//将next指向下一个结点</span></span><br><span class="line">            <span class="type">Node</span> <span class="variable">next</span> <span class="operator">=</span> node.next;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//next是有效结点，则设置pred的后继结点是next</span></span><br><span class="line">            <span class="keyword">if</span> (next != <span class="literal">null</span> &amp;&amp; next.waitStatus &lt;= <span class="number">0</span>)</span><br><span class="line">                compareAndSetNext(pred, predNext, next);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        </span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">            	运行到这里有几种可能性</span></span><br><span class="line"><span class="comment">            	1.pred是头结点，也即前驱结点是头结点</span></span><br><span class="line"><span class="comment">            	2.pred的线程不存在</span></span><br><span class="line"><span class="comment">            	3.pred的状态不是SIGNAL</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">//唤醒线程</span></span><br><span class="line">            unparkSuccessor(node);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//后继结点指向自己</span></span><br><span class="line">        node.next = node; <span class="comment">// help GC</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p><strong>Node结点在队尾，移除队尾元素</strong></p>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B-JUC%E7%AF%87%5B5-AQS%5D/image-20230930180647588.png"  alt="Node结点在队尾">
      </p>
<p><strong>Node结点在队中，移除Node结点</strong></p>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B-JUC%E7%AF%87%5B5-AQS%5D/image-20230930180804316.png"  alt="Node结点在队中">
      </p>

        <h3 id="unparkSuccessor方法"   >
          <a href="#unparkSuccessor方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#unparkSuccessor方法" class="headerlink" title="unparkSuccessor方法"></a>unparkSuccessor方法</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">unparkSuccessor</span><span class="params">(Node node)</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//获取Node结点的waitStatus</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">ws</span> <span class="operator">=</span> node.waitStatus;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//node有效将ws置为0，意思为活跃中</span></span><br><span class="line">    <span class="keyword">if</span> (ws &lt; <span class="number">0</span>)</span><br><span class="line">        compareAndSetWaitStatus(node, ws, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    	从同步队列的后面往前找，第一个靠近node的结点s</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="type">Node</span> <span class="variable">s</span> <span class="operator">=</span> node.next;</span><br><span class="line">    <span class="keyword">if</span> (s == <span class="literal">null</span> || s.waitStatus &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        s = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">Node</span> <span class="variable">t</span> <span class="operator">=</span> tail; t != <span class="literal">null</span> &amp;&amp; t != node; t = t.prev)</span><br><span class="line">            <span class="keyword">if</span> (t.waitStatus &lt;= <span class="number">0</span>)</span><br><span class="line">                s = t;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//唤醒结点s</span></span><br><span class="line">    <span class="keyword">if</span> (s != <span class="literal">null</span>)</span><br><span class="line">        LockSupport.unpark(s.thread);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>这里也即Acquire方法的全部流程，由此我们也可得出一个结论</p>
<p><strong>AQS是一个非公平同步器，当线程需要加锁的时候会直接进行tryAcquire加锁，只有加锁失败才会进入同步队列中</strong></p>
<p>接下来加完锁就要看解锁，所以我们看向release方法</p>

        <h3 id="release方法"   >
          <a href="#release方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#release方法" class="headerlink" title="release方法"></a>release方法</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">release</span><span class="params">(<span class="type">int</span> arg)</span> &#123;</span><br><span class="line">        <span class="comment">//尝试解锁成功进入下面语句，尝试唤醒其他线程</span></span><br><span class="line">    	<span class="keyword">if</span> (tryRelease(arg)) &#123;</span><br><span class="line">            <span class="comment">//获取头结点</span></span><br><span class="line">            <span class="type">Node</span> <span class="variable">h</span> <span class="operator">=</span> head;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">            	当头结点不为空，也即存在同步队列</span></span><br><span class="line"><span class="comment">            	并且ws.waitStatus不为0，说明有线程在等待唤醒</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">            <span class="keyword">if</span> (h != <span class="literal">null</span> &amp;&amp; h.waitStatus != <span class="number">0</span>)</span><br><span class="line">                <span class="comment">//唤醒h之后的第一个需要被唤醒的线程</span></span><br><span class="line">                unparkSuccessor(h);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">unparkSuccessor</span><span class="params">(Node node)</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//获取Node结点的waitStatus</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">ws</span> <span class="operator">=</span> node.waitStatus;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//node有效将ws置为0，意思为活跃中</span></span><br><span class="line">    <span class="keyword">if</span> (ws &lt; <span class="number">0</span>)</span><br><span class="line">        compareAndSetWaitStatus(node, ws, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    	从同步队列的后面往前找，第一个靠近node的结点s</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="type">Node</span> <span class="variable">s</span> <span class="operator">=</span> node.next;</span><br><span class="line">    <span class="keyword">if</span> (s == <span class="literal">null</span> || s.waitStatus &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        s = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">Node</span> <span class="variable">t</span> <span class="operator">=</span> tail; t != <span class="literal">null</span> &amp;&amp; t != node; t = t.prev)</span><br><span class="line">            <span class="keyword">if</span> (t.waitStatus &lt;= <span class="number">0</span>)</span><br><span class="line">                s = t;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//唤醒结点s</span></span><br><span class="line">    <span class="keyword">if</span> (s != <span class="literal">null</span>)</span><br><span class="line">        LockSupport.unpark(s.thread);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h3 id="tryRelease方法"   >
          <a href="#tryRelease方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#tryRelease方法" class="headerlink" title="tryRelease方法"></a>tryRelease方法</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//由子类去重写</span></span><br><span class="line"><span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">tryRelease</span><span class="params">(<span class="type">int</span> arg)</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>

<p><strong>释放锁流程</strong></p>
<ul>
<li>尝试tryRelease，如果锁的statu为0，说明解锁成功返回true<ul>
<li>获取AQS同步器的头结点<ul>
<li>同步器头结点如果为null，说明没有同步队列也即没有等待线程直接返回true即可</li>
<li>同步器头结点不为空，并且ws!&#x3D;0,说明有线程在等待，唤醒离头结点最近的第一个需要被唤醒的线程</li>
</ul>
</li>
</ul>
</li>
<li>解锁失败返回false</li>
</ul>
<p>而上面我们有返回中断标志位，这是让我们自己去响应中断返回结果，而有没有能帮我们抛出异常而不用我们来反应中断的呢？</p>
<p>当然是有的，那就是acquireInterruptibly方法</p>

        <h3 id="acquireInterruptibly方法"   >
          <a href="#acquireInterruptibly方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#acquireInterruptibly方法" class="headerlink" title="acquireInterruptibly方法"></a>acquireInterruptibly方法</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">acquireInterruptibly</span><span class="params">(<span class="type">int</span> arg)</span></span><br><span class="line">        <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">   	<span class="comment">//线程中断标志位为true那么就抛出中断异常</span></span><br><span class="line">    <span class="keyword">if</span> (Thread.interrupted())</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InterruptedException</span>();</span><br><span class="line">    <span class="comment">//尝试去加锁，加锁失败之后走doAcquireInterruptibly方法加锁</span></span><br><span class="line">    <span class="keyword">if</span> (!tryAcquire(arg))</span><br><span class="line">        doAcquireInterruptibly(arg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h3 id="doAcquireInterruptibly方法"   >
          <a href="#doAcquireInterruptibly方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#doAcquireInterruptibly方法" class="headerlink" title="doAcquireInterruptibly方法"></a>doAcquireInterruptibly方法</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">doAcquireInterruptibly</span><span class="params">(<span class="type">int</span> arg)</span></span><br><span class="line">    <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">Node</span> <span class="variable">node</span> <span class="operator">=</span> addWaiter(Node.EXCLUSIVE);</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">failed</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            <span class="comment">//获取当前线程的前一个线程，只有前一个线程是头结点才允许加锁</span></span><br><span class="line">            <span class="keyword">final</span> <span class="type">Node</span> <span class="variable">p</span> <span class="operator">=</span> node.predecessor();</span><br><span class="line">            <span class="keyword">if</span> (p == head &amp;&amp; tryAcquire(arg)) &#123;</span><br><span class="line">                setHead(node);</span><br><span class="line">                p.next = <span class="literal">null</span>; <span class="comment">// help GC</span></span><br><span class="line">                failed = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (shouldParkAfterFailedAcquire(p, node) &amp;&amp;</span><br><span class="line">                parkAndCheckInterrupt())</span><br><span class="line">                <span class="comment">//检查中断标志位为true则抛出异常，而不用我们自己处理</span></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InterruptedException</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (failed)</span><br><span class="line">            cancelAcquire(node);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>这一段方法逻辑和acquireQueued方法逻辑是一致的，只是在响应中断方面，acquireQueued方法会返回中断标志位交给我们自己处理，而这个方法是出现中断之后会抛出异常，而不用我们自己处理中断</p>
<p>而上面都在说独占锁的过程，而我们知道共享锁，所以我们接下来看共享锁的获取流程</p>

        <h3 id="acquireShared方法"   >
          <a href="#acquireShared方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#acquireShared方法" class="headerlink" title="acquireShared方法"></a>acquireShared方法</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">acquireShared</span><span class="params">(<span class="type">int</span> arg)</span> &#123;</span><br><span class="line">        <span class="comment">//获取共享锁</span></span><br><span class="line">    	<span class="keyword">if</span> (tryAcquireShared(arg) &lt; <span class="number">0</span>)</span><br><span class="line">            <span class="comment">//如果加锁失败</span></span><br><span class="line">            doAcquireShared(arg);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h3 id="tryAcquireShared方法"   >
          <a href="#tryAcquireShared方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#tryAcquireShared方法" class="headerlink" title="tryAcquireShared方法"></a>tryAcquireShared方法</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//尝试加锁，由子类去实现</span></span><br><span class="line"><span class="keyword">protected</span> <span class="type">int</span> <span class="title function_">tryAcquireShared</span><span class="params">(<span class="type">int</span> arg)</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h3 id="doAcquireShared方法"   >
          <a href="#doAcquireShared方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#doAcquireShared方法" class="headerlink" title="doAcquireShared方法"></a>doAcquireShared方法</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">doAcquireShared</span><span class="params">(<span class="type">int</span> arg)</span> &#123;</span><br><span class="line">    <span class="comment">//创建一个模式为共享模式的结点</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">Node</span> <span class="variable">node</span> <span class="operator">=</span> addWaiter(Node.SHARED);</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">failed</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">interrupted</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            <span class="comment">//获取前驱结点</span></span><br><span class="line">            <span class="keyword">final</span> <span class="type">Node</span> <span class="variable">p</span> <span class="operator">=</span> node.predecessor();</span><br><span class="line">            <span class="comment">//如果前驱结点是头指针结点，那么就尝试进行加锁，如果加锁成功则将头结点更新，并将头结点移除</span></span><br><span class="line">            <span class="keyword">if</span> (p == head) &#123;</span><br><span class="line">                <span class="comment">//记录一下可以获取共享锁的资源数，也即拿到锁r将大于0</span></span><br><span class="line">                <span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> tryAcquireShared(arg);</span><br><span class="line">                <span class="comment">//如果加锁成功</span></span><br><span class="line">                <span class="keyword">if</span> (r &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                    setHeadAndPropagate(node, r);</span><br><span class="line">                    <span class="comment">//将p的下一个结点置空</span></span><br><span class="line">                    p.next = <span class="literal">null</span>; <span class="comment">// help GC</span></span><br><span class="line">                    <span class="comment">//判断中断</span></span><br><span class="line">                    <span class="keyword">if</span> (interrupted)</span><br><span class="line">                        selfInterrupt();</span><br><span class="line">                    failed = <span class="literal">false</span>;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//判断是否阻塞和处理响应中断</span></span><br><span class="line">            <span class="keyword">if</span> (shouldParkAfterFailedAcquire(p, node) &amp;&amp;</span><br><span class="line">                parkAndCheckInterrupt())</span><br><span class="line">                interrupted = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        	如果failed为false，说明获取到了锁结束方法</span></span><br><span class="line"><span class="comment">        	如果failed为true，说明获取不到锁，将当前线程移除同步队列</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="keyword">if</span> (failed)</span><br><span class="line">            cancelAcquire(node);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h3 id="setHeadAndPropagate方法"   >
          <a href="#setHeadAndPropagate方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#setHeadAndPropagate方法" class="headerlink" title="setHeadAndPropagate方法"></a>setHeadAndPropagate方法</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">setHeadAndPropagate</span><span class="params">(Node node, <span class="type">int</span> propagate)</span> &#123;</span><br><span class="line">    <span class="comment">//记录老的头结点</span></span><br><span class="line">    <span class="type">Node</span> <span class="variable">h</span> <span class="operator">=</span> head;</span><br><span class="line">    <span class="comment">//设置新的头结点</span></span><br><span class="line">    setHead(node);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**以下IF语句有五种情况</span></span><br><span class="line"><span class="comment">    	1.当前结点node获取锁成功，也即propagate＞0</span></span><br><span class="line"><span class="comment">    	2.原来的头结点为空，也即同步队列头结点为空</span></span><br><span class="line"><span class="comment">    	3.原来的头结点不为空但是锁的状态字小于等于0</span></span><br><span class="line"><span class="comment">    	4.将当前结点更新成头结点为空</span></span><br><span class="line"><span class="comment">    	5.将当前结点更新成头结点之后锁的状态字小于等于0</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (propagate &gt; <span class="number">0</span> || h == <span class="literal">null</span> || h.waitStatus &lt; <span class="number">0</span> ||</span><br><span class="line">        (h = head) == <span class="literal">null</span> || h.waitStatus &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">//获取当前结点的下一个结点</span></span><br><span class="line">        <span class="type">Node</span> <span class="variable">s</span> <span class="operator">=</span> node.next;</span><br><span class="line">        <span class="comment">//判断下一个结点如果是共享模式则进入唤醒</span></span><br><span class="line">        <span class="keyword">if</span> (s == <span class="literal">null</span> || s.isShared())</span><br><span class="line">            doReleaseShared();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h3 id="doReleaseShared方法"   >
          <a href="#doReleaseShared方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#doReleaseShared方法" class="headerlink" title="doReleaseShared方法"></a>doReleaseShared方法</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">doReleaseShared</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="comment">//死循环一直去唤醒</span></span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">h</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="comment">//当h不为空并且不为尾结点</span></span><br><span class="line">        <span class="keyword">if</span> (h != <span class="literal">null</span> &amp;&amp; h != tail) &#123;</span><br><span class="line">            <span class="comment">//获取状态</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">ws</span> <span class="operator">=</span> h.waitStatus;</span><br><span class="line">            <span class="comment">//如果ws==-1,也即等待信号唤醒</span></span><br><span class="line">            <span class="keyword">if</span> (ws == Node.SIGNAL) &#123;</span><br><span class="line">                <span class="comment">//如果CAS更新h的ws从-1到0失败，则continue再来一遍</span></span><br><span class="line">                <span class="keyword">if</span> (!compareAndSetWaitStatus(h, Node.SIGNAL, <span class="number">0</span>))</span><br><span class="line">                    <span class="keyword">continue</span>;            <span class="comment">// loop to recheck cases</span></span><br><span class="line">                <span class="comment">//CAS成功则唤醒同步队列中离结点h最近的结点</span></span><br><span class="line">                unparkSuccessor(h);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//如果ws为0那么就更新成传播状态-3</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (ws == <span class="number">0</span> &amp;&amp;</span><br><span class="line">                     !compareAndSetWaitStatus(h, <span class="number">0</span>, Node.PROPAGATE))</span><br><span class="line">				<span class="comment">//CAS失败则重新再来一遍设置h状态</span></span><br><span class="line">                <span class="keyword">continue</span>;                <span class="comment">// loop on failed CAS</span></span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line">        <span class="comment">//如果头结点没有变化则退出循环</span></span><br><span class="line">        <span class="keyword">if</span> (h == head)                   <span class="comment">// loop if head changed</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>这里有一个关键点在于每一次循环都会获取头结点<code>Node h = head</code>,并且最后每次还会判断<code>if( h == head ) break;</code></p>
<p>这是因为当头结点不为空，并且不是尾结点的时候都会将其唤醒，如果CAS更新失败则会continue，只有CAS成功进入唤醒状态或者ws从0更新成-3，那么才会进入h&#x3D;&#x3D;head的判断</p>
<p>而每次成功唤醒之后，应该会进行doAcquireShared方法去尝试获取锁，也即当获取锁成功则head还会被重新设置，只有头结点没有改变才会跳出循环</p>
<p>理想状态下：</p>
<p><strong>当第一个获取共享锁的线程成功，则会不断唤醒排在其身后连在一起的共享模式线程</strong></p>

        <h3 id="doAcquireSharedInterruptibly方法"   >
          <a href="#doAcquireSharedInterruptibly方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#doAcquireSharedInterruptibly方法" class="headerlink" title="doAcquireSharedInterruptibly方法"></a>doAcquireSharedInterruptibly方法</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">doAcquireSharedInterruptibly</span><span class="params">(<span class="type">int</span> arg)</span></span><br><span class="line">    <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">Node</span> <span class="variable">node</span> <span class="operator">=</span> addWaiter(Node.SHARED);</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">failed</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">Node</span> <span class="variable">p</span> <span class="operator">=</span> node.predecessor();</span><br><span class="line">            <span class="keyword">if</span> (p == head) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> tryAcquireShared(arg);</span><br><span class="line">                <span class="keyword">if</span> (r &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                    setHeadAndPropagate(node, r);</span><br><span class="line">                    p.next = <span class="literal">null</span>; <span class="comment">// help GC</span></span><br><span class="line">                    failed = <span class="literal">false</span>;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//抛出中断异常</span></span><br><span class="line">            <span class="keyword">if</span> (shouldParkAfterFailedAcquire(p, node) &amp;&amp;</span><br><span class="line">                parkAndCheckInterrupt())</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InterruptedException</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">//获取锁失败取消线程任务</span></span><br><span class="line">        <span class="keyword">if</span> (failed)</span><br><span class="line">            cancelAcquire(node);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>这个方法和doAcquireShared方法的唯一区别就在于响应中断的方式不同，这个则是直接抛出中断异常，而那个方法是返回上层我们程序员自己手动处理中断状态</p>
<p>至此，AQS的同步队列中获取锁的方式已经全部说完，我们下一个就是看条件队列</p>

        <h2 id="条件队列"   >
          <a href="#条件队列" class="heading-link"><i class="fas fa-link"></i></a><a href="#条件队列" class="headerlink" title="条件队列"></a>条件队列</h2>
      <p>条件队列也是阻塞队列，在线程等待某个资源的释放然后唤醒，也即<strong>当条件不成立的时候线程进入条件队列，当条件成立则将线程从条件队列移除并继续执行</strong></p>
<p>而条件队列也主要依靠两个方法，一个是<strong>await方法</strong>(使线程进入条件队列等待资源)，另一个则是<strong>signal方法</strong>(使线程从阻塞唤醒，从条件队列中移除)</p>
<p>我们一开始也将带着条件队列猜测模型学习</p>
<p><em>猜想模型有误，只是提供一个最初印象的模型图，仅供参考</em></p>
<p><strong>条件队列猜测模型</strong></p>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B-JUC%E7%AF%87%5B5-AQS%5D/image-20230928181742497.png"  alt="条件队列猜测模型">
      </p>

        <h3 id="await方法"   >
          <a href="#await方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#await方法" class="headerlink" title="await方法"></a>await方法</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">await</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="comment">//如果线程中断了则抛出中断异常</span></span><br><span class="line">    <span class="keyword">if</span> (Thread.interrupted())</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InterruptedException</span>();</span><br><span class="line">    <span class="comment">//添加新的结点入条件队列</span></span><br><span class="line">    <span class="type">Node</span> <span class="variable">node</span> <span class="operator">=</span> addConditionWaiter();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//将当前线程获取的锁全部释放，记录重入次数</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">savedState</span> <span class="operator">=</span> fullyRelease(node);</span><br><span class="line">    <span class="comment">//中断模式为0</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">interruptMode</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    	进入while循环的条件：不在同步队列中</span></span><br><span class="line"><span class="comment">    	退出while循环的情景：</span></span><br><span class="line"><span class="comment">    		1.因为中断唤醒线程，所以设置中断模式</span></span><br><span class="line"><span class="comment">    		2.因为signal唤醒线程也即资源满足条件，所以结点一定在同步队列中不符合while循环条件</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">while</span> (!isOnSyncQueue(node)) &#123;</span><br><span class="line">        <span class="comment">//如果结点不在同步队列中(在条件队列中)=&gt;阻塞</span></span><br><span class="line">        LockSupport.park(<span class="built_in">this</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//线程唤醒如果是因为中断过，那么就设置中断模式并且跳出循环</span></span><br><span class="line">        <span class="keyword">if</span> ((interruptMode = checkInterruptWhileWaiting(node)) != <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//重新争抢锁成功，并且不是因为中断唤醒</span></span><br><span class="line">    <span class="keyword">if</span> (acquireQueued(node, savedState) &amp;&amp; interruptMode != THROW_IE)</span><br><span class="line">        <span class="comment">//那么就设置中断模式为REINTERRUPT，需要本线程自己中断</span></span><br><span class="line">        interruptMode = REINTERRUPT;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//如果条件队列中的下一个结点不为空，那么清除条件队列的失效结点</span></span><br><span class="line">    <span class="keyword">if</span> (node.nextWaiter != <span class="literal">null</span>) </span><br><span class="line">        unlinkCancelledWaiters();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//如果中断模式不为0，也即发生过中断</span></span><br><span class="line">    <span class="keyword">if</span> (interruptMode != <span class="number">0</span>)</span><br><span class="line">        reportInterruptAfterWait(interruptMode);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h4 id="addConditionWaiter方法"   >
          <a href="#addConditionWaiter方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#addConditionWaiter方法" class="headerlink" title="addConditionWaiter方法"></a>addConditionWaiter方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Node <span class="title function_">addConditionWaiter</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//获取条件队列最后一个Waiter</span></span><br><span class="line">    <span class="type">Node</span> <span class="variable">t</span> <span class="operator">=</span> lastWaiter;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//如果最后一个Waiter存在但是状态不是条件队列状态(-2)，那么并且重新获取LastWaiter</span></span><br><span class="line">    <span class="keyword">if</span> (t != <span class="literal">null</span> &amp;&amp; t.waitStatus != Node.CONDITION) &#123;</span><br><span class="line">        unlinkCancelledWaiters();</span><br><span class="line">        t = lastWaiter;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//创建当前线程的结点，状态为条件队列状态(-2)</span></span><br><span class="line">    <span class="type">Node</span> <span class="variable">node</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(Thread.currentThread(), Node.CONDITION);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//如果最后一个Waiter为空，也即条件队列为空，那么当前结点就是条件队列的头结点</span></span><br><span class="line">    <span class="keyword">if</span> (t == <span class="literal">null</span>)</span><br><span class="line">        <span class="comment">//将条件队列的头结点修改成node</span></span><br><span class="line">        firstWaiter = node;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="comment">//条件队列不为空，将node加入到条件队列的尾部</span></span><br><span class="line">        t.nextWaiter = node;</span><br><span class="line">    <span class="comment">//将尾指针指向最后一个结点</span></span><br><span class="line">    lastWaiter = node;</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h4 id="unlinkCancelledWaiters方法"   >
          <a href="#unlinkCancelledWaiters方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#unlinkCancelledWaiters方法" class="headerlink" title="unlinkCancelledWaiters方法"></a>unlinkCancelledWaiters方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">unlinkCancelledWaiters</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//t为第一个Waiter</span></span><br><span class="line">    <span class="type">Node</span> <span class="variable">t</span> <span class="operator">=</span> firstWaiter;</span><br><span class="line">    <span class="comment">//跟踪指针trail，用于记录操作的结点前一个结点</span></span><br><span class="line">    <span class="type">Node</span> <span class="variable">trail</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">//当t不为空也即同步队列不为空</span></span><br><span class="line">    <span class="keyword">while</span> (t != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">//获取下一个结点</span></span><br><span class="line">        <span class="type">Node</span> <span class="variable">next</span> <span class="operator">=</span> t.nextWaiter;</span><br><span class="line">        <span class="comment">//当前结点的状态不为条件队列状态，也即要移除出条件队列</span></span><br><span class="line">        <span class="keyword">if</span> (t.waitStatus != Node.CONDITION) &#123;</span><br><span class="line">            <span class="comment">//将t指向下一个结点设置为空</span></span><br><span class="line">            t.nextWaiter = <span class="literal">null</span>;</span><br><span class="line">            <span class="comment">//如果trail为空也即taril还没被设置值也即头结点就是不合法，则更新头指针</span></span><br><span class="line">            <span class="keyword">if</span> (trail == <span class="literal">null</span>)</span><br><span class="line">                firstWaiter = next;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="comment">//trail不为空，则更新trail的下一个结点为当前结点的下一个结点</span></span><br><span class="line">                trail.nextWaiter = next;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//如果下一个结点为空，也即到了队列的末尾则更新尾指针</span></span><br><span class="line">            <span class="keyword">if</span> (next == <span class="literal">null</span>)</span><br><span class="line">                lastWaiter = trail;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>  </span><br><span class="line">            trail = t; <span class="comment">//当前结点状态是条件队列状态(-2)则保留 </span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//移动指针t向后遍历</span></span><br><span class="line">        t = next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="条件队列新增结点和移除结点图解"   >
          <a href="#条件队列新增结点和移除结点图解" class="heading-link"><i class="fas fa-link"></i></a><a href="#条件队列新增结点和移除结点图解" class="headerlink" title="条件队列新增结点和移除结点图解"></a>条件队列新增结点和移除结点图解</h5>
      <p><strong>新增结点</strong>，判断尾结点是否是条件队列状态，如果不是则进行<strong>删除不合法结点</strong>，如果是则将当前结点添加到条件队列尾部</p>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B-JUC%E7%AF%87%5B5-AQS%5D/image-20231007182801004.png"  alt="条件队列新增结点">
      </p>
<p><strong>移除结点</strong>，从<strong>头结点开始</strong>判断是否满足条件队列要求</p>
<ul>
<li>当头结点不合法</li>
</ul>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B-JUC%E7%AF%87%5B5-AQS%5D/image-20231007183346412.png"  alt="删除结点，头结点不合法">
      </p>
<p>删除头结点</p>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B-JUC%E7%AF%87%5B5-AQS%5D/image-20231007183935160.png"  alt="删除头结点">
      </p>
<ul>
<li><p>当中间结点不合法</p>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B-JUC%E7%AF%87%5B5-AQS%5D/image-20231007184327495.png"  alt="当中间结点不合法">
      </p>
</li>
</ul>
<p>移除不合法的中间结点</p>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B-JUC%E7%AF%87%5B5-AQS%5D/image-20231007184610289.png"  alt="移除不合法的中间结点">
      </p>
<ul>
<li><p>当尾结点不合法</p>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B-JUC%E7%AF%87%5B5-AQS%5D/image-20231007184847981.png"  alt="尾结点不合法">
      </p>
</li>
</ul>
<p>移除尾结点</p>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B-JUC%E7%AF%87%5B5-AQS%5D/image-20231007185104698.png"  alt="移除尾结点">
      </p>

        <h4 id="fullyRelease方法"   >
          <a href="#fullyRelease方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#fullyRelease方法" class="headerlink" title="fullyRelease方法"></a>fullyRelease方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="type">int</span> <span class="title function_">fullyRelease</span><span class="params">(Node node)</span> &#123;</span><br><span class="line">    <span class="comment">//失败解锁标志位</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">failed</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//获取锁的重入次数</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">savedState</span> <span class="operator">=</span> getState();</span><br><span class="line">        <span class="keyword">if</span> (release(savedState)) &#123;</span><br><span class="line">            <span class="comment">//将failed标志位置为false，意思是全部解锁成功</span></span><br><span class="line">            failed = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">return</span> savedState;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalMonitorStateException</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">//没有全部解锁成功，那么就将此节点置为失效结点</span></span><br><span class="line">        <span class="keyword">if</span> (failed)</span><br><span class="line">            node.waitStatus = Node.CANCELLED;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h4 id="release方法-1"   >
          <a href="#release方法-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#release方法-1" class="headerlink" title="release方法"></a>release方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">release</span><span class="params">(<span class="type">int</span> arg)</span> &#123;</span><br><span class="line">    <span class="comment">//尝试解锁</span></span><br><span class="line">    <span class="keyword">if</span> (tryRelease(arg)) &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">h</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="comment">//成功唤醒同步队列中头结点的下一个结点</span></span><br><span class="line">        <span class="keyword">if</span> (h != <span class="literal">null</span> &amp;&amp; h.waitStatus != <span class="number">0</span>)</span><br><span class="line">            unparkSuccessor(h);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//解锁失败</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h4 id="isOnSyncQueue方法"   >
          <a href="#isOnSyncQueue方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#isOnSyncQueue方法" class="headerlink" title="isOnSyncQueue方法"></a>isOnSyncQueue方法</h4>
      <p>判断当前结点是不是在同步队列中</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//返回true说明在同步队列中，返回false说明不在同步队列中</span></span><br><span class="line"><span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">isOnSyncQueue</span><span class="params">(Node node)</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//如果结点等待状态为-2(条件队列)，或者结点的前驱结点为空，说明不在同步队列中</span></span><br><span class="line">  	<span class="comment">//也即同步队列的结点状态不能为-2，并且前驱结点不能为空</span></span><br><span class="line">    <span class="keyword">if</span> (node.waitStatus == Node.CONDITION || node.prev == <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//后继结点不为空，说明在同步队列中(也即：同步队列除了尾结点后继结点不为空)</span></span><br><span class="line">    <span class="keyword">if</span> (node.next != <span class="literal">null</span>) <span class="comment">// If has successor, it must be on queue</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//如果后继节点为空判断是不是在同步队列的尾结点</span></span><br><span class="line">    <span class="keyword">return</span> findNodeFromTail(node);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h4 id="findNodeFromTail方法"   >
          <a href="#findNodeFromTail方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#findNodeFromTail方法" class="headerlink" title="findNodeFromTail方法"></a>findNodeFromTail方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//从尾结点开始搜索结点node，遍历结点</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">findNodeFromTail</span><span class="params">(Node node)</span> &#123;</span><br><span class="line">    <span class="type">Node</span> <span class="variable">t</span> <span class="operator">=</span> tail;</span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        <span class="comment">//如果尾结点是当前结点node，返回true</span></span><br><span class="line">        <span class="keyword">if</span> (t == node)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="comment">//如果搜索结点为空，说明搜索完同步队列还没找到结点node，说明node不在同步队列中</span></span><br><span class="line">        <span class="keyword">if</span> (t == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">//向前搜索</span></span><br><span class="line">        t = t.prev;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>



<p><strong>checkInterruptWhileWaiting方法</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="title function_">checkInterruptWhileWaiting</span><span class="params">(Node node)</span> &#123;</span><br><span class="line">	<span class="comment">//如果中断过，那么返回值要么是THROW_IE(-1)要么是REINTERRUPT(1)</span></span><br><span class="line">    <span class="comment">//没有中断过则返回0</span></span><br><span class="line">    <span class="keyword">return</span> Thread.interrupted() ?</span><br><span class="line">        (transferAfterCancelledWait(node) ? THROW_IE : REINTERRUPT) :</span><br><span class="line">        <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//也即返回值有 -1(THROW_IE),0,1(REINTERRUPT)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h4 id="transferAfterCancelledWait方法"   >
          <a href="#transferAfterCancelledWait方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#transferAfterCancelledWait方法" class="headerlink" title="transferAfterCancelledWait方法"></a>transferAfterCancelledWait方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">transferAfterCancelledWait</span><span class="params">(Node node)</span> &#123;</span><br><span class="line">    <span class="comment">//CAS设置结点状态标志位从-2到0(也即这是中断唤醒线程再导致添加在同步队列中，所以设置中断模式为THROW_IE)</span></span><br><span class="line">    <span class="keyword">if</span> (compareAndSetWaitStatus(node, Node.CONDITION, <span class="number">0</span>)) &#123;</span><br><span class="line">        <span class="comment">//CAS成功，添加结点到同步队列，返回true</span></span><br><span class="line">        enq(node);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//如果结点不在同步队列中，那么就让出CPU，直到它在同步队列中</span></span><br><span class="line">    <span class="keyword">while</span> (!isOnSyncQueue(node))</span><br><span class="line">        Thread.<span class="keyword">yield</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//返回false</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h4 id="reportInterruptAfterWait方法"   >
          <a href="#reportInterruptAfterWait方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#reportInterruptAfterWait方法" class="headerlink" title="reportInterruptAfterWait方法"></a>reportInterruptAfterWait方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">reportInterruptAfterWait</span><span class="params">(<span class="type">int</span> interruptMode)</span></span><br><span class="line">    <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="comment">//如果中断模式是THROW_IE，也即条件队列线程唤醒是因为线程中断，抛出异常</span></span><br><span class="line">    <span class="keyword">if</span> (interruptMode == THROW_IE)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InterruptedException</span>();</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (interruptMode == REINTERRUPT)</span><br><span class="line">        <span class="comment">//如果中断模式是REINTERRUPT说明是SSignal唤醒线程，则线程自己中断</span></span><br><span class="line">        selfInterrupt();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>






        <h3 id="signal方法"   >
          <a href="#signal方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#signal方法" class="headerlink" title="signal方法"></a>signal方法</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">signal</span><span class="params">()</span> &#123;</span><br><span class="line">    		</span><br><span class="line">    		<span class="comment">//判断是否是持锁线程唤醒，如果当前线程不是持锁线程那么则抛错</span></span><br><span class="line">            <span class="keyword">if</span> (!isHeldExclusively())</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalMonitorStateException</span>();</span><br><span class="line">            </span><br><span class="line">    		<span class="comment">//持锁线程可以去唤醒条件队列的结点</span></span><br><span class="line">    </span><br><span class="line">    		</span><br><span class="line">    		<span class="comment">//获取条件队列的第一个Waiter</span></span><br><span class="line">    		<span class="type">Node</span> <span class="variable">first</span> <span class="operator">=</span> firstWaiter;</span><br><span class="line">            <span class="comment">//如果条件线程不为空那么尝试从第一个结点开始Signal唤醒</span></span><br><span class="line">    		<span class="keyword">if</span> (first != <span class="literal">null</span>)</span><br><span class="line">                doSignal(first);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></div></figure>




        <h4 id="isHeldExclusively方法"   >
          <a href="#isHeldExclusively方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#isHeldExclusively方法" class="headerlink" title="isHeldExclusively方法"></a>isHeldExclusively方法</h4>
      <p>方法由子类实现，如果当前线程不是持锁线程则抛错</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">isHeldExclusively</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h4 id="doSignal方法"   >
          <a href="#doSignal方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#doSignal方法" class="headerlink" title="doSignal方法"></a>doSignal方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//将条件队列队首开始，尝试将一个结点从条件队列移到同步队列</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">doSignal</span><span class="params">(Node first)</span> &#123;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="comment">//将第一个结点移出条件队列(无论是否成功移到同步队列)</span></span><br><span class="line">        </span><br><span class="line">      	<span class="comment">//将头结点指针更新成第一个结点的下一个结点，如果下一个结点为空同时也更新条件队列尾指针</span></span><br><span class="line">        <span class="keyword">if</span> ( (firstWaiter = first.nextWaiter) == <span class="literal">null</span>)</span><br><span class="line">            lastWaiter = <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">//将第一个结点指针更新为空</span></span><br><span class="line">        first.nextWaiter = <span class="literal">null</span>;</span><br><span class="line">    &#125; <span class="keyword">while</span> (!transferForSignal(first) &amp;&amp;  <span class="comment">//将第一个结点尝试移到同步队列中，当成功则返回true，失败返回false</span></span><br><span class="line">             (first = firstWaiter) != <span class="literal">null</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//如果第一个结点移到同步队列失败，则重新获取第一个结点直到同步队列为空或者成功移动一个结点到同步队列</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>






        <h4 id="transferForSignal方法"   >
          <a href="#transferForSignal方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#transferForSignal方法" class="headerlink" title="transferForSignal方法"></a>transferForSignal方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//返回false:通过Signal转移到同步队列失败</span></span><br><span class="line"><span class="comment">//返回true:通过Signal转移到同步队列成功</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">transferForSignal</span><span class="params">(Node node)</span> &#123;</span><br><span class="line">    <span class="comment">//如果CAS更新结点状态失败，则返回false</span></span><br><span class="line">    <span class="keyword">if</span> (!compareAndSetWaitStatus(node, Node.CONDITION, <span class="number">0</span>))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">   	<span class="comment">//CAS成功，结点状态更新成0</span></span><br><span class="line">    <span class="comment">//将结点入同步队列尾部，enq返回原先的尾结点(此时同步队列的倒数第二个结点)</span></span><br><span class="line">    <span class="type">Node</span> <span class="variable">p</span> <span class="operator">=</span> enq(node);</span><br><span class="line">    <span class="type">int</span> <span class="variable">ws</span> <span class="operator">=</span> p.waitStatus;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//如果p状态大于0(结点P失效)或者p状态更新成-1失败(0-&gt;-1) 那么唤醒结点线程</span></span><br><span class="line">    <span class="keyword">if</span> (ws &gt; <span class="number">0</span> || !compareAndSetWaitStatus(p, ws, Node.SIGNAL))</span><br><span class="line">        <span class="comment">//唤醒结点线程，让它去争抢一次锁</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">        	因为AQS同步队列中只有前一个结点的是头结点才能争锁成功</span></span><br><span class="line"><span class="comment">        	这里可能是让本线程更新同步队列结点的状态</span></span><br><span class="line"><span class="comment">        	或者移除不合法结点之后此节点前一个结点是头结点，于是能尝试争锁</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        LockSupport.unpark(node.thread);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//返回true，也即通过Signal添加到同步队列成功</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h3 id="signalAll方法"   >
          <a href="#signalAll方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#signalAll方法" class="headerlink" title="signalAll方法"></a>signalAll方法</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">signalAll</span><span class="params">()</span> &#123;</span><br><span class="line">    		<span class="comment">//判断是否是持锁线程进行全部唤醒，不是则抛出异常</span></span><br><span class="line">            <span class="keyword">if</span> (!isHeldExclusively())</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalMonitorStateException</span>();</span><br><span class="line">    		<span class="comment">//获取同步队列的头指针</span></span><br><span class="line">            <span class="type">Node</span> <span class="variable">first</span> <span class="operator">=</span> firstWaiter;</span><br><span class="line">    		<span class="comment">//如果同步队列存在则唤醒全部</span></span><br><span class="line">            <span class="keyword">if</span> (first != <span class="literal">null</span>)</span><br><span class="line">                doSignalAll(first);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></div></figure>








        <h4 id="doSignalAll方法"   >
          <a href="#doSignalAll方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#doSignalAll方法" class="headerlink" title="doSignalAll方法"></a>doSignalAll方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">doSignalAll</span><span class="params">(Node first)</span> &#123;</span><br><span class="line">    		<span class="comment">//将同步队列的首尾指针指向空</span></span><br><span class="line">            lastWaiter = firstWaiter = <span class="literal">null</span>;</span><br><span class="line">            <span class="comment">//将原先的头结点向后遍历，尝试唤醒全部条件队列线程</span></span><br><span class="line">    		<span class="keyword">do</span> &#123;</span><br><span class="line">          	</span><br><span class="line">                <span class="type">Node</span> <span class="variable">next</span> <span class="operator">=</span> first.nextWaiter;</span><br><span class="line">                first.nextWaiter = <span class="literal">null</span>;</span><br><span class="line">                transferForSignal(first);</span><br><span class="line">                first = next;</span><br><span class="line">            &#125; <span class="keyword">while</span> (first != <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></div></figure>


        <h3 id="小结"   >
          <a href="#小结" class="heading-link"><i class="fas fa-link"></i></a><a href="#小结" class="headerlink" title="小结"></a>小结</h3>
      <p>AQS是一个<strong>非公平锁</strong>，当需要加锁的时候都是先尝试获取一把锁，如果获取失败才会进入AQS同步队列中。又因为AQS分有独占锁和共享锁，以及同步队列和条件队列，所以这里单独对加锁、解锁以及两个队列再进行一个知识性总结</p>

        <h4 id="独占锁"   >
          <a href="#独占锁" class="heading-link"><i class="fas fa-link"></i></a><a href="#独占锁" class="headerlink" title="独占锁"></a>独占锁</h4>
      
        <h5 id="加锁"   >
          <a href="#加锁" class="heading-link"><i class="fas fa-link"></i></a><a href="#加锁" class="headerlink" title="加锁"></a>加锁</h5>
      
        <h5 id="解锁"   >
          <a href="#解锁" class="heading-link"><i class="fas fa-link"></i></a><a href="#解锁" class="headerlink" title="解锁"></a>解锁</h5>
      </div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2023/09/07/%E6%AD%BB%E4%B9%8B%E5%89%8D%E8%A6%81%E5%81%9A%E5%AE%8C%E7%9A%84%E7%AE%97%E6%B3%95%E6%89%8B%E5%86%8C-%5B7.%E5%9B%9E%E6%BA%AF%E7%AE%97%E6%B3%95%5D/">死之前要做完的算法手册-[7.回溯算法]</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2023-09-07</span></span><span class="post-meta-item post-meta-item--wordcount"><span class="post-meta-item__icon"><i class="far fa-file-word"></i></span><span class="post-meta-item__info">字数统计</span><span class="post-meta-item__value">18.7k</span></span><span class="post-meta-item post-meta-item--readtime"><span class="post-meta-item__icon"><i class="far fa-clock"></i></span><span class="post-meta-item__info">阅读时长</span><span class="post-meta-item__value">165分</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h1 id="回溯算法理论基础"   >
          <a href="#回溯算法理论基础" class="heading-link"><i class="fas fa-link"></i></a><a href="#回溯算法理论基础" class="headerlink" title="回溯算法理论基础"></a>回溯算法理论基础</h1>
      <p>回溯法又称回溯搜索法，是一种<strong>暴力搜索法</strong></p>
<blockquote>
<p>回溯的本质就是穷举，穷举所有可能，选出想要的结果</p>
</blockquote>
<p>回溯法可以抽象成一个N叉树，在集合递归中寻找结果，而<strong>集合长度为树的宽度，递归的深度构成了树的深度</strong></p>
<p><em>回溯法的模板</em></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(参数)</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(终止条件)&#123;</span><br><span class="line">        收获结果集; </span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(集合长度)&#123;</span><br><span class="line">        处理结点;</span><br><span class="line">        递归;</span><br><span class="line">        回溯;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h1 id="组合"   >
          <a href="#组合" class="heading-link"><i class="fas fa-link"></i></a><a href="#组合" class="headerlink" title="组合"></a>组合</h1>
      
        <h2 id="77-组合"   >
          <a href="#77-组合" class="heading-link"><i class="fas fa-link"></i></a><a href="#77-组合" class="headerlink" title="77.组合"></a>77.组合</h2>
      <p>给定两个整数 <code>n</code> 和 <code>k</code>，返回范围 <code>[1, n]</code> 中所有可能的 <code>k</code> 个数的组合。</p>
<p>你可以按 <strong>任何顺序</strong> 返回答案。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/combinations/" >Leetcode.77题(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做"   >
          <a href="#第一次做" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;09&#x2F;08</p>

        <h4 id="第一次代码"   >
          <a href="#第一次代码" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; result;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">combine</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            List&lt;Integer&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            list.add(i);</span><br><span class="line">            backtarcking(list,n,i+<span class="number">1</span>,k-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtarcking</span><span class="params">(List&lt;Integer&gt; list,<span class="type">int</span> n,<span class="type">int</span> index,<span class="type">int</span> k)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(k==<span class="number">0</span> || index&gt;n)&#123;</span><br><span class="line">            result.add(list);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=k;i&gt;=<span class="number">0</span>;i--)&#123;</span><br><span class="line">            list.add(index);</span><br><span class="line">            backtarcking(list,n,index+<span class="number">1</span>,k-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败"   >
          <a href="#提交失败" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:输入n&#x3D;4，k&#x3D;2，输出[[1,2,2],[1,2,2],[2,3,3],[2,3,3],[3,4,4],[3,4,4],[4]] ，预期输出[[1,2],[1,3],[1,4],[2,3],[2,4],[3,4]]</p>

        <h4 id="第二次代码"   >
          <a href="#第二次代码" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; result;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">combine</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            List&lt;Integer&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            list.add(i);</span><br><span class="line">            backtarcking(list,n,i+<span class="number">1</span>,k-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtarcking</span><span class="params">(List&lt;Integer&gt; list,<span class="type">int</span> n,<span class="type">int</span> index,<span class="type">int</span> k)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(k==<span class="number">0</span> || index&gt;n)&#123;</span><br><span class="line">            result.add(list);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=k;i&gt;=<span class="number">0</span>;i--)&#123;</span><br><span class="line">            list.add(index);</span><br><span class="line">            backtarcking(list,n,index+<span class="number">1</span>,k-<span class="number">1</span>);</span><br><span class="line">            list.remove(list.size()-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-1"   >
          <a href="#提交失败-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-1" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:输入n&#x3D;4，k&#x3D;2，输出[[1],[1],[2],[2],[3],[3],[4]] ，预期输出[[1,2],[1,3],[1,4],[2,3],[2,4],[3,4]]</p>
<p><em>未能自己做出来</em></p>

        <h3 id="题解"   >
          <a href="#题解" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解" class="headerlink" title="题解"></a>题解</h3>
      <p>思路：定义两个全局变量，一个result收集结果集，一个list用于收集单个路径(组合)，当list的长度等于k的时候就收获结果</p>
<p><em>如果还没能看懂可以看这部分中的图解，改成N叉树之后分析</em></p>
<p><strong>实现</strong></p>
<ul>
<li><p>递归函数的参数和返回值</p>
<ul>
<li><p>返回值void:因为整个过程都收获到结果集result中</p>
</li>
<li><p>参数n:集合的长度(组合能取值的范围)</p>
</li>
<li><p>参数k:组合的个数</p>
</li>
<li><p>参数index：每次开始的搜索的索引值，第一次传入1表示从1开始搜索</p>
</li>
</ul>
</li>
<li><p>递归函数的结束条件</p>
<p>当list.size&#x3D;&#x3D;k也即组合个数达到要求，可以收获结果集。 <strong>result.add(new ArrayList(list))</strong>;</p>
<blockquote>
<p>如果result直接添加list，会后面递归中改变list值导致结果集中的数据也改变</p>
</blockquote>
</li>
<li><p>单层递归的处理逻辑</p>
<p>从index到n开始搜索，每一次递归前添加当前元素，然后递归结束之后<strong>回溯</strong></p>
</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; result;</span><br><span class="line">    List&lt;Integer&gt; list;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">combine</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        backtracking(n,k,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span> n,<span class="type">int</span> k, <span class="type">int</span> index)</span>&#123;</span><br><span class="line">    	<span class="comment">//收获结果集</span></span><br><span class="line">        <span class="keyword">if</span>(list.size()==k)&#123;</span><br><span class="line">            result.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>(list));</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=index;i&lt;=n;i++)&#123;</span><br><span class="line">            list.add(i);</span><br><span class="line">            backtracking(n,k,i+<span class="number">1</span>);</span><br><span class="line">            <span class="comment">//回溯</span></span><br><span class="line">            list.remove(list.size()-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h3 id="图解"   >
          <a href="#图解" class="heading-link"><i class="fas fa-link"></i></a><a href="#图解" class="headerlink" title="图解"></a>图解</h3>
      <p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="https://images-kkblog.oss-cn-hangzhou.aliyuncs.com/image-20230908122504278.png"  alt="回溯法组合思路(1)">
      </p>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="https://images-kkblog.oss-cn-hangzhou.aliyuncs.com/image-20230908122912662.png"  alt="回溯法思路(2)">
      </p>
<p>也即我们需要收获叶子结点，并且每次搜索都是从当前搜索位置之后开始</p>
<blockquote>
<p>第一次搜索为1  所以要搜索234</p>
<p>第二次搜索为2 所以要搜索34</p>
<p>..</p>
</blockquote>
<p>我们通过index来保证搜索以后的位置</p>

        <h3 id="小结"   >
          <a href="#小结" class="heading-link"><i class="fas fa-link"></i></a><a href="#小结" class="headerlink" title="小结"></a>小结</h3>
      <p>这道题其实我自己做的时候也差一点能写出来，因为没能写在笔记上我做这道题的具体过程，因为很多次的过程都是因为添加数据之后然后修改过list，导致最后的数值多了或者少了，因为list一直是一个地址，所以result通常添加的值就是一个list。</p>
<p>而经过视频学习之后发现，这个<strong>存入数据的时候可以new ArrayList(list)</strong> ，copy一个新的ArrayList。</p>
<p>同时这道题有回溯的思想是值得我们学习到的，list添加数据之后单层递归要回溯pop出元素</p>

        <h2 id="77-组合-优化"   >
          <a href="#77-组合-优化" class="heading-link"><i class="fas fa-link"></i></a><a href="#77-组合-优化" class="headerlink" title="77.组合(优化)"></a>77.组合(优化)</h2>
      <p>给定两个整数 <code>n</code> 和 <code>k</code>，返回范围 <code>[1, n]</code> 中所有可能的 <code>k</code> 个数的组合。</p>
<p>你可以按 <strong>任何顺序</strong> 返回答案。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/combinations/description/" >Leetcode.77题(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="题解-1"   >
          <a href="#题解-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-1" class="headerlink" title="题解"></a>题解</h3>
      <p>在这里我们进行一个剪枝的优化</p>
<p><strong>假设</strong></p>
<p>假如n&#x3D;4，k&#x3D;4的时候，我们可以简单知道唯一的答案就是[1,2,3,4]。而我们之前的穷举除了要查找1，还要查找2、3、4，但是这个时候无论如何都不能达到需要的k值，也即我们当集合中剩余的元素不可能达到组合的个数的时候就可以进行剪枝</p>
<p>也即我们可以求进行组合搜索的时候至多索引的位置</p>
<p><strong>实现</strong></p>
<ul>
<li><p>获取至多索引的长度</p>
<p>**k-list.size()**为还需要的元素个数</p>
<p><strong>n-(k-list.size())+1</strong>为至多索引的位置，我们可以假设极端情况来判断这个是否要加1</p>
<blockquote>
<p>假设n为4 k为3  list中元素为0  所以4-(3-0)+1 也即最多索引为2</p>
</blockquote>
</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; result;</span><br><span class="line">    List&lt;Integer&gt; list;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">combine</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        backtracking(n,k,<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span> n,<span class="type">int</span> k,<span class="type">int</span> index)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(list.size()==k)&#123;</span><br><span class="line">            result.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>(list));</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//具体剪枝的逻辑就在循环中条件的判断中</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=index;i&lt;=(n-(k-list.size())+<span class="number">1</span>);i++)&#123;</span><br><span class="line">            list.add(i);</span><br><span class="line">            backtracking(n,k,i+<span class="number">1</span>);</span><br><span class="line">            list.remove(list.size()-<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h2 id="216-组合总合-III"   >
          <a href="#216-组合总合-III" class="heading-link"><i class="fas fa-link"></i></a><a href="#216-组合总合-III" class="headerlink" title="216.组合总合 III"></a>216.组合总合 III</h2>
      <p>找出所有相加之和为 <code>n</code> 的 <code>k</code> 个数的组合，且满足下列条件：</p>
<ul>
<li>只使用数字1到9</li>
<li>每个数字 <strong>最多使用一次</strong></li>
</ul>
<p>返回 <em>所有可能的有效组合的列表</em> 。该列表不能包含相同的组合两次，组合可以以任何顺序返回。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/combination-sum-iii/" >Leetcode.216(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-1"   >
          <a href="#第一次做-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-1" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;09&#x2F;09</p>

        <h4 id="第一次代码-1"   >
          <a href="#第一次代码-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-1" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; result;</span><br><span class="line">    List&lt;Integer&gt; list;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">combinationSum3</span><span class="params">(<span class="type">int</span> k, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        backtracking(k,n,<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span> k,<span class="type">int</span> n ,<span class="type">int</span> index)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(list.size()==k)&#123;</span><br><span class="line">            <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i:list)&#123;</span><br><span class="line">                sum+=i;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(sum==n)&#123;</span><br><span class="line">                result.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>(list));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=index;i&lt;=<span class="number">9</span>;i++)&#123;</span><br><span class="line">            list.add(i);</span><br><span class="line">            backtracking(k,n,i);</span><br><span class="line">            list.remove(list.size()-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-2"   >
          <a href="#提交失败-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-2" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:k&#x3D;3,n&#x3D;7，输出[[1,1,5],[1,2,4],[1,3,3],[2,2,3]]，预期输出[1,2,4]</p>
<p>递归遍历的时候因为一个元素只能用一次，所以后面将递归下次的索引值改了</p>

        <h4 id="第二次代码-1"   >
          <a href="#第二次代码-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码-1" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; result;</span><br><span class="line">    List&lt;Integer&gt; list;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">combinationSum3</span><span class="params">(<span class="type">int</span> k, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        backtracking(k,n,<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span> k,<span class="type">int</span> n ,<span class="type">int</span> index)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(list.size()==k)&#123;</span><br><span class="line">            <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i:list)&#123;</span><br><span class="line">                sum+=i;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(sum==n)&#123;</span><br><span class="line">                result.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>(list));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=index;i&lt;=<span class="number">9</span>;i++)&#123;</span><br><span class="line">            list.add(i);</span><br><span class="line">            backtracking(k,n,i+<span class="number">1</span>);</span><br><span class="line">            list.remove(list.size()-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功"   >
          <a href="#提交成功" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-2"   >
          <a href="#题解-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-2" class="headerlink" title="题解"></a>题解</h3>
      <p>思路：这道题和之前做的组合题相似，不过是要满足组合数之和要满足n，所以我们在收获结果集的时候改变一下条件，当满足条件的收获即可</p>
<p><strong>实现</strong></p>
<ul>
<li><p>递归函数的参数和返回值</p>
<ul>
<li><p>返回值void：无返回值，整个结果集被全局变量result收获</p>
</li>
<li><p>参数k：需要的组合元素个数</p>
</li>
<li><p>参数n：目标总数</p>
</li>
<li><p>参数sum：当前list集合中的元素之和</p>
</li>
<li><p>参数index：下次搜索的索引下标</p>
</li>
</ul>
</li>
<li><p>递归函数的结束条件</p>
<p>当list.size&#x3D;&#x3D;k，也即达到符合组合数，判断是否组合之和符合条件如果是收获，如果不是则直接结束</p>
</li>
<li><p>单层递归的逻辑</p>
<ul>
<li>从index到n开始搜索，每一次递归前添加当前元素到list，并且统计集合之和到sum，然后递归结束之后<strong>回溯</strong>，不仅仅回溯集合还回溯sum</li>
</ul>
</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">List&lt;List&lt;Integer&gt;&gt; result;</span><br><span class="line">    List&lt;Integer&gt; list;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">combinationSum3</span><span class="params">(<span class="type">int</span> k, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        backtracking(k,n,<span class="number">0</span>,<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span> k,<span class="type">int</span> n ,<span class="type">int</span> sum,<span class="type">int</span> index)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(list.size()==k)&#123;</span><br><span class="line">           <span class="keyword">if</span>(sum==n)&#123;</span><br><span class="line">               result.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>(list));</span><br><span class="line">           &#125;</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=index;i&lt;=<span class="number">9</span>;i++)&#123;</span><br><span class="line">			<span class="comment">//元素添加之后总和增加，增加list元素</span></span><br><span class="line">            sum+=i;</span><br><span class="line">            list.add(i);</span><br><span class="line">            backtracking(k,n,sum,i+<span class="number">1</span>);</span><br><span class="line">            <span class="comment">//回溯，回溯sum也回溯list</span></span><br><span class="line">            sum-=i;</span><br><span class="line">            list.remove(list.size()-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>


        <h3 id="剪枝"   >
          <a href="#剪枝" class="heading-link"><i class="fas fa-link"></i></a><a href="#剪枝" class="headerlink" title="剪枝"></a>剪枝</h3>
      <p>在这里我们能进行一个剪枝的操作，为了就是在不可能达到的情况下不会再去搜索</p>
<ul>
<li><p>第一部分</p>
<ul>
<li><p>当递归的时候sum&gt;n的时候，无论怎么样后面的分支都不会产生目标集，所以直接返回即可</p>
<blockquote>
<p>例如此时sum&#x3D;9 n为5，那无论后面怎么加数据都不会导致sum&#x3D;&#x3D;n</p>
</blockquote>
</li>
</ul>
</li>
<li><p>第二部分</p>
<ul>
<li><p>当剩下的索引位置无法满足k的时候</p>
<blockquote>
<p>例如索引为8，K为3，那么怎么样都不会有后面满足条件的组合</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<p><strong>实现</strong></p>
<ul>
<li>第一部分剪枝，当递归结束的判断条件，if(sum&gt;n) return;</li>
<li>第二部分剪枝，循环的判断条件，9-(k-list.size())+1，为<strong>至多满足组合的索引下标</strong></li>
</ul>
<p><strong>剪枝代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; result;</span><br><span class="line">    List&lt;Integer&gt; list;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">combinationSum3</span><span class="params">(<span class="type">int</span> k, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        backtracking(k,n,<span class="number">0</span>,<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span> k,<span class="type">int</span> n ,<span class="type">int</span> sum,<span class="type">int</span> index)</span>&#123;</span><br><span class="line"> 		<span class="comment">//剪枝部分1</span></span><br><span class="line">        <span class="keyword">if</span>(sum&gt;n)&#123;</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(list.size()==k)&#123;</span><br><span class="line">           <span class="keyword">if</span>(sum==n)&#123;</span><br><span class="line">               result.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>(list));</span><br><span class="line">           &#125;</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//剪枝部分2</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=index;i&lt;=<span class="number">9</span>-(k-list.size())+<span class="number">1</span>;i++)&#123;</span><br><span class="line">            sum+=i;</span><br><span class="line">            list.add(i);</span><br><span class="line">            backtracking(k,n,sum,i+<span class="number">1</span>);</span><br><span class="line">            sum-=i;</span><br><span class="line">            list.remove(list.size()-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h2 id="17-电话号码的字母组合"   >
          <a href="#17-电话号码的字母组合" class="heading-link"><i class="fas fa-link"></i></a><a href="#17-电话号码的字母组合" class="headerlink" title="17.电话号码的字母组合"></a>17.电话号码的字母组合</h2>
      <p>给定一个仅包含数字 <code>2-9</code> 的字符串，返回所有它能表示的字母组合。答案可以按 <strong>任意顺序</strong> 返回。</p>
<p>给出数字到字母的映射如下（与电话按键相同）。注意 1 不对应任何字母。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/letter-combinations-of-a-phone-number/" >Leetcode.17题(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-2"   >
          <a href="#第一次做-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-2" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;09&#x2F;11</p>

        <h4 id="第一次代码-2"   >
          <a href="#第一次代码-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-2" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="type">int</span>[] hash=&#123;-<span class="number">1</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">5</span>,<span class="number">8</span>,<span class="number">11</span>,<span class="number">14</span>,<span class="number">18</span>,<span class="number">21</span>,<span class="number">25</span>&#125;;</span><br><span class="line">    <span class="type">char</span>[] table;</span><br><span class="line">    <span class="type">int</span> index;</span><br><span class="line">    List&lt;String&gt; result;</span><br><span class="line">    List&lt;String&gt; path;</span><br><span class="line">    List&lt;Integer&gt; list;</span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">letterCombinations</span><span class="params">(String digits)</span> &#123;</span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        path=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        table=<span class="keyword">new</span> <span class="title class_">char</span>[<span class="number">26</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">26</span>;i++)&#123; table[i]=(<span class="type">char</span>)(<span class="string">&#x27;a&#x27;</span>+i);&#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span>[] str=<span class="keyword">new</span> <span class="title class_">int</span>[digits.length()];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;str.length;i++)&#123;</span><br><span class="line">            str[i]=Integer.parseInt(digits.charAt(i)+<span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Arrays.sort(str);</span><br><span class="line">        index=<span class="number">0</span>;</span><br><span class="line">        backtracking(str,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span>[] str,<span class="type">int</span> start)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(list.size()==str.length)&#123;</span><br><span class="line">            result.add(path.toString());</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=start;i&lt;str.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(index&lt;hash[str[i]]) index=hash[str[i]];</span><br><span class="line">            list.add(i);</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=hash[str[i]-<span class="number">1</span>];j&lt;index;j++)&#123;</span><br><span class="line">                StringBuilder sb=<span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">                sb.append(table[j]);</span><br><span class="line">                path.add(sb.toString());</span><br><span class="line">                </span><br><span class="line">                backtracking(str,i+<span class="number">1</span>);</span><br><span class="line">                path.remove(path.size()-<span class="number">1</span>);    </span><br><span class="line">            &#125;           </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-3"   >
          <a href="#提交失败-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-3" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:输入[“23”] 输出[“[a, c]”,”[a, d]”,”[a, e]”,”[b]”,”[c]”,”[d]”,”[e]”]，预期输出[“ad”,”ae”,”af”,”bd”,”be”,”bf”,”cd”,”ce”,”cf”]</p>

        <h4 id="第二次代码-2"   >
          <a href="#第二次代码-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码-2" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="type">int</span>[] hash=&#123;-<span class="number">1</span>,-<span class="number">1</span>,<span class="number">2</span>,<span class="number">5</span>,<span class="number">8</span>,<span class="number">11</span>,<span class="number">14</span>,<span class="number">18</span>,<span class="number">21</span>,<span class="number">25</span>&#125;;</span><br><span class="line">    <span class="type">char</span>[] table;</span><br><span class="line">    <span class="type">int</span> index;</span><br><span class="line">    List&lt;String&gt; result;</span><br><span class="line">    List&lt;String&gt; path;</span><br><span class="line">    List&lt;Integer&gt; list;</span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">letterCombinations</span><span class="params">(String digits)</span> &#123;</span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        path=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        table=<span class="keyword">new</span> <span class="title class_">char</span>[<span class="number">26</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">26</span>;i++)&#123; table[i]=(<span class="type">char</span>)(<span class="string">&#x27;a&#x27;</span>+i);&#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span>[] str=<span class="keyword">new</span> <span class="title class_">int</span>[digits.length()];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;str.length;i++)&#123;</span><br><span class="line">            str[i]=Integer.parseInt(digits.charAt(i)+<span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Arrays.sort(str);</span><br><span class="line">        index=<span class="number">0</span>;</span><br><span class="line">        backtracking(str,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span>[] str,<span class="type">int</span> start)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(list.size()==str.length)&#123;</span><br><span class="line">            result.add(path.toString());</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=start;i&lt;str.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(index&lt;hash[str[i]]) index=hash[str[i]];</span><br><span class="line">            list.add(i);</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=hash[str[i]-<span class="number">1</span>]+<span class="number">1</span>;j&lt;=index;j++)&#123;</span><br><span class="line">                StringBuilder sb=<span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">                sb.append(table[j]);</span><br><span class="line">                path.add(sb.toString());</span><br><span class="line">                </span><br><span class="line">                backtracking(str,i+<span class="number">1</span>);</span><br><span class="line">                path.remove(path.size()-<span class="number">1</span>);    </span><br><span class="line">            &#125;     </span><br><span class="line">            list.remove(list.size()-<span class="number">1</span>);      </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-4"   >
          <a href="#提交失败-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-4" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:输入[“23”] 输出[“[a, d]”,”[a, e]”,”[a, f]”,”[b, d]”,”[b, e]”,”[b, f]”,”[c, d]”,”[c, e]”,”[c, f]”,”[d, d]”,”[d, e]”,”[d, f]”,”[e, d]”,”[e, e]”,”[e, f]”,”[f, d]”,”[f, e]”,”[f, f]”]，预期输出[“ad”,”ae”,”af”,”bd”,”be”,”bf”,”cd”,”ce”,”cf”]</p>
<p>没做出来</p>

        <h3 id="题解-3"   >
          <a href="#题解-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-3" class="headerlink" title="题解"></a>题解</h3>
      <p><strong>思路</strong></p>
<p>我们用一个hashTable做映射表，然后用index指向正在处理的位置，如果index等于digits的最后字符位置，说明已经到收获结果的时候</p>
<p><strong>实现</strong></p>
<ul>
<li><p>初始化，List<String> result用于接收结果集，List<String> path用于接收单层路径，</p>
<p>hashTable&#x3D;{“”,””,”abc”,”def”,”ghi”,”jkl”,”mno”,”pqrs”,”tuv”,”wxyz”}用于做映射数组</p>
</li>
<li><p>递归函数的参数和返回值</p>
<ul>
<li><p>返回值void：所有的结果集都接收在result中</p>
</li>
<li><p>参数digits：电话字母组合的字符串</p>
</li>
<li><p>参数index：表示当前处理的字符位置</p>
<blockquote>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">例如 digits=<span class="string">&quot;23&quot;</span>   index=<span class="number">0</span>  说明当前处理<span class="string">&quot;2&quot;</span>字符</span><br><span class="line">				  index=<span class="number">1</span>  说明当前处理<span class="string">&quot;3&quot;</span>字符</span><br><span class="line">				  index=<span class="number">2</span>  说明当前字符串已经全部被处理了可以收获结果集</span><br></pre></td></tr></table></div></figure></blockquote>
</li>
</ul>
</li>
<li><p>递归函数的结束条件</p>
<p>当index&#x3D;&#x3D;digits.length():也即处理完每个字符，收获结果</p>
</li>
<li><p>单层递归的逻辑</p>
<ul>
<li>获取当前字符所对应的数字：int num&#x3D;digits[index];</li>
<li>通过hashTable映射，遍历每个数字对应的数组</li>
<li>将每个数组中的元素依次添加到path路径中</li>
<li>递归调用函数，处理下一个位置字符</li>
<li>回溯</li>
</ul>
</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;String&gt; result;</span><br><span class="line">    List&lt;String&gt; path;</span><br><span class="line">    String[] hashTable=&#123;<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;abc&quot;</span>,<span class="string">&quot;def&quot;</span>,<span class="string">&quot;ghi&quot;</span>,<span class="string">&quot;jkl&quot;</span>,<span class="string">&quot;mno&quot;</span>,<span class="string">&quot;pqrs&quot;</span>,<span class="string">&quot;tuv&quot;</span>,<span class="string">&quot;wxyz&quot;</span>&#125;;</span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">letterCombinations</span><span class="params">(String digits)</span> &#123;</span><br><span class="line">        <span class="comment">//初始化result和path集合</span></span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        path=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//如果digits为空或者为空串，则直接返回空集合</span></span><br><span class="line">        <span class="keyword">if</span>(digits==<span class="literal">null</span> || <span class="string">&quot;&quot;</span>.equals(digits)) <span class="keyword">return</span> result;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//digits不为空串则进行回溯搜索</span></span><br><span class="line">        backtarcking(digits,<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtarcking</span><span class="params">(String digits,<span class="type">int</span> index)</span>&#123;</span><br><span class="line">        <span class="comment">//参数index指向的是正在处理的个数，当指向digtis.length()也即指向最后一个字符后面说明可以收获结果</span></span><br><span class="line">        <span class="keyword">if</span>(index==digits.length())&#123;</span><br><span class="line">            StringBuilder sb=<span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">            <span class="comment">//拼接path路径，收获结果到result中</span></span><br><span class="line">            <span class="keyword">for</span>(String s:path)&#123;</span><br><span class="line">                sb.append(s);</span><br><span class="line">            &#125;</span><br><span class="line">            result.add(sb.toString());</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="comment">//获取当前index位置下的数，例如”23“ index为 0  则num为2</span></span><br><span class="line">        <span class="comment">//								index为 1  则num为3  </span></span><br><span class="line">        <span class="type">int</span> num=digits.charAt(index)-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//遍历hashTable中映射对应的数组，</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;hashTable[num].length();i++)&#123;</span><br><span class="line">            <span class="comment">//添加数组中对应的字符</span></span><br><span class="line">            path.add(hashTable[num].charAt(i)+<span class="string">&quot;&quot;</span>);</span><br><span class="line">            <span class="comment">//操作下一个位置字符</span></span><br><span class="line">            backtarcking(digits,index+<span class="number">1</span>);</span><br><span class="line">            <span class="comment">//回溯</span></span><br><span class="line">            path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h3 id="图解-1"   >
          <a href="#图解-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#图解-1" class="headerlink" title="图解"></a>图解</h3>
      <p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="https://images-kkblog.oss-cn-hangzhou.aliyuncs.com/image-20230911225341797.png"  alt="电话号码的字母组合">
      </p>

        <h2 id="39-组合总和"   >
          <a href="#39-组合总和" class="heading-link"><i class="fas fa-link"></i></a><a href="#39-组合总和" class="headerlink" title="39.组合总和"></a>39.组合总和</h2>
      <p>给你一个 <strong>无重复元素</strong> 的整数数组 <code>candidates</code> 和一个目标整数 <code>target</code> ，找出 <code>candidates</code> 中可以使数字和为目标数 <code>target</code> 的 所有 <strong>不同组合</strong> ，并以列表形式返回。你可以按 <strong>任意顺序</strong> 返回这些组合。</p>
<p><code>candidates</code> 中的 <strong>同一个</strong> 数字可以 <strong>无限制重复被选取</strong> 。如果至少一个数字的被选数量不同，则两种组合是不同的。 </p>
<p>对于给定的输入，保证和为 <code>target</code> 的不同组合数少于 <code>150</code> 个。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/combination-sum/" >Leetcode.39题(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-3"   >
          <a href="#第一次做-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-3" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;09&#x2F;12</p>

        <h4 id="第一次代码-3"   >
          <a href="#第一次代码-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-3" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; result;</span><br><span class="line">    List&lt;Integer&gt; path;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">combinationSum</span><span class="params">(<span class="type">int</span>[] candidates, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        path=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        backtracking(candidates,target);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span>[] candidates,<span class="type">int</span> target)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(target&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(target==<span class="number">0</span>) result.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>(path));</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;candidates.length;i++)&#123;</span><br><span class="line">            path.add(candidates[i]);</span><br><span class="line">            backtracking(candidates,target-candidates[i]);</span><br><span class="line">            path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交错误"   >
          <a href="#提交错误" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交错误" class="headerlink" title="提交错误"></a>提交错误</h5>
      <p>CASE:candidates &#x3D;[2,3,5] target&#x3D;7,输出[[2,2,2,2],[2,3,3],[3,2,3],[3,3,2],[3,5],[5,3]]，预期输出[[2,2,2,2],[2,3,3],[3,5]]</p>

        <h4 id="第二次代码-3"   >
          <a href="#第二次代码-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码-3" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; result;</span><br><span class="line">    List&lt;Integer&gt; path;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">combinationSum</span><span class="params">(<span class="type">int</span>[] candidates, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        path=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        backtracking(candidates,target,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span>[] candidates,<span class="type">int</span> target,<span class="type">int</span> index)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(target&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(target==<span class="number">0</span>) result.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>(path));</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=index;i&lt;candidates.length;i++)&#123;</span><br><span class="line">            path.add(candidates[i]);</span><br><span class="line">            backtracking(candidates,target-candidates[i],i);</span><br><span class="line">            path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-1"   >
          <a href="#提交成功-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-1" class="headerlink" title="提交成功"></a>提交成功</h5>
      <p>传入一个index参数，可以确定每次开始的位置，如果当前结点并没有完全结束之前可以重复使用，所以递归传入的i为当前位置。为的是index以后位置的结果不会重复</p>

        <h3 id="题解-4"   >
          <a href="#题解-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-4" class="headerlink" title="题解"></a>题解</h3>
      <p>思路：利用全局变量result收获结果集，以及全局变量path来获取单层路径，然后当所需的值小于等于0的时候做一个收获结果集的操作。如果等于0则收获，如果小于0就结束。然后这个取完一个元素之后，这个位置的元素可以重复取，所以我们对index传参的过程中可以不断的使用当前位置，而当前位置结束之后就不能再使用，防止组合的重复</p>
<p><strong>实现</strong></p>
<ul>
<li>递归函数的参数和返回值<ul>
<li>返回值void：所有的结果都在result集合中</li>
<li>参数candidates：用于遍历的数组</li>
<li>参数target：<strong>目前所需的值</strong></li>
<li>参数index：遍历的起始位置</li>
</ul>
</li>
<li>递归函数的结束条件<ul>
<li>当target&lt;0，说明总和已经超过了，结束递归</li>
<li>当target&#x3D;&#x3D;0，说明当前组合是需要的，添加到result集合中再结束递归</li>
</ul>
</li>
<li>单层递归的逻辑<ul>
<li>添加当前结点值到path中</li>
<li>递归，从当前位置开始，以便可以取相同元素</li>
<li>回溯</li>
</ul>
</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; result;</span><br><span class="line">    List&lt;Integer&gt; path;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">combinationSum</span><span class="params">(<span class="type">int</span>[] candidates, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        path=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        backtracking(candidates,target,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span>[] candidates,<span class="type">int</span> target,<span class="type">int</span> index)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(target&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(target==<span class="number">0</span>) result.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>(path));</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=index;i&lt;candidates.length;i++)&#123;</span><br><span class="line">            path.add(candidates[i]);</span><br><span class="line">            backtracking(candidates,target-candidates[i],i);</span><br><span class="line">            path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h3 id="图解-2"   >
          <a href="#图解-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#图解-2" class="headerlink" title="图解"></a>图解</h3>
      <p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="https://images-kkblog.oss-cn-hangzhou.aliyuncs.com/image-20230912092618756.png"  alt="组合总和">
      </p>

        <h3 id="剪枝-1"   >
          <a href="#剪枝-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#剪枝-1" class="headerlink" title="剪枝"></a>剪枝</h3>
      <p><strong>思想</strong></p>
<ul>
<li><p>先对数组进行<strong>排序</strong></p>
<blockquote>
<p>不排序的话如果数组为2534，target&#x3D;4，那么就会错过结果集</p>
</blockquote>
</li>
<li><p>再判断当前位置元素是否大于target，如果大于了就可以剪枝不再遍历后面元素</p>
</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; result;</span><br><span class="line">    List&lt;Integer&gt; path;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">combinationSum</span><span class="params">(<span class="type">int</span>[] candidates, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        path=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Arrays.sort(candidates);</span><br><span class="line">        backtracking(candidates,target,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span>[] candidates,<span class="type">int</span> target,<span class="type">int</span> index)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(target&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(target==<span class="number">0</span>) result.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>(path));</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="comment">//剪枝逻辑就在for循环的条件中，添加了candidates[i]&lt;=target</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=index;i&lt;candidates.length&amp;&amp; candidates[i]&lt;=target;i++)&#123;</span><br><span class="line">            path.add(candidates[i]);</span><br><span class="line">            backtracking(candidates,target-candidates[i],i);</span><br><span class="line">            path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h2 id="40-组合总和II"   >
          <a href="#40-组合总和II" class="heading-link"><i class="fas fa-link"></i></a><a href="#40-组合总和II" class="headerlink" title="40.组合总和II"></a>40.组合总和II</h2>
      <p>给定一个候选人编号的集合 <code>candidates</code> 和一个目标数 <code>target</code> ，找出 <code>candidates</code> 中所有可以使数字和为 <code>target</code> 的组合。</p>
<p><code>candidates</code> 中的每个数字在每个组合中只能使用 <strong>一次</strong> 。</p>
<p><strong>注意：</strong>解集不能包含重复的组合。 </p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/combination-sum-ii/" >Leetcode.40(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-4"   >
          <a href="#第一次做-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-4" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;09&#x2F;13</p>

        <h4 id="第一次代码-4"   >
          <a href="#第一次代码-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-4" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; result;</span><br><span class="line">    List&lt;Integer&gt; path;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">combinationSum2</span><span class="params">(<span class="type">int</span>[] candidates, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        path=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        backtracking(candidates,target,<span class="number">0</span>);</span><br><span class="line">        Arrays.sort(candidates);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span>[] candidates,<span class="type">int</span> target,<span class="type">int</span> start)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(target&lt;<span class="number">0</span>) <span class="keyword">return</span> ;</span><br><span class="line">        <span class="keyword">if</span>(target==<span class="number">0</span>) &#123;</span><br><span class="line">            result.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>(path));</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=start;i&lt;candidates.length;i++)&#123;</span><br><span class="line">            path.add(candidates[i]);</span><br><span class="line">            backtracking(candidates,target-candidates[i],i+<span class="number">1</span>);</span><br><span class="line">            path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-5"   >
          <a href="#提交失败-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-5" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:candidates &#x3D;[10,1,2,7,6,1,5]，target&#x3D;8，输出[[1,2,5],[1,7],[1,6,1],[2,6],[2,1,5],[7,1]]，预期输出[[1,1,6],[1,2,5],[1,7],[2,6]]</p>

        <h4 id="第二次代码-4"   >
          <a href="#第二次代码-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码-4" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; result;</span><br><span class="line">    List&lt;Integer&gt; path;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">combinationSum2</span><span class="params">(<span class="type">int</span>[] candidates, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        path=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Arrays.sort(candidates);</span><br><span class="line">        backtracking(candidates,target,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span>[] candidates,<span class="type">int</span> target,<span class="type">int</span> start)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(target&lt;<span class="number">0</span>) <span class="keyword">return</span> ;</span><br><span class="line">        <span class="keyword">if</span>(target==<span class="number">0</span>) &#123;</span><br><span class="line">            result.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>(path));</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=start;i&lt;candidates.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i!=<span class="number">0</span> &amp;&amp; candidates[i-<span class="number">1</span>]==candidates[i])&#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            path.add(candidates[i]);</span><br><span class="line">            backtracking(candidates,target-candidates[i],i+<span class="number">1</span>);</span><br><span class="line">            path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">        </span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-6"   >
          <a href="#提交失败-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-6" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:candidates &#x3D;[10,1,2,7,6,1,5]，target&#x3D;8，输出[[1,2,5],[1,7],[1,6,1],[2,6],[2,1,5],[7,1]]，预期输出[[1,1,6],[1,2,5],[1,7],[2,6]]</p>

        <h4 id="第三次代码"   >
          <a href="#第三次代码" class="heading-link"><i class="fas fa-link"></i></a><a href="#第三次代码" class="headerlink" title="第三次代码"></a>第三次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; result;</span><br><span class="line">    List&lt;Integer&gt; path;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">combinationSum2</span><span class="params">(<span class="type">int</span>[] candidates, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        path=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Arrays.sort(candidates);</span><br><span class="line">        backtracking(candidates,target,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span>[] candidates,<span class="type">int</span> target,<span class="type">int</span> start)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(target&lt;<span class="number">0</span>) <span class="keyword">return</span> ;</span><br><span class="line">        <span class="keyword">if</span>(target==<span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span>(List&lt;Integer&gt; list:result)&#123;</span><br><span class="line">                <span class="keyword">if</span>(list.size()!=path.size()) <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">if</span>(list.equals(path)) <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            result.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>(path));</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=start;i&lt;candidates.length;)&#123;</span><br><span class="line">            path.add(candidates[i]);</span><br><span class="line">            backtracking(candidates,target-candidates[i],i+<span class="number">1</span>);</span><br><span class="line">            path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-7"   >
          <a href="#提交失败-7" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-7" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:candidates&#x3D;[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],target &#x3D;30 超出时间限制</p>

        <h4 id="第四次代码"   >
          <a href="#第四次代码" class="heading-link"><i class="fas fa-link"></i></a><a href="#第四次代码" class="headerlink" title="第四次代码"></a>第四次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; result;</span><br><span class="line">    List&lt;Integer&gt; path;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">combinationSum2</span><span class="params">(<span class="type">int</span>[] candidates, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        path=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Arrays.sort(candidates);</span><br><span class="line">        backtracking(candidates,target,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span>[] candidates,<span class="type">int</span> target,<span class="type">int</span> start)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(target&lt;<span class="number">0</span>) <span class="keyword">return</span> ;</span><br><span class="line">        <span class="keyword">if</span>(target==<span class="number">0</span>) &#123;</span><br><span class="line">            result.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>(path));</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=start;i&lt;candidates.length;)&#123;</span><br><span class="line">            path.add(candidates[i]);</span><br><span class="line">            backtracking(candidates,target-candidates[i],i+<span class="number">1</span>);</span><br><span class="line">            path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span>(i!=candidates.length-<span class="number">1</span>&amp;&amp;candidates[i]==candidates[i+<span class="number">1</span>])&#123;</span><br><span class="line">                i+=<span class="number">2</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span> i++;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-8"   >
          <a href="#提交失败-8" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-8" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:candidates&#x3D;[2,2,2]，target&#x3D;2，输出[[2],[2]],预期输出[2]</p>

        <h4 id="第五次代码"   >
          <a href="#第五次代码" class="heading-link"><i class="fas fa-link"></i></a><a href="#第五次代码" class="headerlink" title="第五次代码"></a>第五次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; result;</span><br><span class="line">    List&lt;Integer&gt; path;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">combinationSum2</span><span class="params">(<span class="type">int</span>[] candidates, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        path=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//给数组排序</span></span><br><span class="line">        Arrays.sort(candidates);</span><br><span class="line">        backtracking(candidates,target,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span>[] candidates,<span class="type">int</span> target,<span class="type">int</span> start)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(target&lt;<span class="number">0</span>) <span class="keyword">return</span> ;</span><br><span class="line">        <span class="keyword">if</span>(target==<span class="number">0</span>) &#123;</span><br><span class="line">            result.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>(path));</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=start;i&lt;candidates.length;)&#123;</span><br><span class="line">            path.add(candidates[i]);</span><br><span class="line">            backtracking(candidates,target-candidates[i],i+<span class="number">1</span>);</span><br><span class="line">            path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">            <span class="comment">//回溯之后指针移到下一个元素位置，如果下一个元素和当前元素相同，说明下一个组合中以下一个元素开始的组合已经重复了</span></span><br><span class="line">            i++;</span><br><span class="line">            <span class="keyword">while</span>(i!=<span class="number">0</span>&amp;&amp;i&lt;candidates.length)&#123;</span><br><span class="line">                <span class="keyword">if</span>(candidates[i-<span class="number">1</span>]==candidates[i]) i++;</span><br><span class="line">                <span class="keyword">else</span> &#123;<span class="keyword">break</span>;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交通过"   >
          <a href="#提交通过" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交通过" class="headerlink" title="提交通过"></a>提交通过</h5>
      
        <h3 id="题解-5"   >
          <a href="#题解-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-5" class="headerlink" title="题解"></a>题解</h3>
      <p>思路：这道题和之前的题目不一样的点在于数组中有相同数值的元素，并且规定组合中元素不能重复取，但是取相同值的元素，</p>
<p>我们利用一个used数组来对原数组使用元素的情况进行判断，如果used[i]&#x3D;&#x3D;1说明这个位置元素已经取过，如果used[i]&#x3D;&#x3D;0说明这个位置元素还没取过</p>
<p><strong>实现</strong></p>
<ul>
<li><p>全局变量</p>
<ul>
<li>List&lt;List<Integer>&gt; result :用于统计结果集</li>
<li>List<Integer> path :用于记录单个路径</li>
<li>int[] used :用来标记这个位置元素是否使用</li>
</ul>
</li>
<li><p>初始化并且将candidates数组进行<strong>排序</strong>（使其相同值元素能在一起，方便进行<strong>层次维度</strong>的去重）</p>
</li>
<li><p>递归函数的返回值和参数</p>
<ul>
<li>返回值void：所有结果集都在result中</li>
<li>参数candidates：数组</li>
<li>参数target：目标和</li>
<li>参数start：搜索的开始索引值</li>
</ul>
</li>
<li><p>递归函数的结束条件</p>
<ul>
<li>当target&lt;0，说明当前path中元素和超过了所需，直接结束递归</li>
<li>当target&#x3D;&#x3D;0，说明path中的元素就是当前需要的组合，result.add(new ArrayList(path))，收获结果</li>
</ul>
</li>
<li><p>单层递归的处理逻辑</p>
<ul>
<li><p><strong>去重处理</strong></p>
</li>
<li><ul>
<li><p>判断当(i!&#x3D;0 &amp;&amp; candidates[i-1]&#x3D;&#x3D;candidates[i] &amp;&amp; used[i-1]&#x3D;&#x3D;0时，直接跳过不处理</p>
</li>
<li><p>i！&#x3D;0 第一个元素不进行判断</p>
</li>
<li><p>candidates[i-1]&#x3D;&#x3D;candidates[i]  说明当前元素和前一个元素值相同，要准备进行去重(如果是层次上的相同则去除，如果是深度上的相同则保留)</p>
</li>
<li><p>used[i-1]&#x3D;&#x3D;0，说明前一个元素没有用过，如果 candidates[i-1]&#x3D;&#x3D;candidates[i] &amp;&amp;used[i-1]&#x3D;&#x3D;0 说明当前的组合是前一个位置元素的<strong>子组合</strong></p>
</li>
</ul>
</li>
<li><p>添加路径到path中，将used[i]置为1</p>
</li>
<li><p>递归搜索i+1的位置</p>
</li>
<li><p>回溯，回溯path也回溯used[i]，将used[i]置为0，表示这个位置元素没有用过</p>
</li>
</ul>
</li>
</ul>
<p><strong>代码</strong>(利用used数组)</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; result;</span><br><span class="line">    List&lt;Integer&gt; path;</span><br><span class="line">    <span class="type">int</span>[] used;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">combinationSum2</span><span class="params">(<span class="type">int</span>[] candidates, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        path=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//排序</span></span><br><span class="line">        Arrays.sort(candidates);</span><br><span class="line">        used=<span class="keyword">new</span> <span class="title class_">int</span>[candidates.length];</span><br><span class="line">        backtracking(candidates,target,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span>[] candidates,<span class="type">int</span> target,<span class="type">int</span> start)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(target&lt;<span class="number">0</span>) <span class="keyword">return</span> ;</span><br><span class="line">        <span class="keyword">if</span>(target==<span class="number">0</span>) &#123;</span><br><span class="line">            result.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>(path));</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=start;i&lt;candidates.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i!=<span class="number">0</span> &amp;&amp; candidates[i-<span class="number">1</span>]==candidates[i] &amp;&amp; used[i-<span class="number">1</span>]==<span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line">            path.add(candidates[i]);</span><br><span class="line">            used[i]=<span class="number">1</span>;</span><br><span class="line">            backtracking(candidates,target-candidates[i],i+<span class="number">1</span>);</span><br><span class="line">            used[i]=<span class="number">0</span>;</span><br><span class="line">            path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p><strong>代码(不用used数组去重)</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; result;</span><br><span class="line">    List&lt;Integer&gt; path;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">combinationSum2</span><span class="params">(<span class="type">int</span>[] candidates, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        path=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//给数组排序</span></span><br><span class="line">        Arrays.sort(candidates);</span><br><span class="line">        backtracking(candidates,target,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span>[] candidates,<span class="type">int</span> target,<span class="type">int</span> start)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(target&lt;<span class="number">0</span>) <span class="keyword">return</span> ;</span><br><span class="line">        <span class="keyword">if</span>(target==<span class="number">0</span>) &#123;</span><br><span class="line">            result.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>(path));</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=start;i&lt;candidates.length;)&#123;</span><br><span class="line">            path.add(candidates[i]);</span><br><span class="line">            backtracking(candidates,target-candidates[i],i+<span class="number">1</span>);</span><br><span class="line">            path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">            <span class="comment">//回溯之后指针移到下一个元素位置，如果下一个元素和当前元素相同，说明下一个组合中以下一个元素开始的组合已经重复了</span></span><br><span class="line">            i++;</span><br><span class="line">            <span class="keyword">while</span>(i!=<span class="number">0</span>&amp;&amp;i&lt;candidates.length)&#123;</span><br><span class="line">                <span class="keyword">if</span>(candidates[i-<span class="number">1</span>]==candidates[i]) i++;</span><br><span class="line">                <span class="keyword">else</span> &#123;<span class="keyword">break</span>;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h3 id="图解-3"   >
          <a href="#图解-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#图解-3" class="headerlink" title="图解"></a>图解</h3>
      <p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="https://images-kkblog.oss-cn-hangzhou.aliyuncs.com/image-20230913122948179.png"  alt="组合总和II">
      </p>

        <h1 id="分割"   >
          <a href="#分割" class="heading-link"><i class="fas fa-link"></i></a><a href="#分割" class="headerlink" title="分割"></a>分割</h1>
      
        <h2 id="131-分割回文串"   >
          <a href="#131-分割回文串" class="heading-link"><i class="fas fa-link"></i></a><a href="#131-分割回文串" class="headerlink" title="131.分割回文串"></a>131.分割回文串</h2>
      <p>给你一个字符串 <code>s</code>，请你将 <code>s</code> 分割成一些子串，使每个子串都是 <strong>回文串</strong> 。返回 <code>s</code> 所有可能的分割方案。</p>
<p><strong>回文串</strong> 是正着读和反着读都一样的字符串。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/palindrome-partitioning/" >Leetcode.131题(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-5"   >
          <a href="#第一次做-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-5" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;09&#x2F;10</p>

        <h4 id="第一次代码-5"   >
          <a href="#第一次代码-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-5" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">solution</span>&#123;</span><br><span class="line">	List&lt;List&lt;String&gt;&gt; result;</span><br><span class="line">    List&lt;String&gt; list;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;String&gt;&gt; <span class="title function_">partition</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        backtracking(s,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(String s,<span class="type">int</span> start,<span class="type">int</span> index)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(index==s.length())&#123;</span><br><span class="line">            <span class="keyword">for</span>(String str:list)&#123;</span><br><span class="line">                StringBuilder sb=<span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">                sb.append(str);</span><br><span class="line">                sb.reverse();</span><br><span class="line">                <span class="keyword">if</span>(!sb.toString().equals(str))<span class="keyword">return</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">            result.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>(list));</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=start;i&lt;s.length();i++)&#123;</span><br><span class="line"></span><br><span class="line">            StringBuilder sb=<span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">            <span class="keyword">if</span>(start!=<span class="number">0</span>)&#123; sb.append(s.substring(<span class="number">0</span>,start));&#125;</span><br><span class="line"></span><br><span class="line">            sb.append(s.substring(i,i+<span class="number">1</span>));</span><br><span class="line">            list.add(sb.toString());</span><br><span class="line">            backtracking(s,i+<span class="number">1</span>,i+<span class="number">1</span>);</span><br><span class="line">            list.remove(list.size()-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-9"   >
          <a href="#提交失败-9" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-9" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:s&#x3D;”aab” 输出[[“b”]] 预期结果[[“a”,”a”,”b”],[“aa”,”b”]]</p>
<p>没能做出来卡了一个多小时</p>

        <h3 id="题解-6"   >
          <a href="#题解-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-6" class="headerlink" title="题解"></a>题解</h3>
      <p>思路：这道题的解法是，start指向的是切割位置，切割位置前就为一个子串，然后用substring方法切割，范围是[start，I+1）,因为start是不变的所以就能不断切割出子串，然后是子串的添加到list中</p>
<p><strong>实现</strong></p>
<ul>
<li>递归函数的参数和返回值<ul>
<li>返回值void，所有的结果都在结果集result中</li>
<li>参数s：用于切割的回文串</li>
<li>参数start，标记切割位置</li>
</ul>
</li>
<li>递归函数的结束条件<ul>
<li>当start&#x3D;&#x3D;s.length() 也即切割点到了回文串的最后一个字符，也就没有切割下的子串了，能收获已经正在result中的数据</li>
</ul>
</li>
<li>单层递归的逻辑<ul>
<li>每层循环从start，开始start传入0，代表的切割位置</li>
<li>对切割下的子串进行一个判断（isBackString方法）<ul>
<li>如果是回文串返回true，<strong>则添加到list结果集中</strong></li>
<li>如果不是回文串则返回false，则continue</li>
<li>函数的逻辑是利用StringBuilder进行一个字符串反转，如果反转后相同则是回文串</li>
</ul>
</li>
<li>递归，切割i+1的位置</li>
<li>回溯，将结果集添加的元素回溯出去</li>
</ul>
</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;String&gt;&gt; result;</span><br><span class="line">    List&lt;String&gt; list;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;String&gt;&gt; <span class="title function_">partition</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        backtracking(s,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(String s,<span class="type">int</span> start)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(start==s.length())&#123;</span><br><span class="line">            result.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>(list));</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=start;i&lt;s.length();i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(isBackString(s,start,i+<span class="number">1</span>))&#123;</span><br><span class="line">                list.add(s.substring(start,i+<span class="number">1</span>));</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            backtracking(s,i+<span class="number">1</span>);</span><br><span class="line">            list.remove(list.size()-<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isBackString</span><span class="params">(String s,<span class="type">int</span> start,<span class="type">int</span> i)</span></span><br><span class="line">    &#123;</span><br><span class="line">        String str=s.substring(start,i);</span><br><span class="line">        StringBuilder sb=<span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        sb.append(str);</span><br><span class="line">        sb.reverse();</span><br><span class="line">        <span class="keyword">return</span> str.equals(sb.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h2 id="93-复原IP地址"   >
          <a href="#93-复原IP地址" class="heading-link"><i class="fas fa-link"></i></a><a href="#93-复原IP地址" class="headerlink" title="93.复原IP地址"></a>93.复原IP地址</h2>
      <p><strong>有效 IP 地址</strong> 正好由四个整数（每个整数位于 <code>0</code> 到 <code>255</code> 之间组成，且不能含有前导 <code>0</code>），整数之间用 <code>&#39;.&#39;</code> 分隔。</p>
<ul>
<li>例如：<code>&quot;0.1.2.201&quot;</code> 和<code> &quot;192.168.1.1&quot;</code> 是 <strong>有效</strong> IP 地址，但是 <code>&quot;0.011.255.245&quot;</code>、<code>&quot;192.168.1.312&quot;</code> 和 <code>&quot;192.168@1.1&quot;</code> 是 <strong>无效</strong> IP 地址。</li>
</ul>
<p>给定一个只包含数字的字符串 <code>s</code> ，用以表示一个 IP 地址，返回所有可能的<strong>有效 IP 地址</strong>，这些地址可以通过在 <code>s</code> 中插入 <code>&#39;.&#39;</code> 来形成。你 <strong>不能</strong> 重新排序或删除 <code>s</code> 中的任何数字。你可以按 <strong>任何</strong> 顺序返回答案。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/restore-ip-addresses/" >Leetcode.93题(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-6"   >
          <a href="#第一次做-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-6" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;09&#x2F;14</p>

        <h4 id="第一次代码-6"   >
          <a href="#第一次代码-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-6" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;String&gt; result;</span><br><span class="line">    List&lt;String&gt; path;</span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">restoreIpAddresses</span><span class="params">(String s)</span> &#123; </span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span>(s.length()&lt;<span class="number">4</span>) <span class="keyword">return</span> result;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">char</span> c:s.toCharArray())&#123;</span><br><span class="line">            <span class="keyword">if</span>(c&gt;=<span class="string">&#x27;0&#x27;</span> &amp;&amp; c&lt;=<span class="string">&#x27;9&#x27;</span>) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">        path=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        backtracking(s,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(String s,<span class="type">int</span> index)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(index==s.length())&#123;</span><br><span class="line">            <span class="keyword">for</span>(String str:path)&#123;</span><br><span class="line">                <span class="keyword">if</span>(str.length()!=<span class="number">1</span>&amp;&amp;str.charAt(<span class="number">0</span>)==<span class="string">&#x27;0&#x27;</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(Integer.parseInt(str)&gt;<span class="number">255</span>) <span class="keyword">return</span> ;</span><br><span class="line">                </span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">            StringBuilder sb=<span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;path.size();i++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(i==path.size()-<span class="number">1</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    sb.append(path.get(i));</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                sb.append(path.get(i)+<span class="string">&quot;.&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(sb.length()!=<span class="number">0</span>) result.add(sb.toString());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=index;i&lt;s.length();i++)&#123;</span><br><span class="line">            path.add(s.substring(index,i+<span class="number">1</span>));</span><br><span class="line">            backtracking(s,i+<span class="number">1</span>);</span><br><span class="line">            path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-10"   >
          <a href="#提交失败-10" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-10" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:java.lang.NumberFormatException: For input string: “5525511135”</p>

        <h4 id="第二次代码-5"   >
          <a href="#第二次代码-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码-5" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;String&gt; result;</span><br><span class="line">    List&lt;String&gt; path;</span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">restoreIpAddresses</span><span class="params">(String s)</span> &#123; </span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span>(s.length()&lt;<span class="number">4</span>) <span class="keyword">return</span> result;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">char</span> c:s.toCharArray())&#123;</span><br><span class="line">            <span class="keyword">if</span>(c&gt;=<span class="string">&#x27;0&#x27;</span> &amp;&amp; c&lt;=<span class="string">&#x27;9&#x27;</span>) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">        path=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        backtracking(s,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(String s,<span class="type">int</span> index)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(index==s.length())&#123;</span><br><span class="line">            StringBuilder sb=<span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;path.size();i++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(i==path.size()-<span class="number">1</span>)&#123;</span><br><span class="line">                    sb.append(path.get(i));</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                sb.append(path.get(i)+<span class="string">&quot;.&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            result.add(sb.toString());</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=index;i&lt;s.length();i++)&#123;</span><br><span class="line">            path.add(s.substring(index,i+<span class="number">1</span>));</span><br><span class="line">            backtracking(s,i+<span class="number">1</span>);</span><br><span class="line">            path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-11"   >
          <a href="#提交失败-11" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-11" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>没能做出来</p>

        <h3 id="题解-7"   >
          <a href="#题解-7" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-7" class="headerlink" title="题解"></a>题解</h3>
      <p>思路：用一个sum来统计多少个逗号’.’，index代表分割线，然后分割出来的子串要符合条件的时候才会递归去搜索，然后最后用StringBuilder拼接结果集</p>
<p><strong>实现</strong></p>
<ul>
<li><p>定义全局变量</p>
<ul>
<li><p>result：用于收获结果集</p>
</li>
<li><p>path:用于统计切割的字符串路径</p>
</li>
</ul>
</li>
<li><p>初始化，并且对s做一个初步的验证保证s只能有数字</p>
</li>
<li><p>递归函数的参数和返回值</p>
<ul>
<li>返回值void：所有的结果都收获在结果集中</li>
<li>参数index：表示切割的字符位置</li>
<li>参数sum：表示已经切割过后有几个逗号</li>
</ul>
</li>
<li><p>递归函数的结束条件</p>
<ul>
<li><p>当sum&#x3D;&#x3D;3说明已经切割了三次：则path中有三个字符串，而从index到s.length()-1为最后一个字符串</p>
<p>判断最后一个字符串是否符合要求，如果符合要求则需要收获结果集</p>
</li>
</ul>
</li>
<li><p>单层递归逻辑</p>
<ul>
<li><p>判断从index到i切割的字符串是否符合要求</p>
<ul>
<li><p>如果不符合要求则不需要继续回溯，继续遍历切割</p>
</li>
<li><p>如果符合要求则需要将切割子串添加到path数组中，并将sum+1，表示该位置已经切割出字符串了，然后递归去切割子串</p>
<p>递归结束之后回溯</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>验证要求合法性函数(isvalid)</p>
<ul>
<li>区间是左闭右闭，切割str&#x3D;s.substring(begin,end+1)</li>
<li>验证子串str是否为空或者为空串，如果是则不合法返回false</li>
<li>验证子串str是否长度超过4，如果是则不合法返回false</li>
<li>验证子串str是否长度不为1并且头字符是0，如果是则不合法，返回false</li>
<li>验证子串str转换成Integer类型之后数值是否大于255，如果是则不合法，返回false</li>
</ul>
</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;String&gt; result;</span><br><span class="line">    List&lt;String&gt; path;</span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">restoreIpAddresses</span><span class="params">(String s)</span> &#123; </span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span>(s.length()&lt;<span class="number">4</span>) <span class="keyword">return</span> result;</span><br><span class="line">        <span class="comment">//验证对IP地址是否有其他字符</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">char</span> c:s.toCharArray())&#123;</span><br><span class="line">            <span class="keyword">if</span>(c&gt;=<span class="string">&#x27;0&#x27;</span> &amp;&amp; c&lt;=<span class="string">&#x27;9&#x27;</span>) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">        path=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        backtracking(s,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(String s,<span class="type">int</span> index,<span class="type">int</span> sum)</span>&#123;</span><br><span class="line">        <span class="comment">//当sum==3说明切割了三次</span></span><br><span class="line">       <span class="keyword">if</span>(sum==<span class="number">3</span>)&#123;</span><br><span class="line">           <span class="comment">//验证第三个逗号之后的字符串是否合法，如果合法则收集结果集</span></span><br><span class="line">           <span class="keyword">if</span>(isvalid(s,index,s.length()-<span class="number">1</span>))&#123;</span><br><span class="line">               StringBuilder sb=<span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">               <span class="keyword">for</span>(String str:path)&#123;</span><br><span class="line">                   sb.append(str+<span class="string">&quot;.&quot;</span>);</span><br><span class="line">               &#125;</span><br><span class="line">               sb.append(s.substring(index,s.length()));</span><br><span class="line">               result.add(sb.toString());</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">for</span>(<span class="type">int</span> i=index;i&lt;s.length();i++)&#123;</span><br><span class="line">          <span class="comment">//判断切割出来的第一个子串是否符合条件，如果是则才能继续递归</span></span><br><span class="line">          <span class="keyword">if</span>(isvalid(s,index,i))&#123;</span><br><span class="line">              path.add(s.substring(index,i+<span class="number">1</span>));</span><br><span class="line">              <span class="comment">//向i之后搜索，将逗号总数+1,递归之后会回溯</span></span><br><span class="line">              backtracking(s,i+<span class="number">1</span>,sum+<span class="number">1</span>);</span><br><span class="line">              path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//验证子串的合法性，方法是左闭右闭的子串区间</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isvalid</span><span class="params">(String s,<span class="type">int</span> begin,<span class="type">int</span> end)</span>&#123;</span><br><span class="line">		</span><br><span class="line">        String str=s.substring(begin,end+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span>(str==<span class="literal">null</span> || <span class="string">&quot;&quot;</span>.equals(str)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span>(str.length()!=<span class="number">1</span> &amp;&amp; str.charAt(<span class="number">0</span>)==<span class="string">&#x27;0&#x27;</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span>(str.length()&gt;=<span class="number">4</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span>(Integer.parseInt(str)&gt;<span class="number">255</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h1 id="子集"   >
          <a href="#子集" class="heading-link"><i class="fas fa-link"></i></a><a href="#子集" class="headerlink" title="子集"></a>子集</h1>
      
        <h2 id="78-子集"   >
          <a href="#78-子集" class="heading-link"><i class="fas fa-link"></i></a><a href="#78-子集" class="headerlink" title="78.子集"></a>78.子集</h2>
      <p>给你一个整数数组 <code>nums</code> ，数组中的元素 <strong>互不相同</strong> 。返回该数组所有可能的子集（幂集）。</p>
<p>解集 <strong>不能</strong> 包含重复的子集。你可以按 <strong>任意顺序</strong> 返回解集。</p>
<p> <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/subsets/" >Leetcode.78题(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-7"   >
          <a href="#第一次做-7" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-7" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;09&#x2F;15</p>

        <h4 id="第一次代码-7"   >
          <a href="#第一次代码-7" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-7" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; result;</span><br><span class="line">    List&lt;Integer&gt; path;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">subsets</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        path=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        backtracking(nums,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span>[] nums,<span class="type">int</span> index)</span>&#123;</span><br><span class="line">        result.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>(path));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=index;i&lt;nums.length;i++)&#123;</span><br><span class="line">            path.add(nums[i]);</span><br><span class="line">            backtracking(nums,i);</span><br><span class="line">            path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-12"   >
          <a href="#提交失败-12" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-12" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:超过内存限制</p>
<p>原因是每次递归之后i还是0，导致死循环</p>

        <h4 id="第二次代码-6"   >
          <a href="#第二次代码-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码-6" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; result;</span><br><span class="line">    List&lt;Integer&gt; path;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">subsets</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        path=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        backtracking(nums,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span>[] nums,<span class="type">int</span> index)</span>&#123;</span><br><span class="line">        result.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>(path));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=index;i&lt;nums.length;i++)&#123;</span><br><span class="line">            path.add(nums[i]);</span><br><span class="line">            backtracking(nums,i+<span class="number">1</span>);</span><br><span class="line">            path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-2"   >
          <a href="#提交成功-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-2" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-8"   >
          <a href="#题解-8" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-8" class="headerlink" title="题解"></a>题解</h3>
      <p>思想：我们这道题收获结果集和之前的问题不一样，之前的收获结果集都是在<strong>叶子结点</strong>收获，而这道题的结果在每个结点中，也即结果集在<strong>每个结点</strong>收获，具体可以看图解</p>
<p><strong>实现</strong></p>
<ul>
<li>定义全局变量<ul>
<li>result：用于收获结果集</li>
<li>path：用于存放单条路径</li>
</ul>
</li>
<li>递归函数的参数和返回值<ul>
<li>返回值void：所有结果都收获到结果集中</li>
<li>参数nums：要获取子集的数组</li>
<li>参数index：当前循环开始的搜索位置索引</li>
</ul>
</li>
<li>递归函数的结束条件<ul>
<li>当index&gt;&#x3D;nums.length，也即收获到最后的元素就结束条件</li>
</ul>
</li>
<li>递归函数的单层逻辑<ul>
<li>收获结果(每个结点都是结果)</li>
<li>递归搜索剩下子集</li>
<li>回溯</li>
</ul>
</li>
</ul>
<p><em>这里可以没有递归结束条件，当搜索到最后的时候index&#x3D;nums.length就会结束递归</em></p>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; result;</span><br><span class="line">    List&lt;Integer&gt; path;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">subsets</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        path=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        backtracking(nums,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span>[] nums,<span class="type">int</span> index)</span>&#123;</span><br><span class="line">        <span class="comment">//收获结果集</span></span><br><span class="line">        result.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>(path));</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=index;i&lt;nums.length;i++)&#123;</span><br><span class="line">            path.add(nums[i]);</span><br><span class="line">            backtracking(nums,i+<span class="number">1</span>);</span><br><span class="line">            path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h3 id="图解-4"   >
          <a href="#图解-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#图解-4" class="headerlink" title="图解"></a>图解</h3>
      <p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="https://images-kkblog.oss-cn-hangzhou.aliyuncs.com/image-20230915105009585.png"  alt="子集树形结构">
      </p>

        <h2 id="90-子集II"   >
          <a href="#90-子集II" class="heading-link"><i class="fas fa-link"></i></a><a href="#90-子集II" class="headerlink" title="90.子集II"></a>90.子集II</h2>
      <p>给你一个整数数组 <code>nums</code> ，其中可能包含重复元素，请你返回该数组所有可能的子集（幂集）。</p>
<p>解集 <strong>不能</strong> 包含重复的子集。返回的解集中，子集可以按 <strong>任意顺序</strong> 排列。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/subsets-ii/" >Leetcode.90题(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-8"   >
          <a href="#第一次做-8" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-8" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;09&#x2F;16</p>

        <h4 id="第一次代码-8"   >
          <a href="#第一次代码-8" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-8" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; result;</span><br><span class="line">    List&lt;Integer&gt; path;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">subsetsWithDup</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        path=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        backtracking(nums,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span>[] nums,<span class="type">int</span> start)</span>&#123;</span><br><span class="line">        result.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>(path));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=start;i&lt;nums.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i&gt;start &amp;&amp; nums[i]==nums[i-<span class="number">1</span>]) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            path.add(nums[i]);</span><br><span class="line">            backtracking(nums,i+<span class="number">1</span>);</span><br><span class="line">            path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-13"   >
          <a href="#提交失败-13" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-13" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:nums &#x3D;[4,4,4,1,4]，输出[[],[4],[4,4],[4,4,4],[4,4,4,1],[4,4,4,1,4],[4,4,4,4],[4,4,1],[4,4,1,4],[4,4,4],[4,1],[4,1,4],[4,4],[1],[1,4],[4]]，预期输出：[[],[1],[1,4],[1,4,4],[1,4,4,4],[1,4,4,4,4],[4],[4,4],[4,4,4],[4,4,4,4]]</p>
<p>原因忘记排序，要对数组进行排序，将相同值放在一起，这样才好判断子集是否使用过这个元素</p>

        <h4 id="第二次代码-7"   >
          <a href="#第二次代码-7" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码-7" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; result;</span><br><span class="line">    List&lt;Integer&gt; path;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">subsetsWithDup</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        path=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Arrays.sort(nums);</span><br><span class="line">        backtracking(nums,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span>[] nums,<span class="type">int</span> start)</span>&#123;</span><br><span class="line">        result.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>(path));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=start;i&lt;nums.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i&gt;start &amp;&amp; nums[i]==nums[i-<span class="number">1</span>]) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            path.add(nums[i]);</span><br><span class="line">            backtracking(nums,i+<span class="number">1</span>);</span><br><span class="line">            path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-3"   >
          <a href="#提交成功-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-3" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-9"   >
          <a href="#题解-9" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-9" class="headerlink" title="题解"></a>题解</h3>
      <p>这道题就是78.子集问题以及40.组合总和II的一个结合，对每一个结点的结果都进行收获，对重复组合的一个去重操作</p>
<p><strong>实现</strong></p>
<ul>
<li>定义全局变量<ul>
<li>result: 收获结果集的集合</li>
<li>path：单条结果的路径</li>
</ul>
</li>
<li>递归函数的参数和返回值<ul>
<li>返回值void：所有结果递归时都收获在结果集中，所以没有返回值</li>
<li>参数nums:用于求得子集的数组</li>
<li>参数start：表示当前操作的索引下标</li>
</ul>
</li>
<li>递归函数的结束条件<ul>
<li>当start&gt;&#x3D;nums.length;也即遍历到最后一个元素那么就该结束递归</li>
</ul>
</li>
<li>单层递归的逻辑<ul>
<li>收获结果，每一个结点都是一个结果</li>
<li>递归去获取子集<ul>
<li>树层方面的去重：当i&gt;start说明已经经过递归回溯之后，并且nums[i]&#x3D;&#x3D;nums[i-1]，也即这是层次方面的重复，所以直接跳过这个层结点</li>
</ul>
</li>
<li>回溯</li>
</ul>
</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; result;</span><br><span class="line">    List&lt;Integer&gt; path;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">subsetsWithDup</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        path=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"> 		<span class="comment">//对数组进行排序</span></span><br><span class="line">        Arrays.sort(nums);</span><br><span class="line">        backtracking(nums,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span>[] nums,<span class="type">int</span> start)</span>&#123;</span><br><span class="line">        <span class="comment">//收获结果</span></span><br><span class="line">        result.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>(path));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=start;i&lt;nums.length;i++)&#123;</span><br><span class="line">            <span class="comment">//如果当前元素和前一个元素相同并且是层次方面的重合，那么就要跳过</span></span><br><span class="line">            <span class="keyword">if</span>(i&gt;start &amp;&amp; nums[i]==nums[i-<span class="number">1</span>]) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            path.add(nums[i]);</span><br><span class="line">            backtracking(nums,i+<span class="number">1</span>);</span><br><span class="line">            <span class="comment">//回溯</span></span><br><span class="line">            path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h1 id="排序"   >
          <a href="#排序" class="heading-link"><i class="fas fa-link"></i></a><a href="#排序" class="headerlink" title="排序"></a>排序</h1>
      
        <h2 id="46-全排列"   >
          <a href="#46-全排列" class="heading-link"><i class="fas fa-link"></i></a><a href="#46-全排列" class="headerlink" title="46.全排列"></a>46.全排列</h2>
      <p>给定一个不含重复数字的数组 <code>nums</code> ，返回其 <em>所有可能的全排列</em> 。你可以 <strong>按任意顺序</strong> 返回答案。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/permutations/" >Leetcode.46题(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-9"   >
          <a href="#第一次做-9" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-9" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;09&#x2F;19</p>

        <h4 id="第一次代码-9"   >
          <a href="#第一次代码-9" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-9" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; result;</span><br><span class="line">    List&lt;Integer&gt; path;</span><br><span class="line">    HashSet&lt;Integer&gt; set;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">permute</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        path=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        set=<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        backtracking(nums,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span>[] nums,<span class="type">int</span> start)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(path.size()==nums.length)&#123;</span><br><span class="line">            result.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>(path));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=start;i&lt;nums.length;i++)&#123;</span><br><span class="line">            path.add(nums[i]);</span><br><span class="line">            set.add(nums[i]);</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;nums.length;j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(set.contains(nums[j])) <span class="keyword">continue</span>;</span><br><span class="line">                backtracking(nums,j);</span><br><span class="line">                path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">                set.remove(set.size()-<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-14"   >
          <a href="#提交失败-14" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-14" class="headerlink" title="提交失败"></a>提交失败</h5>
      
        <h3 id="题解-10"   >
          <a href="#题解-10" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-10" class="headerlink" title="题解"></a>题解</h3>
      <p>思路：这道题和组合问题以及子集问题有所不同，因为排序问题主要讲究的是<strong>顺序</strong>，而不是元素。</p>
<blockquote>
<p> 当(1,2)两个元素只有(1,2)这个组合但是排序有(1,2),(2,1)这两个结果</p>
</blockquote>
<p>所以排序问题我们对数据的重复操作并不能通过startindex控制，我们可以引入一个set集合</p>
<p><strong>实现</strong></p>
<ul>
<li><p>定义全局变量</p>
<ul>
<li>result：收获结果集合</li>
<li>path：单个结果的路径集合</li>
<li>set：用于防止重复数据的set集合</li>
</ul>
</li>
<li><p>递归函数的参数和返回值</p>
<ul>
<li>返回值void：所有结果都在结果集中，所以没有返回值</li>
<li>参数nums，用于获取全排列的数组</li>
</ul>
</li>
<li><p>递归函数的结束条件</p>
<p>当path.size()&#x3D;&#x3D;nums.length，也即叶子结点收获结果</p>
</li>
<li><p>单层递归的实现逻辑</p>
<ul>
<li>每次递归的循环开始都是从0开始，因为要遍历整个数组</li>
<li>当set包含当前元素则跳过</li>
<li>set不包含当前元素则添加到path以及set中，递归</li>
<li>回溯，回溯path集合也set集合</li>
</ul>
<p>循环代码</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;nums.length;i++)&#123;</span><br><span class="line">            <span class="comment">//如果包含则跳过</span></span><br><span class="line">            <span class="keyword">if</span>(set.contains(nums[i])) <span class="keyword">continue</span>;</span><br><span class="line">            path.add(nums[i]);</span><br><span class="line">            set.add(nums[i]);</span><br><span class="line">            backtracking(nums);</span><br><span class="line">            <span class="comment">//回溯</span></span><br><span class="line">            path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">            set.remove(nums[i]);            </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//关键在于每次从0开始，以便对整个数组的全排列</span></span><br><span class="line"><span class="comment">//每次递归先判断当前元素是否被使用过，如果是则跳过</span></span><br></pre></td></tr></table></div></figure></li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; result;</span><br><span class="line">    List&lt;Integer&gt; path;</span><br><span class="line">    HashSet&lt;Integer&gt; set;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">permute</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        path=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        set=<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        backtracking(nums);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span>[] nums)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(path.size()==nums.length)&#123;</span><br><span class="line">            result.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>(path));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;nums.length;i++)&#123;</span><br><span class="line">            <span class="comment">//如果包含则跳过</span></span><br><span class="line">            <span class="keyword">if</span>(set.contains(nums[i])) <span class="keyword">continue</span>;</span><br><span class="line">            path.add(nums[i]);</span><br><span class="line">            set.add(nums[i]);</span><br><span class="line">            backtracking(nums);</span><br><span class="line">            <span class="comment">//回溯</span></span><br><span class="line">            path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">            set.remove(nums[i]);            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="47-全排列II"   >
          <a href="#47-全排列II" class="heading-link"><i class="fas fa-link"></i></a><a href="#47-全排列II" class="headerlink" title="47.全排列II"></a>47.全排列II</h2>
      
        <h3 id="第一次做-10"   >
          <a href="#第一次做-10" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-10" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;09&#x2F;20</p>

        <h4 id="第一次代码-10"   >
          <a href="#第一次代码-10" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-10" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; result;</span><br><span class="line">    List&lt;Integer&gt; path;</span><br><span class="line">    HashSet&lt;Integer&gt; hashSet;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">permuteUnique</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        path=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        hashSet=<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        backtracking(nums,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span>[] nums,<span class="type">int</span> start)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(path.size()==nums.length)&#123;</span><br><span class="line">            result.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>(path));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(start&gt;=nums.length) <span class="keyword">return</span>;</span><br><span class="line">        HashSet set=<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=start;i&lt;nums.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i&gt;start &amp;&amp; hashSet.contains(nums[i])) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span>(path.size()!=<span class="number">0</span> &amp;&amp; nums[i]&lt;path.get(path.size()-<span class="number">1</span>) || set.contains(nums[i]))</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">            path.add(nums[i]);</span><br><span class="line">            set.add(nums[i]);</span><br><span class="line">            hashSet.add(nums[i]);</span><br><span class="line">            backtracking(nums,i+<span class="number">1</span>);</span><br><span class="line">            path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">            hashSet.remove(nums[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-15"   >
          <a href="#提交失败-15" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-15" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:nums[1,1,2],输出[1,1,2]，预期输出[[1,1,2],[1,2,1],[2,1,1]]</p>

        <h4 id="第二次代码-8"   >
          <a href="#第二次代码-8" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码-8" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; result;</span><br><span class="line">    List&lt;Integer&gt; path;</span><br><span class="line">    HashSet&lt;Integer&gt; hashSet;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">permuteUnique</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        path=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        hashSet=<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        backtracking(nums);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span>[] nums)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(path.size()==nums.length)&#123;</span><br><span class="line">            result.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>(path));</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        HashSet&lt;Integer&gt; set=<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;nums.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(set.contains(nums[i])) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(hashSet.contains(i)) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            path.add(nums[i]);</span><br><span class="line">            set.add(nums[i]);</span><br><span class="line">            hashSet.add(i);</span><br><span class="line">            backtracking(nums);</span><br><span class="line">            hashSet.remove(i);</span><br><span class="line">            path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-4"   >
          <a href="#提交成功-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-4" class="headerlink" title="提交成功"></a>提交成功</h5>
      <p>hashset来判断是否索引下标被用过(类似于Used数组)，set用来判断当前元素是否层次上的重复</p>

        <h3 id="题解-11"   >
          <a href="#题解-11" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-11" class="headerlink" title="题解"></a>题解</h3>
      <p>这道题和46.全排列相似，不同点在于数组中是有重复的元素的，所以我们要对数组的相同元素进行一个去重的一个操作，将收获结果中没有层次上的重复</p>
<p>思路：我们用两个set来对数据的一个去重，第一个去重层次方面上的去重，当数组不能相同元素获取，第二个是深度上面的去重</p>
<p><strong>实现</strong>：</p>
<ul>
<li>定义全局变量<ul>
<li>result：用于收获结果集</li>
<li>path：用于单层路径上的获取</li>
<li>hashset：用于深度上的去重，用索引i作为深度上的重复判断</li>
</ul>
</li>
<li>将nums进行排序，相同值的元素可以排在一起，主要用于对层次方面的处理</li>
<li>递归函数的参数和返回值<ul>
<li>返回值void：所有的结果都在result结果集中，所以没有额外的返回值</li>
<li>参数nums：用于需要获取全排列的参数</li>
</ul>
</li>
<li>递归函数的结束条件<ul>
<li>当path.size()&#x3D;&#x3D;nums.length，也就是获取了一个全排列则需要添加结果到结果集中，然后结束</li>
</ul>
</li>
<li>递归函数的单层逻辑<ul>
<li>定义一个变量Hashset<Integer> set：用于层次方面上的去重</li>
<li>循环，获取全排列<ul>
<li>每次排列从0开始</li>
<li>判断set中是否有nums[i]，如果包含说明这是经过回溯之后的，然后出现了相同大小元素(层次相同)</li>
<li>判断hashset中是否包含i，如果包含说明在前面已经用过i索引下标的元素，所以不能重复获取，于是要continue</li>
<li>path添加nums[i],set添加num[i],hashset添加i</li>
<li>递归</li>
<li>回溯，回溯hashset和path</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; result;</span><br><span class="line">    List&lt;Integer&gt; path;</span><br><span class="line">   	<span class="comment">//用于深度上面的去重</span></span><br><span class="line">    HashSet&lt;Integer&gt; hashSet;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">permuteUnique</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        path=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        hashSet=<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        backtracking(nums);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span>[] nums)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(path.size()==nums.length)&#123;</span><br><span class="line">            result.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>(path));</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="comment">//set数组是用于层次上的去重</span></span><br><span class="line">        HashSet&lt;Integer&gt; set=<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;nums.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(set.contains(nums[i])) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(hashSet.contains(i)) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            path.add(nums[i]);</span><br><span class="line">            set.add(nums[i]);</span><br><span class="line">            hashSet.add(i);</span><br><span class="line">            backtracking(nums);</span><br><span class="line">            <span class="comment">//hashset回溯</span></span><br><span class="line">            hashSet.remove(i);</span><br><span class="line">            path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h1 id="棋盘问题"   >
          <a href="#棋盘问题" class="heading-link"><i class="fas fa-link"></i></a><a href="#棋盘问题" class="headerlink" title="棋盘问题"></a>棋盘问题</h1>
      
        <h2 id="51-N皇后"   >
          <a href="#51-N皇后" class="heading-link"><i class="fas fa-link"></i></a><a href="#51-N皇后" class="headerlink" title="51.N皇后"></a>51.N皇后</h2>
      <p>按照国际象棋的规则，皇后可以攻击与之处在同一行或同一列或同一斜线上的棋子。</p>
<p><strong>n 皇后问题</strong> 研究的是如何将 <code>n</code> 个皇后放置在 <code>n×n</code> 的棋盘上，并且使皇后彼此之间不能相互攻击。</p>
<p>给你一个整数 <code>n</code> ，返回所有不同的 <strong>n 皇后问题</strong> 的解决方案。</p>
<p>每一种解法包含一个不同的 <strong>n 皇后问题</strong> 的棋子放置方案，该方案中 <code>&#39;Q&#39;</code> 和 <code>&#39;.&#39;</code> 分别代表了皇后和空位。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/n-queens/description/" >Leetcode.51题(hard)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-11"   >
          <a href="#第一次做-11" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-11" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;09&#x2F;24</p>

        <h4 id="第一次代码-11"   >
          <a href="#第一次代码-11" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-11" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;String&gt;&gt; result;</span><br><span class="line">    List&lt;String&gt; path;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;String&gt;&gt; <span class="title function_">solveNQueens</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">       result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">       path=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">       backtracking(<span class="number">0</span>,n);        </span><br><span class="line">       <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span> start,<span class="type">int</span> n)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(start==n)&#123;</span><br><span class="line">            result.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>(path));</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="comment">//初始化数组</span></span><br><span class="line">        <span class="type">char</span>[] arr=<span class="keyword">new</span> <span class="title class_">char</span>[n];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;arr.length;i++)&#123;</span><br><span class="line">            arr[i]=<span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line">        <span class="comment">//循环获取路径</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">            <span class="comment">//如果path中无字符串</span></span><br><span class="line">            <span class="keyword">if</span>(path.size()==<span class="number">0</span>)&#123;</span><br><span class="line">                arr[i]=<span class="string">&#x27;Q&#x27;</span>;</span><br><span class="line">                <span class="comment">//拼接char[] 数组</span></span><br><span class="line">                StringBuilder sb=<span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">char</span> c:arr)&#123;</span><br><span class="line">                    sb.append(c);</span><br><span class="line">                &#125;</span><br><span class="line">                path.add(sb.toString());</span><br><span class="line">                <span class="comment">//递归搜索</span></span><br><span class="line">                backtracking(start+<span class="number">1</span>,n);</span><br><span class="line">                path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">                arr[i]=<span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//如果path中有字符，判断i是否符合要求</span></span><br><span class="line">                <span class="comment">//默认flag为false</span></span><br><span class="line">                <span class="type">boolean</span> flag=<span class="literal">false</span>;</span><br><span class="line">                <span class="comment">//从path中获取每一个字符串</span></span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;path.size();j++)&#123;</span><br><span class="line">                    <span class="comment">//获取gap也即i的规矩，当Q的同一列和斜角都不符合要求</span></span><br><span class="line">                    <span class="type">int</span> gap=start-j;</span><br><span class="line">                    <span class="type">char</span>[] pre=path.get(j).toCharArray();</span><br><span class="line">                    <span class="comment">//获取Q的字符下标</span></span><br><span class="line">                    <span class="type">int</span> k=<span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">for</span>(;k&lt;pre.length;k++)&#123;</span><br><span class="line">                        <span class="keyword">if</span>(pre[k]==<span class="string">&#x27;Q&#x27;</span>) <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//如果i==k+gap || i==k ||i==k-gap  也即同一列，右斜线，左斜线</span></span><br><span class="line">                    <span class="keyword">if</span>(i==k+gap||i==k||i==k-gap)&#123;</span><br><span class="line">                        flag=<span class="literal">true</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    </span><br><span class="line">                &#125;</span><br><span class="line">                	<span class="comment">//如果flag==true，也即不符合要求</span></span><br><span class="line">                    <span class="keyword">if</span>(flag) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">                	<span class="comment">//符合要求添加到path中</span></span><br><span class="line">                    arr[i]=<span class="string">&#x27;Q&#x27;</span>;</span><br><span class="line">                    StringBuilder sb=<span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">                    <span class="keyword">for</span>(<span class="type">char</span> c:arr)&#123;</span><br><span class="line">                    sb.append(c);</span><br><span class="line">                    &#125;</span><br><span class="line">                    path.add(sb.toString());</span><br><span class="line">                    backtracking(start+<span class="number">1</span>,n);</span><br><span class="line">                    path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">                    arr[i]=<span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h3 id="题解-12"   >
          <a href="#题解-12" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-12" class="headerlink" title="题解"></a>题解</h3>
      <p>思路：我们每一层都用Char[]数组来表示，然后检验皇后合法性的时候用char[]来判断，这道题重要的是在<strong>检验皇后合法性</strong></p>
<p><strong>实现</strong></p>
<ul>
<li><p>定义全局变量</p>
<ul>
<li>result：用于收获结果集</li>
<li>path：用于单次棋盘搜索结果</li>
</ul>
</li>
<li><p>递归函数的返回值和参数</p>
<ul>
<li>返回值void：所有结果都在result中</li>
<li>参数row：判断现在要在path操作第几行，也即棋盘的第几行</li>
<li>参数n：判断总的棋盘是n*n的</li>
</ul>
</li>
<li><p>递归函数的结束条件</p>
<ul>
<li>当row&#x3D;&#x3D;n，也即操作n行都操作过，说明收获结果集</li>
</ul>
</li>
<li><p>递归函数的单层逻辑</p>
<ul>
<li>创建char[] line，用于记录每一行的元素，初始化都为’.’</li>
<li>循环，每次从0开始，遍历n次<ul>
<li>检验当前位置i是否符合n皇后的题意：<strong>不能在同一行、不能在同一列、不能在同一斜线</strong></li>
<li>如果符合题意则递归搜索下一个结果集</li>
</ul>
</li>
<li>回溯</li>
</ul>
</li>
<li><p>检验位置i是否符合N皇后要求的函数valid：</p>
<ul>
<li>当path为空则返回true：也即第一行都符合要求</li>
<li>当path不为空：<ul>
<li>循环i遍历path，获取path中已经符合要求的行</li>
<li>获取当前层与path中行的距离：<strong>int gap&#x3D;row-i</strong>；</li>
<li>找到path.get(i)中的n皇后位置：int k；</li>
<li>判断k与当前格子数index以及行数的距离gap之间的关系，只要存在以下任意关系都返回false<ul>
<li><strong>当index&#x3D;&#x3D;k，也即在已经存在的某一行的皇后同一列</strong></li>
<li><strong>当index&#x3D;&#x3D;k+gap，也即在已经存在的某一行的右下斜线</strong></li>
<li><strong>当index&#x3D;&#x3D;k-gap，也即在已经存在的某一行的左下斜线</strong></li>
</ul>
</li>
<li>如果循环到最后，则返回true，说明当前位置index符合要求</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;String&gt;&gt; result;</span><br><span class="line">    List&lt;String&gt; path;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;String&gt;&gt; <span class="title function_">solveNQueens</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        path=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        backtracking(<span class="number">0</span>,n);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span>  <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span> row,<span class="type">int</span> n)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(row==n)&#123;</span><br><span class="line">            result.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>(path));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">char</span>[] line=<span class="keyword">new</span> <span class="title class_">char</span>[n];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;line.length;i++) line[i]=<span class="string">&#x27;.&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(valid(i,n,row))&#123;</span><br><span class="line">                StringBuilder sb=<span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">                line[i]=<span class="string">&#x27;Q&#x27;</span>;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">char</span> c: line) sb.append(c);</span><br><span class="line">                path.add(sb.toString());</span><br><span class="line">                backtracking(row+<span class="number">1</span>,n);</span><br><span class="line">                path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">                line[i]=<span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">valid</span><span class="params">(<span class="type">int</span> index,<span class="type">int</span> n,<span class="type">int</span> row)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(path.size()==<span class="number">0</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;path.size();i++)&#123;</span><br><span class="line">            <span class="comment">//gap用于标记当前层到搜索path层的数</span></span><br><span class="line">            <span class="type">int</span> gap=row-i;</span><br><span class="line">            <span class="type">char</span>[] pathStr=path.get(i).toCharArray();</span><br><span class="line">           	<span class="comment">//找到这层皇后位置</span></span><br><span class="line">            <span class="type">int</span> k=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(;k&lt;pathStr.length;k++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(pathStr[k]==<span class="string">&#x27;Q&#x27;</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//检验当前位置放皇后是否符合标准</span></span><br><span class="line">            <span class="keyword">if</span>(k==index || k==index-gap || k==index+gap) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h3 id="图解-5"   >
          <a href="#图解-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#图解-5" class="headerlink" title="图解"></a>图解</h3>
      <p>检验当前位置index，与k，与row的关系图解</p>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="https://images-kkblog.oss-cn-hangzhou.aliyuncs.com/image-20230925093903694.png"  alt="检验当前位置index，与k，与row的关系图解">
      </p>

        <h2 id="37-解数独"   >
          <a href="#37-解数独" class="heading-link"><i class="fas fa-link"></i></a><a href="#37-解数独" class="headerlink" title="37.解数独"></a>37.解数独</h2>
      <p>编写一个程序，通过填充空格来解决数独问题。</p>
<p>数独的解法需 <strong>遵循如下规则</strong>：</p>
<ol>
<li>数字 <code>1-9</code> 在每一行只能出现一次。</li>
<li>数字 <code>1-9</code> 在每一列只能出现一次。</li>
<li>数字 <code>1-9</code> 在每一个以粗实线分隔的 <code>3x3</code> 宫内只能出现一次。（请参考示例图）</li>
</ol>
<p>数独部分空格内已填入了数字，空白格用 <code>&#39;.&#39;</code> 表示。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/sudoku-solver/" >Leetcode.37题(hard)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-12"   >
          <a href="#第一次做-12" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-12" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;09&#x2F;26</p>

        <h4 id="第一次代码-12"   >
          <a href="#第一次代码-12" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-12" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;HashSet&lt;Character&gt;&gt; xList;</span><br><span class="line">    List&lt;HashSet&lt;Character&gt;&gt; yList;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">solveSudoku</span><span class="params">(<span class="type">char</span>[][] board)</span> &#123;</span><br><span class="line">        xList=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        yList=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> x=<span class="number">0</span>;x&lt;board.length;x++)&#123;</span><br><span class="line">            <span class="type">char</span>[] arr=board[x];</span><br><span class="line">            HashSet&lt;Character&gt; xSet=<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> y=<span class="number">0</span>;y&lt;arr.length;y++)&#123;</span><br><span class="line">                xSet.add(arr[y]);</span><br><span class="line">            &#125;</span><br><span class="line">            xList.add(xSet);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;board.length;i++)&#123;</span><br><span class="line">            HashSet&lt;Character&gt; ySet=<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;board.length;j++)&#123;</span><br><span class="line">                ySet.add(board[i][j]);</span><br><span class="line">            &#125;</span><br><span class="line">            yList.add(ySet);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        backtracking(board,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">char</span>[][] board,<span class="type">int</span> row)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(row==board.length)&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;board.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(valid(i,row))&#123;</span><br><span class="line">                board[row][i]=(<span class="type">char</span>) (i-<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">                xList.get(row).add((<span class="type">char</span>)(i-<span class="string">&#x27;0&#x27;</span>));</span><br><span class="line">                yList.get(i).add((<span class="type">char</span>)(i-<span class="string">&#x27;0&#x27;</span>));</span><br><span class="line">                backtracking(board,row+<span class="number">1</span>);</span><br><span class="line">                xList.get(row).remove((<span class="type">char</span>)(i-<span class="string">&#x27;0&#x27;</span>));</span><br><span class="line">                yList.get(i).remove((<span class="type">char</span>)(i-<span class="string">&#x27;0&#x27;</span>));</span><br><span class="line">                board[row][i]=<span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">valid</span><span class="params">(<span class="type">int</span> i,<span class="type">int</span> row)</span>&#123;</span><br><span class="line">        <span class="type">char</span> num=(<span class="type">char</span>) (i-<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span>(xList.get(row).contains(num)||yList.get(i).contains(num)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span>(row&gt;=<span class="number">0</span> &amp;&amp; row&lt;=<span class="number">2</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i&gt;=<span class="number">0</span> &amp;&amp; i&lt;=<span class="number">2</span>)&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;=<span class="number">2</span>;j++)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(j==i) <span class="keyword">continue</span>;</span><br><span class="line">                    <span class="keyword">if</span>(xList.get(j).contains(num)||yList.get(j).contains(num)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(i&gt;=<span class="number">3</span> &amp;&amp; i&lt;=<span class="number">5</span>)&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">3</span>;j&lt;=<span class="number">5</span>;j++)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(j==i) <span class="keyword">continue</span>;</span><br><span class="line">                    <span class="keyword">if</span>(xList.get(j).contains(num)||yList.get(j).contains(num)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">6</span>;j&lt;=<span class="number">8</span>;j++)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(j==i) <span class="keyword">continue</span>;</span><br><span class="line">                    <span class="keyword">if</span>(xList.get(j).contains(num)||yList.get(j).contains(num)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(row&gt;=<span class="number">3</span> &amp;&amp; row&lt;=<span class="number">5</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i&gt;=<span class="number">0</span> &amp;&amp; i&lt;=<span class="number">2</span>)&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;=<span class="number">2</span>;j++)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(j==i) <span class="keyword">continue</span>;</span><br><span class="line">                    <span class="keyword">if</span>(xList.get(j).contains(num)||yList.get(j).contains(num)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(i&gt;=<span class="number">3</span> &amp;&amp; i&lt;=<span class="number">5</span>)&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">3</span>;j&lt;=<span class="number">5</span>;j++)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(j==i) <span class="keyword">continue</span>;</span><br><span class="line">                    <span class="keyword">if</span>(xList.get(j).contains(num)||yList.get(j).contains(num)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">6</span>;j&lt;=<span class="number">8</span>;j++)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(j==i) <span class="keyword">continue</span>;</span><br><span class="line">                    <span class="keyword">if</span>(xList.get(j).contains(num)||yList.get(j).contains(num)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(i&gt;=<span class="number">0</span> &amp;&amp; i&lt;=<span class="number">2</span>)&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;=<span class="number">2</span>;j++)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(j==i) <span class="keyword">continue</span>;</span><br><span class="line">                    <span class="keyword">if</span>(xList.get(j).contains(num)||yList.get(j).contains(num)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(i&gt;=<span class="number">3</span> &amp;&amp; i&lt;=<span class="number">5</span>)&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">3</span>;j&lt;=<span class="number">5</span>;j++)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(j==i) <span class="keyword">continue</span>;</span><br><span class="line">                    <span class="keyword">if</span>(xList.get(j).contains(num)||yList.get(j).contains(num)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">6</span>;j&lt;=<span class="number">8</span>;j++)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(j==i) <span class="keyword">continue</span>;</span><br><span class="line">                    <span class="keyword">if</span>(xList.get(j).contains(num)||yList.get(j).contains(num)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-16"   >
          <a href="#提交失败-16" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-16" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:</p>
<p>输入board &#x3D;</p>
<p>[[“5”,”3”,”.”,”.”,”7”,”.”,”.”,”.”,”.”],[“6”,”.”,”.”,”1”,”9”,”5”,”.”,”.”,”.”],[“.”,”9”,”8”,”.”,”.”,”.”,”.”,”6”,”.”],[“8”,”.”,”.”,”.”,”6”,”.”,”.”,”.”,”3”],[“4”,”.”,”.”,”8”,”.”,”3”,”.”,”.”,”1”],[“7”,”.”,”.”,”.”,”2”,”.”,”.”,”.”,”6”],[“.”,”6”,”.”,”.”,”.”,”.”,”2”,”8”,”.”],[“.”,”.”,”.”,”4”,”1”,”9”,”.”,”.”,”5”],[“.”,”.”,”.”,”.”,”8”,”.”,”.”,”7”,”9”]]</p>
<p>输出</p>
<p>[[“.”,”.”,”.”,”.”,”.”,”.”,”.”,”.”,”.”],[“.”,”.”,”.”,”.”,”.”,”.”,”.”,”.”,”.”],[“.”,”.”,”.”,”.”,”.”,”.”,”.”,”.”,”.”],[“.”,”.”,”.”,”.”,”.”,”.”,”.”,”.”,”.”],[“.”,”.”,”.”,”.”,”.”,”.”,”.”,”.”,”.”],[“.”,”.”,”.”,”.”,”.”,”.”,”.”,”.”,”.”],[“.”,”.”,”.”,”.”,”.”,”.”,”.”,”.”,”.”],[“.”,”.”,”.”,”.”,”.”,”.”,”.”,”.”,”.”],[“.”,”.”,”.”,”.”,”.”,”.”,”.”,”.”,”.”]]</p>
<p>预期输出</p>
<p>[[“5”,”3”,”4”,”6”,”7”,”8”,”9”,”1”,”2”],[“6”,”7”,”2”,”1”,”9”,”5”,”3”,”4”,”8”],[“1”,”9”,”8”,”3”,”4”,”2”,”5”,”6”,”7”],[“8”,”5”,”9”,”7”,”6”,”1”,”4”,”2”,”3”],[“4”,”2”,”6”,”8”,”5”,”3”,”7”,”9”,”1”],[“7”,”1”,”3”,”9”,”2”,”4”,”8”,”5”,”6”],[“9”,”6”,”1”,”5”,”3”,”7”,”2”,”8”,”4”],[“2”,”8”,”7”,”4”,”1”,”9”,”6”,”3”,”5”],[“3”,”4”,”5”,”2”,”8”,”6”,”1”,”7”,”9”]]</p>
<p>没做出来</p>

        <h3 id="题解-13"   >
          <a href="#题解-13" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-13" class="headerlink" title="题解"></a>题解</h3>
      <p>思路：这道题和N皇后的问题的题解的过程，这个不仅仅只是填一个数而是要将棋盘填满，所以这个循环应该是两个循环嵌套，这道题还有对棋盘数独落子的校验，满足行不同数字，列不同数字，同时九宫格内也不能有重复数字</p>
<p><strong>实现</strong></p>
<ul>
<li>递归函数的参数和返回值<ul>
<li>参数board：棋盘，需要填满的数独棋盘</li>
<li>返回值boolean：如果找到一个填满的棋盘就可以返回，而不需要继续搜索</li>
</ul>
</li>
<li>递归函数的结束条件<ul>
<li>当棋盘被填满也即两层for循环结束之后没有返回false，说明找到一个被填满的棋盘</li>
</ul>
</li>
<li>递归函数的单层逻辑<ul>
<li>第一层for循环，遍历行，从第一行到最后一行（0~board.length)<ul>
<li>第二层for循环，遍历列，从第一列到最后一列(0~board.length)<ul>
<li>判断当前（i，j）是否是空字符串，也即如果有数字则continue<ul>
<li>第三层for循环，遍历1-9尝试填进当前(i，j)位置<ul>
<li>如果当前位置符合要求，则填进数字</li>
<li>递归搜索下一个数字</li>
<li>回溯</li>
</ul>
</li>
<li>如果1-9都失败了，则返回false</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>如果两层循环结束还没有返回返回false，说明已经落满数字返回true</li>
</ul>
</li>
<li>校验数字是否符合要求<ul>
<li>需要行中不能有重复数字</li>
<li>需要列中不能有重复数字</li>
<li>需要在九宫格中不能有重复数字<ul>
<li>解决行中重复数字<ul>
<li>遍历当前行的0-9列，如果board(row)(j)&#x3D;&#x3D;val，返回false</li>
</ul>
</li>
<li>解决列中不能有重复数字<ul>
<li>遍历当前列的0-9行，如果board(i)(col)&#x3D;&#x3D;val，返回false</li>
</ul>
</li>
<li>解决九宫格中重复数字<ul>
<li>获取当前在九宫格的启示位置<ul>
<li>int startX&#x3D; (row&#x2F;3) *3;</li>
<li>int startY&#x3D;(col&#x2F;3) *3;</li>
<li>所以（startX，startY）就是当前九宫格第一个元素位置</li>
<li>第一层for循环从startX到startX+3<ul>
<li>第二层for循环从startY到startY+3<ul>
<li>if(board(m,n)&#x3D;&#x3D;val) return false，说明九宫格内有相同的数字</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">solveSudoku</span><span class="params">(<span class="type">char</span>[][] board)</span> &#123;</span><br><span class="line">        backtracking(board);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">char</span>[][] board)</span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> row=<span class="number">0</span>;row&lt;board.length;row++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> col=<span class="number">0</span>;col&lt;board.length;col++)&#123;</span><br><span class="line">                <span class="comment">//如果是空格字符</span></span><br><span class="line">                <span class="keyword">if</span>(board[row][col]==<span class="string">&#x27;.&#x27;</span>)&#123;</span><br><span class="line">                    <span class="keyword">for</span>(<span class="type">char</span> j=<span class="string">&#x27;1&#x27;</span>;j&lt;=<span class="string">&#x27;9&#x27;</span>;j++)&#123;</span><br><span class="line">                        <span class="keyword">if</span>(valid(board,row,col,j))&#123;</span><br><span class="line">                            board[row][col]=j;</span><br><span class="line">                            <span class="comment">//如果找到第一个子结果则返回</span></span><br><span class="line">                            <span class="keyword">if</span>(backtracking(board)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                            board[row][col]=<span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//说明1-9都不合适返回false</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//说明循环结束，把棋盘都填满</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">valid</span><span class="params">(<span class="type">char</span>[][] board,<span class="type">int</span> row, <span class="type">int</span> col ,<span class="type">char</span> j)</span>&#123;</span><br><span class="line">        <span class="comment">//同一行</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;board.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(j==board[row][i]) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//同一列</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;board.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(j==board[i][col]) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="comment">//求得九宫格</span></span><br><span class="line">        <span class="type">int</span> startX=(row/<span class="number">3</span>)*<span class="number">3</span>;</span><br><span class="line">        <span class="type">int</span> startY=(col/<span class="number">3</span>)*<span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=startX;i&lt;startX+<span class="number">3</span>;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> k=startY;k&lt;startY+<span class="number">3</span>;k++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(j==board[i][k]) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h1 id="其他"   >
          <a href="#其他" class="heading-link"><i class="fas fa-link"></i></a><a href="#其他" class="headerlink" title="其他"></a>其他</h1>
      
        <h2 id="491-递增子序列"   >
          <a href="#491-递增子序列" class="heading-link"><i class="fas fa-link"></i></a><a href="#491-递增子序列" class="headerlink" title="491.递增子序列"></a>491.递增子序列</h2>
      <p>给你一个整数数组 <code>nums</code> ，找出并返回所有该数组中不同的递增子序列，递增子序列中 <strong>至少有两个元素</strong> 。你可以按 <strong>任意顺序</strong> 返回答案。</p>
<p>数组中可能含有重复元素，如出现两个整数相等，也可以视作递增序列的一种特殊情况。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/non-decreasing-subsequences/" >Leetcode.491(题)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-13"   >
          <a href="#第一次做-13" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-13" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;09&#x2F;18</p>

        <h4 id="第一次代码-13"   >
          <a href="#第一次代码-13" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-13" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="type">int</span> MIN;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; result;</span><br><span class="line">    List&lt;Integer&gt; path;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">findSubsequences</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        MIN=Integer.MAX_VALUE+<span class="number">1</span>;</span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        path=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        backtracking(nums,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span>[] nums,<span class="type">int</span> start)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(path.size()&gt;=<span class="number">2</span>)&#123;</span><br><span class="line">            result.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>(path));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(start&gt;=nums.length) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=start;i&lt;nums.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i==start &amp;&amp; nums[i]&gt;=MIN)&#123;</span><br><span class="line">                MIN=nums[i];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(nums[i]&lt;MIN)<span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                path.add(nums[i]);</span><br><span class="line">                backtracking(nums,i+<span class="number">1</span>);</span><br><span class="line">                path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-17"   >
          <a href="#提交失败-17" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-17" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE: nums&#x3D;[4,6,7,7] 输出[[4,6],[4,6,7],[4,6,7,7],[4,6,7],[4,7],[4,7,7],[4,7],[7,7]]，预期输出[[4,6],[4,6,7],[4,6,7,7],[4,7],[4,7,7],[6,7],[6,7,7],[7,7]]</p>

        <h4 id="第二次代码-9"   >
          <a href="#第二次代码-9" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码-9" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="type">int</span>[] used;</span><br><span class="line">    <span class="type">int</span> MIN;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; result;</span><br><span class="line">    List&lt;Integer&gt; path;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">findSubsequences</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        MIN=Integer.MAX_VALUE+<span class="number">1</span>;</span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        path=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        used=<span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">201</span>];</span><br><span class="line">        backtracking(nums,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span>[] nums,<span class="type">int</span> start)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(path.size()&gt;=<span class="number">2</span>)&#123;</span><br><span class="line">            result.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>(path));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(start&gt;=nums.length) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=start;i&lt;nums.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i==start &amp;&amp; nums[i]&gt;=MIN)&#123;</span><br><span class="line">                MIN=nums[i];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(nums[i]&lt;MIN)<span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(i&gt;start&amp;&amp;used[<span class="number">100</span>+nums[i]]==<span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line">                path.add(nums[i]);</span><br><span class="line">                used[<span class="number">100</span>+nums[i]]=<span class="number">1</span>;</span><br><span class="line">                backtracking(nums,i+<span class="number">1</span>);</span><br><span class="line">                path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">                MIN=nums[i];</span><br><span class="line">                used[<span class="number">100</span>+nums[i]]=<span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-18"   >
          <a href="#提交失败-18" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-18" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE: nums&#x3D;[4,6,7,7] 输出[[4,6],[4,6,7],[4,6,7,7] 预期输出[[4,6],[4,6,7],[4,6,7,7],[4,7],[4,7,7],[6,7],[6,7,7],[7,7]]</p>

        <h4 id="第三次代码-1"   >
          <a href="#第三次代码-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#第三次代码-1" class="headerlink" title="第三次代码"></a>第三次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; result;</span><br><span class="line">    List&lt;Integer&gt; path;</span><br><span class="line">    HashMap&lt;Integer,Integer&gt; used;</span><br><span class="line">    <span class="type">int</span> min=Integer.MAX_VALUE+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">findSubsequences</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        path=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        used=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        backtracking(nums,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span>[] nums,<span class="type">int</span> start)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(path.size()&gt;=<span class="number">2</span>)&#123;</span><br><span class="line">            result.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>(path));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=start;i&lt;nums.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[i]&gt;=min)&#123;</span><br><span class="line">                min=nums[i];</span><br><span class="line">                <span class="keyword">if</span>(i&gt;start &amp;&amp; used.containsKey(nums[i]) &amp;&amp;used.get(nums[i])==<span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                path.add(nums[i]);</span><br><span class="line">                used.put(nums[i],used.getOrDefault(nums[i],<span class="number">0</span>)+<span class="number">1</span>);</span><br><span class="line">                backtracking(nums,i+<span class="number">1</span>);</span><br><span class="line">                path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">                used.put(nums[i],used.getOrDefault(nums[i],<span class="number">0</span>)-<span class="number">1</span>);</span><br><span class="line">                min=nums[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-19"   >
          <a href="#提交失败-19" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-19" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE: nums&#x3D;[4,6,7,7] 输出[[4,6],[4,6,7],[4,6,7,7] 预期输出[[4,6],[4,6,7],[4,6,7,7],[4,7],[4,7,7],[6,7],[6,7,7],[7,7]]</p>
<p>这道题在去重没能写出来</p>

        <h3 id="题解-14"   >
          <a href="#题解-14" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-14" class="headerlink" title="题解"></a>题解</h3>
      <p>思想，这道题和组合总和II和子集II有相似之处又有不同之处</p>
<ul>
<li>相似：这道题同组合总和II一样，需要对数据去重，也是层次上的去重而非深度上的去重，同子集II一样对收获结果是在满足条件的结点，而不是全在叶子结点上收获，同时函数的结束条件也在循环判断中的结束条件一般</li>
<li>不同：这道题不能对数组进行排列，不然会对受过结果集造成影响</li>
</ul>
<p><strong>实现</strong></p>
<ul>
<li><p>定义全局变量</p>
<ul>
<li>result:用于收获结果集集合</li>
<li>path：用于记录单个结果路径</li>
</ul>
</li>
<li><p>递归函数的返回值和参数</p>
<ul>
<li>返回值void：所有的结果都保存在result集合中，所以不需要返回值</li>
<li>参数nums：用于求得子序列的数组</li>
<li>参数start，表示此时操作的位置索引下标</li>
</ul>
</li>
<li><p>递归函数的结束条件</p>
<p>当start&gt;&#x3D;nums.length,也即操作到数组的最后位置(最后一个元素之后)，也即完成了本次深度上的搜索</p>
<p><del>(可以不用写结束条件，因为单层递归的时候的for循环结束条件也就是递归函数的结束条件)</del></p>
</li>
<li><p>函数的单层逻辑</p>
<ul>
<li><p>声明一个set集合，用于表示已经遍历过的元素，对相同数据的<strong>去重</strong>需要</p>
</li>
<li><p>对数据进行判断是否能添加到path路径中</p>
<ul>
<li><p>当path.size()!&#x3D;0 &amp;&amp; nums[i]小于path集合中最后一个元素(path集合是一个非递减集合)</p>
<p>也即当现在元素小于路径中最后一个元素则continue跳过</p>
</li>
<li><p>当set.contains(nums[i])&#x3D;&#x3D;true，也即这个元素已经收获过(层次上的重复)，则continue跳过</p>
<blockquote>
<p>因为Set是每层中定义的一个去重集合，深度搜索的时候不会对重复元素判断，而只有层次相同的情况下并且已经收获到结果集中的元素才需要跳过</p>
</blockquote>
</li>
</ul>
</li>
<li><p>添加到path路径和set去重集合中</p>
</li>
<li><p>递归遍历搜索下一个路径</p>
</li>
<li><p>回溯(只需要回溯path集合不用回溯set去重集合【set集合是每层new出来的，不需要对其去重】)</p>
</li>
</ul>
</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; result;</span><br><span class="line">    List&lt;Integer&gt; path;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">findSubsequences</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        path=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        backtracking(nums,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span>[] nums,<span class="type">int</span> start)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(path.size()&gt;=<span class="number">2</span>) &#123;</span><br><span class="line">            result.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>(path));</span><br><span class="line">        &#125;</span><br><span class="line">        HashSet&lt;Integer&gt; set=<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=start;i&lt;nums.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(path.size()!=<span class="number">0</span>&amp;&amp; nums[i]&lt;path.get(path.size()-<span class="number">1</span>) || set.contains(nums[i])) <span class="keyword">continue</span>;</span><br><span class="line">            path.add(nums[i]);</span><br><span class="line">            set.add(nums[i]);</span><br><span class="line">            backtracking(nums,i+<span class="number">1</span>);</span><br><span class="line">            path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h3 id="图解-6"   >
          <a href="#图解-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#图解-6" class="headerlink" title="图解"></a>图解</h3>
      <p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="https://images-kkblog.oss-cn-hangzhou.aliyuncs.com/image-20230918174610627.png"  alt="递增子序列">
      </p>

        <h2 id="332-重新安排行程"   >
          <a href="#332-重新安排行程" class="heading-link"><i class="fas fa-link"></i></a><a href="#332-重新安排行程" class="headerlink" title="332.重新安排行程"></a>332.重新安排行程</h2>
      <p>给你一份航线列表 <code>tickets</code> ，其中 <code>tickets[i] = [fromi, toi]</code> 表示飞机出发和降落的机场地点。请你对该行程进行重新规划排序。</p>
<p>所有这些机票都属于一个从 <code>JFK</code>（肯尼迪国际机场）出发的先生，所以该行程必须从 <code>JFK</code> 开始。如果存在多种有效的行程，请你按字典排序返回最小的行程组合。</p>
<ul>
<li>例如，行程 <code>[&quot;JFK&quot;, &quot;LGA&quot;]</code> 与 <code>[&quot;JFK&quot;, &quot;LGB&quot;]</code> 相比就更小，排序更靠前。</li>
</ul>
<p>假定所有机票至少存在一种合理的行程。且所有的机票 必须都用一次 且 只能用一次。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/reconstruct-itinerary/" >Leetcode.332题(hard)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-14"   >
          <a href="#第一次做-14" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-14" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;09&#x2F;22</p>

        <h4 id="第一次代码-14"   >
          <a href="#第一次代码-14" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-14" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;String&gt; result;</span><br><span class="line">    List&lt;String&gt; path;</span><br><span class="line">    HashSet&lt;List&lt;String&gt;&gt; used;</span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">findItinerary</span><span class="params">(List&lt;List&lt;String&gt;&gt; tickets)</span> &#123;</span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        used=<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        path=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        backtracking(tickets);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(List&lt;List&lt;String&gt;&gt; tickets)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(used.size()==tickets.size())&#123;</span><br><span class="line">            result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>(path);</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;tickets.size();i++)&#123;</span><br><span class="line">            List&lt;String&gt; ticket=tickets.get(i);</span><br><span class="line">            <span class="keyword">if</span>(used.contains(ticket)) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span>(path.size()==<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(!ticket.get(<span class="number">0</span>).equals(<span class="string">&quot;JFK&quot;</span>)) <span class="keyword">continue</span>;</span><br><span class="line">                path.add(ticket.get(<span class="number">0</span>));</span><br><span class="line">                path.add(ticket.get(<span class="number">1</span>));</span><br><span class="line">                used.add(ticket);</span><br><span class="line">                backtracking(tickets);</span><br><span class="line">                path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">                path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">                used.remove(ticket);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(!ticket.get(<span class="number">0</span>).equals(path.get(path.size()-<span class="number">1</span>)))</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">                path.add(ticket.get(<span class="number">1</span>));</span><br><span class="line">                used.add(ticket);</span><br><span class="line">                backtracking(tickets);</span><br><span class="line">                path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">                used.remove(ticket);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交错误-1"   >
          <a href="#提交错误-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交错误-1" class="headerlink" title="提交错误"></a>提交错误</h5>
      <p>CASE:tickets &#x3D;[[“JFK”,”SFO”],[“JFK”,”ATL”],[“SFO”,”ATL”],[“ATL”,”JFK”],[“ATL”,”SFO”]]，输出[“JFK”,”ATL”,”SFO”,”ATL”,”JFK”,”SFO”]，预期输出[“JFK”,”ATL”,”JFK”,”SFO”,”ATL”,”SFO”]</p>
<p>这并不是字典拍戏的最短行程</p>

        <h4 id="第二次代码-10"   >
          <a href="#第二次代码-10" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码-10" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;String&gt; result;</span><br><span class="line">    List&lt;String&gt; path;</span><br><span class="line">    HashSet&lt;List&lt;String&gt;&gt; used;</span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">findItinerary</span><span class="params">(List&lt;List&lt;String&gt;&gt; tickets)</span> &#123;</span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        used=<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        path=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        backtracking(tickets);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(List&lt;List&lt;String&gt;&gt; tickets)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(used.size()==tickets.size())&#123;</span><br><span class="line">            <span class="keyword">if</span>(result.size()==<span class="number">0</span>)&#123;</span><br><span class="line">            result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>(path);</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (used.size() == tickets.size()) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;path.size();i++)&#123;</span><br><span class="line">                String oldStr=result.get(i);</span><br><span class="line">                String newStr=path.get(i);</span><br><span class="line">                <span class="keyword">if</span>(oldStr.equals(newStr)) <span class="keyword">continue</span>;</span><br><span class="line">                <span class="type">int</span> j=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span>(;;)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(oldStr.length()-newStr.length()&lt;<span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span>(oldStr.length()-newStr.length()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                        result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>(path);</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        <span class="type">char</span> oldChar=oldStr.charAt(j);</span><br><span class="line">                        <span class="type">char</span> newChar=newStr.charAt(j);</span><br><span class="line">                        <span class="keyword">if</span>(oldChar-newChar&lt;<span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">                        <span class="keyword">else</span> <span class="keyword">if</span>(oldChar-newChar&gt;<span class="number">0</span>) &#123;</span><br><span class="line">                            result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(path);</span><br><span class="line">                            <span class="keyword">return</span>;</span><br><span class="line">                        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                            j++;</span><br><span class="line">                            <span class="keyword">continue</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;tickets.size();i++)&#123;</span><br><span class="line">            List&lt;String&gt; ticket=tickets.get(i);</span><br><span class="line">            <span class="keyword">if</span>(used.contains(ticket)) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span>(path.size()==<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(!ticket.get(<span class="number">0</span>).equals(<span class="string">&quot;JFK&quot;</span>)) <span class="keyword">continue</span>;</span><br><span class="line">                path.add(ticket.get(<span class="number">0</span>));</span><br><span class="line">                path.add(ticket.get(<span class="number">1</span>));</span><br><span class="line">                used.add(ticket);</span><br><span class="line">                backtracking(tickets);</span><br><span class="line">                path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">                path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">                used.remove(ticket);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(!ticket.get(<span class="number">0</span>).equals(path.get(path.size()-<span class="number">1</span>)))</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">                path.add(ticket.get(<span class="number">1</span>));</span><br><span class="line">                used.add(ticket);</span><br><span class="line">                backtracking(tickets);</span><br><span class="line">                path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">                used.remove(ticket);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-20"   >
          <a href="#提交失败-20" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-20" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:tickets&#x3D;[[“EZE”,”AXA”],[“TIA”,”ANU”],[“ANU”,”JFK”],[“JFK”,”ANU”],[“ANU”,”EZE”],[“TIA”,”ANU”],[“AXA”,”TIA”],[“TIA”,”JFK”],[“ANU”,”TIA”],[“JFK”,”TIA”]]，输出[]，预期输出[“JFK”,”ANU”,”EZE”,”AXA”,”TIA”,”ANU”,”JFK”,”TIA”,”ANU”,”TIA”,”JFK”]</p>

        <h4 id="第三次代码-2"   >
          <a href="#第三次代码-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#第三次代码-2" class="headerlink" title="第三次代码"></a>第三次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;String&gt; result;</span><br><span class="line">    List&lt;String&gt; path;</span><br><span class="line">    HashSet&lt;Integer&gt; hashTable;</span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">findItinerary</span><span class="params">(List&lt;List&lt;String&gt;&gt; tickets)</span> &#123;</span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        hashTable=<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        path=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        backtracking(tickets);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(List&lt;List&lt;String&gt;&gt; tickets)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(path.size()==tickets.size()+<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(result.size()==<span class="number">0</span>)&#123;</span><br><span class="line">            result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>(path);</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;path.size();i++)&#123;</span><br><span class="line">                String oldStr=result.get(i);</span><br><span class="line">                String newStr=path.get(i);</span><br><span class="line">                <span class="keyword">if</span>(oldStr.equals(newStr)) <span class="keyword">continue</span>;</span><br><span class="line">                <span class="type">int</span> j=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span>(;;)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(oldStr.length()-newStr.length()&lt;<span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span>(oldStr.length()-newStr.length()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                        result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>(path);</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        <span class="type">char</span> oldChar=oldStr.charAt(j);</span><br><span class="line">                        <span class="type">char</span> newChar=newStr.charAt(j);</span><br><span class="line">                        <span class="keyword">if</span>(oldChar-newChar&lt;<span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">                        <span class="keyword">else</span> <span class="keyword">if</span>(oldChar-newChar&gt;<span class="number">0</span>) &#123;</span><br><span class="line">                            result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(path);</span><br><span class="line">                            <span class="keyword">return</span>;</span><br><span class="line">                        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                            j++;</span><br><span class="line">                            <span class="keyword">continue</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        HashSet&lt;List&lt;String&gt;&gt; used= <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;tickets.size();i++)&#123;</span><br><span class="line">            List&lt;String&gt; ticket=tickets.get(i);</span><br><span class="line">            <span class="keyword">if</span>(hashTable.contains(i)) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span>(used.contains(ticket)) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span>(path.size()==<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(!ticket.get(<span class="number">0</span>).equals(<span class="string">&quot;JFK&quot;</span>)) <span class="keyword">continue</span>;</span><br><span class="line">                path.add(ticket.get(<span class="number">0</span>));</span><br><span class="line">                path.add(ticket.get(<span class="number">1</span>));</span><br><span class="line">                used.add(ticket);</span><br><span class="line">                hashTable.add(i);</span><br><span class="line">                backtracking(tickets);</span><br><span class="line">                path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">                path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">                hashTable.remove(i);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(!ticket.get(<span class="number">0</span>).equals(path.get(path.size()-<span class="number">1</span>)))</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">                path.add(ticket.get(<span class="number">1</span>));</span><br><span class="line">                used.add(ticket);</span><br><span class="line">                hashTable.add(i);</span><br><span class="line">                backtracking(tickets);</span><br><span class="line">                path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">                hashTable.remove(i);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-21"   >
          <a href="#提交失败-21" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-21" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>超出时间限制</p>
<p>要对数据进行剪枝</p>

        <h4 id="第四次代码-1"   >
          <a href="#第四次代码-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#第四次代码-1" class="headerlink" title="第四次代码"></a>第四次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;String&gt; result;</span><br><span class="line">    List&lt;String&gt; path;</span><br><span class="line">    HashSet&lt;Integer&gt; hashTable;</span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">findItinerary</span><span class="params">(List&lt;List&lt;String&gt;&gt; tickets)</span> &#123;</span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        hashTable=<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        path=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Collections.sort(tickets,(a,b)-&gt;a.get(<span class="number">1</span>).compareTo(b.get(<span class="number">1</span>)));</span><br><span class="line">        backtracking(tickets);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">backtracking</span><span class="params">(List&lt;List&lt;String&gt;&gt; tickets)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(path.size()==tickets.size()+<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(result.size()==<span class="number">0</span>)&#123;</span><br><span class="line">            result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>(path);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;path.size();i++)&#123;</span><br><span class="line">                String oldStr=result.get(i);</span><br><span class="line">                String newStr=path.get(i);</span><br><span class="line">                <span class="keyword">if</span>(oldStr.equals(newStr)) <span class="keyword">continue</span>;</span><br><span class="line">                <span class="type">int</span> j=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span>(;;)&#123;</span><br><span class="line">                    </span><br><span class="line">                        <span class="type">char</span> oldChar=oldStr.charAt(j);</span><br><span class="line">                        <span class="type">char</span> newChar=newStr.charAt(j);</span><br><span class="line">                        <span class="keyword">if</span>(oldChar-newChar&lt;<span class="number">0</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                        <span class="keyword">else</span> <span class="keyword">if</span>(oldChar-newChar&gt;<span class="number">0</span>) &#123;</span><br><span class="line">                            result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(path);</span><br><span class="line">                            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                            j++;</span><br><span class="line">                            <span class="keyword">continue</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    </span><br><span class="line">                &#125;</span><br><span class="line">            </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        HashSet&lt;List&lt;String&gt;&gt; used= <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;tickets.size();i++)&#123;</span><br><span class="line">            List&lt;String&gt; ticket=tickets.get(i);</span><br><span class="line">            <span class="keyword">if</span>(hashTable.contains(i)|| used.contains(ticket)) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span>(path.size()==<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(!ticket.get(<span class="number">0</span>).equals(<span class="string">&quot;JFK&quot;</span>)) <span class="keyword">continue</span>;</span><br><span class="line">                path.add(ticket.get(<span class="number">0</span>));</span><br><span class="line">                path.add(ticket.get(<span class="number">1</span>));</span><br><span class="line">                used.add(ticket);</span><br><span class="line">                hashTable.add(i);</span><br><span class="line">                <span class="keyword">if</span>(backtracking(tickets)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">                path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">                hashTable.remove(i);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(!ticket.get(<span class="number">0</span>).equals(path.get(path.size()-<span class="number">1</span>)))<span class="keyword">continue</span>;</span><br><span class="line">                path.add(ticket.get(<span class="number">1</span>));</span><br><span class="line">                used.add(ticket);</span><br><span class="line">                hashTable.add(i);</span><br><span class="line">                <span class="keyword">if</span>(backtracking(tickets))<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">                hashTable.remove(i);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-5"   >
          <a href="#提交成功-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-5" class="headerlink" title="提交成功"></a>提交成功</h5>
      <p>关键在于对原机票进行排序，然后我们只要获取第一个最小路径的结果就可以结束</p>

        <h3 id="题解-15"   >
          <a href="#题解-15" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-15" class="headerlink" title="题解"></a>题解</h3>
      <p>思路：这道题是综合性很强的一道题，不仅要对层次方面去重，还要求得排序问题，并且这道题与之前做的题有很大不同的点就在于如何做一个剪枝的操作，这道题可以在递归的时候获取到最小路径之后结束递归做剪枝</p>
<p><strong>实现</strong></p>
<ul>
<li><p>定义全局变量</p>
<ul>
<li>result：存放的是路径(最小路径)</li>
<li>used：存放的是已经使用过的索引下标，用于深度上的排序去重</li>
</ul>
</li>
<li><p>初始化数据</p>
<ul>
<li>创建result和used对象</li>
<li><strong>对tickets进行排序</strong>：这一步相当重要，在提前排序好之后，我们结果集收获到的第一个结果就是最短路径，之后就可以不再收集！</li>
<li>对result数组添加初始化值:“JFK”，这是机场的起始位置，也可以不初始化只是要在第一张机票的时候添加起飞机场和目的机场两个，在这里只是为了后面添加结果的时候<strong>只需要添加目的机场</strong>即可。</li>
</ul>
</li>
<li><p>递归函数的返回值和参数</p>
<ul>
<li>返回值boolean：当找到最短路径为true，当没有找到最短路径为false</li>
</ul>
<blockquote>
<p>返回true之后之后递归可以不用进行了，这一步会在代码体现</p>
</blockquote>
<ul>
<li>参数tickets，总的机票集合</li>
</ul>
</li>
<li><p>递归函数的结束条件</p>
<ul>
<li>当result.size()&#x3D;&#x3D;tickets.size()+1,说明收获到一个结果集，此第一个结果集就是<strong>最短路径，返回true为了让所有递归结束</strong></li>
</ul>
</li>
<li><p>递归函数的单层逻辑</p>
<ul>
<li><p>定义一个set集合，用于层次上的去重</p>
</li>
<li><p>循环每次从0开始</p>
<ul>
<li><p>当used包含索引i，说明这个元素在深度上重复选择，continue</p>
</li>
<li><p>当set包含ticket，说明层次上这个元素重复，continue</p>
</li>
<li><p>也即!used.contains（i）&amp;&amp;!set.contains(ticket) 说明这个机票没被用过</p>
<ul>
<li>如果result.size()&#x3D;&#x3D;1，说明是刚起飞，判断当前机票ticket是否起始站为”JFK”，如果不是则continue</li>
<li>如果result.size()！&#x3D;1，判断当前机票ticket是否起始站和result中最后一个元素相等，如果不相等则continue</li>
<li>result添加目的站</li>
<li>used添加索引i，set添加当前机票</li>
<li>进行递归<ul>
<li>if(backtracking(tickets)){ return true},如果递归中返回true就不需要继续搜索了</li>
</ul>
</li>
<li>回溯</li>
</ul>
</li>
<li><p>当循环遍历到最后位置则返回false</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;String&gt; result; <span class="comment">//结果集</span></span><br><span class="line">    HashSet&lt;Integer&gt; used; <span class="comment">//索引i的深度去重</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">findItinerary</span><span class="params">(List&lt;List&lt;String&gt;&gt; tickets)</span> &#123;</span><br><span class="line">        result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        used=<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//对机票排序（由小到大）为的是最短路径</span></span><br><span class="line">        Collections.sort(tickets,(a,b)-&gt;a.get(<span class="number">1</span>).compareTo(b.get(<span class="number">1</span>)));</span><br><span class="line">        <span class="comment">//初始化result集合</span></span><br><span class="line">        result.add(<span class="string">&quot;JFK&quot;</span>);</span><br><span class="line">        backtracking(tickets);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">backtracking</span><span class="params">(List&lt;List&lt;String&gt;&gt; tickets)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(result.size()==tickets.size()+<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="comment">//set用于层次上的去重</span></span><br><span class="line">        HashSet&lt;List&lt;String&gt;&gt; set=<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;tickets.size();i++)&#123;</span><br><span class="line">            <span class="comment">//获取当前机票</span></span><br><span class="line">            List&lt;String&gt; ticket=tickets.get(i);</span><br><span class="line">           	<span class="comment">//如果i包含于used中或者ticket机票包含于set中说明重复</span></span><br><span class="line">            <span class="keyword">if</span>(used.contains(i) || set.contains(ticket)) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span>(result.size()==<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="comment">//当result.size()==1说明为起飞站，判断当前机票是否起始站是&quot;JFK&quot;，如果不是则continue</span></span><br><span class="line">                <span class="keyword">if</span>(!ticket.get(<span class="number">0</span>).equals(<span class="string">&quot;JFK&quot;</span>)) <span class="keyword">continue</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//判断机票的起始站和result的最后一站是否相同，不相同则continue</span></span><br><span class="line">                <span class="keyword">if</span>(!ticket.get(<span class="number">0</span>).equals(result.get(result.size()-<span class="number">1</span>))) <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            result.add(ticket.get(<span class="number">1</span>));</span><br><span class="line">            used.add(i);</span><br><span class="line">            set.add(ticket);</span><br><span class="line">            <span class="comment">//递归去获取返回值，如果返回true就说明收获到最短路径，可以不要再搜索了，进行剪枝</span></span><br><span class="line">            <span class="keyword">if</span>(backtracking(tickets))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//回溯</span></span><br><span class="line">            result.remove(result.size()-<span class="number">1</span>);</span><br><span class="line">            used.remove(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//没有找到</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h1 id="总结"   >
          <a href="#总结" class="heading-link"><i class="fas fa-link"></i></a><a href="#总结" class="headerlink" title="总结"></a>总结</h1>
      <p>回溯法主要就是一个<strong>暴力搜索法</strong>，当需要多次for循环遍历元素，然后搜索最终的结果，就可以从回溯法开始出发</p>
<p>下一个算法将进入贪心算法部分</p>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2023/08/26/%E6%AD%BB%E4%B9%8B%E5%89%8D%E8%A6%81%E5%81%9A%E5%AE%8C%E7%9A%84%E7%AE%97%E6%B3%95%E6%89%8B%E5%86%8C-%5B6.%E4%BA%8C%E5%8F%89%E6%A0%91%5D/">死之前要做完的算法手册-[6.二叉树]</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2023-08-26</span></span><span class="post-meta-item post-meta-item--wordcount"><span class="post-meta-item__icon"><i class="far fa-file-word"></i></span><span class="post-meta-item__info">字数统计</span><span class="post-meta-item__value">35k</span></span><span class="post-meta-item post-meta-item--readtime"><span class="post-meta-item__icon"><i class="far fa-clock"></i></span><span class="post-meta-item__info">阅读时长</span><span class="post-meta-item__value">287分</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h1 id="二叉树的基本理论基础"   >
          <a href="#二叉树的基本理论基础" class="heading-link"><i class="fas fa-link"></i></a><a href="#二叉树的基本理论基础" class="headerlink" title="二叉树的基本理论基础"></a>二叉树的基本理论基础</h1>
      <p><strong>二叉树的定义代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">class</span> <span class="title class_">TreeNode</span>&#123;</span><br><span class="line">    <span class="comment">//数据</span></span><br><span class="line">    <span class="type">int</span> val;</span><br><span class="line"> 	<span class="comment">//左右子结点</span></span><br><span class="line">    TreeNode left;</span><br><span class="line">    TreeNode right;</span><br><span class="line">    TreeNode ()&#123;&#125;</span><br><span class="line">    TreeNode(<span class="type">int</span> val)&#123;</span><br><span class="line">        <span class="built_in">this</span>.val=val;</span><br><span class="line">    &#125;</span><br><span class="line">    TreeNode(<span class="type">int</span> val,TreeNode left,TreeNode right)&#123;</span><br><span class="line">        <span class="built_in">this</span>.val=val;</span><br><span class="line">        <span class="built_in">this</span>.left=left;</span><br><span class="line">        <span class="built_in">this</span>.right=right;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p><strong>平衡二叉树</strong></p>
<p>平衡二叉树是指左右子树的高度差不超过1，就是平衡二叉树</p>
<p><strong>满二叉树</strong></p>
<p>满二叉树是指一个二叉树只有度为0的叶子结点和度为2的非叶子结点，除了叶子结点的每个结点都有左右子树</p>
<p><strong>完全二叉树</strong></p>
<p>完全二叉树是指除了最后一层是满二叉树，并且最后一层必须都先填满左边</p>
<p><em>二叉搜索树</em></p>
<p>二叉搜索树是指结点有数值，二叉搜索树是一个<strong>有序树</strong></p>
<p><em>平衡二叉搜索树</em></p>
<p>平衡二叉搜索树是指结点有数值的平衡二叉树，左右子树高度差不超过1</p>

        <h1 id="二叉树的递归遍历"   >
          <a href="#二叉树的递归遍历" class="heading-link"><i class="fas fa-link"></i></a><a href="#二叉树的递归遍历" class="headerlink" title="二叉树的递归遍历"></a>二叉树的递归遍历</h1>
      <p>二叉树分为<strong>深度优先搜索</strong>和<strong>广度优先搜索</strong>，我们这里先探究的是深度优先遍历中的利用递归遍历</p>
<p><em>深度优先搜索，当某一个方向遍历到最后一个结点则结束当前方向，进行下一个方向的遍历</em></p>
<p><em>广度优先搜索，当遍历完一层之后再遍历下一层，一层一层搜索</em></p>
<p>二叉树的递归遍历主要分为：<strong>前、中、后序遍历</strong></p>
<p>前序遍历的遍历方式为:<strong>中</strong>左右</p>
<p>中序遍历的遍历方式为:左<strong>中</strong>右</p>
<p>后序遍历的遍历方式为:左右<strong>中</strong></p>
<p><em>所以我们记前中后序遍历只要知道这是在说明中间结点的位置</em></p>
<p>例</p>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="https://images-kkblog.oss-cn-hangzhou.aliyuncs.com/image-20230826101301155.png"  alt="前中后序遍历示例">
      </p>
<p>如何用递归来遍历二叉树，主要分三步</p>
<p>①判断递归需要的参数以及返回值 ：这里参数为存放遍历之后的集合以及当前结点。返回值是Void,因为遍历结果已经存放在参数里面了</p>
<p>②明确递归的结束条件：深度优先遍历，即当前遍历的元素为空则结束这一深度遍历</p>
<p>③判断单层递归要做什么：将存放遍历值，遍历左子树以及遍历右子树</p>
<p>所以我们整个的深度优先遍历的代码如下</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//中序遍历</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">inorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        midItor(root,list);</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">midItor</span><span class="params">(TreeNode node,List&lt;Integer&gt; list)</span>&#123;</span><br><span class="line">    	<span class="comment">//当某一方向遍历到底则结束当前方向递归</span></span><br><span class="line">        <span class="keyword">if</span>(node==<span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line">        midItor(node.left,list);	<span class="comment">//遍历左子树</span></span><br><span class="line">        list.add(node.val);			<span class="comment">//存放遍历值</span></span><br><span class="line">        midItor(node.right,list);	<span class="comment">//遍历右子树</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//而前序和后序遍历的执行逻辑</span></span><br><span class="line"><span class="comment">//只有存放遍历值的步骤不一样</span></span><br><span class="line"><span class="comment">//	也即前序是先存放遍历值再遍历左右子树</span></span><br><span class="line"><span class="comment">//	也即后序是先遍历左右子树再存放遍历值</span></span><br></pre></td></tr></table></div></figure>




        <h2 id="前序遍历"   >
          <a href="#前序遍历" class="heading-link"><i class="fas fa-link"></i></a><a href="#前序遍历" class="headerlink" title="前序遍历"></a>前序遍历</h2>
      <p>给你二叉树的根节点 <code>root</code> ，返回它节点值的 <strong>前序</strong> 遍历。</p>

        <h3 id="144-二叉树的前序遍历"   >
          <a href="#144-二叉树的前序遍历" class="heading-link"><i class="fas fa-link"></i></a><a href="#144-二叉树的前序遍历" class="headerlink" title="144.二叉树的前序遍历"></a>144.二叉树的前序遍历</h3>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/binary-tree-preorder-traversal/" >Leetcode.144题(easy)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h4 id="第一次做"   >
          <a href="#第一次做" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做" class="headerlink" title="第一次做"></a>第一次做</h4>
      <p>第一次做于23&#x2F;08&#x2F;26</p>

        <h5 id="第一次代码"   >
          <a href="#第一次代码" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码" class="headerlink" title="第一次代码"></a>第一次代码</h5>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">preorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">return</span> prefixIt(root,list);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">prefixIt</span><span class="params">(TreeNode root,List&lt;Integer&gt; list)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> list;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(root!=<span class="literal">null</span>)&#123;</span><br><span class="line">            list.add(root.val);</span><br><span class="line">            <span class="keyword">if</span>(root.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">                prefixIt(root.left,list);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(root.right!=<span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                prefixIt(root.right,list);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h6 id="提交成功"   >
          <a href="#提交成功" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功" class="headerlink" title="提交成功"></a>提交成功</h6>
      
        <h3 id="题解"   >
          <a href="#题解" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解" class="headerlink" title="题解"></a>题解</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">preorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        beforeItor(root,list);</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">beforeItor</span><span class="params">(TreeNode node,List&lt;Integer&gt; list)</span>&#123;</span><br><span class="line">    	<span class="comment">//当某一方向遍历到底则结束当前方向递归</span></span><br><span class="line">        <span class="keyword">if</span>(node==<span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">		list.add(node.val);			<span class="comment">//存放遍历值</span></span><br><span class="line">        beforeItor(node.left,list);	<span class="comment">//遍历左子树</span></span><br><span class="line">        beforeItor(node.right,list);	<span class="comment">//遍历右子树</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>




        <h2 id="中序遍历"   >
          <a href="#中序遍历" class="heading-link"><i class="fas fa-link"></i></a><a href="#中序遍历" class="headerlink" title="中序遍历"></a>中序遍历</h2>
      
        <h3 id="94-二叉树的中序遍历"   >
          <a href="#94-二叉树的中序遍历" class="heading-link"><i class="fas fa-link"></i></a><a href="#94-二叉树的中序遍历" class="headerlink" title="94.二叉树的中序遍历"></a>94.二叉树的中序遍历</h3>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/binary-tree-inorder-traversal/" >Leetcode.94题(easy)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h4 id="第一次做-1"   >
          <a href="#第一次做-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-1" class="headerlink" title="第一次做"></a>第一次做</h4>
      <p>第一次做于23&#x2F;08&#x2F;26</p>

        <h5 id="第一次代码-1"   >
          <a href="#第一次代码-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-1" class="headerlink" title="第一次代码"></a>第一次代码</h5>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">inorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; list= <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">return</span> midItor(root,list);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">midItor</span><span class="params">(TreeNode root,List&lt;Integer&gt; list)</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(root!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(root.left!=<span class="literal">null</span>) midItor(root.left,list);</span><br><span class="line">            list.add(root.val);</span><br><span class="line">            <span class="keyword">if</span>(root.right!=<span class="literal">null</span>) midItor(root.right,list);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h6 id="提交成功-1"   >
          <a href="#提交成功-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-1" class="headerlink" title="提交成功"></a>提交成功</h6>
      
        <h3 id="题解-1"   >
          <a href="#题解-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-1" class="headerlink" title="题解"></a>题解</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">inorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        midItor(root,list);</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">midItor</span><span class="params">(TreeNode node,List&lt;Integer&gt; list)</span>&#123;</span><br><span class="line">    	<span class="comment">//当某一方向遍历到底则结束当前方向递归</span></span><br><span class="line">        <span class="keyword">if</span>(node==<span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line">        midItor(node.left,list);	<span class="comment">//遍历左子树</span></span><br><span class="line">        list.add(node.val);			<span class="comment">//存放遍历值</span></span><br><span class="line">        midItor(node.right,list);	<span class="comment">//遍历右子树</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>




        <h2 id="后序遍历"   >
          <a href="#后序遍历" class="heading-link"><i class="fas fa-link"></i></a><a href="#后序遍历" class="headerlink" title="后序遍历"></a>后序遍历</h2>
      
        <h3 id="145-二叉树的后序遍历"   >
          <a href="#145-二叉树的后序遍历" class="heading-link"><i class="fas fa-link"></i></a><a href="#145-二叉树的后序遍历" class="headerlink" title="145.二叉树的后序遍历"></a>145.二叉树的后序遍历</h3>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/binary-tree-postorder-traversal/" >Leetcode.145题(easy)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h4 id="第一次做-2"   >
          <a href="#第一次做-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-2" class="headerlink" title="第一次做"></a>第一次做</h4>
      <p>第一次做于23&#x2F;08&#x2F;26 </p>

        <h5 id="第一次代码-2"   >
          <a href="#第一次代码-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-2" class="headerlink" title="第一次代码"></a>第一次代码</h5>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">postorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">return</span> afterItor(root,list);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">afterItor</span><span class="params">(TreeNode root,List&lt;Integer&gt; list)</span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(root!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(root.left!=<span class="literal">null</span>) afterItor(root.left,list);</span><br><span class="line">            <span class="keyword">if</span>(root.right!=<span class="literal">null</span>) afterItor(root.right,list);</span><br><span class="line">            list.add(root.val);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h6 id="提交成功-2"   >
          <a href="#提交成功-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-2" class="headerlink" title="提交成功"></a>提交成功</h6>
      
        <h3 id="题解-2"   >
          <a href="#题解-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-2" class="headerlink" title="题解"></a>题解</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">postorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        afterItor(root,list);</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterItor</span><span class="params">(TreeNode node,List&lt;Integer&gt; list)</span>&#123;</span><br><span class="line">    	<span class="comment">//当某一方向遍历到底则结束当前方向递归</span></span><br><span class="line">        <span class="keyword">if</span>(node==<span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line">        afterItor(node.left,list);	<span class="comment">//遍历左子树</span></span><br><span class="line">        afterItor(node.right,list);	<span class="comment">//遍历右子树</span></span><br><span class="line">        list.add(node.val);			<span class="comment">//存放遍历值</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>




        <h1 id="二叉树的非递归遍历-迭代遍历"   >
          <a href="#二叉树的非递归遍历-迭代遍历" class="heading-link"><i class="fas fa-link"></i></a><a href="#二叉树的非递归遍历-迭代遍历" class="headerlink" title="二叉树的非递归遍历(迭代遍历)"></a>二叉树的非递归遍历(迭代遍历)</h1>
      <p>上面我们提到了二叉树的<strong>深度优先搜索</strong>中的递归遍历方法，而递归遍历通常也能用非递归的方法解决</p>
<p><strong>迭代遍历</strong>：用一个栈来模拟二叉树的遍历过程</p>
<p>迭代遍历主要的是处理两件事：遍历结点以及处理结点</p>
<p>我们用前序遍历详细说说这个关系</p>

        <h2 id="前序遍历-1"   >
          <a href="#前序遍历-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#前序遍历-1" class="headerlink" title="前序遍历"></a>前序遍历</h2>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/binary-tree-preorder-traversal/" >Leetcode.144题(easy)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><strong>思路</strong></p>
<p>我们前序遍历也即是<strong>中左右</strong>的遍历方式，而栈是一个先进后出的一个数据结构</p>
<p>在这里我们遍历结点和处理结点都是同时的，也即当我们遍历到中结点就要将中结点数据添加list中</p>
<p>而左右子结点入栈应该是先右子树入栈再是左子树入栈，因为LIFO的特性，先处理左子树那就得后入栈</p>
<p><strong>实现</strong></p>
<p>①将根节点添加进栈中</p>
<p>②将中结点弹出，如果结点非空则添加到结果集合中，并且将结点的右子树和左子树入栈</p>
<p>（<strong>入栈顺序为中，右，左。处理顺序为中，左，右</strong>）</p>
<p>③当处理结束将结果集返回</p>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">preorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Stack&lt;TreeNode&gt; stack=<span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">		<span class="comment">//将根节点入栈</span></span><br><span class="line">        stack.add(root);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(stack.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">//将中结点弹出</span></span><br><span class="line">            TreeNode node=stack.pop();</span><br><span class="line">            <span class="comment">//当结点非空添加到结果集，并将右子树，左子树入栈。每个结点都保持中右左的入栈顺序，处理顺序为中左右</span></span><br><span class="line">            <span class="keyword">if</span>(node!=<span class="literal">null</span>)&#123;</span><br><span class="line">               </span><br><span class="line">                list.add(node.val);</span><br><span class="line">                <span class="comment">//右子树入栈</span></span><br><span class="line">                stack.add(node.right);</span><br><span class="line">                <span class="comment">//左子树入栈</span></span><br><span class="line">                stack.add(node.left);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>




        <h2 id="后序遍历-1"   >
          <a href="#后序遍历-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#后序遍历-1" class="headerlink" title="后序遍历"></a>后序遍历</h2>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/binary-tree-postorder-traversal/" >Leetcode.145题(easy)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><strong>思路</strong></p>
<p>后序遍历也即<strong>左右中</strong>的遍历方式 ，我们前序遍历的遍历方式是中左右，然后先入栈右子树再入栈左子树就能达到处理顺序是中左右。而我们将子树的入栈顺序颠倒，也即入栈左子树再入栈右子树就可以得到中右左的结果集，我们最后再将中右左的结果集反转就能得到左右中的遍历结果。</p>
<p>也即 <strong>左右中</strong> &#x3D;&#x3D;   前序遍历 <strong>中左右</strong> -&gt;将子树入栈顺序颠倒 <strong>中右左</strong> -&gt;  反转结果集 <strong>左右中</strong></p>
<p><strong>实现</strong></p>
<p>①将根节点添加进栈中</p>
<p>②将中结点弹出，如果结点非空则添加到结果集合中，并且将结点的左子树和右子树入栈</p>
<p>（<strong>入栈顺序为中，左，右。处理顺序为中，右，左</strong>）</p>
<p>③反转结果集(中，右，左 反转成 左，右，中)</p>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">postorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Stack&lt;TreeNode&gt; stack=<span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        stack.add(root);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(stack.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            TreeNode node=stack.pop();</span><br><span class="line">            <span class="comment">//当结点非空，则将左子树、右子树入栈。每个结点入栈顺序为中左右 处理顺序为中右左</span></span><br><span class="line">            <span class="keyword">if</span>(node!=<span class="literal">null</span>)&#123;</span><br><span class="line">                list.add(node.val);</span><br><span class="line">                <span class="comment">//左子树入栈</span></span><br><span class="line">                stack.add(node.left);</span><br><span class="line">                <span class="comment">//右子树入栈</span></span><br><span class="line">                stack.add(node.right);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    	<span class="comment">//反转结果集</span></span><br><span class="line">        Collections.reverse(list);</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>




        <h2 id="中序遍历-1"   >
          <a href="#中序遍历-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#中序遍历-1" class="headerlink" title="中序遍历"></a>中序遍历</h2>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/binary-tree-inorder-traversal/" >Leetcode.94题(easy)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><strong>思路</strong></p>
<p>这里遍历结点和处理结点不是同时进行的，也即当我们遍历到这个结点要先去处理左节点，所以我们引入了一个<strong>用于遍历的指针</strong></p>
<p>通过指针的不断移动确认当前遍历到的结点，如果当前指针不为空则将结点入栈，再去操作左右子树</p>
<p>如果当前指针为空 说明上一个结点没有左子树  则返回到上个结点将其出栈，再去判断右子树是否为空</p>
<p><strong>实现</strong></p>
<p>①定义一个用于遍历的指针cur，代表着此时遍历到的结点</p>
<p>②如果当前结点不为空 则入栈，将指针指向当前结点的左子树</p>
<p>③如果当前结点为空，则说明左子树为空，返回上一个结点将其弹出实现了左中的路线，再将当前结点指向右子树</p>
<p>④如果当前指针为空并且栈为空说明遍历已经结束 实现了<strong>左中右</strong>的逻辑</p>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">inorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">       List&lt;Integer&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">       Stack&lt;TreeNode&gt; stack=<span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">	<span class="comment">//定义一个用于遍历的指针</span></span><br><span class="line">    	TreeNode cur=root;</span><br><span class="line">	</span><br><span class="line">    	<span class="comment">//当当前结点不为空或者栈不为空的时候说明没有遍历完</span></span><br><span class="line">       <span class="keyword">while</span>(cur!=<span class="literal">null</span> || stack.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">           <span class="keyword">if</span>(cur!=<span class="literal">null</span>)&#123;</span><br><span class="line">               <span class="comment">//当前结点入栈，指向左子树</span></span><br><span class="line">               stack.add(cur);</span><br><span class="line">               cur=cur.left;</span><br><span class="line">           &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">               <span class="comment">//cur==null</span></span><br><span class="line">               <span class="comment">//说明这里没有左子树，返回最近的父节点让它出栈，然后指向父节点的右子树</span></span><br><span class="line">               TreeNode node=stack.pop();</span><br><span class="line">               list.add(node.val);</span><br><span class="line">               cur=node.right;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> list;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></div></figure>




        <h2 id="统一迭代法"   >
          <a href="#统一迭代法" class="heading-link"><i class="fas fa-link"></i></a><a href="#统一迭代法" class="headerlink" title="统一迭代法"></a>统一迭代法</h2>
      <p>因为前中后序代码的不一致性，所以我们可以引入一个<strong>空指针</strong>，这样可以使其迭代法的代码可以能像递归法一样只要移动几个代码的位置就能分别实现前中后序</p>
<p>思想：以<strong>中序遍历</strong>为假设</p>
<p>当当前结点不为空的时候，将其左右子树和当前结点重新入栈 <del>需要实现左中右的逻辑</del></p>
<ul>
<li><p>假如左右子树都不为空 那么实现栈中 		<strong>右结点 当前结点 null 左结点</strong></p>
</li>
<li><p>假如左子树为空右子树不为空， 那么栈中 <strong>右结点 当前结点 null</strong> </p>
</li>
<li><p>假如左子树不为空右子树为空， 那么栈中 <strong>当前结点 null 左结点</strong></p>
</li>
<li><p>假如左右子树都为空，那么栈中  		       <strong>当前结点 null</strong></p>
</li>
</ul>
<p>当遇见null结点的时候只要pop栈就能找到当前结点，也即维护了一个<strong>当前结点后跟着一个空指针标记</strong></p>

        <h3 id="中序遍历-2"   >
          <a href="#中序遍历-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#中序遍历-2" class="headerlink" title="中序遍历"></a>中序遍历</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">inorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Stack&lt;TreeNode&gt; stack=<span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">    	<span class="comment">//根节点为空就直接返回</span></span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> list;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    	<span class="comment">//根节点不为空</span></span><br><span class="line">        stack.add(root);</span><br><span class="line">        <span class="keyword">while</span>(stack.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            TreeNode node=stack.pop();</span><br><span class="line">            <span class="keyword">if</span>(node!=<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="comment">//重新入栈顺序为 右中左 </span></span><br><span class="line">                </span><br><span class="line">                <span class="comment">//当右子树结点为空不入栈</span></span><br><span class="line">                <span class="keyword">if</span>(node.right!=<span class="literal">null</span>) stack.add(node.right);</span><br><span class="line">			</span><br><span class="line">                stack.add(node);</span><br><span class="line">                stack.add(<span class="literal">null</span>);</span><br><span class="line">                <span class="comment">//当左子树结点为空不入栈</span></span><br><span class="line">                <span class="keyword">if</span>(node.left!=<span class="literal">null</span>) stack.add(node.left);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//node==null</span></span><br><span class="line">                <span class="comment">//那么空节点前一个就是当前结点 直接pop</span></span><br><span class="line">                TreeNode inNode=stack.pop();</span><br><span class="line">                list.add(inNode.val);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>




        <h3 id="前序遍历-2"   >
          <a href="#前序遍历-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#前序遍历-2" class="headerlink" title="前序遍历"></a>前序遍历</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">preorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Stack&lt;TreeNode&gt; stack=<span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> list;</span><br><span class="line">        &#125;</span><br><span class="line">        stack.add(root);</span><br><span class="line">        <span class="keyword">while</span>(stack.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            TreeNode node=stack.pop();</span><br><span class="line">            <span class="keyword">if</span>(node!=<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="comment">//重新入栈顺序为 右左中</span></span><br><span class="line">                <span class="comment">//当右子树结点为空不入栈，当左子树结点为空不入栈</span></span><br><span class="line">                <span class="keyword">if</span>(node.right!=<span class="literal">null</span>) stack.add(node.right);</span><br><span class="line">                <span class="keyword">if</span>(node.left!=<span class="literal">null</span>) stack.add(node.left);</span><br><span class="line"></span><br><span class="line">                stack.add(node);</span><br><span class="line">                stack.add(<span class="literal">null</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//node==null</span></span><br><span class="line">				<span class="comment">//那么空节点前一个就是当前结点 直接pop</span></span><br><span class="line">                TreeNode inNode=stack.pop();</span><br><span class="line">                list.add(inNode.val);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h3 id="后序遍历-2"   >
          <a href="#后序遍历-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#后序遍历-2" class="headerlink" title="后序遍历"></a>后序遍历</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">ublic List&lt;Integer&gt; <span class="title function_">postorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Stack&lt;TreeNode&gt; stack=<span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> list;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        stack.add(root);</span><br><span class="line">        <span class="keyword">while</span>(stack.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            TreeNode node=stack.pop();</span><br><span class="line">            <span class="keyword">if</span>(node!=<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="comment">//重新入栈顺序为 中右左</span></span><br><span class="line">                </span><br><span class="line">                stack.add(node);</span><br><span class="line">                stack.add(<span class="literal">null</span>);</span><br><span class="line">                <span class="comment">//当右子树结点为空不入栈，当左子树结点为空不入栈</span></span><br><span class="line">                <span class="keyword">if</span>(node.right!=<span class="literal">null</span>) stack.add(node.right);</span><br><span class="line">                <span class="keyword">if</span>(node.left!=<span class="literal">null</span>) stack.add(node.left);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//node==null</span></span><br><span class="line">                <span class="comment">//那么空节点前一个就是当前结点 直接pop</span></span><br><span class="line">                TreeNode inNode=stack.pop();</span><br><span class="line">                list.add(inNode.val);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h3 id="小结"   >
          <a href="#小结" class="heading-link"><i class="fas fa-link"></i></a><a href="#小结" class="headerlink" title="小结"></a>小结</h3>
      <p>这个统一迭代法主要利用了一个<strong>空指针来标记当前结点</strong>的位置，当结点不为空的时候统一将有效结点入栈，当结点为空时找前一个元素即可找到当前结点。这样代码只需要移动少部分顺序即可完成前中后序的遍历</p>

        <h1 id="二叉树的层序遍历"   >
          <a href="#二叉树的层序遍历" class="heading-link"><i class="fas fa-link"></i></a><a href="#二叉树的层序遍历" class="headerlink" title="二叉树的层序遍历"></a>二叉树的层序遍历</h1>
      <p>二叉树有<strong>深度优先搜索</strong>与<strong>广度优先搜索</strong>，我们这里来学的就是广度优先搜索中的层序遍历</p>
<p>给你二叉树的根节点 <code>root</code> ，返回其节点值的 <strong>层序遍历</strong> 。 （即逐层地，从左到右访问所有节点）。</p>

        <h2 id="102-二叉树的层序遍历"   >
          <a href="#102-二叉树的层序遍历" class="heading-link"><i class="fas fa-link"></i></a><a href="#102-二叉树的层序遍历" class="headerlink" title="102.二叉树的层序遍历"></a>102.二叉树的层序遍历</h2>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/binary-tree-level-order-traversal/" >Leetcode.102题(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-3"   >
          <a href="#第一次做-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-3" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;08&#x2F;27</p>

        <h4 id="第一次代码-3"   >
          <a href="#第一次代码-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-3" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">levelOrder</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Queue&lt;TreeNode&gt; Fatherqueue=<span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line">        Queue&lt;TreeNode&gt; Sonqueue=<span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> result;</span><br><span class="line"></span><br><span class="line">        Fatherqueue.add(root);</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span>(Fatherqueue.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            List&lt;Integer&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            TreeNode node=Fatherqueue.poll();</span><br><span class="line">            <span class="keyword">if</span>(node!=<span class="literal">null</span>)&#123;</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span>(node.left!=<span class="literal">null</span>)Sonqueue.add(node.left);</span><br><span class="line">                <span class="keyword">if</span>(node.right!=<span class="literal">null</span>)Sonqueue.add(node.right);</span><br><span class="line">                list.add(node.val);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(Fatherqueue.size()==<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">while</span>(Sonqueue.size()!=<span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    Fatherqueue.add(Sonqueue.poll());</span><br><span class="line">                &#125;</span><br><span class="line">                result.add(list);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败"   >
          <a href="#提交失败" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:root &#x3D;[3,9,20,null,null,15,7]，输出[[3],[20],[7]] 预期输出[[3],[9,20],[15,7]]</p>
<p>原因出在这个list队列每次循环都会重置，而改进逻辑是在每次父队列为空的时候new一个List出来 然后list指向这个新的List</p>

        <h4 id="第二次代码"   >
          <a href="#第二次代码" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">levelOrder</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Queue&lt;TreeNode&gt; Fatherqueue=<span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line">        Queue&lt;TreeNode&gt; Sonqueue=<span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> result;</span><br><span class="line"></span><br><span class="line">        Fatherqueue.add(root);</span><br><span class="line"></span><br><span class="line">        List&lt;Integer&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">while</span>(Fatherqueue.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">       </span><br><span class="line">            TreeNode node=Fatherqueue.poll();</span><br><span class="line">            <span class="keyword">if</span>(node!=<span class="literal">null</span>)&#123;</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span>(node.left!=<span class="literal">null</span>)Sonqueue.add(node.left);</span><br><span class="line">                <span class="keyword">if</span>(node.right!=<span class="literal">null</span>)Sonqueue.add(node.right);</span><br><span class="line">                list.add(node.val);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(Fatherqueue.size()==<span class="number">0</span>)&#123;</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">while</span>(Sonqueue.size()!=<span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    Fatherqueue.add(Sonqueue.poll());</span><br><span class="line">                &#125;</span><br><span class="line">                result.add(list);</span><br><span class="line">                list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-3"   >
          <a href="#提交成功-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-3" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-3"   >
          <a href="#题解-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-3" class="headerlink" title="题解"></a>题解</h3>
      <p><strong>思路</strong></p>
<p>用一个<strong>size</strong>记录每一层的结点数:获取一下队列中的结点个数记录为size，然后当结点数大于0的时候操作队列。当结点为0说明本层遍历完了 重新获取一下队列中的结点数</p>
<p>如</p>
<figure class="highlight c"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">第一层size为<span class="number">1</span> 说明本层只需要弹出一个结点即可，操作队列弹出一个元素进入下一层</span><br><span class="line"></span><br><span class="line">第二层size为<span class="number">2</span> 说明本层需要弹出两个结点，队列只需要弹出两次</span><br><span class="line"></span><br><span class="line">第三层size为<span class="number">3</span> 说明第三层只有三个结点</span><br></pre></td></tr></table></div></figure>

<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">levelOrder</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Queue&lt;TreeNode&gt; queue=<span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">    	<span class="comment">//将根节点入队</span></span><br><span class="line">        queue.add(root);</span><br><span class="line">		</span><br><span class="line">    	<span class="comment">//当队列非空说明没有遍历完</span></span><br><span class="line">        <span class="keyword">while</span>(queue.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">//记录本层结点数  快照size</span></span><br><span class="line">            <span class="type">int</span> size=queue.size();</span><br><span class="line">            <span class="comment">//每一层的list集合</span></span><br><span class="line">            List&lt;Integer&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            <span class="keyword">while</span>(size--&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="comment">//弹出结点</span></span><br><span class="line">                TreeNode node=queue.poll();</span><br><span class="line">                list.add(node.val);</span><br><span class="line">                <span class="comment">//将当前结点左右结点(非空)入队</span></span><br><span class="line">                <span class="keyword">if</span>(node.left!=<span class="literal">null</span>) queue.add(node.left);</span><br><span class="line">                <span class="keyword">if</span>(node.right!=<span class="literal">null</span>) queue.add(node.right);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//添加进每层的结果集中</span></span><br><span class="line">            result.add(list);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="107-二叉树的层序遍历II"   >
          <a href="#107-二叉树的层序遍历II" class="heading-link"><i class="fas fa-link"></i></a><a href="#107-二叉树的层序遍历II" class="headerlink" title="107.二叉树的层序遍历II"></a>107.二叉树的层序遍历II</h2>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/binary-tree-level-order-traversal-ii/" >Leetcode.107题(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p>给你二叉树的根节点 <code>root</code> ，返回其节点值 <strong>自底向上的层序遍历</strong> 。 （即按从叶子节点所在层到根节点所在的层，逐层从左向右遍历）</p>

        <h3 id="第一次做-4"   >
          <a href="#第一次做-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-4" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;08&#x2F;28</p>

        <h4 id="第一次代码-4"   >
          <a href="#第一次代码-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-4" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">levelOrderBottom</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Queue&lt;TreeNode&gt; queue=<span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        queue.add(root);</span><br><span class="line">        <span class="keyword">while</span>(queue.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="type">int</span> size=queue.size();</span><br><span class="line">            List&lt;Integer&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            <span class="keyword">while</span>(size--&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                TreeNode node=queue.poll();</span><br><span class="line">                <span class="keyword">if</span>(node.left!=<span class="literal">null</span>) queue.add(node.left);</span><br><span class="line">                <span class="keyword">if</span>(node.right!=<span class="literal">null</span>) queue.add(node.right);</span><br><span class="line">                list.add(node.val);</span><br><span class="line">            &#125;</span><br><span class="line">            result.add(list);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Collections.reverse(result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-4"   >
          <a href="#提交成功-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-4" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-4"   >
          <a href="#题解-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-4" class="headerlink" title="题解"></a>题解</h3>
      <p>这道题和102题(二叉树的层序遍历)相似，但是要求的是自底向顶的数据输出</p>
<p>那么可以知道层序遍历是自顶向底的顺序输出，所以我们最后只要将层序遍历结果集反转即可达到要求</p>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">levelOrderBottom</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Queue&lt;TreeNode&gt; queue=<span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line">        queue.add(root);</span><br><span class="line">        <span class="keyword">while</span>(queue.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">//统计每一次要操作的数据量</span></span><br><span class="line">            <span class="type">int</span> size=queue.size();</span><br><span class="line">            List&lt;Integer&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            <span class="keyword">while</span>(size--&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                TreeNode node=queue.poll();</span><br><span class="line">                <span class="keyword">if</span>(node.left!=<span class="literal">null</span>) queue.add(node.left);</span><br><span class="line">                <span class="keyword">if</span>(node.right!=<span class="literal">null</span>) queue.add(node.right);</span><br><span class="line">                list.add(node.val);</span><br><span class="line">            &#125;</span><br><span class="line">            result.add(list);</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="comment">//反转自顶向底的结果集</span></span><br><span class="line">        Collections.reverse(result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="199-二叉树的右视图"   >
          <a href="#199-二叉树的右视图" class="heading-link"><i class="fas fa-link"></i></a><a href="#199-二叉树的右视图" class="headerlink" title="199.二叉树的右视图"></a>199.二叉树的右视图</h2>
      <p>给定一个二叉树的 <strong>根节点</strong> <code>root</code>，想象自己站在它的右侧，按照从顶部到底部的顺序，返回从右侧所能看到的节点值。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/binary-tree-right-side-view/" >Leetcode.199题(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-5"   >
          <a href="#第一次做-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-5" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;08&#x2F;28</p>

        <h4 id="第一次代码-5"   >
          <a href="#第一次代码-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-5" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">rightSideView</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Queue&lt;TreeNode&gt; queue=<span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> list;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        queue.add(root);</span><br><span class="line">        <span class="keyword">while</span>(queue.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="type">int</span> size=queue.size();</span><br><span class="line">            <span class="keyword">while</span>(size--&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                TreeNode node=queue.poll();</span><br><span class="line">                <span class="comment">//当size==0 说明该结点是这层的最后一个结点，也即右视图能看到的结点</span></span><br><span class="line">                <span class="keyword">if</span>(size==<span class="number">0</span>)&#123;</span><br><span class="line">                    list.add(node.val);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(node.left!=<span class="literal">null</span>) queue.add(node.left);</span><br><span class="line">                <span class="keyword">if</span>(node.right!=<span class="literal">null</span>) queue.add(node.right);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-5"   >
          <a href="#提交成功-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-5" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-5"   >
          <a href="#题解-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-5" class="headerlink" title="题解"></a>题解</h3>
      <p>思路：我们层序遍历然后将每层的最后一个元素添加到结果集中返回即可</p>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">rightSideView</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Queue&lt;TreeNode&gt; queue=<span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> list;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        queue.add(root);</span><br><span class="line">        <span class="keyword">while</span>(queue.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="type">int</span> size=queue.size();</span><br><span class="line">            <span class="keyword">while</span>(size--&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                TreeNode node=queue.poll();</span><br><span class="line">                <span class="comment">//当size==0 说明该结点是这层的最后一个结点，也即右视图能看到的结点</span></span><br><span class="line">                <span class="keyword">if</span>(size==<span class="number">0</span>)&#123;</span><br><span class="line">                    list.add(node.val);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(node.left!=<span class="literal">null</span>) queue.add(node.left);</span><br><span class="line">                <span class="keyword">if</span>(node.right!=<span class="literal">null</span>) queue.add(node.right);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="637-二叉树的层平均值"   >
          <a href="#637-二叉树的层平均值" class="heading-link"><i class="fas fa-link"></i></a><a href="#637-二叉树的层平均值" class="headerlink" title="637.二叉树的层平均值"></a>637.二叉树的层平均值</h2>
      <p>给定一个非空二叉树的根节点 <code>root</code> , 以数组的形式返回每一层节点的平均值。与实际答案相差 <code>10-5</code> 以内的答案可以被接受。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/average-of-levels-in-binary-tree/" >Leetcode.637题(easy)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-6"   >
          <a href="#第一次做-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-6" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;08&#x2F;28</p>

        <h4 id="第一次代码-6"   >
          <a href="#第一次代码-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-6" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Double&gt; <span class="title function_">averageOfLevels</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Double&gt; result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Queue&lt;TreeNode&gt; queue=<span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">        queue.add(root);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(queue.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="type">int</span> size=queue.size();            </span><br><span class="line">            <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">            <span class="type">double</span> num=size;</span><br><span class="line">            <span class="keyword">while</span>(size--&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                TreeNode node=queue.poll();</span><br><span class="line">                <span class="keyword">if</span>(node.left!=<span class="literal">null</span>) queue.add(node.left);</span><br><span class="line">                <span class="keyword">if</span>(node.right!=<span class="literal">null</span>) queue.add(node.right);</span><br><span class="line">                sum+=node.val;</span><br><span class="line">            &#125;</span><br><span class="line">            result.add(sum/num);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-1"   >
          <a href="#提交失败-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-1" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE: 输入root&#x3D;[2,147,483,647，2,147,483,647，2,147,483,647] 输出[2,147,483,647.0，-1.0] 预期输出[2,147,483,647.0，2,147,483,647.0]</p>
<p>原因在于int的上限为2,147,483,647所以我只要把sum的数据类型改成double即可</p>

        <h4 id="第二次代码-1"   >
          <a href="#第二次代码-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码-1" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Double&gt; <span class="title function_">averageOfLevels</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Double&gt; result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Queue&lt;TreeNode&gt; queue=<span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">        queue.add(root);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(queue.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="type">int</span> size=queue.size();            </span><br><span class="line">            <span class="type">double</span> sum=<span class="number">0</span>;</span><br><span class="line">            <span class="type">double</span> num=size;</span><br><span class="line">            <span class="keyword">while</span>(size--&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                TreeNode node=queue.poll();</span><br><span class="line">                <span class="keyword">if</span>(node.left!=<span class="literal">null</span>) queue.add(node.left);</span><br><span class="line">                <span class="keyword">if</span>(node.right!=<span class="literal">null</span>) queue.add(node.right);</span><br><span class="line">                sum+=node.val;</span><br><span class="line">            &#125;</span><br><span class="line">            result.add(sum/num);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-6"   >
          <a href="#提交成功-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-6" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-6"   >
          <a href="#题解-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-6" class="headerlink" title="题解"></a>题解</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">ublic List&lt;Double&gt; <span class="title function_">averageOfLevels</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Double&gt; result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Queue&lt;TreeNode&gt; queue=<span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">        queue.add(root);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(queue.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">//记录每层的结点数</span></span><br><span class="line">            <span class="type">int</span> size=queue.size();</span><br><span class="line">            <span class="comment">//统计每层总和</span></span><br><span class="line">            <span class="type">double</span> sum=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;size;i++)&#123;</span><br><span class="line">                TreeNode node=queue.poll();</span><br><span class="line">                <span class="keyword">if</span>(node.left!=<span class="literal">null</span>) queue.add(node.left);</span><br><span class="line">                <span class="keyword">if</span>(node.right!=<span class="literal">null</span>) queue.add(node.right);</span><br><span class="line">                sum+=node.val;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//添加每层平均值</span></span><br><span class="line">            result.add(sum/size);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="429-N叉树的层序遍历"   >
          <a href="#429-N叉树的层序遍历" class="heading-link"><i class="fas fa-link"></i></a><a href="#429-N叉树的层序遍历" class="headerlink" title="429.N叉树的层序遍历"></a>429.N叉树的层序遍历</h2>
      <p>给定一个 N 叉树，返回其节点值的<em>层序遍历</em>。（即从左到右，逐层遍历）。</p>
<p>树的序列化输入是用层序遍历，每组子节点都由 null 值分隔（参见示例）。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/n-ary-tree-level-order-traversal/" >Leetcode.429(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-7"   >
          <a href="#第一次做-7" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-7" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;08&#x2F;28</p>

        <h4 id="第一次代码-7"   >
          <a href="#第一次代码-7" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-7" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">levelOrder</span><span class="params">(Node root)</span> &#123;</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Queue&lt;Node&gt; queue=<span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">        queue.add(root);</span><br><span class="line">        <span class="keyword">while</span>(queue.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="type">int</span> size=queue.size();</span><br><span class="line">            List&lt;Integer&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            <span class="keyword">while</span>(size--&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="type">Node</span> <span class="variable">node</span> <span class="operator">=</span>queue.poll();</span><br><span class="line">                list.add(node.val);</span><br><span class="line">                <span class="keyword">if</span>(node.children!=<span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">for</span>(Node n: node.children)&#123;</span><br><span class="line">                        queue.add(n);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            result.add(list);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-7"   >
          <a href="#提交成功-7" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-7" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-7"   >
          <a href="#题解-7" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-7" class="headerlink" title="题解"></a>题解</h3>
      <p>思路：统计每层个数，然后每个结点获取他的数据入list中并将子结点集合(children)入队</p>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">levelOrder</span><span class="params">(Node root)</span> &#123;</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Queue&lt;Node&gt; queue=<span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">        queue.add(root);</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">while</span>(queue.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="type">int</span> size=queue.size();</span><br><span class="line">            </span><br><span class="line">            List&lt;Integer&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            <span class="keyword">while</span>(size--&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="type">Node</span> <span class="variable">node</span> <span class="operator">=</span>queue.poll();</span><br><span class="line">                list.add(node.val);</span><br><span class="line">                <span class="comment">//当子节点集合不为空</span></span><br><span class="line">                <span class="keyword">if</span>(node.children!=<span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="comment">//子结点入队</span></span><br><span class="line">                    <span class="keyword">for</span>(Node n: node.children)&#123;</span><br><span class="line">                        queue.add(n);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            result.add(list);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="515-在每个树行中找最大值"   >
          <a href="#515-在每个树行中找最大值" class="heading-link"><i class="fas fa-link"></i></a><a href="#515-在每个树行中找最大值" class="headerlink" title="515.在每个树行中找最大值"></a>515.在每个树行中找最大值</h2>
      <p>给定一棵二叉树的根节点 <code>root</code> ，请找出该二叉树中每一层的最大值。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/find-largest-value-in-each-tree-row/" >Leetcode.515题(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-8"   >
          <a href="#第一次做-8" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-8" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;08&#x2F;28</p>

        <h4 id="第一次代码-8"   >
          <a href="#第一次代码-8" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-8" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">largestValues</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Queue&lt;TreeNode&gt; queue=<span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">        queue.add(root);</span><br><span class="line">        <span class="keyword">while</span>(queue.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="type">int</span> size=queue.size();</span><br><span class="line">            <span class="type">int</span> MAX=Integer.MAX_VALUE+<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span>(size--&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                TreeNode node=queue.poll();</span><br><span class="line">                <span class="keyword">if</span>(node.val&gt;=MAX) MAX=node.val;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(node.left!=<span class="literal">null</span>) queue.add(node.left);</span><br><span class="line">                <span class="keyword">if</span>(node.right!=<span class="literal">null</span>) queue.add(node.right);</span><br><span class="line">            &#125;</span><br><span class="line">            result.add(MAX);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-8"   >
          <a href="#提交成功-8" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-8" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-8"   >
          <a href="#题解-8" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-8" class="headerlink" title="题解"></a>题解</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">largestValues</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Queue&lt;TreeNode&gt; queue=<span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">        queue.add(root);</span><br><span class="line">        <span class="keyword">while</span>(queue.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="type">int</span> size=queue.size();</span><br><span class="line">            <span class="comment">//记录每层最大值</span></span><br><span class="line">            <span class="type">int</span> MAX=Integer.MAX_VALUE+<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span>(size--&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                TreeNode node=queue.poll();</span><br><span class="line">                <span class="keyword">if</span>(node.val&gt;=MAX) MAX=node.val;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(node.left!=<span class="literal">null</span>) queue.add(node.left);</span><br><span class="line">                <span class="keyword">if</span>(node.right!=<span class="literal">null</span>) queue.add(node.right);</span><br><span class="line">            &#125;</span><br><span class="line">            result.add(MAX);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="116-填充每个节点的下一个右侧节点指针"   >
          <a href="#116-填充每个节点的下一个右侧节点指针" class="heading-link"><i class="fas fa-link"></i></a><a href="#116-填充每个节点的下一个右侧节点指针" class="headerlink" title="116.填充每个节点的下一个右侧节点指针"></a>116.填充每个节点的下一个右侧节点指针</h2>
      <p>给定一个 <strong>完美二叉树</strong> ，其所有叶子节点都在同一层，每个父节点都有两个子节点。二叉树定义如下：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">struct Node &#123;</span><br><span class="line">  int val;</span><br><span class="line">  Node *left;</span><br><span class="line">  Node *right;</span><br><span class="line">  Node *next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>填充它的每个 next 指针，让这个指针指向其下一个右侧节点。如果找不到下一个右侧节点，则将 next 指针设置为 <code>NULL</code>。</p>
<p>初始状态下，所有 next 指针都被设置为 <code>NULL</code>。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/populating-next-right-pointers-in-each-node/" >Leetcode.116题(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-9"   >
          <a href="#第一次做-9" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-9" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;08&#x2F;28</p>

        <h4 id="第一次代码-9"   >
          <a href="#第一次代码-9" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-9" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Node <span class="title function_">connect</span><span class="params">(Node root)</span> &#123;</span><br><span class="line">        Queue&lt;Node&gt; queue=<span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line">        Node cur;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>)&#123;</span><br><span class="line">           <span class="keyword">return</span> root;</span><br><span class="line">        &#125;</span><br><span class="line">        queue.add(root);</span><br><span class="line">        <span class="keyword">while</span>(queue.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="type">int</span> size=queue.size();</span><br><span class="line">            cur=queue.peek();</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;size;i++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(i==<span class="number">0</span>)&#123;</span><br><span class="line">                    queue.poll();</span><br><span class="line">                &#125;</span><br><span class="line">                Node next=queue.poll();</span><br><span class="line">                cur.next=next;</span><br><span class="line">                cur=next;</span><br><span class="line">                <span class="keyword">if</span>(next!=<span class="literal">null</span>)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(next.left!=<span class="literal">null</span>) queue.add(next.left);</span><br><span class="line">                    <span class="keyword">if</span>(next.right!=<span class="literal">null</span>) queue.add(next.right);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-2"   >
          <a href="#提交失败-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-2" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:输入[1,2,3,4,5,6,7] 输出[1,#,2,#,4,#] 预期输出[1,#,2,3,#,4,5,6,7,#]</p>
<p>当每层第一个的时候忘记继续操作了</p>

        <h4 id="第二次代码-2"   >
          <a href="#第二次代码-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码-2" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Node <span class="title function_">connect</span><span class="params">(Node root)</span> &#123;</span><br><span class="line">       Queue&lt;Node&gt; queue=<span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line">       Node cur;</span><br><span class="line">       <span class="keyword">if</span>(root==<span class="literal">null</span>)&#123;</span><br><span class="line">          <span class="keyword">return</span> root;</span><br><span class="line">       &#125;</span><br><span class="line">       queue.add(root);</span><br><span class="line">       <span class="keyword">while</span>(queue.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">           <span class="type">int</span> size=queue.size();</span><br><span class="line">           cur=queue.peek();</span><br><span class="line">           <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;size;i++)&#123;</span><br><span class="line">               <span class="keyword">if</span>(i==<span class="number">0</span>)&#123;</span><br><span class="line">                   Node next=queue.poll();</span><br><span class="line">                   <span class="keyword">if</span>(next.left!=<span class="literal">null</span>) queue.add(next.left);</span><br><span class="line">                   <span class="keyword">if</span>(next.right!=<span class="literal">null</span>) queue.add(next.right);</span><br><span class="line">                   <span class="keyword">continue</span>;</span><br><span class="line">               &#125;</span><br><span class="line">               Node next=queue.poll();</span><br><span class="line">               cur.next=next;</span><br><span class="line">               cur=next;</span><br><span class="line">               <span class="keyword">if</span>(next!=<span class="literal">null</span>)&#123;</span><br><span class="line">                   <span class="keyword">if</span>(next.left!=<span class="literal">null</span>) queue.add(next.left);</span><br><span class="line">                   <span class="keyword">if</span>(next.right!=<span class="literal">null</span>) queue.add(next.right);</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> root;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-9"   >
          <a href="#提交成功-9" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-9" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-9"   >
          <a href="#题解-9" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-9" class="headerlink" title="题解"></a>题解</h3>
      <p>思路： 还是层序遍历</p>
<ul>
<li><p>size–之后为0说明是这层最后一个结点就不做处理，只将子结点入队</p>
</li>
<li><p>size–之后不为0说明这层还有结点，通过peek方法取得当前结点的下一个结点 指向下一个结点即可，然后将当前结点的子结点入队</p>
</li>
</ul>
<p>								</p>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Node <span class="title function_">connect</span><span class="params">(Node root)</span> &#123;</span><br><span class="line">        Queue&lt;Node&gt; queue=<span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line">        Node cur;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>)&#123;</span><br><span class="line">           <span class="keyword">return</span> root;</span><br><span class="line">        &#125;</span><br><span class="line">        queue.add(root);</span><br><span class="line">        <span class="keyword">while</span>(queue.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="type">int</span> size=queue.size();</span><br><span class="line">            <span class="keyword">while</span>(size--&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="comment">//获取当前结点</span></span><br><span class="line">                Node node=queue.poll();</span><br><span class="line">                <span class="comment">//当size!=0 说明没到本层最后一个结点，队里还有本层的下一个结点</span></span><br><span class="line">                <span class="keyword">if</span>(size!=<span class="number">0</span>)&#123;</span><br><span class="line">                    Node next=queue.peek();</span><br><span class="line">                    node.next=next;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//子结点入队</span></span><br><span class="line">                <span class="keyword">if</span>(node.left!=<span class="literal">null</span>) queue.add(node.left);</span><br><span class="line">                <span class="keyword">if</span>(node.right!=<span class="literal">null</span>) queue.add(node.right);</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="117-填充每个节点的下一个右侧节点指针-II"   >
          <a href="#117-填充每个节点的下一个右侧节点指针-II" class="heading-link"><i class="fas fa-link"></i></a><a href="#117-填充每个节点的下一个右侧节点指针-II" class="headerlink" title="117.填充每个节点的下一个右侧节点指针 II"></a>117.填充每个节点的下一个右侧节点指针 II</h2>
      <p>给定一个二叉树：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">struct Node &#123;</span><br><span class="line">  int val;</span><br><span class="line">  Node *left;</span><br><span class="line">  Node *right;</span><br><span class="line">  Node *next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>填充它的每个 next 指针，让这个指针指向其下一个右侧节点。如果找不到下一个右侧节点，则将 next 指针设置为 <code>NULL</code> 。</p>
<p>初始状态下，所有 next 指针都被设置为 <code>NULL</code> 。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/populating-next-right-pointers-in-each-node-ii/" >Leetcode.117题(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><em>这题于106题的区别在于 106题二叉树是完美二叉树 这道题是普通二叉树</em></p>

        <h3 id="第一次做-10"   >
          <a href="#第一次做-10" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-10" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;08&#x2F;28</p>

        <h4 id="第一次代码-10"   >
          <a href="#第一次代码-10" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-10" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Node <span class="title function_">connect</span><span class="params">(Node root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        Queue&lt;Node&gt; queue= <span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line">        queue.add(root);</span><br><span class="line">        <span class="keyword">while</span>(queue.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="type">int</span> size=queue.size();</span><br><span class="line">            <span class="keyword">while</span>(size--&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                Node node=queue.poll();</span><br><span class="line">                <span class="keyword">if</span>(size!=<span class="number">0</span>)&#123;</span><br><span class="line">                    Node next=queue.peek();</span><br><span class="line">                    node.next=next;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(node.left!=<span class="literal">null</span>) queue.add(node.left);</span><br><span class="line">                <span class="keyword">if</span>(node.right!=<span class="literal">null</span>) queue.add(node.right);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-10"   >
          <a href="#提交成功-10" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-10" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-10"   >
          <a href="#题解-10" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-10" class="headerlink" title="题解"></a>题解</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Node <span class="title function_">connect</span><span class="params">(Node root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        Queue&lt;Node&gt; queue= <span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line">        queue.add(root);</span><br><span class="line">        <span class="keyword">while</span>(queue.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="type">int</span> size=queue.size();</span><br><span class="line">            <span class="keyword">while</span>(size--&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="comment">//获取当前结点</span></span><br><span class="line">                Node node=queue.poll();</span><br><span class="line">                <span class="comment">//当size!=0 说明没到本层最后一个结点，队里还有本层的下一个结点</span></span><br><span class="line">                <span class="keyword">if</span>(size!=<span class="number">0</span>)&#123;</span><br><span class="line">                    Node next=queue.peek();</span><br><span class="line">                    node.next=next;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//子结点入队</span></span><br><span class="line">                <span class="keyword">if</span>(node.left!=<span class="literal">null</span>) queue.add(node.left);</span><br><span class="line">                <span class="keyword">if</span>(node.right!=<span class="literal">null</span>) queue.add(node.right);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="104-二叉树的最大深度"   >
          <a href="#104-二叉树的最大深度" class="heading-link"><i class="fas fa-link"></i></a><a href="#104-二叉树的最大深度" class="headerlink" title="104.二叉树的最大深度"></a>104.二叉树的最大深度</h2>
      <p>给定一个二叉树 <code>root</code> ，返回其最大深度。</p>
<p>二叉树的 <strong>最大深度</strong> 是指从根节点到最远叶子节点的最长路径上的节点数。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/maximum-depth-of-binary-tree/" >Leetcode.104题(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-11"   >
          <a href="#第一次做-11" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-11" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;08&#x2F;28</p>

        <h4 id="第一次代码-11"   >
          <a href="#第一次代码-11" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-11" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxDepth</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    	<span class="comment">//用于统计层数</span></span><br><span class="line">        <span class="type">int</span> dept=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> dept;</span><br><span class="line">        Queue&lt;TreeNode&gt; queue=<span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        queue.add(root);</span><br><span class="line">        <span class="keyword">while</span>(queue.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">//层数自增</span></span><br><span class="line">            dept++;</span><br><span class="line">            <span class="type">int</span> size=queue.size();</span><br><span class="line">            <span class="keyword">while</span>(size--&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                TreeNode node=queue.poll();</span><br><span class="line">                <span class="keyword">if</span>(node.left!=<span class="literal">null</span>) queue.add(node.left);</span><br><span class="line">                <span class="keyword">if</span>(node.right!=<span class="literal">null</span>) queue.add(node.right);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dept;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-11"   >
          <a href="#提交成功-11" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-11" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="第二次做"   >
          <a href="#第二次做" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次做" class="headerlink" title="第二次做"></a>第二次做</h3>
      <p>第二次做于23&#x2F;08&#x2F;30</p>

        <h4 id="第一次代码-12"   >
          <a href="#第一次代码-12" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-12" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxDepth</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        Queue&lt;TreeNode&gt; queue=<span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> dept=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> dept;</span><br><span class="line">        queue.add(root);</span><br><span class="line">        <span class="keyword">while</span>(queue.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            dept++;</span><br><span class="line">            <span class="type">int</span> size=queue.size();</span><br><span class="line">            <span class="keyword">while</span>(size--&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                TreeNode node=queue.poll();</span><br><span class="line">                <span class="keyword">if</span>(node.left!=<span class="literal">null</span>) queue.add(node.left);</span><br><span class="line">                <span class="keyword">if</span>(node.right!=<span class="literal">null</span>) queue.add(node.right);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dept;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-12"   >
          <a href="#提交成功-12" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-12" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-11"   >
          <a href="#题解-11" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-11" class="headerlink" title="题解"></a>题解</h3>
      <p>我们只要用一个count来统计层数即可，当层序遍历的时候count++就能统计做大深度</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxDepth</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">     	<span class="comment">//用于统计深度 </span></span><br><span class="line">    	<span class="type">int</span> dept=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> dept;</span><br><span class="line">        Queue&lt;TreeNode&gt; queue=<span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        queue.add(root);</span><br><span class="line">        <span class="keyword">while</span>(queue.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            dept++;</span><br><span class="line">            <span class="type">int</span> size=queue.size();</span><br><span class="line">            <span class="keyword">while</span>(size--&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                TreeNode node=queue.poll();</span><br><span class="line">                <span class="keyword">if</span>(node.left!=<span class="literal">null</span>) queue.add(node.left);</span><br><span class="line">                <span class="keyword">if</span>(node.right!=<span class="literal">null</span>) queue.add(node.right);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dept;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="111-二叉树的最小深度"   >
          <a href="#111-二叉树的最小深度" class="heading-link"><i class="fas fa-link"></i></a><a href="#111-二叉树的最小深度" class="headerlink" title="111.二叉树的最小深度"></a>111.二叉树的最小深度</h2>
      <p>给定一个二叉树，找出其最小深度。</p>
<p>最小深度是从根节点到最近叶子节点的最短路径上的节点数量。</p>
<p><strong>说明：</strong>叶子节点是指没有子节点的节点。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/minimum-depth-of-binary-tree/" >Leetcode.111题(easy)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-12"   >
          <a href="#第一次做-12" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-12" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;08&#x2F;28</p>

        <h4 id="第一次代码-13"   >
          <a href="#第一次代码-13" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-13" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minDepth</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="type">int</span> dept=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> dept;</span><br><span class="line">        </span><br><span class="line">        Queue&lt;TreeNode&gt; queue=<span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line">        queue.add(root);</span><br><span class="line">        <span class="keyword">while</span>(queue.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="type">int</span> size=queue.size();</span><br><span class="line">            dept++;</span><br><span class="line">            <span class="keyword">while</span>(size--&gt;<span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                TreeNode node=queue.poll();</span><br><span class="line">                <span class="keyword">if</span>(node.left==<span class="literal">null</span> &amp;&amp; node.right==<span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> dept;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(node.left!=<span class="literal">null</span>) queue.add(node.left);</span><br><span class="line">                <span class="keyword">if</span>(node.right!=<span class="literal">null</span>) queue.add(node.right);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dept;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-13"   >
          <a href="#提交成功-13" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-13" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="第二次做-1"   >
          <a href="#第二次做-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次做-1" class="headerlink" title="第二次做"></a>第二次做</h3>
      <p>第二次做于23&#x2F;08&#x2F;30</p>

        <h4 id="第一次代码-14"   >
          <a href="#第一次代码-14" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-14" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//层序遍历</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minDepth</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        Queue&lt;TreeNode&gt; queue=<span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> dept=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> dept;</span><br><span class="line">        queue.add(root);</span><br><span class="line">        <span class="keyword">while</span>(queue.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            dept++;</span><br><span class="line">            <span class="type">int</span> size=queue.size();</span><br><span class="line">            <span class="keyword">while</span>(size--&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                TreeNode node=queue.poll();</span><br><span class="line">                <span class="keyword">if</span>(node.left==<span class="literal">null</span> &amp;&amp; node.right==<span class="literal">null</span>) <span class="keyword">return</span> dept;</span><br><span class="line">                <span class="keyword">if</span>(node.left!=<span class="literal">null</span>) queue.add(node.left);</span><br><span class="line">                <span class="keyword">if</span>(node.right!=<span class="literal">null</span>) queue.add(node.right);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dept;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-14"   >
          <a href="#提交成功-14" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-14" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-12"   >
          <a href="#题解-12" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-12" class="headerlink" title="题解"></a>题解</h3>
      <p>本题目的就是找到离根节点最近的叶子结点，所以我们层序遍历找到第一个叶子结点就是离根最近的叶子结点</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minDepth</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="type">int</span> dept=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> dept;</span><br><span class="line">        </span><br><span class="line">        Queue&lt;TreeNode&gt; queue=<span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line">        queue.add(root);</span><br><span class="line">    	<span class="comment">//层序遍历</span></span><br><span class="line">        <span class="keyword">while</span>(queue.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="type">int</span> size=queue.size();</span><br><span class="line">            dept++;</span><br><span class="line">            <span class="keyword">while</span>(size--&gt;<span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                TreeNode node=queue.poll();</span><br><span class="line">                <span class="comment">//判断当前结点是不是叶子结点(左右子树为空)</span></span><br><span class="line">                <span class="keyword">if</span>(node.left==<span class="literal">null</span> &amp;&amp; node.right==<span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> dept;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(node.left!=<span class="literal">null</span>) queue.add(node.left);</span><br><span class="line">                <span class="keyword">if</span>(node.right!=<span class="literal">null</span>) queue.add(node.right);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dept;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="小结-1"   >
          <a href="#小结-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#小结-1" class="headerlink" title="小结"></a>小结</h2>
      <p>我们通过这几道题的训练可以明白和使用层序遍历，总之这些题目是大同小异。我们明白了用<strong>队列</strong>来完成<strong>广度优先搜索</strong></p>

        <h1 id="翻转二叉树"   >
          <a href="#翻转二叉树" class="heading-link"><i class="fas fa-link"></i></a><a href="#翻转二叉树" class="headerlink" title="翻转二叉树"></a>翻转二叉树</h1>
      <p>给你一棵二叉树的根节点 <code>root</code> ，翻转这棵二叉树，并返回其根节点。</p>

        <h2 id="226-翻转二叉树"   >
          <a href="#226-翻转二叉树" class="heading-link"><i class="fas fa-link"></i></a><a href="#226-翻转二叉树" class="headerlink" title="226.翻转二叉树"></a>226.翻转二叉树</h2>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/invert-binary-tree/" >LeetCode.226(easy)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-13"   >
          <a href="#第一次做-13" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-13" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;08&#x2F;29</p>

        <h4 id="第一次代码-15"   >
          <a href="#第一次代码-15" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-15" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//统一迭代法</span></span><br><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">invertTree</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="comment">//用统一迭代法(后序遍历)</span></span><br><span class="line">        Stack&lt;TreeNode&gt; stack=<span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> root;</span><br><span class="line">        stack.add(root);</span><br><span class="line">        <span class="keyword">while</span>(stack.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            TreeNode node=stack.pop();</span><br><span class="line">            <span class="keyword">if</span>(node!=<span class="literal">null</span>)&#123;</span><br><span class="line">                stack.add(node);</span><br><span class="line">                stack.add(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(node.left!=<span class="literal">null</span>) stack.add(node.left);</span><br><span class="line">                <span class="keyword">if</span>(node.right!=<span class="literal">null</span>) stack.add(node.right);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                TreeNode temp=stack.pop();</span><br><span class="line">                TreeNode tempRight=temp.right;</span><br><span class="line">                temp.right=temp.left;</span><br><span class="line">                temp.left=tempRight;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-15"   >
          <a href="#提交成功-15" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-15" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-13"   >
          <a href="#题解-13" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-13" class="headerlink" title="题解"></a>题解</h3>
      <p>这道题用前序和后序的时候可以直接交换中结点的左右子树，然后处理左右子树即可。</p>
<p>而用中序的时候有一个踩坑的顺序点，因为中序是左中右，所以处理完左子树之后就和右子树做了交换，而下一步是处理右子树就等于是又反转了一遍原先的左子树。所以这里比较绕就不用中序</p>
<p><strong>递归法</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//递归法</span></span><br><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">invertTree</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        ReverseTree(root);</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">ReverseTree</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    	<span class="comment">//处理左子树、右子树</span></span><br><span class="line">        <span class="keyword">if</span>(root.left!=<span class="literal">null</span>) ReverseTree(root.left);</span><br><span class="line">        <span class="keyword">if</span>(root.right!=<span class="literal">null</span>) ReverseTree(root.right);</span><br><span class="line">		<span class="comment">//交换左右子树</span></span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">temp</span> <span class="operator">=</span>root.right;</span><br><span class="line">        root.right=root.left;</span><br><span class="line">        root.left=temp;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>

<p><strong>非递归法</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//统一迭代法</span></span><br><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">invertTree</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="comment">//用统一迭代法(后序遍历)</span></span><br><span class="line">        Stack&lt;TreeNode&gt; stack=<span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> root;</span><br><span class="line">        stack.add(root);</span><br><span class="line">        <span class="keyword">while</span>(stack.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            TreeNode node=stack.pop();</span><br><span class="line">            <span class="keyword">if</span>(node!=<span class="literal">null</span>)&#123;</span><br><span class="line">                stack.add(node);</span><br><span class="line">                stack.add(<span class="literal">null</span>);</span><br><span class="line">				</span><br><span class="line">                <span class="comment">//添加左右子树结点</span></span><br><span class="line">                <span class="keyword">if</span>(node.left!=<span class="literal">null</span>) stack.add(node.left);</span><br><span class="line">                <span class="keyword">if</span>(node.right!=<span class="literal">null</span>) stack.add(node.right);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//node==null</span></span><br><span class="line">                TreeNode temp=stack.pop();</span><br><span class="line">                <span class="comment">//交换左右子树</span></span><br><span class="line">                TreeNode tempRight=temp.right;</span><br><span class="line">                temp.right=temp.left;</span><br><span class="line">                temp.left=tempRight;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h1 id="对称二叉树"   >
          <a href="#对称二叉树" class="heading-link"><i class="fas fa-link"></i></a><a href="#对称二叉树" class="headerlink" title="对称二叉树"></a>对称二叉树</h1>
      <p>给你一个二叉树的根节点 <code>root</code> ， 检查它是否轴对称。</p>

        <h2 id="101-对称二叉树"   >
          <a href="#101-对称二叉树" class="heading-link"><i class="fas fa-link"></i></a><a href="#101-对称二叉树" class="headerlink" title="101.对称二叉树"></a>101.对称二叉树</h2>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/symmetric-tree/" >Leetcode.101题(easy)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-14"   >
          <a href="#第一次做-14" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-14" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;08&#x2F;29</p>

        <h4 id="第一次代码-16"   >
          <a href="#第一次代码-16" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-16" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSymmetric</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line"></span><br><span class="line">        Stack&lt;TreeNode&gt; stack=<span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">        stack.add(root);</span><br><span class="line">        <span class="type">int</span> arr[]=<span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">1001</span>];</span><br><span class="line">        <span class="type">int</span> i=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(stack.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            TreeNode node=stack.pop();</span><br><span class="line">            <span class="keyword">if</span>(node!=<span class="literal">null</span>)&#123;</span><br><span class="line">                stack.add(node.left);</span><br><span class="line">                stack.add(node.right);</span><br><span class="line">                arr[i]=node.val;</span><br><span class="line">            &#125;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        ReserveTree(root);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> newArr[]=<span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">1001</span>];</span><br><span class="line">        stack.add(root);</span><br><span class="line">        <span class="type">int</span> j=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(stack.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            TreeNode node=stack.pop();</span><br><span class="line">            <span class="keyword">if</span>(node!=<span class="literal">null</span>)&#123;</span><br><span class="line">                stack.add(node.left);</span><br><span class="line">                stack.add(node.right);</span><br><span class="line">                newArr[j]=node.val;</span><br><span class="line">            &#125;</span><br><span class="line">            j++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;j;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(arr[i]!=newArr[i]) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">ReserveTree</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> ;</span><br><span class="line"></span><br><span class="line">        ReserveTree(root.left);</span><br><span class="line">        ReserveTree(root.right);</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">temp</span> <span class="operator">=</span> root.right;</span><br><span class="line">        root.right=root.left;</span><br><span class="line">        root.left=temp;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>


        <h5 id="提交错误"   >
          <a href="#提交错误" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交错误" class="headerlink" title="提交错误"></a>提交错误</h5>
      <p>CASE: root[1,0] 输出true 预期输出false</p>

        <h4 id="第二次代码-3"   >
          <a href="#第二次代码-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码-3" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSymmetric</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        Queue&lt;TreeNode&gt; queue=<span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line">        Stack&lt;TreeNode&gt; stack=<span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">        queue.add(root);</span><br><span class="line">        <span class="type">int</span> number=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(queue.size()!=<span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            </span><br><span class="line">            <span class="type">int</span> size=queue.size();</span><br><span class="line">            <span class="keyword">while</span>(size--&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                number++;</span><br><span class="line">                TreeNode node=queue.poll();</span><br><span class="line">                <span class="keyword">if</span>(node.left!=<span class="literal">null</span>) queue.add(node.left);</span><br><span class="line">                <span class="keyword">if</span>(node.right!=<span class="literal">null</span>) queue.add(node.right);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(number!=<span class="number">1</span>&amp;&amp; number%<span class="number">2</span>!=<span class="number">1</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        stack.add(root);</span><br><span class="line">        <span class="type">int</span> arr[]=<span class="keyword">new</span> <span class="title class_">int</span>[Integer.MAX_VALUE];</span><br><span class="line">        <span class="type">int</span> i=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(stack.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            TreeNode node=stack.pop();</span><br><span class="line">            <span class="keyword">if</span>(node!=<span class="literal">null</span>)&#123;</span><br><span class="line">                stack.add(node.left);</span><br><span class="line">                stack.add(node.right);</span><br><span class="line">                arr[i++]=node.val;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        ReserveTree(root);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> newArr[]=<span class="keyword">new</span> <span class="title class_">int</span>[Integer.MAX_VALUE];</span><br><span class="line">        stack.add(root);</span><br><span class="line">        <span class="type">int</span> j=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(stack.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            TreeNode node=stack.pop();</span><br><span class="line">            <span class="keyword">if</span>(node!=<span class="literal">null</span>)&#123;</span><br><span class="line">                stack.add(node.left);</span><br><span class="line">                stack.add(node.right);</span><br><span class="line">                newArr[j++]=node.val;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">          </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;j;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(arr[i]!=newArr[i]) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">ReserveTree</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> ;</span><br><span class="line"></span><br><span class="line">        ReserveTree(root.left);</span><br><span class="line">        ReserveTree(root.right);</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">temp</span> <span class="operator">=</span> root.right;</span><br><span class="line">        root.right=root.left;</span><br><span class="line">        root.left=temp;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>


        <h5 id="提交错误-1"   >
          <a href="#提交错误-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交错误-1" class="headerlink" title="提交错误"></a>提交错误</h5>
      <p>CASE:超出内存限制</p>

        <h4 id="第三次代码"   >
          <a href="#第三次代码" class="heading-link"><i class="fas fa-link"></i></a><a href="#第三次代码" class="headerlink" title="第三次代码"></a>第三次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSymmetric</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line"></span><br><span class="line">       Stack&lt;TreeNode&gt; stack=<span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">       stack.add(root);</span><br><span class="line">       ArrayList&lt;Integer&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">       <span class="keyword">while</span>(stack.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">           TreeNode node=stack.pop();</span><br><span class="line">           <span class="keyword">if</span>(node!=<span class="literal">null</span>)&#123;</span><br><span class="line">               stack.add(node.left);</span><br><span class="line">               stack.add(node.right);</span><br><span class="line">               list.add(node.val);</span><br><span class="line">           &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">               list.add(<span class="literal">null</span>);</span><br><span class="line">           &#125;</span><br><span class="line">           </span><br><span class="line">       &#125;</span><br><span class="line">       ReserveTree(root);</span><br><span class="line"></span><br><span class="line">       ArrayList&lt;Integer&gt; tempList=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">       stack.add(root);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">while</span>(stack.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">           TreeNode node=stack.pop();</span><br><span class="line">           <span class="keyword">if</span>(node!=<span class="literal">null</span>)&#123;</span><br><span class="line">               stack.add(node.left);</span><br><span class="line">               stack.add(node.right);</span><br><span class="line">               tempList.add(node.val);</span><br><span class="line">           &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">               tempList.add(<span class="literal">null</span>);</span><br><span class="line">           &#125;</span><br><span class="line">         </span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       </span><br><span class="line">       <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;list.size();i++)&#123;</span><br><span class="line">           <span class="keyword">if</span>(list.get(i)!=<span class="literal">null</span> &amp;&amp; tempList.get(i)!=<span class="literal">null</span>)</span><br><span class="line">           &#123;</span><br><span class="line">               <span class="keyword">if</span>(!list.get(i).equals(tempList.get(i))) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">if</span>(list.get(i)==<span class="literal">null</span>&amp;&amp;tempList.get(i)!=<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">           <span class="keyword">if</span>(list.get(i)!=<span class="literal">null</span>&amp;&amp;tempList.get(i)==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">ReserveTree</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">       <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> ;</span><br><span class="line"></span><br><span class="line">       ReserveTree(root.left);</span><br><span class="line">       ReserveTree(root.right);</span><br><span class="line">       <span class="type">TreeNode</span> <span class="variable">temp</span> <span class="operator">=</span> root.right;</span><br><span class="line">       root.right=root.left;</span><br><span class="line">       root.left=temp;</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-16"   >
          <a href="#提交成功-16" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-16" class="headerlink" title="提交成功"></a>提交成功</h5>
      <p>做法是先用list存放原来树的元素，然后反转之后再遍历一遍放到tempList 如果这两个集合元素是一样的说明是对称的</p>

        <h3 id="题解-14"   >
          <a href="#题解-14" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-14" class="headerlink" title="题解"></a>题解</h3>
      <p>我们这道题求一棵树是否是对称二叉树，也即只要左右子树能够相互翻转。 也即<strong>左右子树镜像</strong></p>
<p><strong>思路</strong></p>
<p>求根结点的左子树和右子树是否镜像</p>
<ul>
<li><p>如果左子树为空并且右子树为空  返回true</p>
</li>
<li><p>如果左子树不为空 右子树为空 返回false</p>
</li>
<li><p>如果左子树为空 右子树不为空 返回false</p>
</li>
<li><p>如果左右子树都不为空 但是左结点和右结点值不相等 返回false</p>
</li>
<li><p>如果左右子树不为空 且值相等 则进行判断</p>
<ul>
<li><p>判断传入的左子树的左孩子 于 传入的右子树的右孩子 是否镜像</p>
</li>
<li><p>判断传入的左子树的右孩子 于 传入的右子树的做孩子 是否镜像</p>
</li>
</ul>
</li>
<li><p>如果左右子树镜像则返回true</p>
</li>
</ul>
<p>利用后序遍历最后处理中结点</p>
<p>等于是同时<strong>遍历根节点下的左右子树</strong>，左子树的遍历是左右中，而右子树的遍历是右左中</p>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSymmetric</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">       <span class="comment">//检查左右子树是否镜像</span></span><br><span class="line">       <span class="keyword">return</span> check(root.left,root.right); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">check</span><span class="params">(TreeNode left,TreeNode right)</span>&#123;</span><br><span class="line">    	<span class="comment">//如果左右子树为空 </span></span><br><span class="line">        <span class="keyword">if</span>(left==<span class="literal">null</span>&amp;&amp; right==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="comment">//如果左子树为空 右子树不为空</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(left==<span class="literal">null</span> &amp;&amp; right!=<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		<span class="comment">//如果左子树不为空 右子树为空</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(left!=<span class="literal">null</span> &amp;&amp; right==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">//如果左右子树不为空但是值不相等</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(left.val!=right.val) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//运行到这里左右子树不为空 值也相等，判断左子树的左结点和右子树的右孩子是否相等</span></span><br><span class="line">        <span class="type">boolean</span> outCheck=check(left.left,right.right);</span><br><span class="line">        <span class="comment">//判断左子树的右节点和右子树的左结点是否相等</span></span><br><span class="line">        <span class="type">boolean</span> inCheck=check(left.right,right.left);</span><br><span class="line">        <span class="comment">//处理中结点 左右为镜像则返回true</span></span><br><span class="line">        <span class="keyword">return</span> outCheck &amp;&amp; inCheck;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br></pre></td></tr></table></div></figure>


        <h2 id="100-相同的树"   >
          <a href="#100-相同的树" class="heading-link"><i class="fas fa-link"></i></a><a href="#100-相同的树" class="headerlink" title="100.相同的树"></a>100.相同的树</h2>
      <p>给你两棵二叉树的根节点 <code>p</code> 和 <code>q</code> ，编写一个函数来检验这两棵树是否相同。</p>
<p>如果两个树在结构上相同，并且节点具有相同的值，则认为它们是相同的。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/same-tree/" >Leetcode.100题(easy)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-15"   >
          <a href="#第一次做-15" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-15" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;08&#x2F;29</p>

        <h4 id="第一次代码-17"   >
          <a href="#第一次代码-17" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-17" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSameTree</span><span class="params">(TreeNode p, TreeNode q)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(p==<span class="literal">null</span>&amp;&amp; q==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(p!=<span class="literal">null</span> &amp;&amp; q==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(p==<span class="literal">null</span> &amp;&amp; q!=<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(p.val!=q.val) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">boolean</span> leftCheck=isSameTree(p.left,q.left);</span><br><span class="line">        <span class="type">boolean</span> rightCheck=isSameTree(p.right,q.right);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> leftCheck&amp;&amp; rightCheck;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-17"   >
          <a href="#提交成功-17" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-17" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-15"   >
          <a href="#题解-15" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-15" class="headerlink" title="题解"></a>题解</h3>
      <p>求左子树和右子树是否相等</p>
<ul>
<li><p>如果左子树为空并且右子树为空  返回true</p>
</li>
<li><p>如果左子树不为空 右子树为空 返回false</p>
</li>
<li><p>如果左子树为空 右子树不为空 返回false</p>
</li>
<li><p>如果左右子树都不为空 但是左结点和右结点值不相等 返回false</p>
</li>
<li><p>如果左右子树不为空 且值相等 则进行判断</p>
<ul>
<li><p>判断传入的左子树的左孩子 于 传入的右子树的左孩子 是否镜像</p>
</li>
<li><p>判断传入的左子树的右孩子 于 传入的右子树的右孩子 是否镜像</p>
</li>
</ul>
</li>
<li><p>如果左右子树镜像则返回true</p>
</li>
</ul>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSameTree</span><span class="params">(TreeNode p, TreeNode q)</span> &#123;</span><br><span class="line">    	</span><br><span class="line">        <span class="keyword">if</span>(p==<span class="literal">null</span>&amp;&amp; q==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(p!=<span class="literal">null</span> &amp;&amp; q==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(p==<span class="literal">null</span> &amp;&amp; q!=<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(p.val!=q.val) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    	<span class="comment">//运行到这里 左子树和右子树不为空且值相等 ，判断左子树的左孩子和右子树的左孩子是否相等</span></span><br><span class="line">        <span class="type">boolean</span> leftCheck=isSameTree(p.left,q.left);</span><br><span class="line">    	<span class="comment">//判断左子树的右孩子和右子树的右孩子是否相等</span></span><br><span class="line">        <span class="type">boolean</span> rightCheck=isSameTree(p.right,q.right);</span><br><span class="line">		<span class="comment">//判断中结点</span></span><br><span class="line">        <span class="keyword">return</span> leftCheck&amp;&amp; rightCheck;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>

<p>本质上还是同时后序遍历两个子树，都是左右中</p>

        <h2 id="572-另一棵树的子树"   >
          <a href="#572-另一棵树的子树" class="heading-link"><i class="fas fa-link"></i></a><a href="#572-另一棵树的子树" class="headerlink" title="572.另一棵树的子树"></a>572.另一棵树的子树</h2>
      <p>给你两棵二叉树 <code>root</code> 和 <code>subRoot</code> 。检验 <code>root</code> 中是否包含和 <code>subRoot</code> 具有相同结构和节点值的子树。如果存在，返回 <code>true</code> ；否则，返回 <code>false</code> 。</p>
<p>二叉树 <code>tree</code> 的一棵子树包括 <code>tree</code> 的某个节点和这个节点的所有后代节点。<code>tree</code> 也可以看做它自身的一棵子树。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/subtree-of-another-tree/" >Leetcode.572题(easy)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-16"   >
          <a href="#第一次做-16" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-16" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;08&#x2F;29</p>

        <h4 id="第一次代码-18"   >
          <a href="#第一次代码-18" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-18" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSubtree</span><span class="params">(TreeNode root, TreeNode subRoot)</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> leftContains=Contains(root.left,subRoot);</span><br><span class="line">        <span class="type">boolean</span> rightContains=Contains(root.right,subRoot);</span><br><span class="line">        <span class="keyword">return</span> leftContains || rightContains;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">Contains</span><span class="params">(TreeNode node,TreeNode Root)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(node==<span class="literal">null</span>&amp;&amp; Root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(node!=<span class="literal">null</span> &amp;&amp; Root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(node==<span class="literal">null</span> &amp;&amp; Root!=<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(node.val!=Root.val)&#123;</span><br><span class="line">            Contains(node.left,Root);</span><br><span class="line">            Contains(node.right,Root);  </span><br><span class="line">        &#125;</span><br><span class="line">        Boolean left=<span class="literal">false</span>;</span><br><span class="line">        Boolean right=<span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span>(node.val==Root.val)&#123;</span><br><span class="line">            left=Contains(node.left,Root.left);</span><br><span class="line">            right=Contains(node.right,Root.right);</span><br><span class="line">              </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> left || right;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"> </span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-3"   >
          <a href="#提交失败-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-3" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE: 输入root&#x3D;[3,4,5,1,2,null,null,null,null,0] subRoot&#x3D;[4,1,2]  输出true 预期输出false</p>

        <h4 id="第二次代码-4"   >
          <a href="#第二次代码-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码-4" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSubtree</span><span class="params">(TreeNode root, TreeNode subRoot)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> contains(root,subRoot);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">contains</span><span class="params">(TreeNode node,TreeNode Root)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(node==<span class="literal">null</span> &amp;&amp; Root ==<span class="literal">null</span> ) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(node!=<span class="literal">null</span>&amp;&amp; Root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(node==<span class="literal">null</span> &amp;&amp; Root !=<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(node.val!=Root.val)&#123;</span><br><span class="line">            <span class="type">boolean</span> left=contains(node.left,Root);</span><br><span class="line">            <span class="type">boolean</span> right=contains(node.right,Root);</span><br><span class="line">            <span class="keyword">return</span> left|| right;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(node.val==Root.val)&#123;</span><br><span class="line">            <span class="type">boolean</span> left=contains(node.left,Root.left);</span><br><span class="line">            <span class="type">boolean</span> right=contains(node.right,Root.right);</span><br><span class="line">            <span class="keyword">return</span> left&amp;&amp;right;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;   </span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-4"   >
          <a href="#提交失败-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-4" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:输入root&#x3D;[1,1] subRoot&#x3D;[1]  输出false 预期输出true</p>
<p>没做出来</p>

        <h4 id="第三次代码-1"   >
          <a href="#第三次代码-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#第三次代码-1" class="headerlink" title="第三次代码"></a>第三次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSubtree</span><span class="params">(TreeNode root, TreeNode subRoot)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> SearchRoot(root,subRoot);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">SearchRoot</span><span class="params">(TreeNode root,TreeNode subRoot)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(root.val!=subRoot.val)&#123;</span><br><span class="line">            <span class="type">boolean</span> left=SearchRoot(root.left,subRoot);</span><br><span class="line">            <span class="type">boolean</span> right=SearchRoot(root.right,subRoot);</span><br><span class="line">            <span class="keyword">return</span> left || right;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> checkAll(root,subRoot);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkAll</span><span class="params">(TreeNode root,TreeNode subRoot)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>&amp;&amp;subRoot==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(root==<span class="literal">null</span> &amp;&amp; subRoot!=<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(root!=<span class="literal">null</span> &amp;&amp; subRoot==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(root.val!=subRoot.val) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">boolean</span> left=checkAll(root.left,subRoot.left);</span><br><span class="line">        <span class="type">boolean</span> right=checkAll(root.right,subRoot.right);</span><br><span class="line">        <span class="keyword">return</span> left&amp;&amp;right;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-5"   >
          <a href="#提交失败-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-5" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:[1,1] subRoot&#x3D;[1] 输出false 预期输出true</p>

        <h4 id="第四次代码"   >
          <a href="#第四次代码" class="heading-link"><i class="fas fa-link"></i></a><a href="#第四次代码" class="headerlink" title="第四次代码"></a>第四次代码</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">public boolean isSubtree(TreeNode root, TreeNode subRoot) &#123;</span><br><span class="line">        return SearchRoot(root,subRoot);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public boolean SearchRoot(TreeNode root,TreeNode subRoot)&#123;</span><br><span class="line">        if(root==null) return false;</span><br><span class="line"></span><br><span class="line">        if(root.val!=subRoot.val)&#123;</span><br><span class="line">            boolean left=SearchRoot(root.left,subRoot);</span><br><span class="line">            boolean right=SearchRoot(root.right,subRoot);</span><br><span class="line">            return left || right;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return checkAll(root,subRoot);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public boolean checkAll(TreeNode root,TreeNode subRoot)&#123;</span><br><span class="line">        if(root==null&amp;&amp;subRoot==null) return true;</span><br><span class="line">        else if(root==null &amp;&amp; subRoot!=null) return false;</span><br><span class="line">        else if(root!=null &amp;&amp; subRoot==null) return false;</span><br><span class="line">        else if(root.val!=subRoot.val) return false;</span><br><span class="line"></span><br><span class="line">        boolean left=checkAll(root.left,subRoot.left);</span><br><span class="line">        boolean right=checkAll(root.right,subRoot.right);</span><br><span class="line">        if(!(left)&amp;&amp;right)&#123;</span><br><span class="line">            if(root.left!=null)&#123;</span><br><span class="line">                return SearchRoot(root.left,subRoot);</span><br><span class="line">            &#125;else if(root.right!=null)&#123;</span><br><span class="line">                return SearchRoot(root.right,subRoot);</span><br><span class="line">            &#125;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        return left&amp;&amp;right;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-6"   >
          <a href="#提交失败-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-6" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:输入root&#x3D;[1,1,1] subRoot&#x3D;[1] 输出false 预期输出true</p>

        <h4 id="第五次代码"   >
          <a href="#第五次代码" class="heading-link"><i class="fas fa-link"></i></a><a href="#第五次代码" class="headerlink" title="第五次代码"></a>第五次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSubtree</span><span class="params">(TreeNode root, TreeNode subRoot)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> SearchRoot(root,subRoot);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">SearchRoot</span><span class="params">(TreeNode root,TreeNode subRoot)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(root.val!=subRoot.val)&#123;</span><br><span class="line">            <span class="type">boolean</span> left=SearchRoot(root.left,subRoot);</span><br><span class="line">            <span class="type">boolean</span> right=SearchRoot(root.right,subRoot);</span><br><span class="line">            <span class="keyword">return</span> left || right;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> checkAll(root,subRoot);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkAll</span><span class="params">(TreeNode root,TreeNode subRoot)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>&amp;&amp;subRoot==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(root==<span class="literal">null</span> &amp;&amp; subRoot!=<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(root!=<span class="literal">null</span> &amp;&amp; subRoot==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(root.val!=subRoot.val) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">boolean</span> left=checkAll(root.left,subRoot.left);</span><br><span class="line">        <span class="type">boolean</span> right=checkAll(root.right,subRoot.right);</span><br><span class="line">        <span class="keyword">if</span>(!(left&amp;&amp;right))&#123;</span><br><span class="line">            <span class="keyword">if</span>(root.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> SearchRoot(root.left,subRoot);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(root.right!=<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> SearchRoot(root.right,subRoot);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> left&amp;&amp;right;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-7"   >
          <a href="#提交失败-7" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-7" class="headerlink" title="提交失败"></a>提交失败</h5>
      
        <h4 id="第六次代码"   >
          <a href="#第六次代码" class="heading-link"><i class="fas fa-link"></i></a><a href="#第六次代码" class="headerlink" title="第六次代码"></a>第六次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSubtree</span><span class="params">(TreeNode root, TreeNode subRoot)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> SearchRoot(root,subRoot);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">SearchRoot</span><span class="params">(TreeNode root,TreeNode subRoot)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(root.val!=subRoot.val)&#123;</span><br><span class="line">            <span class="type">boolean</span> left=SearchRoot(root.left,subRoot);</span><br><span class="line">            <span class="type">boolean</span> right=SearchRoot(root.right,subRoot);</span><br><span class="line">            <span class="keyword">return</span> left || right;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> checkAll(root,subRoot);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkAll</span><span class="params">(TreeNode root,TreeNode subRoot)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>&amp;&amp;subRoot==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(root==<span class="literal">null</span> &amp;&amp; subRoot!=<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(root!=<span class="literal">null</span> &amp;&amp; subRoot==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(root.val!=subRoot.val) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">boolean</span> left=checkAll(root.left,subRoot.left);</span><br><span class="line">        <span class="type">boolean</span> right=checkAll(root.right,subRoot.right);</span><br><span class="line">        <span class="keyword">if</span>(!(left&amp;&amp;right))&#123;</span><br><span class="line">            </span><br><span class="line">                <span class="type">boolean</span> newLeft=SearchRoot(root.left,subRoot);</span><br><span class="line">                <span class="type">boolean</span> newRight=SearchRoot(root.right,subRoot);</span><br><span class="line">         </span><br><span class="line">            <span class="keyword">return</span> newLeft||newRight;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> left&amp;&amp;right;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-8"   >
          <a href="#提交失败-8" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-8" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:root &#x3D;[4,1,null,1,null,6,7] subRoot&#x3D;[4,1,null,6,7] 输出true 预期输出false</p>

        <h4 id="第七次代码"   >
          <a href="#第七次代码" class="heading-link"><i class="fas fa-link"></i></a><a href="#第七次代码" class="headerlink" title="第七次代码"></a>第七次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSubtree</span><span class="params">(TreeNode root, TreeNode subRoot)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> SearchRoot(root,subRoot);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">SearchRoot</span><span class="params">(TreeNode root,TreeNode subRoot)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(root.val!=subRoot.val)&#123;</span><br><span class="line">            <span class="type">boolean</span> left=SearchRoot(root.left,subRoot);</span><br><span class="line">            <span class="type">boolean</span> right=SearchRoot(root.right,subRoot);</span><br><span class="line">            <span class="keyword">return</span> left || right;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">boolean</span> result=checkAll(root,subRoot);</span><br><span class="line">        <span class="keyword">if</span>(result)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="type">boolean</span> left=SearchRoot(root.left,subRoot);</span><br><span class="line">            <span class="type">boolean</span> right=SearchRoot(root.right,subRoot);</span><br><span class="line">            <span class="keyword">return</span> left||right;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkAll</span><span class="params">(TreeNode root,TreeNode subRoot)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>&amp;&amp;subRoot==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(root==<span class="literal">null</span> &amp;&amp; subRoot!=<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(root!=<span class="literal">null</span> &amp;&amp; subRoot==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(root.val!=subRoot.val) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">boolean</span> left=checkAll(root.left,subRoot.left);</span><br><span class="line">        <span class="type">boolean</span> right=checkAll(root.right,subRoot.right);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> left&amp;&amp;right;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-18"   >
          <a href="#提交成功-18" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-18" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-16"   >
          <a href="#题解-16" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-16" class="headerlink" title="题解"></a>题解</h3>
      <p>利用双递归，一个方法来判断当前树是否是相同的子树，一个方法来判断值相同的情况下结构是否相同</p>
<p><strong>思路</strong></p>
<p>方法isSubtree 判断树是否包含子树</p>
<ul>
<li><p>判断当前树是否<strong>是</strong>子树subRoot</p>
</li>
<li><p>判断左子树是否<strong>包含</strong>子树subRoot</p>
</li>
<li><p>判断右子树是否<strong>包含</strong>子树subRoot</p>
</li>
</ul>
<p>方法isSameTree</p>
<ul>
<li>判断当前值是否和子树值相同</li>
<li>判断左子树是否相同</li>
<li>判断右子树是否相同</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSubtree</span><span class="params">(TreeNode root, TreeNode subRoot)</span> &#123;</span><br><span class="line">    	<span class="comment">//如果root或者subRoot只有一个为空 那么就一定root不包含subroot</span></span><br><span class="line">    	<span class="keyword">if</span>(root==<span class="literal">null</span> &amp;&amp; subRoot==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span> || subRoot==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> </span><br><span class="line">              isSameTree(root,subRoot) <span class="comment">//判断当前树是否是子树subRoot</span></span><br><span class="line">            ||isSubtree(root.left,subRoot) <span class="comment">//判断左子树是否包含subRoot</span></span><br><span class="line">            ||isSubtree(root.right,subRoot); <span class="comment">//判断右子树是否包含subRoot</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSameTree</span><span class="params">(TreeNode root,TreeNode subRoot)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span> &amp;&amp; subRoot==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(root==<span class="literal">null</span>|| subRoot==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">//只有值相同且左右子树结构也相同才会返回true</span></span><br><span class="line">        <span class="keyword">return</span> root.val==subRoot.val</span><br><span class="line">                &amp;&amp; isSameTree(root.left,subRoot.left) </span><br><span class="line">                &amp;&amp; isSameTree(root.right,subRoot.right); </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h1 id="二叉树的最大深度"   >
          <a href="#二叉树的最大深度" class="heading-link"><i class="fas fa-link"></i></a><a href="#二叉树的最大深度" class="headerlink" title="二叉树的最大深度"></a>二叉树的最大深度</h1>
      <p>这道题其实在<strong>层序遍历</strong>的时候接触过了，所以这道求二叉树最大深度的做题过程会放在层序遍历的那块中</p>

        <h2 id="104-二叉树的最大深度-1"   >
          <a href="#104-二叉树的最大深度-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#104-二叉树的最大深度-1" class="headerlink" title="104.二叉树的最大深度"></a>104.二叉树的最大深度</h2>
      <p>给定一个二叉树 <code>root</code> ，返回其最大深度。</p>
<p>二叉树的 <strong>最大深度</strong> 是指从根节点到最远叶子节点的最长路径上的节点数。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/maximum-depth-of-binary-tree/" >Leetcode.104题(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="题解-17"   >
          <a href="#题解-17" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-17" class="headerlink" title="题解"></a>题解</h3>
      
        <h4 id="层序遍历"   >
          <a href="#层序遍历" class="heading-link"><i class="fas fa-link"></i></a><a href="#层序遍历" class="headerlink" title="层序遍历"></a>层序遍历</h4>
      <p>每遍历到一层，深度计数器++即可，然后最后返回计数器的值</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxDepth</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        Queue&lt;TreeNode&gt; queue=<span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> dept=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> dept;</span><br><span class="line">        queue.add(root);</span><br><span class="line">        <span class="keyword">while</span>(queue.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            dept++;</span><br><span class="line">            <span class="type">int</span> size=queue.size();</span><br><span class="line">            <span class="keyword">while</span>(size--&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                TreeNode node=queue.poll();</span><br><span class="line">                <span class="keyword">if</span>(node.left!=<span class="literal">null</span>) queue.add(node.left);</span><br><span class="line">                <span class="keyword">if</span>(node.right!=<span class="literal">null</span>) queue.add(node.right);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dept;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h4 id="递归遍历"   >
          <a href="#递归遍历" class="heading-link"><i class="fas fa-link"></i></a><a href="#递归遍历" class="headerlink" title="递归遍历"></a>递归遍历</h4>
      <p>首先我们先要理解，树的高度和树的深度的意义：</p>
<ul>
<li>高度： 某个结点到子叶结点的距离</li>
<li>深度：某个结点到根节点的距离</li>
</ul>
<p>如图所示一颗二叉树的深度和高度的关系</p>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="https://images-kkblog.oss-cn-hangzhou.aliyuncs.com/image-20230830094022228.png"  alt="高度和深度关系">
      </p>
<p>那么本题就能知道其实根节点的高度也是最大深度</p>
<p>我们通过递归来求树的深度的话，我们选用哪种递归方式比较好求？ 答案是<strong>后序遍历</strong>，因为后序遍历是<strong>左右中</strong>，可以获取到左右子树的高度再+1就能知道本结点的高度。</p>
<p><strong>实现</strong></p>
<ul>
<li><p>明确递归的参数以及返回参数：需传入结点，返回高度</p>
</li>
<li><p>明确递归的结束条件： 结束当遍历到NULL结点时，返回高度为0  那么就能保证子叶结点高度为1</p>
</li>
<li><p>单层遍历要做的： 遍历获取左子树和右子树的高度，然后取最大值+1 就代表本结点的高度</p>
</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxDepth</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getHight(root);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getHight</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> leftHight=getHight(root.left);   <span class="comment">//遍历左子树</span></span><br><span class="line">        <span class="type">int</span> rightHight=getHight(root.right); <span class="comment">//遍历右子树</span></span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> rootHight=leftHight&gt;rightHight? leftHight + <span class="number">1</span> : rightHight + <span class="number">1</span>; <span class="comment">//处理中结点</span></span><br><span class="line">        <span class="keyword">return</span> rootHight;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>

<p><strong>精简代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxDepth</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getHight(root);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getHight</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span>  Math.max(getHight(root.left),getHight(root.right))+<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="559-N叉数的最大深度"   >
          <a href="#559-N叉数的最大深度" class="heading-link"><i class="fas fa-link"></i></a><a href="#559-N叉数的最大深度" class="headerlink" title="559.N叉数的最大深度"></a>559.N叉数的最大深度</h2>
      <p>给定一个 N 叉树，找到其最大深度。</p>
<p>最大深度是指从根节点到最远叶子节点的最长路径上的节点总数。</p>
<p>N 叉树输入按层序遍历序列化表示，每组子节点由空值分隔。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/maximum-depth-of-n-ary-tree/" >Leetcode.559(easy)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-17"   >
          <a href="#第一次做-17" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-17" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;08&#x2F;30</p>

        <h4 id="第一次代码-19"   >
          <a href="#第一次代码-19" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-19" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxDepth</span><span class="params">(Node root)</span> &#123;</span><br><span class="line">        Queue&lt;Node&gt; queue=<span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> dept=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> dept;</span><br><span class="line"></span><br><span class="line">        queue.add(root);</span><br><span class="line">        <span class="keyword">while</span>(queue.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="type">int</span> size=queue.size();</span><br><span class="line">            dept++;</span><br><span class="line">            <span class="keyword">while</span>(size--&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                Node node=queue.poll();</span><br><span class="line">                <span class="keyword">for</span>(Node n: node.children)&#123;</span><br><span class="line">                    queue.add(n);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dept;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-19"   >
          <a href="#提交成功-19" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-19" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-18"   >
          <a href="#题解-18" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-18" class="headerlink" title="题解"></a>题解</h3>
      
        <h4 id="层序遍历-1"   >
          <a href="#层序遍历-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#层序遍历-1" class="headerlink" title="层序遍历"></a>层序遍历</h4>
      <p>思路：统计层数，每层将每个结点下的children集合数据添加到队列中</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxDepth</span><span class="params">(Node root)</span> &#123;</span><br><span class="line">        Queue&lt;Node&gt; queue=<span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> dept=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> dept;</span><br><span class="line"></span><br><span class="line">        queue.add(root);</span><br><span class="line">        <span class="keyword">while</span>(queue.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="type">int</span> size=queue.size();</span><br><span class="line">            dept++;</span><br><span class="line">            <span class="keyword">while</span>(size--&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                Node node=queue.poll();</span><br><span class="line">                <span class="comment">//添加子结点入队</span></span><br><span class="line">                <span class="keyword">for</span>(Node n: node.children)&#123;</span><br><span class="line">                    queue.add(n);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dept;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h4 id="递归遍历-1"   >
          <a href="#递归遍历-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#递归遍历-1" class="headerlink" title="递归遍历"></a>递归遍历</h4>
      <p>思想：当传入一个结点Root，先获取子结点的最大高度，然后最大高度++返回即是本结点高度</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxDepth</span><span class="params">(Node root)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getHight(root);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getHight</span><span class="params">(Node root)</span>&#123;</span><br><span class="line">        <span class="comment">//空节点高度为0</span></span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//叶子结点高度为1</span></span><br><span class="line">        <span class="keyword">if</span>(root.children.size()==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> high=<span class="number">0</span>;</span><br><span class="line">        <span class="comment">//统计本结点下的子结点最大高度</span></span><br><span class="line">        <span class="keyword">for</span>(Node n:root.children)&#123;</span><br><span class="line">           high=Math.max(getHight(n),high);</span><br><span class="line">        &#125;</span><br><span class="line">        high++;</span><br><span class="line">        <span class="keyword">return</span> high;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h1 id="二叉树的最小深度"   >
          <a href="#二叉树的最小深度" class="heading-link"><i class="fas fa-link"></i></a><a href="#二叉树的最小深度" class="headerlink" title="二叉树的最小深度"></a>二叉树的最小深度</h1>
      <p>这道题其实也在<strong>层序遍历</strong>的时候接触过了，所以这道题的做题过程也会放在层序遍历的那块中</p>

        <h2 id="111-二叉树的最小深度-1"   >
          <a href="#111-二叉树的最小深度-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#111-二叉树的最小深度-1" class="headerlink" title="111.二叉树的最小深度"></a>111.二叉树的最小深度</h2>
      <p>给定一个二叉树，找出其最小深度。</p>
<p>最小深度是从根节点到最近叶子节点的最短路径上的节点数量。</p>
<p><strong>说明：</strong>叶子节点是指没有子节点的节点。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/minimum-depth-of-binary-tree/" >Leetcode.111题(easy)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="题解-19"   >
          <a href="#题解-19" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-19" class="headerlink" title="题解"></a>题解</h3>
      
        <h4 id="层序遍历-2"   >
          <a href="#层序遍历-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#层序遍历-2" class="headerlink" title="层序遍历"></a>层序遍历</h4>
      <p>思路：层序遍历，当找到第一个叶子结点，返回此时层数也就是最小深度</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minDepth</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        Queue&lt;TreeNode&gt; queue=<span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> dept=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> dept;</span><br><span class="line">        queue.add(root);</span><br><span class="line">        <span class="keyword">while</span>(queue.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            dept++;</span><br><span class="line">            <span class="type">int</span> size=queue.size();</span><br><span class="line">            <span class="keyword">while</span>(size--&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                TreeNode node=queue.poll();</span><br><span class="line">                <span class="keyword">if</span>(node.left==<span class="literal">null</span> &amp;&amp; node.right==<span class="literal">null</span>) <span class="keyword">return</span> dept;</span><br><span class="line">                <span class="keyword">if</span>(node.left!=<span class="literal">null</span>) queue.add(node.left);</span><br><span class="line">                <span class="keyword">if</span>(node.right!=<span class="literal">null</span>) queue.add(node.right);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dept;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h4 id="递归遍历-2"   >
          <a href="#递归遍历-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#递归遍历-2" class="headerlink" title="递归遍历"></a>递归遍历</h4>
      <p>思路：我们用后序遍历，求得左右子树的最小高度，然后+1就是每个结点的最小高度</p>
<p><strong>实现</strong></p>
<ul>
<li><p>递归的传入参数以及返回值：传入TreeNode结点，返回值为结点的最小高度</p>
</li>
<li><p>递归的结束条件：当root&#x3D;&#x3D;null 说明上一个结点是叶子结点，返回高度0</p>
</li>
<li><p>单层递归逻辑：获取左右子树的最小高度，然后最小高度+1就是本结点的最小高度</p>
<ul>
<li><p>当左子树为空右子树不为空，那么最小高度应该是右子树的高度+1</p>
</li>
<li><p>当左子树不为空右子树为空，那么最小高度应该是左子树的高度+1</p>
</li>
<li><p>当左右子树都不为空，那么最小高度是左右子树的最小高度+1</p>
</li>
</ul>
</li>
</ul>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getHight</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> leftHight=getHight(root.left);</span><br><span class="line">        <span class="type">int</span> rightHight=getHight(root.right);</span><br><span class="line">        ...</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></div></figure>

<p>获取左子树和右子树的高度，然后进行左右子树的判断 如下图分析本结点的最小高度</p>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="https://images-kkblog.oss-cn-hangzhou.aliyuncs.com/image-20230830111621147.png"  alt="二叉树的最小深度">
      </p>
<p>因此完整代码应该如下</p>
<p><strong>完整代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minDepth</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> getHight(root);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getHight</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">       <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">       <span class="type">int</span> leftHight=getHight(root.left);</span><br><span class="line">       <span class="type">int</span> rightHight=getHight(root.right);</span><br><span class="line">    	<span class="comment">//左子树为空 那么本结点最小高度应该是右子树高度+1</span></span><br><span class="line">       <span class="keyword">if</span>(root.left==<span class="literal">null</span>) <span class="keyword">return</span> rightHight+<span class="number">1</span>;</span><br><span class="line">       <span class="comment">//右子树为空 本结点最小高度是左子树高度+1</span></span><br><span class="line">       <span class="keyword">if</span>(root.right==<span class="literal">null</span>) <span class="keyword">return</span> leftHight+<span class="number">1</span>;</span><br><span class="line">       </span><br><span class="line">       <span class="comment">//左右子树不为空</span></span><br><span class="line">       <span class="keyword">return</span> leftHight&lt;rightHight? leftHight+<span class="number">1</span>: rightHight+<span class="number">1</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></div></figure>



<p><strong>精简代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minDepth</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> getHight(root);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getHight</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">       <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">       <span class="keyword">if</span>(root.left==<span class="literal">null</span>) <span class="keyword">return</span> getHight(root.right)+<span class="number">1</span>;</span><br><span class="line">       <span class="keyword">if</span>(root.right==<span class="literal">null</span> ) <span class="keyword">return</span> getHight(root.left)+<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> Math.min(getHight(root.left),getHight(root.right))+<span class="number">1</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></div></figure>


        <h1 id="完全二叉树的节点个数"   >
          <a href="#完全二叉树的节点个数" class="heading-link"><i class="fas fa-link"></i></a><a href="#完全二叉树的节点个数" class="headerlink" title="完全二叉树的节点个数"></a>完全二叉树的节点个数</h1>
      <p>给你一棵 <strong>完全二叉树</strong> 的根节点 <code>root</code> ，求出该树的节点个数。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%AE%8C%E5%85%A8%E4%BA%8C%E5%8F%89%E6%A0%91/7773232?fr=aladdin" >完全二叉树</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> 的定义如下：在完全二叉树中，除了最底层节点可能没填满外，其余每层节点数都达到最大值，并且最下面一层的节点都集中在该层最左边的若干位置。若最底层为第 <code>h</code> 层，则该层包含 <code>1~ 2h</code> 个节点。</p>

        <h2 id="222-完全二叉树的节点个数"   >
          <a href="#222-完全二叉树的节点个数" class="heading-link"><i class="fas fa-link"></i></a><a href="#222-完全二叉树的节点个数" class="headerlink" title="222.完全二叉树的节点个数"></a>222.完全二叉树的节点个数</h2>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/count-complete-tree-nodes/" >Leetcode.222题(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-18"   >
          <a href="#第一次做-18" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-18" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;08&#x2F;31</p>

        <h4 id="第一次代码-20"   >
          <a href="#第一次代码-20" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-20" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">countNodes</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="type">int</span> number=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> number;</span><br><span class="line">        Queue&lt;TreeNode&gt; queue=<span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line">        queue.add(root);</span><br><span class="line">        <span class="keyword">while</span>(queue.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="type">int</span> size=queue.size();</span><br><span class="line">            <span class="keyword">while</span>(size--&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                number++;</span><br><span class="line">                TreeNode node= queue.poll();</span><br><span class="line">                <span class="keyword">if</span>(node.left!=<span class="literal">null</span>) queue.add(node.left);</span><br><span class="line">                <span class="keyword">if</span>(node.right!=<span class="literal">null</span>) queue.add(node.right);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> number;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-20"   >
          <a href="#提交成功-20" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-20" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-20"   >
          <a href="#题解-20" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-20" class="headerlink" title="题解"></a>题解</h3>
      <p><strong>层序遍历</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">countNodes</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="type">int</span> number=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> number;</span><br><span class="line">        Queue&lt;TreeNode&gt; queue=<span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line">        queue.add(root);</span><br><span class="line">        <span class="keyword">while</span>(queue.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="type">int</span> size=queue.size();</span><br><span class="line">            <span class="keyword">while</span>(size--&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="comment">//结点数++</span></span><br><span class="line">                number++;</span><br><span class="line">                TreeNode node= queue.poll();</span><br><span class="line">                <span class="keyword">if</span>(node.left!=<span class="literal">null</span>) queue.add(node.left);</span><br><span class="line">                <span class="keyword">if</span>(node.right!=<span class="literal">null</span>) queue.add(node.right);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> number;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>

<p><strong>递归遍历</strong></p>
<p><em>普通二叉树统计结点个数利用前中后序都可以(这里代码是后序)</em></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">countNodes</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> countTree(root);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">countTree</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> leftCount=countTree(root.left);</span><br><span class="line">        <span class="type">int</span> rightCount=countTree(root.right);</span><br><span class="line">        <span class="keyword">return</span> leftCount+rightCount+<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>



<p><em>利用完全二叉树的特性</em></p>
<p>思路</p>
<ul>
<li>因为完全二叉树除了最后一层其他都是满二叉树，所以如果一个二叉树是满二叉树的话 那它的结点个数为2^n -1 个，n为左右子树的深度，而获取左右子树的深度则只需要遍历左子树外侧和右子树外侧</li>
<li>如果一个树不是满二叉树的话，那么统计左右两边子树的个数</li>
</ul>
<p><strong>实现</strong></p>
<ul>
<li><p>递归遍历的返回值和参数：返回值是结点数，参数是传入的根节点</p>
</li>
<li><p>递归遍历的结束条件：</p>
<ul>
<li><p>如果root&#x3D;&#x3D;null 说明是空节点，上一个结点是叶子结点，返回0</p>
</li>
<li><p>如果左子树深度和右子树深度一致，说明是满二叉树，返回2^n-1个结点数(利用位运算 2&lt;&lt;n -1)</p>
<ul>
<li><p>如何获取左右子树深度</p>
</li>
<li><p>左子树深度，定义一个left指向左子树，然后一直往左子树指，当非空深度+1</p>
</li>
<li><p>右子树深度，定义一个right指向右子树，然后一直往右子树指，当非空深度+1</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>单层递归的逻辑：</p>
<p>说明这棵完全二叉树不是满二叉树，那么统计左右子树的节点个数，最后返回左右子树结点数之和+1</p>
</li>
</ul>
<blockquote>
<p>这里获取左右子树深度只搜索子树外侧，不搜索内侧</p>
</blockquote>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="https://images-kkblog.oss-cn-hangzhou.aliyuncs.com/image-20230831100628439.png"  alt="统计完全二叉树结点个数">
      </p>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">countNodes</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getNumber(root);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getNumber</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">        <span class="comment">//空结点</span></span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//指向左子树，指向右子树</span></span><br><span class="line">        TreeNode left=root.left;</span><br><span class="line">        TreeNode right=root.right;</span><br><span class="line">        <span class="comment">//统计深度，左指针一直往左子树的外侧指</span></span><br><span class="line">        <span class="type">int</span> leftDept=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> rightDept=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(left!=<span class="literal">null</span>) &#123;</span><br><span class="line">            left=left.left;</span><br><span class="line">            leftDept++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//右指针一直往右子树的外侧指</span></span><br><span class="line">        <span class="keyword">while</span>(right!=<span class="literal">null</span>)&#123;</span><br><span class="line">            right=right.right;</span><br><span class="line">            rightDept++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//如果左右子树深度相同，说明是满二叉树</span></span><br><span class="line">        <span class="keyword">if</span>(leftDept==rightDept) <span class="keyword">return</span> (<span class="number">2</span>&lt;&lt;leftDept)-<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//不是满二叉树统计左右子树结点数之和+1</span></span><br><span class="line">        <span class="type">int</span> leftNumber=getNumber(root.left);</span><br><span class="line">        <span class="type">int</span> rightNumber=getNumber(root.right);</span><br><span class="line">        <span class="keyword">return</span> leftNumber+rightNumber+<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h1 id="平衡二叉树"   >
          <a href="#平衡二叉树" class="heading-link"><i class="fas fa-link"></i></a><a href="#平衡二叉树" class="headerlink" title="平衡二叉树"></a>平衡二叉树</h1>
      <p>给定一个二叉树，判断它是否是高度平衡的二叉树。</p>
<p>本题中，一棵高度平衡二叉树定义为：</p>
<blockquote>
<p>一个二叉树<em>每个节点</em> 的左右两个子树的高度差的绝对值不超过 1 。</p>
</blockquote>

        <h2 id="110-平衡二叉树"   >
          <a href="#110-平衡二叉树" class="heading-link"><i class="fas fa-link"></i></a><a href="#110-平衡二叉树" class="headerlink" title="110.平衡二叉树"></a>110.平衡二叉树</h2>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/balanced-binary-tree/" >Leetcode.110题(平衡二叉树)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-19"   >
          <a href="#第一次做-19" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-19" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;08&#x2F;31</p>

        <h4 id="第一次代码-21"   >
          <a href="#第一次代码-21" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-21" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isBalanced</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="type">int</span> rootBalanced=getHight(root);</span><br><span class="line">        Boolean leftBalanced=isBalanced(root.left);</span><br><span class="line">        Boolean rightBalanced=isBalanced(root.right);</span><br><span class="line">        <span class="keyword">return</span> rootBalanced&lt;=<span class="number">1</span> &amp;&amp; leftBalanced &amp;&amp; rightBalanced;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getHight</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> leftHight=getHight(root.left);</span><br><span class="line">        <span class="type">int</span> rightHight=getHight(root.right);</span><br><span class="line">        <span class="type">int</span> absoluteHight=leftHight-rightHight;</span><br><span class="line">        <span class="keyword">return</span> absoluteHight&gt; <span class="number">0</span> ? absoluteHight : -<span class="number">1</span> * absoluteHight;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-9"   >
          <a href="#提交失败-9" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-9" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>无论什么测试案例都会一直返回true，通过debug查找到原来是getHight这个方法有问题，左右子树的深度会一直是0，因为单层逻辑没有对数据进行一个加减，所以获取高度绝对值不能放到getHight方法中，getHight就只做一个获取高度的逻辑就行</p>

        <h4 id="第二次代码-5"   >
          <a href="#第二次代码-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码-5" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isBalanced</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="type">int</span> leftHight=getHight(root.left);</span><br><span class="line">        <span class="type">int</span> rightHight=getHight(root.right);</span><br><span class="line">        <span class="type">int</span> rootBalanced=leftHight&gt;rightHight ? </span><br><span class="line">            leftHight-rightHight : rightHight-leftHight;</span><br><span class="line">        Boolean leftBalanced=isBalanced(root.left);</span><br><span class="line">        Boolean rightBalanced=isBalanced(root.right);</span><br><span class="line">        <span class="keyword">return</span> rootBalanced&lt;=<span class="number">1</span> &amp;&amp; leftBalanced &amp;&amp; rightBalanced;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getHight</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> leftHight=getHight(root.left);</span><br><span class="line">        <span class="type">int</span> rightHight=getHight(root.right);</span><br><span class="line">        <span class="keyword">return</span> leftHight&gt;rightHight ? leftHight+<span class="number">1</span>:rightHight+<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-21"   >
          <a href="#提交成功-21" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-21" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-21"   >
          <a href="#题解-21" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-21" class="headerlink" title="题解"></a>题解</h3>
      <p>思路：我们可以在求高度的时候定义一个值-1，来代表左右子树其中之一不是平衡二叉树，那么整棵树就不会是平衡二叉树，于是-1就一直往根节点传，如果是平衡二叉树就求出当前结点高度，然后传给父节点由父节点进行比较左右子树结点高度是否绝对值是否超过1</p>
<p><strong>实现</strong></p>
<ul>
<li><p>递归遍历的参数和返回值：返回值为高度，传入参数为根节点</p>
<ul>
<li>高度如果为-1 那么说明不是平衡二叉树</li>
<li>高度如果不为-1 那么就说是平衡二叉树</li>
</ul>
</li>
<li><p>递归遍历的结束条件</p>
<ul>
<li>如果root&#x3D;&#x3D;null 返回高度0</li>
<li>如果左&#x2F;右子树高度为-1 则返回-1一直到根节点 代表不是平衡二叉树</li>
<li>如果左右子树高度差超过1 则返回-1到根节点</li>
</ul>
</li>
<li><p>递归遍历的单层逻辑</p>
<p>获取左右子树高度，如果左右子树高度不超过1，那么则返回左右子树最大高度+1</p>
</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isBalanced</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">	   <span class="comment">//如果传递上来的高度是-1 说明不是平衡二叉树，其他高度都是平衡二叉树</span></span><br><span class="line">       <span class="keyword">return</span> getHight(root)!=-<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getHight</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//获取左子树高度，如果左子树为-1说明左子树不是平衡二叉树往上传递-1 下同</span></span><br><span class="line">        <span class="type">int</span> leftHight=getHight(root.left);</span><br><span class="line">        <span class="keyword">if</span>(leftHight==-<span class="number">1</span>) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> rightHight=getHight(root.right);</span><br><span class="line">        <span class="keyword">if</span>(rightHight==-<span class="number">1</span>) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">absoluteHight</span></span><br><span class="line">            <span class="operator">=</span>leftHight&gt;rightHight ? leftHight-rightHight: rightHight-leftHight;</span><br><span class="line">        <span class="comment">//如果高度差超过-1 那么就不是平衡二叉树</span></span><br><span class="line">        <span class="keyword">if</span>(absoluteHight&gt;<span class="number">1</span>) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//是平衡二叉树往上传高度</span></span><br><span class="line">        <span class="keyword">return</span> Math.max(leftHight,rightHight)+<span class="number">1</span>; </span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h1 id="二叉树的所有路径"   >
          <a href="#二叉树的所有路径" class="heading-link"><i class="fas fa-link"></i></a><a href="#二叉树的所有路径" class="headerlink" title="二叉树的所有路径"></a>二叉树的所有路径</h1>
      <p>给你一个二叉树的根节点 <code>root</code> ，按 <strong>任意顺序</strong> ，返回所有从根节点到叶子节点的路径。</p>
<p><strong>叶子节点</strong> 是指没有子节点的节点。</p>

        <h2 id="257-二叉树的所有路径"   >
          <a href="#257-二叉树的所有路径" class="heading-link"><i class="fas fa-link"></i></a><a href="#257-二叉树的所有路径" class="headerlink" title="257.二叉树的所有路径"></a>257.二叉树的所有路径</h2>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/binary-tree-paths/" >Leetcode.257题(easy)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-20"   >
          <a href="#第一次做-20" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-20" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;09&#x2F;01</p>

        <h4 id="第一次代码-22"   >
          <a href="#第一次代码-22" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-22" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;String&gt; <span class="title function_">binaryTreePaths</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getSearch(root);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">getSearch</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">        List&lt;String&gt; result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> result;</span><br><span class="line">        </span><br><span class="line">        StringBuilder sb=<span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        sb.append(root.val); <span class="comment">//中</span></span><br><span class="line"></span><br><span class="line">        List&lt;String&gt; leftSearch=getSearch(root.left);</span><br><span class="line">        List&lt;String&gt; rightSearch=getSearch(root.right);</span><br><span class="line">        <span class="keyword">if</span>(leftSearch!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span>(String s:leftSearch)&#123;</span><br><span class="line">                result.add(sb.toString()+<span class="string">&quot;-&gt;&quot;</span>+s);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">     	<span class="keyword">if</span>(rightSearch!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span>(String s:rightSearch)&#123;</span><br><span class="line">                result.add(sb.toString()+<span class="string">&quot;-&gt;&quot;</span>+s);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-10"   >
          <a href="#提交失败-10" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-10" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE: 返回值一直是[] ，一直是空集合返回</p>

        <h4 id="第二次代码-6"   >
          <a href="#第二次代码-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码-6" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;String&gt; <span class="title function_">binaryTreePaths</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getSearch(root);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">getSearch</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">        List&lt;String&gt; result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> result;</span><br><span class="line">        </span><br><span class="line">        StringBuilder sb=<span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        sb.append(root.val); <span class="comment">//中</span></span><br><span class="line"></span><br><span class="line">        List&lt;String&gt; leftSearch=getSearch(root.left);</span><br><span class="line">        List&lt;String&gt; rightSearch=getSearch(root.right);</span><br><span class="line">        <span class="comment">//当左右子树路径有一个不为空则要添加到result中</span></span><br><span class="line">        <span class="keyword">if</span>(leftSearch.size()!=<span class="number">0</span>||rightSearch.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span>(String s:leftSearch)</span><br><span class="line">            result.add(sb.toString()+<span class="string">&quot;-&gt;&quot;</span>+s);</span><br><span class="line">            <span class="keyword">for</span>(String s:rightSearch)&#123;</span><br><span class="line">            result.add(sb.toString()+<span class="string">&quot;-&gt;&quot;</span>+s);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//添加result当前数据</span></span><br><span class="line">            result.add(sb.toString());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-22"   >
          <a href="#提交成功-22" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-22" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-22"   >
          <a href="#题解-22" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-22" class="headerlink" title="题解"></a>题解</h3>
      <p>思路：遍历方式选用前序遍历(中左右)，因为父节点要指向子结点所以采用前序遍历，同时递归的时候要进行一个<strong>回溯</strong>操作。</p>
<p><strong>实现</strong></p>
<ul>
<li><p>选用前序遍历，定义一个result用于装结果集，定义一个path用于表示单层路径</p>
</li>
<li><p>pathGet方法用递归</p>
<ul>
<li>递归的参数和返回类型：递归参数path：单层路径，result：结果集，root：结点</li>
<li>递归的结束条件：当root是叶子结点即可以收获结果集，添加路径到result中。也即叶子结点是left&#x3D;&#x3D;null&amp;&amp;right&#x3D;&#x3D;null</li>
<li>递归的单层逻辑：非叶子结点<ul>
<li>如果左子树不为空则向左收集路径，递归结束调用remove删除最后一个元素进行回溯</li>
<li>如果右子树不为空则向右收集路径，递归结束后调用remove删除最后一个元素进行回溯</li>
</ul>
</li>
</ul>
</li>
<li><p>注意点</p>
<ul>
<li>path要在判断是否为叶子结点之前收集root的数据，因为调用方法时root为叶子结点就结束了，不可能传入空结点所以不用判空。</li>
<li>当向左向右递归结束之后都要回溯数据：删除path路径的最后一个数据，也即左右子树数据</li>
<li>path中的数据是存放的数据，如1-&gt;3-&gt;5存放到path中是135，所以要进行一个拼接再添加到结果集中</li>
</ul>
</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;String&gt; <span class="title function_">binaryTreePaths</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    	<span class="comment">//用于接收结果集</span></span><br><span class="line">        List&lt;String&gt; result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//用于表示单层路径</span></span><br><span class="line">    	List&lt;String&gt; path=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        pathGet(root,path,result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pathGet</span><span class="params">(TreeNode root,List&lt;String&gt; path,List&lt;String&gt; result)</span>&#123;</span><br><span class="line"></span><br><span class="line">        path.add(root.val+<span class="string">&quot;&quot;</span>);<span class="comment">//中</span></span><br><span class="line">        <span class="keyword">if</span>(root.left==<span class="literal">null</span> &amp;&amp; root.right==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">//如果是叶子结点，所以收获结果集。拼接path中的路径  </span></span><br><span class="line">            StringBuilder sb=<span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">            <span class="comment">//遍历到倒数第二个元素，都用元素+“-&gt;”拼接，最后一个元素最后直接拼接</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;path.size()-<span class="number">1</span>;i++)&#123;</span><br><span class="line">                sb.append(path.get(i)+<span class="string">&quot;-&gt;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            sb.append(root.val);</span><br><span class="line">            <span class="comment">//添加到结果集中</span></span><br><span class="line">            result.add(sb.toString());</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//如果左子树不为空，向左收获结果，然后回溯pop掉左子树数据</span></span><br><span class="line">        <span class="keyword">if</span>(root.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">            pathGet(root.left,path,result);</span><br><span class="line">            path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//下同 向右子树收集结果结束递归后回溯</span></span><br><span class="line">        <span class="keyword">if</span>(root.right!=<span class="literal">null</span>)&#123;</span><br><span class="line">            pathGet(root.right,path,result);</span><br><span class="line">            path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h1 id="左叶子之和"   >
          <a href="#左叶子之和" class="heading-link"><i class="fas fa-link"></i></a><a href="#左叶子之和" class="headerlink" title="左叶子之和"></a>左叶子之和</h1>
      <p>给定二叉树的根节点 <code>root</code> ，返回所有左叶子之和。</p>

        <h2 id="404-左叶子之和"   >
          <a href="#404-左叶子之和" class="heading-link"><i class="fas fa-link"></i></a><a href="#404-左叶子之和" class="headerlink" title="404.左叶子之和"></a>404.左叶子之和</h2>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/sum-of-left-leaves/" >Leetcode.404题(easy)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-21"   >
          <a href="#第一次做-21" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-21" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;09&#x2F;01</p>

        <h4 id="第一次代码-23"   >
          <a href="#第一次代码-23" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-23" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">sumOfLeftLeaves</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">       <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">       <span class="keyword">return</span> getSum(root,sum);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getSum</span><span class="params">(TreeNode root,<span class="type">int</span> sum)</span>&#123;</span><br><span class="line">       </span><br><span class="line">       <span class="keyword">if</span>(root.left==<span class="literal">null</span> &amp;&amp; root.right==<span class="literal">null</span>)</span><br><span class="line">       <span class="keyword">return</span> sum=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">       <span class="type">int</span> left=getSum(root.left,sum);</span><br><span class="line">       <span class="type">int</span> right=getSum(root.right,sum);</span><br><span class="line"></span><br><span class="line">       sum+=left+right+ root.left.val;</span><br><span class="line">       <span class="keyword">return</span> sum;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交错误-2"   >
          <a href="#提交错误-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交错误-2" class="headerlink" title="提交错误"></a>提交错误</h5>
      <p>空指针异常，没有root.left</p>

        <h4 id="第二次代码-7"   >
          <a href="#第二次代码-7" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码-7" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">sumOfLeftLeaves</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> getSum(root,sum);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getSum</span><span class="params">(TreeNode root,<span class="type">int</span> sum)</span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(root.left==<span class="literal">null</span> &amp;&amp; root.right==<span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">return</span> sum=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> left=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> right=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(root.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">        left=getSum(root.left,sum);</span><br><span class="line">        sum+=root.left.val;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(root.right!=<span class="literal">null</span>)</span><br><span class="line">        right=getSum(root.right,sum);</span><br><span class="line"></span><br><span class="line">        sum+=left+right;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交错误-3"   >
          <a href="#提交错误-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交错误-3" class="headerlink" title="提交错误"></a>提交错误</h5>
      <p>输入[3,9,20,null,null,15,7]，输出33 预期输出24</p>

        <h4 id="第三次代码-2"   >
          <a href="#第三次代码-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#第三次代码-2" class="headerlink" title="第三次代码"></a>第三次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">sumOfLeftLeaves</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> getSum(root,sum);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getSum</span><span class="params">(TreeNode root,<span class="type">int</span> sum)</span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(root.left==<span class="literal">null</span> &amp;&amp; root.right==<span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">return</span> sum=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> left=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> right=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(root.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">        left=getSum(root.left,sum);</span><br><span class="line">        </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(root.right!=<span class="literal">null</span>)</span><br><span class="line">        right=getSum(root.right,sum);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(root.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">            sum+=left+right+root.left.val;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">             sum+=left+right;</span><br><span class="line">        &#125;</span><br><span class="line">       </span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交错误-4"   >
          <a href="#提交错误-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交错误-4" class="headerlink" title="提交错误"></a>提交错误</h5>
      <p>CASE:root&#x3D;[1,2,3,4,5] ,输出6,预期输出4</p>
<p>原因是我将非叶子结点的左数据也输出了</p>

        <h4 id="第四次代码-1"   >
          <a href="#第四次代码-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#第四次代码-1" class="headerlink" title="第四次代码"></a>第四次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">sumOfLeftLeaves</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> getSum(root);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getSum</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">        <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(root.left==<span class="literal">null</span> &amp;&amp; root.right==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(root.left!=<span class="literal">null</span> &amp;&amp; root.left.left==<span class="literal">null</span> &amp;&amp; root.left.right==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> sum+=root.left.val;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> left=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> right=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(root.left!=<span class="literal">null</span>)</span><br><span class="line">        left=getSum(root.left);</span><br><span class="line">        <span class="keyword">if</span>(root.right!=<span class="literal">null</span>)</span><br><span class="line">        right=getSum(root.right);</span><br><span class="line">        <span class="keyword">return</span> sum+=left+right;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>


        <h5 id="提交错误-5"   >
          <a href="#提交错误-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交错误-5" class="headerlink" title="提交错误"></a>提交错误</h5>
      <p>原因是在判断root左结点是叶子结点就直接结束了循环，而没有对左右子树做判断</p>

        <h4 id="第五次代码-1"   >
          <a href="#第五次代码-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#第五次代码-1" class="headerlink" title="第五次代码"></a>第五次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">sumOfLeftLeaves</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> getSum(root);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getSum</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">        <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(root.left==<span class="literal">null</span> &amp;&amp; root.right==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(root.left!=<span class="literal">null</span> &amp;&amp; root.left.left==<span class="literal">null</span> &amp;&amp; root.left.right==<span class="literal">null</span>)&#123;</span><br><span class="line">            sum+=root.left.val;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> left=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> right=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(root.left!=<span class="literal">null</span>)</span><br><span class="line">        left=getSum(root.left);</span><br><span class="line">        <span class="keyword">if</span>(root.right!=<span class="literal">null</span>)</span><br><span class="line">        right=getSum(root.right);</span><br><span class="line">        <span class="keyword">return</span> sum+=left+right;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-23"   >
          <a href="#提交成功-23" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-23" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-23"   >
          <a href="#题解-23" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-23" class="headerlink" title="题解"></a>题解</h3>
      <p><strong>思路</strong>：我们用<strong>后序遍历</strong>可以实现这道题的代码过程，具体的处理结点应该是左叶子结点的父结点</p>
<blockquote>
<p>左叶子：为叶子结点，并且是父节点的左孩子。</p>
</blockquote>
<p>因为是要统计左叶子之和，所以我们要在父节点处理左叶子之和</p>
<p><strong>实现</strong>：</p>
<ul>
<li>递归条件的参数和返回值：参数root结点，返回值为当前root结点下的左叶子之和</li>
<li>递归的结束条件<ul>
<li>如果root为空 则返回0</li>
<li>如果root是叶子结点则返回0 <em>(root.left&#x3D;&#x3D;null &amp;&amp; root.right&#x3D;&#x3D;null)</em></li>
</ul>
</li>
<li>单层递归的逻辑：<ul>
<li>统计左孩子的左叶子之和，如果左孩子是左叶子，那么左孩子的左叶子之和就为左孩子的值</li>
<li>统计右孩子的左叶子之和</li>
<li>当前结点的左叶子之和为左右结点的左叶子之和的和</li>
</ul>
</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">sumOfLeftLeaves</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> getSum(root);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getSum</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">        <span class="comment">//如果是空节点则返回0  如果是叶子结点则返回0</span></span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(root.left==<span class="literal">null</span>&amp;&amp; root.right==<span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		</span><br><span class="line">        <span class="comment">//遍历左子树统计左叶子之和</span></span><br><span class="line">        <span class="type">int</span> leftNum=getSum(root.left);</span><br><span class="line">        <span class="comment">//如果当前结点的左孩子是叶子结点 则当前结点的左叶子之和就是左孩子的数值</span></span><br><span class="line">        <span class="keyword">if</span>(root.left!=<span class="literal">null</span> &amp;&amp; root.left.left==<span class="literal">null</span> &amp;&amp; root.left.right==<span class="literal">null</span>) </span><br><span class="line">            leftNum=root.left.val;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//统计右子树的左叶子之和</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">rightNum</span> <span class="operator">=</span>getSum(root.right);</span><br><span class="line">        <span class="comment">//返回左右子树的左叶子之和的和 作为当前根节点左叶子之和</span></span><br><span class="line">        <span class="keyword">return</span> leftNum+rightNum;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h1 id="找树左下角的值"   >
          <a href="#找树左下角的值" class="heading-link"><i class="fas fa-link"></i></a><a href="#找树左下角的值" class="headerlink" title="找树左下角的值"></a>找树左下角的值</h1>
      <p>给定一个二叉树的 <strong>根节点</strong> <code>root</code>，请找出该二叉树的 <strong>最底层 最左边</strong> 节点的值。</p>
<p>假设二叉树中至少有一个节点。</p>

        <h2 id="513-找树左下角的值"   >
          <a href="#513-找树左下角的值" class="heading-link"><i class="fas fa-link"></i></a><a href="#513-找树左下角的值" class="headerlink" title="513.找树左下角的值"></a>513.找树左下角的值</h2>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/find-bottom-left-tree-value/" >Leetcode.513(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-22"   >
          <a href="#第一次做-22" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-22" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;09&#x2F;02</p>

        <h4 id="第一次代码-24"   >
          <a href="#第一次代码-24" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-24" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      
        <h5 id="层序遍历-3"   >
          <a href="#层序遍历-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#层序遍历-3" class="headerlink" title="层序遍历"></a>层序遍历</h5>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findBottomLeftValue</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="comment">//层序遍历，当最后一层时第一个结点就是树最左下角的值</span></span><br><span class="line">        Queue&lt;TreeNode&gt; queue=<span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line">        queue.add(root);</span><br><span class="line">        <span class="keyword">while</span>(queue.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="type">int</span> size=queue.size();</span><br><span class="line">            ArrayList&lt;Integer&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            <span class="keyword">while</span>(size--&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                TreeNode node=queue.poll();</span><br><span class="line">                list.add(node.val);</span><br><span class="line">                <span class="keyword">if</span>(node.left!=<span class="literal">null</span>) queue.add(node.left);</span><br><span class="line">                <span class="keyword">if</span>(node.right!=<span class="literal">null</span>) queue.add(node.right);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(queue.size()==<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="comment">//最后一层</span></span><br><span class="line">                <span class="keyword">return</span> list.get(<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> root.val;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h6 id="提交成功-24"   >
          <a href="#提交成功-24" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-24" class="headerlink" title="提交成功"></a>提交成功</h6>
      
        <h5 id="递归遍历-3"   >
          <a href="#递归遍历-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#递归遍历-3" class="headerlink" title="递归遍历"></a>递归遍历</h5>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findBottomLeftValue</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(root.left==<span class="literal">null</span> &amp;&amp; root.right==<span class="literal">null</span>) <span class="keyword">return</span> root.val;</span><br><span class="line">        List&lt;String&gt; path=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        List&lt;String&gt; result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        getLeftLeaves(root,path,result);</span><br><span class="line">        <span class="keyword">if</span>(result.size()==<span class="number">0</span>) <span class="keyword">return</span> root.val;</span><br><span class="line">        <span class="type">int</span> max=result.get(<span class="number">0</span>).charAt(result.get(<span class="number">0</span>).length()-<span class="number">1</span>);</span><br><span class="line">        <span class="type">int</span> index=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;result.size();i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(result.get(i).charAt(result.get(i).length()-<span class="number">1</span>)&gt;max) index=i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result.get(index).charAt(result.get(index).length()-<span class="number">1</span>) - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getLeftLeaves</span><span class="params">(TreeNode root,List&lt;String&gt; path,List&lt;String&gt; result)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> ;</span><br><span class="line">        <span class="keyword">if</span>(root.left==<span class="literal">null</span> &amp;&amp; root.right==<span class="literal">null</span>) <span class="keyword">return</span> ;</span><br><span class="line"></span><br><span class="line">        path.add(root.val+<span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(root.left!=<span class="literal">null</span> &amp;&amp; root.left.left==<span class="literal">null</span> &amp;&amp; root.left.right==<span class="literal">null</span>)&#123;</span><br><span class="line">            StringBuilder sb=<span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">            <span class="keyword">for</span>(String s: path)&#123;</span><br><span class="line">                sb.append(s+<span class="string">&quot;,&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            sb.append(root.left.val+<span class="string">&quot;&quot;</span>);</span><br><span class="line">            result.add(sb.toString());</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        getLeftLeaves(root.left,path,result);</span><br><span class="line">        getLeftLeaves(root.right,path,result);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h6 id="提交失败-11"   >
          <a href="#提交失败-11" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-11" class="headerlink" title="提交失败"></a>提交失败</h6>
      <p>CASE:root&#x3D;[0,-1] 输出1 预期输出-1</p>
<p>原因是符号也占了一个字符，所以我输出的是最后的字符只有1</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findBottomLeftValue</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line"></span><br><span class="line">        List&lt;String&gt; path=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        List&lt;String&gt; result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        getLeftLeaves(root,path,result);</span><br><span class="line">        <span class="keyword">if</span>(result.size()==<span class="number">0</span>) <span class="keyword">return</span> root.val;</span><br><span class="line">        <span class="type">int</span> len=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> index=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;result.size();i++)&#123;</span><br><span class="line">            String s=result.get(i);</span><br><span class="line">            String[] arr=s.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(arr.length&gt;len)&#123;</span><br><span class="line">                index=i;</span><br><span class="line">                len=arr.length;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        String s=result.get(index);</span><br><span class="line">        String[] arr=s.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> Integer.parseInt(arr[arr.length-<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getLeftLeaves</span><span class="params">(TreeNode root,List&lt;String&gt; path,List&lt;String&gt; result)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> ;</span><br><span class="line">        <span class="keyword">if</span>(root.left==<span class="literal">null</span> &amp;&amp; root.right==<span class="literal">null</span>) <span class="keyword">return</span> ;</span><br><span class="line"></span><br><span class="line">        path.add(root.val+<span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(root.left!=<span class="literal">null</span> &amp;&amp; root.left.left==<span class="literal">null</span> &amp;&amp; root.left.right==<span class="literal">null</span>)&#123;</span><br><span class="line">            StringBuilder sb=<span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">            <span class="keyword">for</span>(String s: path)&#123;</span><br><span class="line">                sb.append(s+<span class="string">&quot;,&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            sb.append(root.left.val);</span><br><span class="line">            result.add(sb.toString());</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        getLeftLeaves(root.left,path,result);</span><br><span class="line">        getLeftLeaves(root.right,path,result);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h6 id="提交失败-12"   >
          <a href="#提交失败-12" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-12" class="headerlink" title="提交失败"></a>提交失败</h6>
      <p>CASE:root&#x3D;[1,null,-1] 输出1，预期输出-1</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findBottomLeftValue</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line"></span><br><span class="line">        List&lt;String&gt; path=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        List&lt;String&gt; result=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        getLeftLeaves(root,path,result);</span><br><span class="line">        <span class="keyword">if</span>(result.size()==<span class="number">0</span>) <span class="keyword">return</span> root.val;</span><br><span class="line">        <span class="type">int</span> len=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> index=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;result.size();i++)&#123;</span><br><span class="line">            String s=result.get(i);</span><br><span class="line">            String[] arr=s.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(arr.length&gt;len)&#123;</span><br><span class="line">                index=i;</span><br><span class="line">                len=arr.length;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        String s=result.get(index);</span><br><span class="line">        String[] arr=s.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> Integer.parseInt(arr[arr.length-<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getLeftLeaves</span><span class="params">(TreeNode root,List&lt;String&gt; path,List&lt;String&gt; result)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> ;</span><br><span class="line">        <span class="keyword">if</span>(root.left==<span class="literal">null</span> &amp;&amp; root.right==<span class="literal">null</span>) <span class="keyword">return</span> ;</span><br><span class="line"></span><br><span class="line">        path.add(root.val+<span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(root.left!=<span class="literal">null</span> &amp;&amp; root.left.left==<span class="literal">null</span> &amp;&amp; root.left.right==<span class="literal">null</span>)&#123;</span><br><span class="line">            StringBuilder sb=<span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">            <span class="keyword">for</span>(String s: path)&#123;</span><br><span class="line">                sb.append(s+<span class="string">&quot;,&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            sb.append(root.left.val);</span><br><span class="line">            result.add(sb.toString());</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(root.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">            getLeftLeaves(root.left,path,result);</span><br><span class="line">            path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(root.right!=<span class="literal">null</span>)&#123;</span><br><span class="line">              getLeftLeaves(root.right,path,result);</span><br><span class="line">            path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">        &#125;   </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h6 id="提交失败-13"   >
          <a href="#提交失败-13" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-13" class="headerlink" title="提交失败"></a>提交失败</h6>
      
        <h3 id="题解-24"   >
          <a href="#题解-24" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-24" class="headerlink" title="题解"></a>题解</h3>
      <p>找到树最左下角的值</p>
<blockquote>
<p>树最左下角的值，最底层最靠左的结点数值</p>
</blockquote>
<p>树最左下角的结点不一定是左孩子 ，例如</p>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="https://images-kkblog.oss-cn-hangzhou.aliyuncs.com/image-20230902092036708.png"  alt="树最左下角的结点">
      </p>
<p>这道题用层序遍历就能秒了。</p>

        <h4 id="层序遍历-4"   >
          <a href="#层序遍历-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#层序遍历-4" class="headerlink" title="层序遍历"></a>层序遍历</h4>
      <p>思路： 利用queue做层序遍历，定义一个list用于接收每一层的结点，如果队列为空就说明这是最后一层。返回list第一个数值</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findBottomLeftValue</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="comment">//层序遍历，当最后一层时第一个结点就是树最左下角的结点</span></span><br><span class="line">        Queue&lt;TreeNode&gt; queue=<span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line">        queue.add(root);</span><br><span class="line">        <span class="keyword">while</span>(queue.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="type">int</span> size=queue.size();</span><br><span class="line">            ArrayList&lt;Integer&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            <span class="keyword">while</span>(size--&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                TreeNode node=queue.poll();</span><br><span class="line">                list.add(node.val);</span><br><span class="line">                <span class="keyword">if</span>(node.left!=<span class="literal">null</span>) queue.add(node.left);</span><br><span class="line">                <span class="keyword">if</span>(node.right!=<span class="literal">null</span>) queue.add(node.right);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(queue.size()==<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="comment">//最后一层，list中第一个元素就是最左下角的结点</span></span><br><span class="line">                <span class="keyword">return</span> list.get(<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> root.val;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h4 id="递归遍历-4"   >
          <a href="#递归遍历-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#递归遍历-4" class="headerlink" title="递归遍历"></a>递归遍历</h4>
      <p>思路：我们用一个全局变量depth记录深度。当达到新的深度的时候就记录一下结点的数据。最后返回result就是最深深度时第一个记录的结点数值</p>
<p><strong>实现</strong></p>
<ul>
<li><p>定义一个max 用于统计深度，定义一个result用于记录最深深度结点的值</p>
<ul>
<li><p>例如树有三层</p>
<blockquote>
<p>​             5</p>
<p>​		↙    ↘</p>
<p>​		1               2</p>
<p>​                   ↙    ↘       </p>
<p>​				  3              4</p>
</blockquote>
</li>
<li><p>我们用前中后序遍历都可以，只要<strong>左结点先于右节点遍历到</strong></p>
</li>
<li><p>当遍历到结点1的时候 记录此时最大深度为1 记录结点的值为1 。因此遍历到2的时候不会更新result数值</p>
</li>
<li><p>当遍历到结点3的时候 记录此时最大深度为2  记录结点的值为3。 </p>
</li>
<li><p><del>也即当新的一层只会统计最左(第一个遍历到的结点)结点数值</del></p>
</li>
<li><p>只要保证左结点优于右节点遍历</p>
</li>
</ul>
</li>
<li><p>递归函数的返回值和参数：</p>
<ul>
<li><p>返回值为void，结点数据都保存到全局变量result和max中。</p>
</li>
<li><p>参数root：此时遍历的结点</p>
</li>
<li><p>参数depth：当前结点深度</p>
</li>
</ul>
</li>
<li><p>递归函数的结束条件：</p>
<p>当遍历到叶子结点则统计深度，更新数值</p>
</li>
<li><p>单层递归逻辑：</p>
<ul>
<li>如果左结点非空，向左递归遍历。传入++当前深度，结束递归后，<strong>回溯</strong>当前深度也即depth–</li>
<li>如果右节点非空，向右遍历递归。传入++当前深度，结束递归后，<strong>回溯</strong>当前深度也即depth–</li>
</ul>
</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="comment">//全局变量max，最深深度。 全局变量result 用于记录最深深度的结点的值</span></span><br><span class="line">    <span class="type">int</span> max=Integer.MAX_VALUE+<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> result=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findBottomLeftValue</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        treeBottomLeft(root,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">treeBottomLeft</span><span class="params">(TreeNode node,<span class="type">int</span> depth)</span>&#123;</span><br><span class="line">        <span class="comment">//当遍历到叶子结点</span></span><br><span class="line">        <span class="keyword">if</span>(node.left==<span class="literal">null</span> &amp;&amp;node.right==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">//判断深度，如果深度大于最深深度则更新数据</span></span><br><span class="line">            <span class="keyword">if</span>(depth&gt;max)&#123;</span><br><span class="line">                max=depth;</span><br><span class="line">                result=node.val;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//如果左子树非空，向左遍历。结束遍历回溯当前深度</span></span><br><span class="line">        <span class="keyword">if</span>(node.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">            depth++;</span><br><span class="line">            treeBottomLeft(node.left,depth);</span><br><span class="line">            depth--;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//如果右子树非空，向右遍历。结束遍历回溯当前深度</span></span><br><span class="line">        <span class="keyword">if</span>(node.right!=<span class="literal">null</span>)&#123;</span><br><span class="line">            depth++;</span><br><span class="line">            treeBottomLeft(node.right,depth);</span><br><span class="line">            depth--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h1 id="路径总和"   >
          <a href="#路径总和" class="heading-link"><i class="fas fa-link"></i></a><a href="#路径总和" class="headerlink" title="路径总和"></a>路径总和</h1>
      <p>给你二叉树的根节点 <code>root</code> 和一个表示目标和的整数 <code>targetSum</code> 。判断该树中是否存在 <strong>根节点到叶子节点</strong> 的路径，这条路径上所有节点值相加等于目标和 <code>targetSum</code> 。如果存在，返回 <code>true</code> ；否则，返回 <code>false</code> 。</p>

        <h2 id="112-路径总和"   >
          <a href="#112-路径总和" class="heading-link"><i class="fas fa-link"></i></a><a href="#112-路径总和" class="headerlink" title="112.路径总和"></a>112.路径总和</h2>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/path-sum/" >Leetcode.112题(easy)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-23"   >
          <a href="#第一次做-23" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-23" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;09&#x2F;02</p>

        <h4 id="第一次代码-25"   >
          <a href="#第一次代码-25" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-25" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasPathSum</span><span class="params">(TreeNode root, <span class="type">int</span> targetSum)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> SearchTreeSon(root,targetSum);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">SearchTreeSon</span><span class="params">(TreeNode root,<span class="type">int</span> targetSum)</span>&#123;</span><br><span class="line">        sum+=root.val;</span><br><span class="line">        <span class="keyword">if</span>(root.left==<span class="literal">null</span> &amp;&amp; root.right==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(sum==targetSum)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">boolean</span> left=<span class="literal">false</span>;</span><br><span class="line">        <span class="type">boolean</span> right=<span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span>(root.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">            sum+=root.left.val;</span><br><span class="line">            left=SearchTreeSon(root.left,targetSum);</span><br><span class="line">            sum-=root.left.val;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(root.right!=<span class="literal">null</span>)&#123;</span><br><span class="line">            sum+=root.right.val;</span><br><span class="line">            right=SearchTreeSon(root.right,targetSum);</span><br><span class="line">            sum-=root.right.val;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> left || right;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-14"   >
          <a href="#提交失败-14" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-14" class="headerlink" title="提交失败"></a>提交失败</h5>
      
        <h4 id="第二次提交"   >
          <a href="#第二次提交" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次提交" class="headerlink" title="第二次提交"></a>第二次提交</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasPathSum</span><span class="params">(TreeNode root, <span class="type">int</span> targetSum)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> SearchTreeSon(root,targetSum);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">SearchTreeSon</span><span class="params">(TreeNode root,<span class="type">int</span> targetSum)</span>&#123;</span><br><span class="line">        sum+=root.val;</span><br><span class="line">        <span class="keyword">if</span>(root.left==<span class="literal">null</span> &amp;&amp; root.right==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(sum==targetSum)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">boolean</span> left=<span class="literal">false</span>;</span><br><span class="line">        <span class="type">boolean</span> right=<span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span>(root.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">            left=SearchTreeSon(root.left,targetSum);</span><br><span class="line">            sum-=root.left.val;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(root.right!=<span class="literal">null</span>)&#123;</span><br><span class="line">            right=SearchTreeSon(root.right,targetSum);</span><br><span class="line">            sum-=root.right.val;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> left || right;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-25"   >
          <a href="#提交成功-25" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-25" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h4 id="题解-25"   >
          <a href="#题解-25" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-25" class="headerlink" title="题解"></a>题解</h4>
      <p>思路：这道题用递归做，遍历顺序可以是前中后序，这里我的题解是用的后序的方法，用一个全局变量sum统计当前结点的路径之和</p>
<p><strong>实现</strong></p>
<ul>
<li><p>定义一个sum统计当前路径之和</p>
</li>
<li><p>递归的参数和返回值：</p>
<ul>
<li>参数root：遍历的结点</li>
<li>参数targetSum：传入的目标路径总和</li>
<li>返回值：布尔类型，返回是否找到路径之和相等的叶子结点</li>
</ul>
</li>
<li><p>递归的结束条件：</p>
<p>当遍历到叶子结点的时候判断路径是否相等，如果相等返回true表示找到结点，如果不相等则返回false</p>
</li>
<li><p>单层递归的逻辑：(左右中)</p>
<ul>
<li>当左结点不为空，向左搜寻结点，当左孩子遍历结束要<strong>回溯</strong>当前结点路径 (左)</li>
<li>当右孩子不为空，向右搜寻结点，当右孩子遍历结束要回溯当前结点路径 (右)</li>
<li>当左孩子或者右孩子遍历中有一个返回true则返回true 						       (中)</li>
</ul>
</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"> 	<span class="comment">//全局变量sum用于记录当前结点的路径之和</span></span><br><span class="line">    <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasPathSum</span><span class="params">(TreeNode root, <span class="type">int</span> targetSum)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> SearchTreeSon(root,targetSum);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">SearchTreeSon</span><span class="params">(TreeNode root,<span class="type">int</span> targetSum)</span>&#123;</span><br><span class="line">        <span class="comment">//添加当前结点路径</span></span><br><span class="line">        sum+=root.val;</span><br><span class="line">		<span class="comment">//如果当前结点是叶子结点，判断路径和目标路径是否相等，如果相等返回true，反之返回false</span></span><br><span class="line">        <span class="keyword">if</span>(root.left==<span class="literal">null</span> &amp;&amp; root.right==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(sum==targetSum)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">boolean</span> left=<span class="literal">false</span>;</span><br><span class="line">        <span class="type">boolean</span> right=<span class="literal">false</span>;</span><br><span class="line">        <span class="comment">//当左孩子不为空</span></span><br><span class="line">        <span class="keyword">if</span>(root.left!=<span class="literal">null</span>)&#123;  <span class="comment">//左</span></span><br><span class="line">            left=SearchTreeSon(root.left,targetSum);</span><br><span class="line">            <span class="comment">//回溯到当前结点路径</span></span><br><span class="line">            <span class="comment">//因为向左孩子遍历的时候递归中sum+=root.val        (遍历中是root是当前结点的左孩子)</span></span><br><span class="line">            <span class="comment">//所以结束递归sum-=root.left.val				  (遍历结束后root是当前结点)</span></span><br><span class="line">            sum-=root.left.val;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//下同 当右孩子不为空</span></span><br><span class="line">        <span class="keyword">if</span>(root.right!=<span class="literal">null</span>)&#123; <span class="comment">//右</span></span><br><span class="line">            right=SearchTreeSon(root.right,targetSum);</span><br><span class="line">            sum-=root.right.val;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> left || right; <span class="comment">//中</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h1 id="从中序与后序遍历序列构造二叉树"   >
          <a href="#从中序与后序遍历序列构造二叉树" class="heading-link"><i class="fas fa-link"></i></a><a href="#从中序与后序遍历序列构造二叉树" class="headerlink" title="从中序与后序遍历序列构造二叉树"></a>从中序与后序遍历序列构造二叉树</h1>
      <p>给定两个整数数组 <code>inorder</code> 和 <code>postorder</code> ，其中 <code>inorder</code> 是二叉树的中序遍历， <code>postorder</code> 是同一棵树的后序遍历，请你构造并返回这颗 <em>二叉树</em> 。</p>

        <h2 id="106-从中序与后序遍历序列构造二叉树"   >
          <a href="#106-从中序与后序遍历序列构造二叉树" class="heading-link"><i class="fas fa-link"></i></a><a href="#106-从中序与后序遍历序列构造二叉树" class="headerlink" title="106.从中序与后序遍历序列构造二叉树"></a>106.从中序与后序遍历序列构造二叉树</h2>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/construct-binary-tree-from-inorder-and-postorder-traversal/" >Leetcode.106题(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-24"   >
          <a href="#第一次做-24" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-24" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;09&#x2F;03</p>

        <h4 id="第一次代码-26"   >
          <a href="#第一次代码-26" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-26" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">buildTree</span><span class="params">(<span class="type">int</span>[] inorder, <span class="type">int</span>[] postorder)</span> &#123;</span><br><span class="line">        <span class="type">int</span> root=postorder[postorder.length-<span class="number">1</span>];</span><br><span class="line">        <span class="type">int</span> rootIndex=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;inorder.length-<span class="number">1</span>;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(root==inorder[i])</span><br><span class="line">            &#123;</span><br><span class="line">                rootIndex=i;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125; </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(rootIndex==<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">//没有左子树</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span>[] leftInorder=<span class="keyword">new</span> <span class="title class_">int</span>[rootIndex];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;rootIndex;i++)&#123;</span><br><span class="line">            leftInorder[i]=inorder[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> postNumber=inorder.length-rootIndex-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(postNumber==<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">//没有右子树</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span>[] rightPostorder=<span class="keyword">new</span> <span class="title class_">int</span>[postNumber];</span><br><span class="line">        <span class="type">int</span> j=postorder.length-<span class="number">1</span>;</span><br><span class="line">        j--;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=postNumber-<span class="number">1</span>;i&gt;=<span class="number">0</span>;i--)&#123;</span><br><span class="line">            rightPostorder[i]=postorder[j--];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span>[] rightInorder=<span class="keyword">new</span> <span class="title class_">int</span>[postNumber];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;postNumber;i++)&#123;</span><br><span class="line">            rightInorder[i]=inorder[++rootIndex];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span>[] leftPostorder=<span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(postorder.length-<span class="number">1</span>-postNumber&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            leftPostorder=<span class="keyword">new</span> <span class="title class_">int</span>[postorder.length-<span class="number">1</span>-postNumber];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;leftPostorder.length;i++)&#123;</span><br><span class="line">            leftPostorder[i]=postorder[i];</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(leftInorder.length==<span class="number">0</span> &amp;&amp;rightInorder.length==<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(root,<span class="literal">null</span>,<span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(leftInorder.length==<span class="number">0</span>||leftPostorder.length==<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(root,<span class="literal">null</span>,buildTree(rightInorder,rightPostorder));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(rightInorder.length==<span class="number">0</span>||rightPostorder.length==<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(root,buildTree(leftInorder,leftPostorder),<span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(root,buildTree(leftInorder,leftPostorder),buildTree(rightInorder,rightPostorder));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交错误-6"   >
          <a href="#提交错误-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交错误-6" class="headerlink" title="提交错误"></a>提交错误</h5>
      <p>CASE:inorder&#x3D;[2,1] postorder&#x3D;[2,1] 输出[1,null,2] 预期输出[1,2]</p>
<p>原因：确定根节点索引位置的时候没有遍历inorder数组的最后一个元素</p>

        <h4 id="第二次代码-8"   >
          <a href="#第二次代码-8" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码-8" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">buildTree</span><span class="params">(<span class="type">int</span>[] inorder, <span class="type">int</span>[] postorder)</span> &#123;</span><br><span class="line">        <span class="type">int</span> root=postorder[postorder.length-<span class="number">1</span>];</span><br><span class="line">        <span class="type">int</span> rootIndex=<span class="number">0</span>;</span><br><span class="line">    	<span class="comment">//找到根节点索引位置</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;inorder.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(root==inorder[i])</span><br><span class="line">            &#123;</span><br><span class="line">                rootIndex=i;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125; </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(rootIndex==<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">//没有左子树</span></span><br><span class="line">        &#125;</span><br><span class="line">    	<span class="comment">//左结点中序遍历数组</span></span><br><span class="line">        <span class="type">int</span>[] leftInorder=<span class="keyword">new</span> <span class="title class_">int</span>[rootIndex];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;rootIndex;i++)&#123;</span><br><span class="line">            leftInorder[i]=inorder[i];</span><br><span class="line">        &#125;</span><br><span class="line">    	<span class="comment">//右子树个数</span></span><br><span class="line">        <span class="type">int</span> postNumber=inorder.length-rootIndex-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(postNumber==<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">//没有右子树</span></span><br><span class="line">        &#125;</span><br><span class="line">    	<span class="comment">//右子树后序遍历数组</span></span><br><span class="line">        <span class="type">int</span>[] rightPostorder=<span class="keyword">new</span> <span class="title class_">int</span>[postNumber];</span><br><span class="line">        <span class="type">int</span> j=postorder.length-<span class="number">1</span>;</span><br><span class="line">        j--;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=postNumber-<span class="number">1</span>;i&gt;=<span class="number">0</span>;i--)&#123;</span><br><span class="line">            rightPostorder[i]=postorder[j--];</span><br><span class="line">        &#125;</span><br><span class="line">    	<span class="comment">//右子树中序遍历数组</span></span><br><span class="line">        <span class="type">int</span>[] rightInorder=<span class="keyword">new</span> <span class="title class_">int</span>[postNumber];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;postNumber;i++)&#123;</span><br><span class="line">            rightInorder[i]=inorder[++rootIndex];</span><br><span class="line">        &#125;</span><br><span class="line">    	<span class="comment">//左子树后序遍历数组</span></span><br><span class="line">        <span class="type">int</span>[] leftPostorder=<span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(postorder.length-<span class="number">1</span>-postNumber&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            leftPostorder=<span class="keyword">new</span> <span class="title class_">int</span>[postorder.length-<span class="number">1</span>-postNumber];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;leftPostorder.length;i++)&#123;</span><br><span class="line">            leftPostorder[i]=postorder[i];</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line">        <span class="comment">//左子树和右子树为空 是叶子结点</span></span><br><span class="line">        <span class="keyword">if</span>(leftInorder.length==<span class="number">0</span> &amp;&amp;rightInorder.length==<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(root,<span class="literal">null</span>,<span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    	<span class="comment">//左子树为空</span></span><br><span class="line">        <span class="keyword">if</span>(leftInorder.length==<span class="number">0</span>||leftPostorder.length==<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(root,<span class="literal">null</span>,buildTree(rightInorder,rightPostorder));</span><br><span class="line">        &#125;</span><br><span class="line">    	<span class="comment">//右子树为空</span></span><br><span class="line">        <span class="keyword">if</span>(rightInorder.length==<span class="number">0</span>||rightPostorder.length==<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(root,buildTree(leftInorder,leftPostorder),<span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    	<span class="comment">//左右子树都不为空</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(root,buildTree(leftInorder,leftPostorder),buildTree(rightInorder,rightPostorder));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-26"   >
          <a href="#提交成功-26" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-26" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-26"   >
          <a href="#题解-26" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-26" class="headerlink" title="题解"></a>题解</h3>
      <p>思路：因为中序是左中右，而后序是左右中。所以我们可以通过中结点的位置来切割左右区间，左右区间获得了就能知道左右子树的中序和后序，然后递归调用即可创建树</p>
<p><strong>实现</strong></p>
<ul>
<li><p>先确定中结点位置，因为后序是<strong>左右中</strong>，所以后序数组的最后一个结点就一定是根结点</p>
</li>
<li><p>通过根结点的数值可以去遍历中序数组找到根节点位置，中序数组根结点前的就是左子树结果，根结点后的是右子树中序结果</p>
</li>
<li><p>通过左子树区间长度可以去切割后序数组，后序数组前面左子树区间个数就是左子树的后序结果，然后剩下就是右子树区间以及根节点</p>
</li>
<li><p>递归条件的参数和返回值</p>
<ul>
<li>参数inorder数组：中序数组</li>
<li>参数postorder数组：后序数组</li>
<li>返回值TreeNode：构建的树</li>
</ul>
</li>
<li><p>递归的结束条件</p>
<p>当postorder数组或者inorder数组长度为0 说明是空结点返回null</p>
</li>
<li><p>单层递归的逻辑</p>
</li>
<li><ul>
<li>找到根结点位置</li>
<li>切割中序数组，获取左子树和右子树区间</li>
<li>切割后序数组，通过左子树区间长度可以找到后序数组中左区间个数，获取左右区间</li>
<li>返回结点</li>
</ul>
</li>
</ul>
<blockquote>
<p>注意点</p>
</blockquote>
<p><em>1.数组都是合法的，也即中序和后序遍历的长度一致</em></p>
<p><em>2.当后序数组长度为1，那么说明是根节点也是叶子结点 可以直接返回root没有左右子树</em></p>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">buildTree</span><span class="params">(<span class="type">int</span>[] inorder, <span class="type">int</span>[] postorder)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> inAndPostbuild(inorder,postorder);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">inAndPostbuild</span><span class="params">(<span class="type">int</span>[] inorder,<span class="type">int</span>[] postorder)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(postorder.length==<span class="number">0</span>||inorder.length==<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//后序确定根节点</span></span><br><span class="line">        <span class="type">int</span> rootVal=postorder[postorder.length-<span class="number">1</span>];</span><br><span class="line">        TreeNode root=<span class="keyword">new</span> <span class="title class_">TreeNode</span>(rootVal);</span><br><span class="line">        <span class="comment">//根节点是叶子结点 则直接返回根节点(没有左右子树)</span></span><br><span class="line">        <span class="keyword">if</span>(inorder.length==<span class="number">1</span>||postorder.length==<span class="number">1</span>) <span class="keyword">return</span> root;</span><br><span class="line">        <span class="type">int</span> index=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(;index&lt;inorder.length;index++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(inorder[index]==rootVal) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//运行到这里说明有左子树或者右子树或者左右子树</span></span><br><span class="line">        <span class="comment">//左孩子的中序和后序</span></span><br><span class="line">        <span class="type">int</span>[] leftIn=<span class="keyword">new</span> <span class="title class_">int</span>[index];</span><br><span class="line">        <span class="type">int</span>[] leftPost=<span class="keyword">new</span> <span class="title class_">int</span>[leftIn.length];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;index;j++)&#123;</span><br><span class="line">            leftIn[j]=inorder[j];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> j=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(;j&lt;leftPost.length;j++)&#123;</span><br><span class="line">            leftPost[j]=postorder[j];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//右孩子的中序和后序</span></span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span>[] rightIn=<span class="keyword">new</span> <span class="title class_">int</span>[inorder.length-<span class="number">1</span>-index];</span><br><span class="line">        <span class="type">int</span>[] rightPost=<span class="keyword">new</span> <span class="title class_">int</span>[rightIn.length];</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;rightIn.length;i++,index++)&#123;</span><br><span class="line">            rightIn[i]=inorder[index+<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;rightPost.length;i++)&#123;</span><br><span class="line">            rightPost[i]=postorder[j++];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        root.left=inAndPostbuild(leftIn,leftPost);</span><br><span class="line">        root.right=inAndPostbuild(rightIn,rightPost);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>




        <h3 id="总结"   >
          <a href="#总结" class="heading-link"><i class="fas fa-link"></i></a><a href="#总结" class="headerlink" title="总结"></a>总结</h3>
      <p>我自己在做这道题目的时候，在切割中序的左孩子右孩子以及切割后序的左区间和右区间的思维较为混乱，切割后序的左区间可以通过中序切出来的左子树区间大小来切割。</p>
<p>并且在递归的结束条件我写的比较混乱，但总体来说是思维没错的。</p>
<p>总体来说可以通过根节点的位置来切割左右区间，而切割中序的时候是用根节点位置，切割后序的时候是通过左孩子区间的大小切割</p>
<p>递归结束为:当后序数组为空或者中序数组为空则代表空节点直接返回null </p>

        <h2 id="105-从前序与中序遍历序列构造二叉树"   >
          <a href="#105-从前序与中序遍历序列构造二叉树" class="heading-link"><i class="fas fa-link"></i></a><a href="#105-从前序与中序遍历序列构造二叉树" class="headerlink" title="105.从前序与中序遍历序列构造二叉树"></a>105.从前序与中序遍历序列构造二叉树</h2>
      <p>给定两个整数数组 <code>preorder</code> 和 <code>inorder</code> ，其中 <code>preorder</code> 是二叉树的<strong>先序遍历</strong>， <code>inorder</code> 是同一棵树的<strong>中序遍历</strong>，请构造二叉树并返回其根节点。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/construct-binary-tree-from-preorder-and-inorder-traversal/" >Leetcode.105题(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-25"   >
          <a href="#第一次做-25" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-25" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;09&#x2F;03</p>

        <h4 id="第一次代码-27"   >
          <a href="#第一次代码-27" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-27" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">buildTree</span><span class="params">(<span class="type">int</span>[] preorder, <span class="type">int</span>[] inorder)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> prexAndinBuild(preorder,inorder);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">prexAndinBuild</span><span class="params">(<span class="type">int</span>[] preorder,<span class="type">int</span>[] inorder)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preorder.length==<span class="number">0</span> ||inorder.length==<span class="number">0</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">int</span> rootVal=preorder[<span class="number">0</span>];</span><br><span class="line">        TreeNode root=<span class="keyword">new</span> <span class="title class_">TreeNode</span>(rootVal);</span><br><span class="line">        <span class="keyword">if</span>(preorder.length==<span class="number">1</span>) <span class="keyword">return</span> root;</span><br><span class="line">        <span class="comment">//运行到这里说明起码有左子树或者右子树或者左右子树</span></span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> index=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(;index&lt;inorder.length;index++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(inorder[index]==rootVal) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span>[] leftIn=<span class="keyword">new</span> <span class="title class_">int</span>[index];</span><br><span class="line">        <span class="type">int</span>[] leftPrex=<span class="keyword">new</span> <span class="title class_">int</span>[leftIn.length];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;index;i++)&#123;</span><br><span class="line">            leftIn[i]=inorder[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>,i=<span class="number">0</span>;i&lt;leftPrex.length;i++,j++)&#123;</span><br><span class="line">            leftPrex[i]=preorder[j];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span>[] rightIn=<span class="keyword">new</span> <span class="title class_">int</span>[inorder.length-index-<span class="number">1</span>];</span><br><span class="line">        <span class="type">int</span>[] rightPrex=<span class="keyword">new</span> <span class="title class_">int</span>[rightIn.length];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;rightIn.length;i++,index++)&#123;</span><br><span class="line">            rightIn[i]=inorder[index+<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=leftIn.length+<span class="number">1</span>,i=<span class="number">0</span>;j&lt;rightPrex.length;i++,j++)&#123;</span><br><span class="line">            rightPrex[i]=preorder[j];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        root.left=prexAndinBuild(leftPrex,leftIn);</span><br><span class="line">        root.right=prexAndinBuild(rightPrex,rightIn);</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-15"   >
          <a href="#提交失败-15" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-15" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:preorder&#x3D;[3,9,20,15,7] inorder&#x3D;[9,3,15,20,7] 输出[3,9,20,null,null,0,0] 预期输出[3,9,20,null,null,15,7]</p>
<p>原因是右子树的前序的时候循环条件写错了，应该是i&lt;rightPrex.length 改了就好了</p>

        <h4 id="第二次代码-9"   >
          <a href="#第二次代码-9" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码-9" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">buildTree</span><span class="params">(<span class="type">int</span>[] preorder, <span class="type">int</span>[] inorder)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> prexAndinBuild(preorder,inorder);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">prexAndinBuild</span><span class="params">(<span class="type">int</span>[] preorder,<span class="type">int</span>[] inorder)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preorder.length==<span class="number">0</span> ||inorder.length==<span class="number">0</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">int</span> rootVal=preorder[<span class="number">0</span>];</span><br><span class="line">        TreeNode root=<span class="keyword">new</span> <span class="title class_">TreeNode</span>(rootVal);</span><br><span class="line">        <span class="keyword">if</span>(preorder.length==<span class="number">1</span>) <span class="keyword">return</span> root;</span><br><span class="line">        <span class="comment">//运行到这里说明起码有左子树或者右子树或者左右子树</span></span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> index=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(;index&lt;inorder.length;index++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(inorder[index]==rootVal) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span>[] leftIn=<span class="keyword">new</span> <span class="title class_">int</span>[index];</span><br><span class="line">        <span class="type">int</span>[] leftPrex=<span class="keyword">new</span> <span class="title class_">int</span>[leftIn.length];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;index;i++)&#123;</span><br><span class="line">            leftIn[i]=inorder[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>,i=<span class="number">0</span>;i&lt;leftPrex.length;i++,j++)&#123;</span><br><span class="line">            leftPrex[i]=preorder[j];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span>[] rightIn=<span class="keyword">new</span> <span class="title class_">int</span>[inorder.length-index-<span class="number">1</span>];</span><br><span class="line">        <span class="type">int</span>[] rightPrex=<span class="keyword">new</span> <span class="title class_">int</span>[rightIn.length];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;rightIn.length;i++,index++)&#123;</span><br><span class="line">            rightIn[i]=inorder[index+<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=leftIn.length+<span class="number">1</span>,i=<span class="number">0</span>;i&lt;rightPrex.length;i++,j++)&#123;</span><br><span class="line">            rightPrex[i]=preorder[j];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        root.left=prexAndinBuild(leftPrex,leftIn);</span><br><span class="line">        root.right=prexAndinBuild(rightPrex,rightIn);</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-27"   >
          <a href="#提交成功-27" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-27" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-27"   >
          <a href="#题解-27" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-27" class="headerlink" title="题解"></a>题解</h3>
      <p>思路：这道题和上面中序后序确认二叉树一样，主要是找到中结点的位置，然后切割前序和中序数组，分别获取左区间和右区间</p>
<p><strong>实现</strong></p>
<ul>
<li><p>先确定中结点位置，因为前序是<strong>中左右</strong>，所以前序数组的第一个结点就一定是根结点</p>
</li>
<li><p>通过根结点的数值可以去遍历中序数组找到根节点位置，中序数组根结点前的就是左子树结果，根结点后的是右子树中序结果</p>
</li>
<li><p>通过左子树区间长度可以去切割前序数组，前序数组从索引1开始<del>(因为索引0是根节点)</del>前面左子树区间个数就是左子树的前序结果，然后剩下就是右子树区间</p>
</li>
<li><p>递归条件的参数和返回值</p>
<ul>
<li>参数inorder数组：中序数组</li>
<li>参数preorder数组：前序数组</li>
<li>返回值TreeNode：构建的树</li>
</ul>
</li>
<li><p>递归的结束条件</p>
<p>当preorder数组或者inorder数组长度为0 说明是空结点返回null</p>
</li>
<li><p>单层递归的逻辑</p>
</li>
<li><ul>
<li>找到根结点位置</li>
<li>切割中序数组，获取左子树和右子树区间</li>
<li>切割前序数组，通过左子树区间长度可以找到前序数组中左区间个数，获取左右区间</li>
<li>返回结点</li>
</ul>
</li>
</ul>
<blockquote>
<p>注意点</p>
</blockquote>
<p><em>1.数组都是合法的，也即前序和中序遍历的长度一致</em></p>
<p><em>2.当前序数组长度为1，那么说明是根节点也是叶子结点 可以直接返回root没有左右子树</em></p>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">buildTree</span><span class="params">(<span class="type">int</span>[] preorder, <span class="type">int</span>[] inorder)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> prexAndinBuild(preorder,inorder);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">prexAndinBuild</span><span class="params">(<span class="type">int</span>[] preorder,<span class="type">int</span>[] inorder)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preorder.length==<span class="number">0</span> ||inorder.length==<span class="number">0</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">int</span> rootVal=preorder[<span class="number">0</span>];</span><br><span class="line">        TreeNode root=<span class="keyword">new</span> <span class="title class_">TreeNode</span>(rootVal);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//如果前序数组长度只有1说明根节点是叶子结点</span></span><br><span class="line">        <span class="keyword">if</span>(preorder.length==<span class="number">1</span>) <span class="keyword">return</span> root;</span><br><span class="line">        <span class="comment">//运行到这里说明起码有左子树或者右子树或者左右子树</span></span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> index=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(;index&lt;inorder.length;index++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(inorder[index]==rootVal) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//获取左子树的前序和中序数组</span></span><br><span class="line">        <span class="type">int</span>[] leftIn=<span class="keyword">new</span> <span class="title class_">int</span>[index];</span><br><span class="line">        <span class="type">int</span>[] leftPrex=<span class="keyword">new</span> <span class="title class_">int</span>[leftIn.length];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;index;i++)&#123;</span><br><span class="line">            leftIn[i]=inorder[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>,i=<span class="number">0</span>;i&lt;leftPrex.length;i++,j++)&#123;</span><br><span class="line">            leftPrex[i]=preorder[j];</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="comment">//获取右子树的前序和中序数组</span></span><br><span class="line">        <span class="type">int</span>[] rightIn=<span class="keyword">new</span> <span class="title class_">int</span>[inorder.length-index-<span class="number">1</span>];</span><br><span class="line">        <span class="type">int</span>[] rightPrex=<span class="keyword">new</span> <span class="title class_">int</span>[rightIn.length];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;rightIn.length;i++,index++)&#123;</span><br><span class="line">            rightIn[i]=inorder[index+<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=leftIn.length+<span class="number">1</span>,i=<span class="number">0</span>;i&lt;rightPrex.length;i++,j++)&#123;</span><br><span class="line">            rightPrex[i]=preorder[j];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        root.left=prexAndinBuild(leftPrex,leftIn);</span><br><span class="line">        root.right=prexAndinBuild(rightPrex,rightIn);</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h1 id="最大二叉树"   >
          <a href="#最大二叉树" class="heading-link"><i class="fas fa-link"></i></a><a href="#最大二叉树" class="headerlink" title="最大二叉树"></a>最大二叉树</h1>
      <p>给定一个不重复的整数数组 <code>nums</code> 。 <strong>最大二叉树</strong> 可以用下面的算法从 <code>nums</code> 递归地构建:</p>
<ol>
<li>创建一个根节点，其值为 <code>nums</code> 中的最大值。</li>
<li>递归地在最大值 <strong>左边</strong> 的 <strong>子数组前缀上</strong> 构建左子树。</li>
<li>递归地在最大值 <strong>右边</strong> 的 <strong>子数组后缀上</strong> 构建右子树。</li>
</ol>
<p>返回 <em><code>nums</code> 构建的</em> <em><strong>最大二叉树</strong></em> 。</p>

        <h2 id="654-最大二叉树"   >
          <a href="#654-最大二叉树" class="heading-link"><i class="fas fa-link"></i></a><a href="#654-最大二叉树" class="headerlink" title="654.最大二叉树"></a>654.最大二叉树</h2>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/maximum-binary-tree/description/" >Leetcode.654(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-26"   >
          <a href="#第一次做-26" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-26" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;09&#x2F;03</p>

        <h4 id="第一次代码-28"   >
          <a href="#第一次代码-28" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-28" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">constructMaximumBinaryTree</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> findMax(nums);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">findMax</span><span class="params">(<span class="type">int</span>[] nums)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(nums.length==<span class="number">0</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">int</span> max=nums[<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span> index=<span class="number">0</span>;</span><br><span class="line">        <span class="comment">//找到最大值</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;nums.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[i]&gt;max)&#123;</span><br><span class="line">                max=nums[i];</span><br><span class="line">                index=i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        TreeNode root=<span class="keyword">new</span> <span class="title class_">TreeNode</span>(max);</span><br><span class="line">        <span class="keyword">if</span>(nums.length==<span class="number">1</span>) <span class="keyword">return</span> root;</span><br><span class="line">		</span><br><span class="line">        <span class="type">int</span>[] leftNums=<span class="keyword">new</span> <span class="title class_">int</span>[index];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;index;i++)&#123;</span><br><span class="line">            leftNums[i]=nums[i];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span>[] rightNums=<span class="keyword">new</span> <span class="title class_">int</span>[nums.length-<span class="number">1</span>-index];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;rightNums.length;i++,index++)&#123;</span><br><span class="line">            rightNums[i]=nums[index+<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        root.left=findMax(leftNums);</span><br><span class="line">        root.right=findMax(rightNums);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-28"   >
          <a href="#提交成功-28" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-28" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-28"   >
          <a href="#题解-28" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-28" class="headerlink" title="题解"></a>题解</h3>
      <p>思路：前序递归(中左右)构造最大二叉树，先构造中结点，再构造左子树然后构造右子树</p>
<p><strong>实现</strong></p>
<ul>
<li><p>递归函数的参数和返回值</p>
<ul>
<li>参数nums：整数数组</li>
<li>返回值TreeNode：构造出来的最大二叉树</li>
</ul>
</li>
<li><p>递归的终止条件</p>
<ul>
<li>当nums.length&#x3D;&#x3D;0 说明空数组是空结点，所以返回null</li>
<li>当nums.length&#x3D;&#x3D;1 说明是叶子结点,构造TreeNode(nums[0])返回</li>
</ul>
</li>
<li><p>单层递归的逻辑</p>
<ul>
<li>定义一个max和index 用于标记数组中最大值的值和位置<ul>
<li>遍历nums获取max和index</li>
<li>max标记数组中最大值</li>
<li>index标记数组中最大值的索引下标</li>
</ul>
</li>
<li>获取左子树的nums，递归调用函数构造左子树 <em>左子树nums为数组中index左边部分</em></li>
<li>获取右子树的nums，递归调用函数构造右子树 <em>右子树nums为数组中index右边部分</em></li>
<li>返回构建出的TreeNode结点</li>
</ul>
</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">constructMaximumBinaryTree</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> findMax(nums);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">findMax</span><span class="params">(<span class="type">int</span>[] nums)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(nums.length==<span class="number">0</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">int</span> max=nums[<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span> index=<span class="number">0</span>;</span><br><span class="line">        <span class="comment">//找到最大值</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;nums.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[i]&gt;max)&#123;</span><br><span class="line">                max=nums[i];</span><br><span class="line">                index=i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        TreeNode root=<span class="keyword">new</span> <span class="title class_">TreeNode</span>(max);</span><br><span class="line">        <span class="keyword">if</span>(nums.length==<span class="number">1</span>) <span class="keyword">return</span> root;</span><br><span class="line">		</span><br><span class="line">        <span class="comment">//运行到这里是非叶子结点</span></span><br><span class="line">        <span class="type">int</span>[] leftNums=<span class="keyword">new</span> <span class="title class_">int</span>[index];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;index;i++)&#123;</span><br><span class="line">            leftNums[i]=nums[i];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span>[] rightNums=<span class="keyword">new</span> <span class="title class_">int</span>[nums.length-<span class="number">1</span>-index];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;rightNums.length;i++,index++)&#123;</span><br><span class="line">            rightNums[i]=nums[index+<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        root.left=findMax(leftNums);</span><br><span class="line">        root.right=findMax(rightNums);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h1 id="合并二叉树"   >
          <a href="#合并二叉树" class="heading-link"><i class="fas fa-link"></i></a><a href="#合并二叉树" class="headerlink" title="合并二叉树"></a>合并二叉树</h1>
      <p>给你两棵二叉树： <code>root1</code> 和 <code>root2</code> 。</p>
<p>想象一下，当你将其中一棵覆盖到另一棵之上时，两棵树上的一些节点将会重叠（而另一些不会）。你需要将这两棵树合并成一棵新二叉树。合并的规则是：如果两个节点重叠，那么将这两个节点的值相加作为合并后节点的新值；否则，<strong>不为</strong> null 的节点将直接作为新二叉树的节点。</p>
<p>返回合并后的二叉树。</p>
<p><strong>注意:</strong> 合并过程必须从两个树的根节点开始。</p>

        <h2 id="617-合并二叉树"   >
          <a href="#617-合并二叉树" class="heading-link"><i class="fas fa-link"></i></a><a href="#617-合并二叉树" class="headerlink" title="617.合并二叉树"></a>617.合并二叉树</h2>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/merge-two-binary-trees/" >Leetcode.617题(easy)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-27"   >
          <a href="#第一次做-27" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-27" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;09&#x2F;03 (因为04号上午因部分原因没能完成当日任务，所以于03号晚上提前完成)</p>

        <h4 id="第一次代码-29"   >
          <a href="#第一次代码-29" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-29" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">mergeTrees</span><span class="params">(TreeNode root1, TreeNode root2)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mergeBuild(root1,root2);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">mergeBuild</span><span class="params">(TreeNode root1,TreeNode root2)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(root1==<span class="literal">null</span> &amp;&amp; root2 != <span class="literal">null</span>) <span class="keyword">return</span> root2;</span><br><span class="line">        <span class="keyword">if</span>(root1!=<span class="literal">null</span> &amp;&amp; root2 == <span class="literal">null</span>) <span class="keyword">return</span> root1;</span><br><span class="line">        <span class="keyword">if</span>(root1==<span class="literal">null</span> &amp;&amp; root2==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">int</span> rootVal=root1.val+root2.val;</span><br><span class="line">        TreeNode root=<span class="keyword">new</span> <span class="title class_">TreeNode</span>(rootVal);</span><br><span class="line"></span><br><span class="line">        root.left=mergeBuild(root1.left,root2.left);</span><br><span class="line">        root.right=mergeBuild(root1.right,root2.right);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-29"   >
          <a href="#提交成功-29" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-29" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-29"   >
          <a href="#题解-29" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-29" class="headerlink" title="题解"></a>题解</h3>
      <p>思路：用前序遍历同步地遍历两个二叉树，将二叉树的根节点的数值相加，然后左右子树进行合并</p>
<p><strong>实现</strong></p>
<ul>
<li>递归的参数和返回值<ul>
<li>参数root1:第一颗二叉树</li>
<li>参数root2:第二颗二叉树</li>
<li>返回值TreeNode:二叉树的根节点</li>
</ul>
</li>
<li>递归的结束条件<ul>
<li>当root1为空root2不为空，则合并后的二叉树为root2，直接返回root2</li>
<li>当root1不为空root2为空，则合并后的二叉树为root1，直接返回root1</li>
<li>当root1为空且root2为空，则合并后的二叉树就是空结点，返回null</li>
</ul>
</li>
<li>单层递归的执行逻辑<ul>
<li>获取当前遍历的两个结点的值，相加成为新结点的数值</li>
<li>构造左子树，向左遍历root1和root2</li>
<li>构造右子树，向右遍历root1和root2</li>
<li>返回新的二叉树root</li>
</ul>
</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">mergeTrees</span><span class="params">(TreeNode root1, TreeNode root2)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mergeBuild(root1,root2);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">mergeBuild</span><span class="params">(TreeNode root1,TreeNode root2)</span>&#123;</span><br><span class="line">		<span class="comment">//如果root1为空root2不为空则传回root2</span></span><br><span class="line">        <span class="comment">//如果root1不为空root2为空则传回root1</span></span><br><span class="line">        <span class="comment">//如果roo1和root2都为空 则返回null;</span></span><br><span class="line">        <span class="keyword">if</span>(root1==<span class="literal">null</span> &amp;&amp; root2 != <span class="literal">null</span>) <span class="keyword">return</span> root2;</span><br><span class="line">        <span class="keyword">if</span>(root1!=<span class="literal">null</span> &amp;&amp; root2 == <span class="literal">null</span>) <span class="keyword">return</span> root1;</span><br><span class="line">        <span class="keyword">if</span>(root1==<span class="literal">null</span> &amp;&amp; root2==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">int</span> rootVal=root1.val+root2.val;</span><br><span class="line">        <span class="comment">//定义一个新的二叉树</span></span><br><span class="line">        TreeNode root=<span class="keyword">new</span> <span class="title class_">TreeNode</span>(rootVal);</span><br><span class="line">		<span class="comment">//向左遍历构造左子树</span></span><br><span class="line">        root.left=mergeBuild(root1.left,root2.left);</span><br><span class="line">        <span class="comment">//向右遍历构造右子树</span></span><br><span class="line">        root.right=mergeBuild(root1.right,root2.right);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h1 id="二叉搜索树中的搜索"   >
          <a href="#二叉搜索树中的搜索" class="heading-link"><i class="fas fa-link"></i></a><a href="#二叉搜索树中的搜索" class="headerlink" title="二叉搜索树中的搜索"></a>二叉搜索树中的搜索</h1>
      <p>给定二叉搜索树（BST）的根节点 <code>root</code> 和一个整数值 <code>val</code>。</p>
<p>你需要在 BST 中找到节点值等于 <code>val</code> 的节点。 返回以该节点为根的子树。 如果节点不存在，则返回 <code>null</code> 。</p>

        <h2 id="700-二叉搜索树中的搜索"   >
          <a href="#700-二叉搜索树中的搜索" class="heading-link"><i class="fas fa-link"></i></a><a href="#700-二叉搜索树中的搜索" class="headerlink" title="700.二叉搜索树中的搜索"></a>700.二叉搜索树中的搜索</h2>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/search-in-a-binary-search-tree/" >Leetcode.700题(easy)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-28"   >
          <a href="#第一次做-28" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-28" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;09&#x2F;03(上同，因为04号无法完成日常任务)</p>

        <h4 id="第一次代码-30"   >
          <a href="#第一次代码-30" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-30" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">searchBST</span><span class="params">(TreeNode root, <span class="type">int</span> val)</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> searchTree(root,val);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> TreeNode <span class="title function_">searchTree</span><span class="params">(TreeNode root,<span class="type">int</span> val)</span>&#123;</span><br><span class="line">       <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">       <span class="keyword">if</span>(root.val==val)&#123;</span><br><span class="line">           <span class="keyword">return</span> root;</span><br><span class="line">       &#125;<span class="keyword">else</span> <span class="keyword">if</span>(root.val&gt;val)&#123;</span><br><span class="line">           <span class="keyword">return</span> searchTree(root.left,val);</span><br><span class="line">       &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">           <span class="keyword">return</span> searchTree(root.right,val);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-30"   >
          <a href="#提交成功-30" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-30" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-30"   >
          <a href="#题解-30" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-30" class="headerlink" title="题解"></a>题解</h3>
      
        <h4 id="递归法"   >
          <a href="#递归法" class="heading-link"><i class="fas fa-link"></i></a><a href="#递归法" class="headerlink" title="递归法"></a>递归法</h4>
      <p>思路：因为二叉搜索树的特性，所以我们可以确认搜索的方向，所以这里不用在乎是前中后序</p>
<p><strong>实现</strong></p>
<ul>
<li><p>递归的返回值和参数</p>
<ul>
<li>参数root：二叉搜索树</li>
<li>参数val：搜索的目标值</li>
<li>返回值TreeNode：目标结点，如果没有找到则为null</li>
</ul>
</li>
<li><p>递归的结束条件：</p>
<ul>
<li>当root为空，则为空结点直接返回null</li>
<li>当root不为空<ul>
<li>root.val&#x3D;&#x3D;val：说明当前root是我们要搜索的目标结点，返回root</li>
<li>root.val&gt;val：说明当前结点值比目标结点值大，需要向左子树搜索</li>
<li>root.val&lt;val：说明当前结点值比目标结点小，需要向右子树搜索</li>
</ul>
</li>
</ul>
</li>
<li><p>单层递归的逻辑：</p>
<p>判断当前值和目标值的大小，确认搜索方向搜索</p>
</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">searchBST</span><span class="params">(TreeNode root, <span class="type">int</span> val)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> searchTree(root,val);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">searchTree</span><span class="params">(TreeNode root,<span class="type">int</span> val)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(root.val==val)&#123;</span><br><span class="line">            <span class="comment">//找到搜索结点</span></span><br><span class="line">            <span class="keyword">return</span> root;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(root.val&gt;val)&#123;</span><br><span class="line">            <span class="comment">//传入的数比根节点数小，向左子树搜索</span></span><br><span class="line">            <span class="keyword">return</span> searchTree(root.left,val);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//传入的数比根结点大，向右子树搜索</span></span><br><span class="line">            <span class="keyword">return</span> searchTree(root.right,val);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h4 id="迭代法"   >
          <a href="#迭代法" class="heading-link"><i class="fas fa-link"></i></a><a href="#迭代法" class="headerlink" title="迭代法"></a>迭代法</h4>
      <p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">searchBST</span><span class="params">(TreeNode root, <span class="type">int</span> val)</span> &#123;</span><br><span class="line">    	<span class="comment">//循环的条件为root不为空，说明二叉树还没有搜索完</span></span><br><span class="line">        <span class="keyword">while</span>(root!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">//当目标值和当前值相等，说明找到了结点，直接返回</span></span><br><span class="line">            <span class="keyword">if</span>(root.val==val) <span class="keyword">return</span> root;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(root.val&gt;val)&#123;</span><br><span class="line">                <span class="comment">//当根节点比目标值大，向左子树搜索</span></span><br><span class="line">                root=root.left;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(root.val&lt;val)&#123;</span><br><span class="line">                <span class="comment">//当根节点数比目标值小，向右子树搜索</span></span><br><span class="line">                root=root.right;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    	<span class="comment">//root==null 说明二叉树中没有这个结点返回null</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h1 id="验证二叉搜索树"   >
          <a href="#验证二叉搜索树" class="heading-link"><i class="fas fa-link"></i></a><a href="#验证二叉搜索树" class="headerlink" title="验证二叉搜索树"></a>验证二叉搜索树</h1>
      <p>给你一个二叉树的根节点 <code>root</code> ，判断其是否是一个有效的二叉搜索树。</p>
<p><strong>有效</strong> 二叉搜索树定义如下：</p>
<ul>
<li>节点的左子树只包含 <strong>小于</strong> 当前节点的数。</li>
<li>节点的右子树只包含 <strong>大于</strong> 当前节点的数。</li>
<li>所有左子树和右子树自身必须也是二叉搜索树。</li>
</ul>

        <h2 id="98-验证二叉搜索树"   >
          <a href="#98-验证二叉搜索树" class="heading-link"><i class="fas fa-link"></i></a><a href="#98-验证二叉搜索树" class="headerlink" title="98.验证二叉搜索树"></a>98.验证二叉搜索树</h2>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/validate-binary-search-tree/" >Leetcode.98题(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-29"   >
          <a href="#第一次做-29" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-29" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;09&#x2F;04</p>

        <h4 id="第一次代码-31"   >
          <a href="#第一次代码-31" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-31" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValidBST</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> checkTree(root);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkTree</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span>(root.left==<span class="literal">null</span> &amp;&amp; root.right==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="type">boolean</span> leftTree=checkTree(root.left);</span><br><span class="line">        <span class="keyword">if</span>(!leftTree) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">boolean</span> rightTree=checkTree(root.right);</span><br><span class="line">        <span class="keyword">if</span>(!rightTree) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(root.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(root.left.val&gt;root.val) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(root.right!=<span class="literal">null</span> &amp;&amp; root.right.val&lt;root.val) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-16"   >
          <a href="#提交失败-16" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-16" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE: root&#x3D;[2,2,2] 输出true 预期输出false</p>
<p>原因是左右子树的值应该小于和大于根节点的值，我判断中结点条件的时候没有将“等于”算在内</p>

        <h4 id="第二次代码-10"   >
          <a href="#第二次代码-10" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码-10" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValidBST</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> checkTree(root);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkTree</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span>(root.left==<span class="literal">null</span> &amp;&amp; root.right==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="type">boolean</span> leftTree=checkTree(root.left);</span><br><span class="line">        <span class="keyword">if</span>(!leftTree) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">boolean</span> rightTree=checkTree(root.right);</span><br><span class="line">        <span class="keyword">if</span>(!rightTree) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(root.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(root.left.val&gt;=root.val) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(root.right!=<span class="literal">null</span> &amp;&amp; root.right.val&lt;=root.val) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-17"   >
          <a href="#提交失败-17" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-17" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:[5,4,6,null,null,3,7] 输出true，预期输出false</p>
<p>原因是右子树的3超过了根节点的值 ，我判断了根节点和左右子树是否分别是搜索二叉树</p>

        <h4 id="第三次代码-3"   >
          <a href="#第三次代码-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#第三次代码-3" class="headerlink" title="第三次代码"></a>第三次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValidBST</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> checkTree(root);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkTree</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span>(root.left==<span class="literal">null</span> &amp;&amp; root.right==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="type">boolean</span> leftTree=checkTree(root.left);</span><br><span class="line">        <span class="keyword">if</span>(!leftTree) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">boolean</span> rightTree=checkTree(root.right);</span><br><span class="line">        <span class="keyword">if</span>(!rightTree) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//当左子树不为空搜索左子树中的最大值(向左子树的右子树的外侧搜索)，如果最大值都大于等于根结点则不是搜索二叉树</span></span><br><span class="line">        <span class="keyword">if</span>(root.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="type">int</span> max=root.left.val;</span><br><span class="line">            TreeNode left=root.left;</span><br><span class="line">            <span class="keyword">while</span>(left.right!=<span class="literal">null</span>)&#123;</span><br><span class="line">                max=left.right.val;</span><br><span class="line">                left=left.right;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(max&gt;=root.val) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//当右子树不为空搜索右子树中的最小值(向右子树的左子树的外侧搜索)，如果最小值都小于等于根结点值则根结点不是搜索二叉树</span></span><br><span class="line">        <span class="keyword">if</span>(root.right!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="type">int</span> min=root.right.val;</span><br><span class="line">            TreeNode right=root.right;</span><br><span class="line">            <span class="keyword">while</span>(right.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">                min=right.left.val;</span><br><span class="line">                right=right.left;              </span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(min&lt;=root.val) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-31"   >
          <a href="#提交成功-31" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-31" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-31"   >
          <a href="#题解-31" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-31" class="headerlink" title="题解"></a>题解</h3>
      
        <h4 id="后序遍历-3"   >
          <a href="#后序遍历-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#后序遍历-3" class="headerlink" title="后序遍历"></a>后序遍历</h4>
      <p>思路：利用后序遍历(左右中)验证左右子树是否是二叉搜索树再验证根节点是否是二叉搜索树。在验证根节点的时候利用二叉搜索树的特性找到左子树的最大值和右子树的最小值与根节点数值进行比较。</p>
<p><strong>实现</strong></p>
<ul>
<li>递归遍历的参数和返回值<ul>
<li>参数root:要验证是否是二叉搜索树的根节点</li>
<li>返回值：true表示是二叉搜索树，false表示不是二叉搜索树</li>
</ul>
</li>
<li>递归的结束条件<ul>
<li>如果root&#x3D;&#x3D;null，说明是空结点则返回true</li>
<li>如果root.left&#x3D;&#x3D;null &amp;&amp; root.right&#x3D;&#x3D;null结点则返回true</li>
<li>如果左右子树有一个不是二叉搜索树，那么整个树都不会是二叉搜索树，返回false</li>
</ul>
</li>
<li>单层递归的逻辑<ul>
<li>验证左子树是否是二叉搜索树，如果左子树不是二叉搜索树返回false</li>
<li>验证右子树是否是二叉搜索树，如果右子树不是二叉搜索树返回false</li>
<li>验证根节点是否是二叉搜索树<ul>
<li>如果左子树不为空搜索左子树的最大值，利用二叉搜索树的特性，搜索左子树的右子树外侧的值，最右边的值就是最大值</li>
<li>如果右子树不为空搜索右子树的最小值，利用二叉搜索树的特性，搜索右子树的左子树外侧的值，最左边的值就是最小值</li>
<li>判断最大值是否都小于根结点的值，判断最小值是否都大于根结点的值</li>
<li>如果符合二叉搜索树返回true</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValidBST</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> checkTree(root);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkTree</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">        <span class="comment">//空结点和叶子结点是二叉搜索树，返回true</span></span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span>(root.left==<span class="literal">null</span> &amp;&amp; root.right==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="comment">//验证左子树是否是二叉搜索树，下同验证右子树</span></span><br><span class="line">        <span class="type">boolean</span> leftTree=checkTree(root.left);</span><br><span class="line">        <span class="keyword">if</span>(!leftTree) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">boolean</span> rightTree=checkTree(root.right);</span><br><span class="line">        <span class="keyword">if</span>(!rightTree) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//当左子树不为空搜索左子树中的最大值(向左子树的右子树的外侧搜索)，如果最大值都大于等于根结点则不是搜索二叉树</span></span><br><span class="line">        <span class="keyword">if</span>(root.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="type">int</span> max=root.left.val;</span><br><span class="line">            TreeNode left=root.left;</span><br><span class="line">            <span class="keyword">while</span>(left.right!=<span class="literal">null</span>)&#123;</span><br><span class="line">                max=left.right.val;</span><br><span class="line">                left=left.right;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(max&gt;=root.val) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//当右子树不为空搜索右子树中的最小值(向右子树的左子树的外侧搜索)，如果最小值都小于等于根结点值则根结点不是搜索二叉树</span></span><br><span class="line">        <span class="keyword">if</span>(root.right!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="type">int</span> min=root.right.val;</span><br><span class="line">            TreeNode right=root.right;</span><br><span class="line">            <span class="keyword">while</span>(right.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">                min=right.left.val;</span><br><span class="line">                right=right.left;              </span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(min&lt;=root.val) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h4 id="中序遍历-3"   >
          <a href="#中序遍历-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#中序遍历-3" class="headerlink" title="中序遍历"></a>中序遍历</h4>
      <p>利用二叉搜索树的特性，利用中序遍历(左中右)就可以获得二叉树搜索的结点序列，如果序列是单调递增的那么就是二叉搜索树</p>
<blockquote>
<p>二叉搜索树的中序遍历会将所有结点单调升序输出，这是二叉搜索树有序性的体现之一</p>
</blockquote>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="https://images-kkblog.oss-cn-hangzhou.aliyuncs.com/image-20230904091829189.png"  alt="二叉搜索树的中序遍历">
      </p>
<p><strong>实现</strong></p>
<ul>
<li><p>递归函数的参数和返回值</p>
<ul>
<li>参数root:判断是否是搜索二叉树的根节点</li>
<li>返回值：如果是搜索二叉树返回true，反之返回false</li>
</ul>
</li>
<li><p>递归函数的结束条件</p>
<ul>
<li>当root&#x3D;&#x3D;null 也即root为空结点返回true，是二叉搜索树</li>
<li>当前一个结点的值大于等于当前结点的值，说明不是单调递增，返回false，不是二叉搜索树</li>
<li>当左右搜索结果有一个不是二叉搜索树返回false</li>
</ul>
</li>
<li><p>单层递归逻辑</p>
<ul>
<li>判断左子树是否是二叉搜索树</li>
<li>判断当前结点和前一个结点的值，如果当前结点的值小于等于前一个结点的值则不适合搜索二叉树<ul>
<li>当pre&#x3D;&#x3D;null，说明没有前一个结点，当前结点是第一个叶子结点不会进入判断，而是将pre设为当前结点返回true</li>
<li>当pre!&#x3D;null，则判断root和pre的val数值，如果root.val&lt;&#x3D;pre.val 返回false</li>
</ul>
</li>
<li>将pre指向当前结点，为了准备遍历右子树</li>
<li>判断右子树是否是二叉搜索树</li>
</ul>
<blockquote>
<p>因为中序遍历的时候符合二叉搜索树的单调递增，所以前一个结点pre就指向当前结点的升序序列的前一个结点</p>
</blockquote>
</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>&#123;	</span><br><span class="line">	TreeNode pre;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValidBST</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        pre=<span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">return</span> checkTree(root);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkTree</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">        <span class="comment">//如果是空结点则是搜索二叉树</span></span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//向左子树判断是否是搜索二叉树</span></span><br><span class="line">        <span class="type">boolean</span> left=checkTree(root.left);</span><br><span class="line">        <span class="comment">//当前结点值大于等于当前结点值 则不是搜索二叉树</span></span><br><span class="line">        <span class="keyword">if</span>(pre!=<span class="literal">null</span> &amp;&amp; pre.val&gt;=root.val) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        pre=root;</span><br><span class="line">		<span class="comment">//向右子树判断是否是搜索二叉树</span></span><br><span class="line">        <span class="type">boolean</span> right=checkTree(root.right);</span><br><span class="line">        <span class="comment">//如果左子树或者右子树有一个不是搜索二叉树则整棵树不是搜索二叉树</span></span><br><span class="line">        <span class="keyword">if</span>(!left || !right) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    </span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h1 id="二叉搜索树的最小绝对差"   >
          <a href="#二叉搜索树的最小绝对差" class="heading-link"><i class="fas fa-link"></i></a><a href="#二叉搜索树的最小绝对差" class="headerlink" title="二叉搜索树的最小绝对差"></a>二叉搜索树的最小绝对差</h1>
      <p>给你一个二叉搜索树的根节点 <code>root</code> ，返回 <strong>树中任意两不同节点值之间的最小差值</strong> 。</p>
<p>差值是一个正数，其数值等于两值之差的绝对值。</p>

        <h2 id="530-二叉搜索树的最小绝对差"   >
          <a href="#530-二叉搜索树的最小绝对差" class="heading-link"><i class="fas fa-link"></i></a><a href="#530-二叉搜索树的最小绝对差" class="headerlink" title="530.二叉搜索树的最小绝对差"></a>530.二叉搜索树的最小绝对差</h2>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/minimum-absolute-difference-in-bst/description/" >Leetcode.530题(easy)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-30"   >
          <a href="#第一次做-30" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-30" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;09&#x2F;04</p>

        <h4 id="第一次代码-32"   >
          <a href="#第一次代码-32" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-32" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> min=Integer.MAX_VALUE;</span><br><span class="line">   <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getMinimumDifference</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">       getMinDistinct(root);</span><br><span class="line">       <span class="keyword">return</span> min;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getMinDistinct</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">       <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> ;</span><br><span class="line">       getMinDistinct(root.left);</span><br><span class="line">       <span class="keyword">if</span>(root.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">           <span class="type">int</span> distinct=root.val-root.left.val &lt;<span class="number">0</span>? root.left.val-root.val : root.val-root.left.val;</span><br><span class="line">           <span class="keyword">if</span>(distinct&lt;=min) min=distinct;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span>(root.right!=<span class="literal">null</span>)&#123;</span><br><span class="line">           <span class="type">int</span> distinct=root.val-root.right.val &lt;<span class="number">0</span> ? root.right.val-root.val: root.val-root.right.val;</span><br><span class="line">           <span class="keyword">if</span>(distinct&lt;=min) min=distinct;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       getMinDistinct(root.right);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-18"   >
          <a href="#提交失败-18" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-18" class="headerlink" title="提交失败"></a>提交失败</h5>
      
        <h4 id="第二次代码-11"   >
          <a href="#第二次代码-11" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码-11" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    TreeNode pre;</span><br><span class="line">    <span class="type">int</span> min=Integer.MAX_VALUE;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getMinimumDifference</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        pre=<span class="literal">null</span>;</span><br><span class="line">        getMinDistinct(root);</span><br><span class="line">        <span class="keyword">return</span> min;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">getMinDistinct</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        getMinDistinct(root.left);</span><br><span class="line">        <span class="keyword">if</span>(pre!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="type">int</span> distinct=root.val-pre.val&gt;<span class="number">0</span>?root.val-pre.val :pre.val-root.val;</span><br><span class="line">            <span class="keyword">if</span>(distinct&lt;min) min=distinct;</span><br><span class="line">        &#125;</span><br><span class="line">        pre=root;</span><br><span class="line">        getMinDistinct(root.right);</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-32"   >
          <a href="#提交成功-32" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-32" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-32"   >
          <a href="#题解-32" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-32" class="headerlink" title="题解"></a>题解</h3>
      <p><strong>思路</strong>：我们中序遍历，然后用双指针，以及一个全局变量最小值以此获取最小绝对值</p>
<blockquote>
<p>搜索二叉树的中序遍历可以将全部结点以升序的方式输出</p>
</blockquote>
<p><strong>实现</strong></p>
<ul>
<li>定义一个pre，用于指向当前遍历的前一个结点</li>
<li>定义一个min，用于表示整个遍历过程的最小绝对差。初始化为Intger.MAX_VALUE，最大值</li>
<li>递归函数的参数和返回值<ul>
<li>参数root：要获取距离差最小值的二叉树根节点</li>
<li>返回值：void</li>
</ul>
</li>
<li>递归的结束条件<ul>
<li>当root&#x3D;&#x3D;null：为空节点直接结束</li>
<li>当左右子树遍历完即可结束</li>
</ul>
</li>
<li>单层递归实现逻辑<ul>
<li>遍历左子树，获取左子树的最小绝对差</li>
<li>判断前一个结点和当前结点的绝对差<ul>
<li>如果pre为空，说明这是二叉树的第一个结点，将pre指向当前结点然后结束即可</li>
<li>如果pre不为空，获取pre的值和root的值差值，如果差值小于min。则将min更新成当前差值</li>
</ul>
</li>
<li>将pre指向当前结点，为了准备遍历右子树</li>
<li>遍历右子树</li>
</ul>
</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    TreeNode pre;</span><br><span class="line">    <span class="type">int</span> min=Integer.MAX_VALUE;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getMinimumDifference</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        pre=<span class="literal">null</span>;</span><br><span class="line">        getMinDistinct(root);</span><br><span class="line">        <span class="keyword">return</span> min;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getMinDistinct</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> ;</span><br><span class="line">        getMinDistinct(root.left);</span><br><span class="line">        <span class="keyword">if</span>(pre!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="type">int</span> distinct=root.val-pre.val&gt;<span class="number">0</span>?root.val-pre.val :pre.val-root.val;</span><br><span class="line">            <span class="keyword">if</span>(distinct&lt;min) min=distinct;</span><br><span class="line">        &#125;</span><br><span class="line">        pre=root;</span><br><span class="line">        getMinDistinct(root.right);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h1 id="二叉搜索树中的众数"   >
          <a href="#二叉搜索树中的众数" class="heading-link"><i class="fas fa-link"></i></a><a href="#二叉搜索树中的众数" class="headerlink" title="二叉搜索树中的众数"></a>二叉搜索树中的众数</h1>
      <p>给你一个含重复值的二叉搜索树（BST）的根节点 <code>root</code> ，找出并返回 BST 中的所有 <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E4%BC%97%E6%95%B0/44796" >众数</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>（即，出现频率最高的元素）。</p>
<p>如果树中有不止一个众数，可以按 <strong>任意顺序</strong> 返回。</p>
<p>假定 BST 满足如下定义：</p>
<ul>
<li>结点左子树中所含节点的值 <strong>小于等于</strong> 当前节点的值</li>
<li>结点右子树中所含节点的值 <strong>大于等于</strong> 当前节点的值</li>
<li>左子树和右子树都是二叉搜索树</li>
</ul>

        <h2 id="501-二叉搜索树中的众数"   >
          <a href="#501-二叉搜索树中的众数" class="heading-link"><i class="fas fa-link"></i></a><a href="#501-二叉搜索树中的众数" class="headerlink" title="501.二叉搜索树中的众数"></a>501.二叉搜索树中的众数</h2>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/find-mode-in-binary-search-tree/" >Leetcode.501题(easy)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-31"   >
          <a href="#第一次做-31" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-31" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;09&#x2F;05</p>

        <h4 id="第一次代码-33"   >
          <a href="#第一次代码-33" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-33" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    HashMap&lt;Integer,Integer&gt; map;</span><br><span class="line">    <span class="type">int</span> max=Integer.MAX_VALUE+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] findMode(TreeNode root) &#123;</span><br><span class="line">        map=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        findMaxValue(root);</span><br><span class="line">        <span class="type">int</span>[] arr=<span class="keyword">new</span> <span class="title class_">int</span>[map.size()];</span><br><span class="line">        <span class="type">int</span> i=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> num=<span class="number">0</span>;</span><br><span class="line">        ArrayList&lt;Integer&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(Map.Entry&lt;Integer,Integer&gt; entry:map.entrySet())&#123;</span><br><span class="line">            <span class="type">int</span> key=entry.getKey();</span><br><span class="line">            <span class="type">int</span> value=entry.getValue();</span><br><span class="line">            arr[i++]=value;</span><br><span class="line">            <span class="keyword">if</span>(value&gt;max)&#123;</span><br><span class="line">                num=<span class="number">1</span>;</span><br><span class="line">                list.clear();</span><br><span class="line">                list.add(key);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(value==max)&#123;</span><br><span class="line">                num++;</span><br><span class="line">                list.add(key);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span>[] result=<span class="keyword">new</span> <span class="title class_">int</span>[num];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;num;j++)&#123;</span><br><span class="line">            result[j]=list.get(j);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findMaxValue</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> ;</span><br><span class="line">        findMaxValue(root.left);</span><br><span class="line">        map.put(root.val,map.getOrDefault(root.val,<span class="number">0</span>)+<span class="number">1</span>);</span><br><span class="line">        findMaxValue(root.right);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-19"   >
          <a href="#提交失败-19" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-19" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:root&#x3D;[1,null,2] 输出[2] 预期输出[1,2]</p>

        <h4 id="第二次代码-12"   >
          <a href="#第二次代码-12" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码-12" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    HashMap&lt;Integer,Integer&gt; map;</span><br><span class="line">    <span class="type">int</span> max=Integer.MAX_VALUE+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] findMode(TreeNode root) &#123;</span><br><span class="line">        map=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        findMaxValue(root);</span><br><span class="line">        <span class="type">int</span>[] arr=<span class="keyword">new</span> <span class="title class_">int</span>[map.size()];</span><br><span class="line">        <span class="type">int</span> i=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> num=<span class="number">0</span>;</span><br><span class="line">        ArrayList&lt;Integer&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(Map.Entry&lt;Integer,Integer&gt; entry:map.entrySet())&#123;</span><br><span class="line">            <span class="type">int</span> key=entry.getKey();</span><br><span class="line">            <span class="type">int</span> value=entry.getValue();</span><br><span class="line">            arr[i++]=value;</span><br><span class="line">            <span class="keyword">if</span>(value&gt;max)&#123;</span><br><span class="line">                num=<span class="number">1</span>;</span><br><span class="line">                max=value;</span><br><span class="line">                list.clear();</span><br><span class="line">                list.add(key);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(value==max)&#123;</span><br><span class="line">                num++;</span><br><span class="line">                list.add(key);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span>[] result=<span class="keyword">new</span> <span class="title class_">int</span>[num];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;num;j++)&#123;</span><br><span class="line">            result[j]=list.get(j);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findMaxValue</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> ;</span><br><span class="line">        findMaxValue(root.left);</span><br><span class="line">        map.put(root.val,map.getOrDefault(root.val,<span class="number">0</span>)+<span class="number">1</span>);</span><br><span class="line">        findMaxValue(root.right);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-33"   >
          <a href="#提交成功-33" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-33" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-33"   >
          <a href="#题解-33" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-33" class="headerlink" title="题解"></a>题解</h3>
      <p><strong>双指针</strong></p>
<p>BF解法思路是：遍历一遍二叉搜索树，得到元素出现的最高频率，然后再遍历一遍二叉搜索树，将频率相等的元素放进结果集中</p>
<p><strong>双指针</strong>的思路：只需遍历一遍二叉树，动态更新结果集合最高频率</p>
<p><strong>实现</strong></p>
<ul>
<li><p>我们这里要用中序遍历，因为二叉搜索树的中序遍历有序性，所有结点会以单调不减的序列输出</p>
</li>
<li><p>定义全局变量</p>
<ul>
<li>pre:用于指向前一个结点，双指针中前面的指针</li>
<li>count:用于统计两个指针之间元素出现的个数</li>
<li>maxCount:用于统计整个二叉搜索树的最大出现次数</li>
<li>list:用于收获结果集，存放最大次数的结点值</li>
</ul>
</li>
<li><p>递归函数的返回值和参数</p>
<ul>
<li>返回值：void</li>
<li>参数cur：根节点root，双指针中后面的指针</li>
</ul>
</li>
<li><p>递归函数的结束条件</p>
<p>当cur&#x3D;&#x3D;null，说明当前结点遍历到空结点也即二叉树最右下角的结点，遍历结束直接return</p>
</li>
<li><p>递归函数的单层逻辑</p>
<ul>
<li><p>遍历左子树。统计左子树中的众数</p>
</li>
<li><p>处理中结点逻辑</p>
<ul>
<li>判断前一个结点和当前结点的状态<ul>
<li>pre&#x3D;&#x3D;null，说明cur是第一个结点。count&#x3D;1(出现一次)</li>
<li>pre!&#x3D;null并且pre.val&#x3D;&#x3D;cur.val，说明前后结点值相同。count++</li>
<li>pre!&#x3D;null并且pre.val !&#x3D; cur.val，说明前后结点值不同，重新计数，count&#x3D;1</li>
</ul>
</li>
<li>pre指向当前结点cur</li>
<li>判断count和maxCount的值<ul>
<li>如果count&#x3D;&#x3D;maxCount，说明当前结点也是众数，list.add(cur.val)</li>
<li>如果count&gt;maxCount，说明当前结点才是众数，要清空原来的list(list.clear())，将当前结点值加入集合list.add(cur.val)</li>
</ul>
</li>
</ul>
</li>
<li><p>遍历右子树。统计右子树中的众数</p>
</li>
</ul>
</li>
<li><p>将list集合转换成数组</p>
</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="comment">//指向前一个结点</span></span><br><span class="line">    TreeNode pre=<span class="literal">null</span>;</span><br><span class="line">    <span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> maxCount=<span class="number">0</span>;</span><br><span class="line">    List&lt;Integer&gt; list;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] findMode(TreeNode root) &#123;</span><br><span class="line">        list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        terversal(root);</span><br><span class="line">        <span class="comment">//集合转化成数组</span></span><br><span class="line">        <span class="type">int</span>[] result=<span class="keyword">new</span> <span class="title class_">int</span>[list.size()];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;list.size();i++)&#123;</span><br><span class="line">            result[i]=list.get(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">terversal</span><span class="params">(TreeNode cur)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(cur==<span class="literal">null</span>) <span class="keyword">return</span> ;</span><br><span class="line">        <span class="comment">//左</span></span><br><span class="line">        terversal(cur.left);</span><br><span class="line">        <span class="comment">//统计频率</span></span><br><span class="line">        <span class="keyword">if</span>(pre==<span class="literal">null</span>) count=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(pre!=<span class="literal">null</span> &amp;&amp; cur.val==pre.val)&#123;</span><br><span class="line">            count++;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(cur.val!=pre.val) count=<span class="number">1</span>;</span><br><span class="line">        <span class="comment">//移动指针</span></span><br><span class="line">        pre=cur;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//收获结果集</span></span><br><span class="line">        <span class="keyword">if</span>(count==maxCount)&#123;</span><br><span class="line">            list.add(cur.val);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(count&gt;maxCount)&#123;</span><br><span class="line">            maxCount=count;</span><br><span class="line">            list.clear();</span><br><span class="line">            list.add(cur.val);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//右</span></span><br><span class="line">        terversal(cur.right);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h1 id="二叉树的最近公共祖先"   >
          <a href="#二叉树的最近公共祖先" class="heading-link"><i class="fas fa-link"></i></a><a href="#二叉树的最近公共祖先" class="headerlink" title="二叉树的最近公共祖先"></a>二叉树的最近公共祖先</h1>
      <p>给定一个二叉树, 找到该树中两个指定节点的最近公共祖先。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%9C%80%E8%BF%91%E5%85%AC%E5%85%B1%E7%A5%96%E5%85%88/8918834?fr=aladdin" >百度百科</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>中最近公共祖先的定义为：“对于有根树 T 的两个节点 p、q，最近公共祖先表示为一个节点 x，满足 x 是 p、q 的祖先且 x 的深度尽可能大（<strong>一个节点也可以是它自己的祖先</strong>）。“</p>

        <h2 id="236-二叉树的最近公共祖先"   >
          <a href="#236-二叉树的最近公共祖先" class="heading-link"><i class="fas fa-link"></i></a><a href="#236-二叉树的最近公共祖先" class="headerlink" title="236.二叉树的最近公共祖先"></a>236.二叉树的最近公共祖先</h2>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/lowest-common-ancestor-of-a-binary-tree/" >Leetcode.236题(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-32"   >
          <a href="#第一次做-32" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-32" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;09&#x2F;05</p>

        <h4 id="第一次代码-34"   >
          <a href="#第一次代码-34" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-34" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">lowestCommonAncestor</span><span class="params">(TreeNode root, TreeNode p, TreeNode q)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> findDepthFather(root,p,q);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">findDepthFather</span><span class="params">(TreeNode root,TreeNode p,TreeNode q)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==p || root==q) <span class="keyword">return</span> root;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(root.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(findNode(root.left,p)&amp;&amp;findNode(root.left,q))&#123;</span><br><span class="line">                <span class="keyword">return</span> findDepthFather(root.left,p,q);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(root.right!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>((findNode(root.right,p)&amp;&amp; findNode(root.right,q)))&#123;</span><br><span class="line">                <span class="keyword">return</span> findDepthFather(root.right,p,q);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">findNode</span><span class="params">(TreeNode root,TreeNode target)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root.left==<span class="literal">null</span> &amp;&amp; root.right==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(root==target) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">boolean</span> left=<span class="literal">false</span>;</span><br><span class="line">        <span class="type">boolean</span> right=<span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span>(root.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">            left=findNode(root.left,target);</span><br><span class="line">            <span class="keyword">if</span>(left) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(root.right!=<span class="literal">null</span>)&#123;</span><br><span class="line">            right=findNode(root.right,target);</span><br><span class="line">            <span class="keyword">if</span>(right) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-20"   >
          <a href="#提交失败-20" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-20" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>root&#x3D;[3,5,1,6,2,0,8,null,null,7,4]，p&#x3D;5，q&#x3D;4 输出 3 预期输出5</p>
<p>找结点的时候忘了处理中结点逻辑</p>

        <h4 id="第二次代码-13"   >
          <a href="#第二次代码-13" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码-13" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">lowestCommonAncestor</span><span class="params">(TreeNode root, TreeNode p, TreeNode q)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> findDepthFather(root,p,q);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">findDepthFather</span><span class="params">(TreeNode root,TreeNode p,TreeNode q)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root.val==p.val || root.val==q.val) <span class="keyword">return</span> root;</span><br><span class="line">        <span class="comment">//当左子树非空向左找最深的共同祖先</span></span><br><span class="line">        <span class="keyword">if</span>(root.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(findNode(root.left,p)&amp;&amp;findNode(root.left,q))&#123;</span><br><span class="line">                <span class="keyword">return</span> findDepthFather(root.left,p,q);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//当右子树非空向右找最深的共同祖先</span></span><br><span class="line">        <span class="keyword">if</span>(root.right!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>((findNode(root.right,p)&amp;&amp; findNode(root.right,q)))&#123;</span><br><span class="line">                <span class="keyword">return</span> findDepthFather(root.right,p,q);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//左右都没找到就当前节点是最深共同祖先</span></span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">findNode</span><span class="params">(TreeNode root,TreeNode target)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root.left==<span class="literal">null</span> &amp;&amp; root.right==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(root.val==target.val) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">boolean</span> left=<span class="literal">false</span>;</span><br><span class="line">        <span class="type">boolean</span> right=<span class="literal">false</span>;</span><br><span class="line">        <span class="comment">//当左结点非空判断左子树是否含有target</span></span><br><span class="line">        <span class="keyword">if</span>(root.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">            left=findNode(root.left,target);</span><br><span class="line">            <span class="keyword">if</span>(left) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//当右结点非空判断右子树是否含有target</span></span><br><span class="line">        <span class="keyword">if</span>(root.right!=<span class="literal">null</span>)&#123;</span><br><span class="line">            right=findNode(root.right,target);</span><br><span class="line">            <span class="keyword">if</span>(right) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//中结点值和target相等则返回true</span></span><br><span class="line">        <span class="keyword">if</span>(root.val==target.val) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-34"   >
          <a href="#提交成功-34" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-34" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-34"   >
          <a href="#题解-34" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-34" class="headerlink" title="题解"></a>题解</h3>
      <p><strong>思路</strong>：利用后序遍历来判断最近公共祖先，通过左右子树的最近公共祖先结果来一层层地向根节点返回，虽然是从上往下遍历，但是处理过程是从下往上，这个部分需要用到回溯的思想</p>
<p><strong>实现</strong></p>
<ul>
<li><p>递归函数的返回值和参数</p>
<ul>
<li>返回值：TreeNode，共同祖先，如果为空则没有找到。</li>
<li>参数root：树的根节点</li>
<li>参数p：要搜索的结点之一</li>
<li>参数q：要搜索的结点之一</li>
</ul>
</li>
<li><p>递归函数的结束条件</p>
<ul>
<li>当root&#x3D;&#x3D;null，即遇到空节点返回空，没有公共祖先</li>
<li>当root&#x3D;&#x3D;p或者root&#x3D;&#x3D;q，说明公共祖先就是root，或者遍历中找到了p或者q</li>
</ul>
</li>
<li><p>单层递归的处理逻辑</p>
<ul>
<li><p>向左搜索结点，记录为left</p>
</li>
<li><p>向右搜索结点，记录为right</p>
</li>
<li><p>处理中结点的逻辑</p>
<ul>
<li>当left为空且right为空，说明没有找到公共祖先，返回null</li>
<li>当left不为空且right不为空，说明left包含q和p之一，right也包含p和q之一【题目说明不会重复，所以left和right包含的结点不会是同一个结点】</li>
<li>当left为空且right不为空说明左子树中找到了结点，所以返回left</li>
<li>当left不为空且right为空说明右子树中找打了结点，所以返回right</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">lowestCommonAncestor</span><span class="params">(TreeNode root, TreeNode p, TreeNode q)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> findDepthFather(root,p,q);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">findDepthFather</span><span class="params">(TreeNode root,TreeNode p,TreeNode q)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">//如果当前结点是p或者q即根节点就是最近祖先 返回root</span></span><br><span class="line">        <span class="keyword">if</span>(root==p || root== q) <span class="keyword">return</span> root;</span><br><span class="line">		<span class="comment">//向左搜索左结点</span></span><br><span class="line">        TreeNode left= findDepthFather(root.left,p,q);</span><br><span class="line">        <span class="comment">//向右搜索右结点</span></span><br><span class="line">        TreeNode right=findDepthFather(root.right,p,q);</span><br><span class="line">		<span class="comment">//左右不为空找到祖先为root，左不为空右为空向上返回左结点，左为空右不为空向上返回右结点，左右都为空则返回空</span></span><br><span class="line">        <span class="keyword">if</span>(left!=<span class="literal">null</span> &amp;&amp;right!=<span class="literal">null</span>) <span class="keyword">return</span> root;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(left!=<span class="literal">null</span> &amp;&amp;right==<span class="literal">null</span>) <span class="keyword">return</span> left;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(left==<span class="literal">null</span> &amp;&amp; right!=<span class="literal">null</span>) <span class="keyword">return</span> right;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;  </span><br></pre></td></tr></table></div></figure>


        <h1 id="二叉搜索树的最近公共祖先"   >
          <a href="#二叉搜索树的最近公共祖先" class="heading-link"><i class="fas fa-link"></i></a><a href="#二叉搜索树的最近公共祖先" class="headerlink" title="二叉搜索树的最近公共祖先"></a>二叉搜索树的最近公共祖先</h1>
      <p>给定一个二叉搜索树, 找到该树中两个指定节点的最近公共祖先。</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%9C%80%E8%BF%91%E5%85%AC%E5%85%B1%E7%A5%96%E5%85%88/8918834?fr=aladdin" >百度百科</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>中最近公共祖先的定义为：“对于有根树 T 的两个结点 p、q，最近公共祖先表示为一个结点 x，满足 x 是 p、q 的祖先且 x 的深度尽可能大（<strong>一个节点也可以是它自己的祖先</strong>）。”</p>
<p>例如，给定如下二叉搜索树: root &#x3D; [6,2,8,0,4,7,9,null,null,3,5]</p>

        <h2 id="235-二叉搜索树的最近公共祖先"   >
          <a href="#235-二叉搜索树的最近公共祖先" class="heading-link"><i class="fas fa-link"></i></a><a href="#235-二叉搜索树的最近公共祖先" class="headerlink" title="235.二叉搜索树的最近公共祖先"></a>235.二叉搜索树的最近公共祖先</h2>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/lowest-common-ancestor-of-a-binary-search-tree/" >Leetcode.235题(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-33"   >
          <a href="#第一次做-33" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-33" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;09&#x2F;06</p>

        <h4 id="第一次代码-35"   >
          <a href="#第一次代码-35" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-35" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">lowestCommonAncestor</span><span class="params">(TreeNode root, TreeNode p, TreeNode q)</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> tervalse(root,p,q);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> TreeNode <span class="title function_">tervalse</span><span class="params">(TreeNode root,TreeNode p, TreeNode q)</span>&#123;</span><br><span class="line">       <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">       <span class="keyword">if</span>(root==p  || root==q) <span class="keyword">return</span> root;</span><br><span class="line">       <span class="keyword">if</span>(root.val&gt;=p.val &amp;&amp; root.val&gt;=q.val)&#123;</span><br><span class="line">           <span class="keyword">return</span> tervalse(root.left,p,q);</span><br><span class="line">       &#125;<span class="keyword">else</span> <span class="keyword">if</span>(root.val&lt;=p.val &amp;&amp; root.val&lt;=q.val)&#123;</span><br><span class="line">           <span class="keyword">return</span> tervalse(root.right,p,q);</span><br><span class="line">       &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">           TreeNode left=tervalse(root.left,p,q);</span><br><span class="line">           TreeNode right=tervalse(root.right,p,q);</span><br><span class="line">           <span class="keyword">if</span>(left==<span class="literal">null</span> &amp;&amp; right ==<span class="literal">null</span> ) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">           <span class="keyword">else</span> <span class="keyword">if</span>(left!=<span class="literal">null</span> &amp;&amp; right==<span class="literal">null</span>) <span class="keyword">return</span> left;</span><br><span class="line">           <span class="keyword">else</span> <span class="keyword">if</span>(left==<span class="literal">null</span> &amp;&amp; right!=<span class="literal">null</span>) <span class="keyword">return</span> right;</span><br><span class="line">           <span class="keyword">else</span> <span class="keyword">if</span>(left!=<span class="literal">null</span> &amp;&amp; right!=<span class="literal">null</span>) <span class="keyword">return</span> root; </span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-35"   >
          <a href="#提交成功-35" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-35" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-35"   >
          <a href="#题解-35" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-35" class="headerlink" title="题解"></a>题解</h3>
      
        <h4 id="递归法-1"   >
          <a href="#递归法-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#递归法-1" class="headerlink" title="递归法"></a>递归法</h4>
      <p>思想：因为二叉搜索树的特性，我们可以判断pq的值与root的值确定搜索方向，当root在pq中间的时候，说明root就是最近公共祖先</p>
<p><strong>实现</strong></p>
<ul>
<li>递归函数的参数和返回值<ul>
<li>参数root：用于搜索的结点</li>
<li>参数p：要搜索的两个结点之一</li>
<li>参数q：要搜索的两个结点之一</li>
</ul>
</li>
<li>递归参数的结束条件<ul>
<li>当root为空，说明空结点返回为空</li>
<li>当root&#x3D;&#x3D;p或者root&#x3D;&#x3D;q，说明找到两个结点之一，或者这个结点就是这两个结点的公共祖先，返回root</li>
</ul>
</li>
<li>单层递归的处理逻辑<ul>
<li>如果root.val&gt;&#x3D;p.val &amp;&amp; root.val&gt;&#x3D;q.val 也即<strong>中间结点值比两个结点都大</strong>，所以pq一定在root的左子树中，递归向左子树搜索最近公共祖先</li>
<li>如果root.val&lt;&#x3D;p.val &amp;&amp; root.val&lt;&#x3D;q.val 也即<strong>中间结点值比两个结点都小</strong>，所以pq一定在root的右子树中，递归向右子树搜索最近公共祖先</li>
<li>如果不符合上面两个条件，说明p和q分别在root左右，也即<strong>中间结点值处于两个结点之间</strong>，所以最近公共祖先也即root</li>
</ul>
</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">lowestCommonAncestor</span><span class="params">(TreeNode root, TreeNode p, TreeNode q)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> tervalse(root,p,q);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">tervalse</span><span class="params">(TreeNode root,TreeNode p, TreeNode q)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(root==p  || root==q) <span class="keyword">return</span> root;</span><br><span class="line">        <span class="keyword">if</span>(root.val&gt;=p.val &amp;&amp; root.val&gt;=q.val)&#123;</span><br><span class="line">            <span class="comment">//根节点值比两个结点都大，所以最近公共祖先在根结点的左子树中，也即pq都在root左子树</span></span><br><span class="line">            <span class="keyword">return</span> tervalse(root.left,p,q);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(root.val&lt;=p.val &amp;&amp; root.val&lt;=q.val)&#123;</span><br><span class="line">           	<span class="comment">//根节点值比两个结点都小，所以最近公共祖先在根结点的右子树中，也即pq都在root右子树</span></span><br><span class="line">            <span class="keyword">return</span> tervalse(root.right,p,q);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//root在pq中间，所以root也即最近公共祖先</span></span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>




        <h4 id="迭代法-1"   >
          <a href="#迭代法-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#迭代法-1" class="headerlink" title="迭代法"></a>迭代法</h4>
      <p>思路：因为二叉搜索树的特性，所以搜索方向能够确定，迭代法的题解就变得比较简单</p>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">lowestCommonAncestor</span><span class="params">(TreeNode root, TreeNode p, TreeNode q)</span> &#123;</span><br><span class="line">       <span class="keyword">while</span>(root!=<span class="literal">null</span>)&#123;</span><br><span class="line">     	   <span class="comment">//如果根结点值比两个结点都大(不能等于)，向左子树搜索  		</span></span><br><span class="line">           <span class="keyword">if</span>(root.val&gt;p.val &amp;&amp; root.val&gt;q.val) &#123;</span><br><span class="line">               root=root.left;</span><br><span class="line">           &#125;<span class="keyword">else</span> <span class="keyword">if</span>(root.val&lt;p.val &amp;&amp; root.val&lt;q.val)&#123;</span><br><span class="line">               <span class="comment">//如果根结点值比两个结点都小(不能等于)，向右子树搜索</span></span><br><span class="line">               root=root.right;</span><br><span class="line">           &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">               <span class="comment">//反之root一定在pq之间，或者root是pq之一</span></span><br><span class="line">               <span class="keyword">return</span> root;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h1 id="二叉搜索树中的插入操作"   >
          <a href="#二叉搜索树中的插入操作" class="heading-link"><i class="fas fa-link"></i></a><a href="#二叉搜索树中的插入操作" class="headerlink" title="二叉搜索树中的插入操作"></a>二叉搜索树中的插入操作</h1>
      <p>给定二叉搜索树（BST）的根节点 <code>root</code> 和要插入树中的值 <code>value</code> ，将值插入二叉搜索树。 返回插入后二叉搜索树的根节点。 输入数据 <strong>保证</strong> ，新值和原始二叉搜索树中的任意节点值都不同。</p>
<p><strong>注意</strong>，可能存在多种有效的插入方式，只要树在插入后仍保持为二叉搜索树即可。 你可以返回 <strong>任意有效的结果</strong> 。</p>

        <h2 id="701-二叉搜索树中的插入操作"   >
          <a href="#701-二叉搜索树中的插入操作" class="heading-link"><i class="fas fa-link"></i></a><a href="#701-二叉搜索树中的插入操作" class="headerlink" title="701.二叉搜索树中的插入操作"></a>701.二叉搜索树中的插入操作</h2>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/insert-into-a-binary-search-tree/" >Leetcode.701题(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-34"   >
          <a href="#第一次做-34" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-34" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;09&#x2F;06</p>

        <h4 id="第一次代码-36"   >
          <a href="#第一次代码-36" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-36" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">insertIntoBST</span><span class="params">(TreeNode root, <span class="type">int</span> val)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> tervalse(root,val);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">tervalse</span><span class="params">(TreeNode root,<span class="type">int</span> val)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(val);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(root.val&gt;val)&#123;</span><br><span class="line">            <span class="keyword">if</span>(root.left==<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> root.left=<span class="keyword">new</span> <span class="title class_">TreeNode</span>(val);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(root.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> tervalse(root.left,val);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//root.val&lt;val</span></span><br><span class="line">            <span class="keyword">if</span>(root.right==<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> root.right=<span class="keyword">new</span> <span class="title class_">TreeNode</span>(val);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(root.right!=<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> tervalse(root.right,val);</span><br><span class="line">			</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-21"   >
          <a href="#提交失败-21" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-21" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:root&#x3D;[4,2,7,1,3],val&#x3D;5,返回[5]，预期返回[4,2,7,1,3,5] </p>
<p>我只返回了新结点，而没有把整棵树返回回来，所以对左右子树判断返回的数据</p>

        <h4 id="第二次代码-14"   >
          <a href="#第二次代码-14" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码-14" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">insertIntoBST</span><span class="params">(TreeNode root, <span class="type">int</span> val)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> tervalse(root,val);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">tervalse</span><span class="params">(TreeNode root,<span class="type">int</span> val)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(val);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(root.val&gt;val)&#123;</span><br><span class="line">            <span class="keyword">if</span>(root.left==<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> root.left=<span class="keyword">new</span> <span class="title class_">TreeNode</span>(val);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(root.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">                tervalse(root.left,val);</span><br><span class="line">                <span class="keyword">return</span> root;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//root.val&lt;val</span></span><br><span class="line">            <span class="keyword">if</span>(root.right==<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> root.right=<span class="keyword">new</span> <span class="title class_">TreeNode</span>(val);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(root.right!=<span class="literal">null</span>)&#123;</span><br><span class="line">                tervalse(root.right,val);</span><br><span class="line">                <span class="keyword">return</span> root;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-22"   >
          <a href="#提交失败-22" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-22" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE：root &#x3D;[5,null,14,10,77,null,null,null,95,null,null]，val&#x3D;4，输出[4]，预期输出[5,4,14,null,null,10,77,null,null,null,95]</p>
<p>原因：当左右子树为空的时候应该插入新数据进入左右子树，然后返回整棵树，我只返回了这个结点</p>

        <h4 id="第三次代码-4"   >
          <a href="#第三次代码-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#第三次代码-4" class="headerlink" title="第三次代码"></a>第三次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">insertIntoBST</span><span class="params">(TreeNode root, <span class="type">int</span> val)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> tervalse(root,val);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">tervalse</span><span class="params">(TreeNode root,<span class="type">int</span> val)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(val);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(root.val&gt;val)&#123;</span><br><span class="line">            <span class="keyword">if</span>(root.left==<span class="literal">null</span>)&#123;</span><br><span class="line">                root.left=<span class="keyword">new</span> <span class="title class_">TreeNode</span>(val);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(root.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">                tervalse(root.left,val);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> root;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//root.val&lt;val</span></span><br><span class="line">            <span class="keyword">if</span>(root.right==<span class="literal">null</span>)&#123;</span><br><span class="line">                root.right=<span class="keyword">new</span> <span class="title class_">TreeNode</span>(val);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(root.right!=<span class="literal">null</span>)&#123;</span><br><span class="line">                tervalse(root.right,val);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> root;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-36"   >
          <a href="#提交成功-36" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-36" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h4 id="迭代法-2"   >
          <a href="#迭代法-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#迭代法-2" class="headerlink" title="迭代法"></a>迭代法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">insertIntoBST</span><span class="params">(TreeNode root, <span class="type">int</span> val)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(val);</span><br><span class="line">        TreeNode cur=root;</span><br><span class="line">       	<span class="keyword">while</span>(root!=<span class="literal">null</span>)&#123;</span><br><span class="line">           <span class="keyword">if</span>(root.val&gt;val)&#123;</span><br><span class="line">               <span class="keyword">if</span>(root.left==<span class="literal">null</span>)&#123;</span><br><span class="line">                   root.left=<span class="keyword">new</span> <span class="title class_">TreeNode</span>(val);</span><br><span class="line">                   <span class="keyword">return</span> cur;</span><br><span class="line">               &#125;<span class="keyword">else</span> root=root.left;</span><br><span class="line">           &#125;<span class="keyword">else</span> <span class="keyword">if</span>(root.val&lt;val)&#123;</span><br><span class="line">               <span class="keyword">if</span>(root.right==<span class="literal">null</span>)&#123;</span><br><span class="line">                   root.right=<span class="keyword">new</span> <span class="title class_">TreeNode</span>(val);</span><br><span class="line">                   <span class="keyword">return</span> cur;</span><br><span class="line">               &#125;<span class="keyword">else</span> root=root.right;</span><br><span class="line">           &#125; </span><br><span class="line">       &#125;</span><br><span class="line">        <span class="keyword">return</span> cur;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-37"   >
          <a href="#提交成功-37" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-37" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-36"   >
          <a href="#题解-36" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-36" class="headerlink" title="题解"></a>题解</h3>
      
        <h4 id="递归法-2"   >
          <a href="#递归法-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#递归法-2" class="headerlink" title="递归法"></a>递归法</h4>
      <p>思路：我们在叶子结点进行插入，不对整棵树的原始结构进行改变</p>
<p><strong>实现</strong></p>
<ul>
<li><p>递归函数的参数和返回值</p>
<ul>
<li>返回值：二叉树的根节点</li>
<li>参数root：用于搜索的二叉树结点</li>
<li>参数val：要插入的结点大小</li>
</ul>
</li>
<li><p>递归函数的结束条件</p>
<ul>
<li>当root&#x3D;&#x3D;null，也即用于搜索的二叉树为空，则返回新结点作为树的根节点</li>
</ul>
</li>
<li><p>单层递归的逻辑</p>
<ul>
<li><p>当root.val&gt;val，也即当前结点值比要插入的结点大，应该插入左子树中</p>
<ul>
<li>如果左子树为空，则插入新结点作为当前结点左子树</li>
<li>如果左子树不为空，那么向左子树继续搜索要插入位置</li>
</ul>
</li>
<li><p>当root.val&lt;val，也即当前结点值要比插入的结点小，应该插入右子树中</p>
<ul>
<li>如果右子树为空，则插入新结点作为当前结点右子树</li>
<li>如果右子树不为空，那么向右子树继续搜索要插入的位置</li>
</ul>
</li>
<li><p>返回root，用于搜索的二叉树（也即插入之后的新的二叉树根节点）</p>
</li>
</ul>
</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">insertIntoBST</span><span class="params">(TreeNode root, <span class="type">int</span> val)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> tervalse(root,val);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">tervalse</span><span class="params">(TreeNode root,<span class="type">int</span> val)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(val);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(root.val&gt;val)&#123;</span><br><span class="line">            <span class="keyword">if</span>(root.left==<span class="literal">null</span>)&#123;</span><br><span class="line">              	<span class="comment">//如果左子树为空插入新结点于左子树中</span></span><br><span class="line">                root.left=<span class="keyword">new</span> <span class="title class_">TreeNode</span>(val);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(root.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="comment">//不为空则向左搜索</span></span><br><span class="line">                tervalse(root.left,val);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> root;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//root.val&lt;val</span></span><br><span class="line">            <span class="keyword">if</span>(root.right==<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="comment">//如果右子树为空插入新结点于右子树中</span></span><br><span class="line">                root.right=<span class="keyword">new</span> <span class="title class_">TreeNode</span>(val);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(root.right!=<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="comment">//不为空则向右搜索</span></span><br><span class="line">                tervalse(root.right,val);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> root;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>




        <h4 id="迭代法-3"   >
          <a href="#迭代法-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#迭代法-3" class="headerlink" title="迭代法"></a>迭代法</h4>
      <p>思路：利用二叉树的特性搜索左右子树，然后在叶子结点插入新结点</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">insertIntoBST</span><span class="params">(TreeNode root, <span class="type">int</span> val)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(val);</span><br><span class="line">        <span class="comment">//定义cur来移动结点</span></span><br><span class="line">    	TreeNode cur=root;</span><br><span class="line">       	<span class="keyword">while</span>(cur!=<span class="literal">null</span>)&#123;</span><br><span class="line">           <span class="keyword">if</span>(cur.val&gt;val)&#123;</span><br><span class="line">               <span class="comment">//如果左子树为空则直接插入新结点</span></span><br><span class="line">               <span class="keyword">if</span>(cur.left==<span class="literal">null</span>)&#123;</span><br><span class="line">                   cur.left=<span class="keyword">new</span> <span class="title class_">TreeNode</span>(val);</span><br><span class="line">                   <span class="comment">//插入完返回树的根节点</span></span><br><span class="line">                   <span class="keyword">return</span> root;</span><br><span class="line">               &#125;<span class="keyword">else</span> cur=cur.left; <span class="comment">//反之左子树不为空向左搜索</span></span><br><span class="line">           &#125;<span class="keyword">else</span> <span class="keyword">if</span>(cur.val&lt;val)&#123;</span><br><span class="line">               <span class="comment">//如果右子树为空则直接插入新结点</span></span><br><span class="line">               <span class="keyword">if</span>(cur.right==<span class="literal">null</span>)&#123;</span><br><span class="line">                   cur.right=<span class="keyword">new</span> <span class="title class_">TreeNode</span>(val);</span><br><span class="line">                   <span class="comment">//插入完返回树的根节点</span></span><br><span class="line">                   <span class="keyword">return</span> root;</span><br><span class="line">               &#125;<span class="keyword">else</span> cur=cur.right; <span class="comment">//反之右子树不为空向右搜索</span></span><br><span class="line">           &#125; </span><br><span class="line">       &#125;</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h1 id="删除二叉搜索树中的节点"   >
          <a href="#删除二叉搜索树中的节点" class="heading-link"><i class="fas fa-link"></i></a><a href="#删除二叉搜索树中的节点" class="headerlink" title="删除二叉搜索树中的节点"></a>删除二叉搜索树中的节点</h1>
      <p>给定一个二叉搜索树的根节点 <strong>root</strong> 和一个值 <strong>key</strong>，删除二叉搜索树中的 <strong>key</strong> 对应的节点，并保证二叉搜索树的性质不变。返回二叉搜索树（有可能被更新）的根节点的引用。</p>
<p>一般来说，删除节点可分为两个步骤：</p>
<ol>
<li>首先找到需要删除的节点；</li>
<li>如果找到了，删除它。</li>
</ol>

        <h2 id="450-删除二叉搜索树中的节点"   >
          <a href="#450-删除二叉搜索树中的节点" class="heading-link"><i class="fas fa-link"></i></a><a href="#450-删除二叉搜索树中的节点" class="headerlink" title="450.删除二叉搜索树中的节点"></a>450.删除二叉搜索树中的节点</h2>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/delete-node-in-a-bst/" >Leetcode.450题(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-35"   >
          <a href="#第一次做-35" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-35" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;09&#x2F;06</p>

        <h4 id="第一次代码-37"   >
          <a href="#第一次代码-37" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-37" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">deleteNode</span><span class="params">(TreeNode root, <span class="type">int</span> key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> tervalse(root,key);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">tervalse</span><span class="params">(TreeNode root,<span class="type">int</span> key)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> root;</span><br><span class="line">        <span class="keyword">if</span>(root.val&gt;key)&#123;</span><br><span class="line">            <span class="keyword">if</span>(root.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">                root.left=tervalse(root.left,key);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> root;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(root.val&lt;key)&#123;</span><br><span class="line">            <span class="keyword">if</span>(root.right!=<span class="literal">null</span>)&#123;</span><br><span class="line">                tervalse(root.right,key);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> root;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(root.val==key)&#123;</span><br><span class="line">            <span class="keyword">if</span>(root.left==<span class="literal">null</span> &amp;&amp; root.right==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(root.left!=<span class="literal">null</span> &amp;&amp; root.right==<span class="literal">null</span>) <span class="keyword">return</span> root.left;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(root.left==<span class="literal">null</span> &amp;&amp; root.right!=<span class="literal">null</span>) <span class="keyword">return</span> root.right;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(root.left!=<span class="literal">null</span> &amp;&amp; root.right!=<span class="literal">null</span>)&#123;</span><br><span class="line">                root.right.left=root.left;</span><br><span class="line">                <span class="keyword">return</span> root.right;</span><br><span class="line">            &#125;</span><br><span class="line">           </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-23"   >
          <a href="#提交失败-23" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-23" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:root&#x3D;[5,3,6,2,4,null,7] key&#x3D;7，输出[5,3,6,2,4,null,7] 预期输出[5,3,6,2,4]</p>
<p>原因是未对右子树做删除处理</p>

        <h4 id="第二次代码-15"   >
          <a href="#第二次代码-15" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码-15" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">deleteNode</span><span class="params">(TreeNode root, <span class="type">int</span> key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> tervalse(root,key);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">tervalse</span><span class="params">(TreeNode root,<span class="type">int</span> key)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> root;</span><br><span class="line">        <span class="keyword">if</span>(root.val&gt;key)&#123;</span><br><span class="line">            <span class="keyword">if</span>(root.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">                root.left=tervalse(root.left,key);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> root;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(root.val&lt;key)&#123;</span><br><span class="line">            <span class="keyword">if</span>(root.right!=<span class="literal">null</span>)&#123;</span><br><span class="line">                root.right=tervalse(root.right,key);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> root;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(root.val==key)&#123;</span><br><span class="line">            <span class="keyword">if</span>(root.left==<span class="literal">null</span> &amp;&amp; root.right==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(root.left!=<span class="literal">null</span> &amp;&amp; root.right==<span class="literal">null</span>) <span class="keyword">return</span> root.left;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(root.left==<span class="literal">null</span> &amp;&amp; root.right!=<span class="literal">null</span>) <span class="keyword">return</span> root.right;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(root.left!=<span class="literal">null</span> &amp;&amp; root.right!=<span class="literal">null</span>)&#123;</span><br><span class="line">                root.right.left=root.left;</span><br><span class="line">                <span class="keyword">return</span> root.right;</span><br><span class="line">            &#125;</span><br><span class="line">           </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-24"   >
          <a href="#提交失败-24" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-24" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:root &#x3D;[50,30,70,null,40,60,80]，key&#x3D;50，输出[70,30,80,null,40]，预期输出[60,30,70,null,40,null,80]</p>
<p>原因：当左右子树非空的时候我直接将左子树接到右子树的左子树，造成了数据丢失。</p>

        <h4 id="第三次代码-5"   >
          <a href="#第三次代码-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#第三次代码-5" class="headerlink" title="第三次代码"></a>第三次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">deleteNode</span><span class="params">(TreeNode root, <span class="type">int</span> key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> tervalse(root,key);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">tervalse</span><span class="params">(TreeNode root,<span class="type">int</span> key)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> root;</span><br><span class="line">        <span class="keyword">if</span>(root.val&gt;key)&#123;</span><br><span class="line">            <span class="keyword">if</span>(root.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">                root.left=tervalse(root.left,key);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> root;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(root.val&lt;key)&#123;</span><br><span class="line">            <span class="keyword">if</span>(root.right!=<span class="literal">null</span>)&#123;</span><br><span class="line">                root.right=tervalse(root.right,key);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> root;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(root.val==key)&#123;</span><br><span class="line">            <span class="keyword">if</span>(root.left==<span class="literal">null</span> &amp;&amp; root.right==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(root.left!=<span class="literal">null</span> &amp;&amp; root.right==<span class="literal">null</span>) <span class="keyword">return</span> root.left;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(root.left==<span class="literal">null</span> &amp;&amp; root.right!=<span class="literal">null</span>) <span class="keyword">return</span> root.right;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(root.left!=<span class="literal">null</span> &amp;&amp; root.right!=<span class="literal">null</span>)&#123;</span><br><span class="line">                TreeNode cur=root.right;</span><br><span class="line">                <span class="keyword">if</span>(cur.left==<span class="literal">null</span>)&#123;</span><br><span class="line">                    root.left=root.left;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">while</span>(cur.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">                        cur=cur.left;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                cur.left=root.left;</span><br><span class="line">                <span class="keyword">return</span> root.right;</span><br><span class="line">            &#125;</span><br><span class="line">           </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-38"   >
          <a href="#提交成功-38" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-38" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-37"   >
          <a href="#题解-37" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-37" class="headerlink" title="题解"></a>题解</h3>
      <p>思路：利用二叉搜索树的特性来搜索要删除的结点位置确认方向，如果没能找到要删除的结点则不作处理，如果找到了要删除的结点则要对左右子树做一个处理，维持删除之后搜索二叉树的特性</p>
<p><strong>实现</strong></p>
<ul>
<li>递归参数的返回值和参数<ul>
<li>参数root：根结点</li>
<li>参数key：要删除的结点值大小</li>
</ul>
</li>
<li>递归函数的结束条件<ul>
<li>当root&#x3D;&#x3D;null，说明没有找到结点，返回null</li>
<li>当找到要删除的结点，将其删除结点就可以结束递归了。而要删除结点时有四种情况要考虑，而返回值会在单层递归中将其接住<ul>
<li>左为空右不为空（是叶子结点），直接返回null即可</li>
<li>左不为空右为空，返回左子树</li>
<li>左为空右不为空，返回右子树</li>
<li>左不为空且右为空，将左右子树做拼接处理<ul>
<li>找到右子树的<strong>最左下角结点</strong>，因为最左下角值是最接近左子树最大值的结点，所以将左子树接在最左下角结点的左子树</li>
<li>返回根节点的右子树</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>单层递归的处理逻辑<ul>
<li>当根节点值小于目标值，搜索右子树，且将根节点的右子树设置为删除之后新的右子树（如果没找到会返回原来一样的右子树）</li>
<li>当根节点值大于目标值，搜索左子树，且将根节点的左子树设置为删除之后新的左子树（如果没找到会返回原来一样的左子树）</li>
<li>当根节点值等于目标值，说明找到了要删除的结点，走判断删除结点逻辑。</li>
</ul>
</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">deleteNode</span><span class="params">(TreeNode root, <span class="type">int</span> key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> tervalse(root,key);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">tervalse</span><span class="params">(TreeNode root,<span class="type">int</span> key)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> root;</span><br><span class="line">        <span class="keyword">if</span>(root.val&gt;key)&#123;</span><br><span class="line">            <span class="comment">//当根节点比key大，说明在左子树中搜索左子树</span></span><br><span class="line">            <span class="keyword">if</span>(root.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="comment">//将当前根节点的左子树设置为删除之后新的左子树</span></span><br><span class="line">                root.left=tervalse(root.left,key);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> root;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(root.val&lt;key)&#123;</span><br><span class="line">            <span class="comment">//当根节点值比key小，说明在右子树中搜索右子树</span></span><br><span class="line">            <span class="keyword">if</span>(root.right!=<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="comment">//将当前根节点的右子树设置为删除之后新的右子树</span></span><br><span class="line">                root.right=tervalse(root.right,key);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> root;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(root.val==key)&#123;</span><br><span class="line">            <span class="comment">//找到要删除的结点，有四种场景</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">//①如果是叶子结点则返回空结点</span></span><br><span class="line">            <span class="keyword">if</span>(root.left==<span class="literal">null</span> &amp;&amp; root.right==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(root.left!=<span class="literal">null</span> &amp;&amp; root.right==<span class="literal">null</span>) <span class="keyword">return</span> root.left;<span class="comment">//②左不空右为空 </span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(root.left==<span class="literal">null</span> &amp;&amp; root.right!=<span class="literal">null</span>) <span class="keyword">return</span> root.right;<span class="comment">//③左为空右不为空</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(root.left!=<span class="literal">null</span> &amp;&amp; root.right!=<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="comment">//④左不为空右为空</span></span><br><span class="line">                </span><br><span class="line">                </span><br><span class="line">                </span><br><span class="line">                TreeNode cur=root.right;</span><br><span class="line">                <span class="comment">//当cur指向右子树的最左下角结点 也即cur.left==null</span></span><br><span class="line">                <span class="keyword">while</span>(cur.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">                   cur=cur.left;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">//将root左子树接在cur的左子树中</span></span><br><span class="line">                cur.left=root.left;</span><br><span class="line">                <span class="keyword">return</span> root.right;</span><br><span class="line">            &#125;</span><br><span class="line">           </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h1 id="修剪二叉搜索树"   >
          <a href="#修剪二叉搜索树" class="heading-link"><i class="fas fa-link"></i></a><a href="#修剪二叉搜索树" class="headerlink" title="修剪二叉搜索树"></a>修剪二叉搜索树</h1>
      <p>给你二叉搜索树的根节点 <code>root</code> ，同时给定最小边界<code>low</code> 和最大边界 <code>high</code>。通过修剪二叉搜索树，使得所有节点的值在<code>[low, high]</code>中。修剪树 <strong>不应该</strong> 改变保留在树中的元素的相对结构 (即，如果没有被移除，原有的父代子代关系都应当保留)。 可以证明，存在 <strong>唯一的答案</strong> 。</p>
<p>所以结果应当返回修剪好的二叉搜索树的新的根节点。注意，根节点可能会根据给定的边界发生改变。</p>

        <h2 id="669-修剪二叉搜索树"   >
          <a href="#669-修剪二叉搜索树" class="heading-link"><i class="fas fa-link"></i></a><a href="#669-修剪二叉搜索树" class="headerlink" title="669.修剪二叉搜索树"></a>669.修剪二叉搜索树</h2>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/trim-a-binary-search-tree/" >Leetcode.669题(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-36"   >
          <a href="#第一次做-36" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-36" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;09&#x2F;07</p>

        <h4 id="第一次代码-38"   >
          <a href="#第一次代码-38" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-38" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">trimBST</span><span class="params">(TreeNode root, <span class="type">int</span> low, <span class="type">int</span> high)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> changeTree(root,low,high);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//    [low,high]</span></span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">changeTree</span><span class="params">(TreeNode root,<span class="type">int</span> low, <span class="type">int</span> high)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(root.val&lt;low)&#123;</span><br><span class="line">            <span class="keyword">return</span> changeTree(root.right,low,high);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(root.val&gt;high)&#123;</span><br><span class="line">            <span class="keyword">return</span> changeTree(root.left,low,high);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(root.val&gt;=low &amp;&amp; root.val&lt;=high)&#123;</span><br><span class="line">            <span class="keyword">if</span>(root.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">                root.left=changeTree(root.left,low,high);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(root.right!=<span class="literal">null</span>)&#123;</span><br><span class="line">                root.right=changeTree(root.right,low,high);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-39"   >
          <a href="#提交成功-39" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-39" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-38"   >
          <a href="#题解-38" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-38" class="headerlink" title="题解"></a>题解</h3>
      <p>思路：这道题和前面删除结点不同，需要改变树的结构。不能直接将左右子树拼接上去，而需要将符合条件的子树修剪之后更新</p>
<p><strong>实现</strong></p>
<ul>
<li><p>递归函数的返回值和参数</p>
<ul>
<li>参数root：需要修剪的根节点</li>
<li>参数low：左区间</li>
<li>参数high：右区间</li>
<li>返回值TreeNode：修建之后的根节点</li>
</ul>
</li>
<li><p>递归的结束条件</p>
<ul>
<li>root&#x3D;&#x3D;null：说明是空节点，返回空间点</li>
<li>判断root.val和low与high的值<ul>
<li>root.val&lt;low :说明根节点是需要删除的结点，向右子树遍历修剪右子树，然后返回修剪后的右子树（返回值在单层递归中接住）</li>
<li>root.val&gt;high:说明根节点是需要删除的结点，向左子树遍历修剪左子树，然后返回修剪后的左子树（返回值在单层递归中接住）</li>
</ul>
</li>
</ul>
</li>
<li><p>单层递归的处理逻辑</p>
<p><em>low&lt;&#x3D;root.val&lt;&#x3D;high</em></p>
<ul>
<li>判断是否有左子树，如果有左子树则更新根节点的左子树(root.left)，在这里接住递归之后的返回值</li>
<li>判断是否有右子树，如果有右子树则更新根节点的右子树(root.right)，在这里接住递归之后的返回值</li>
</ul>
</li>
<li><p>返回修枝之后的根节点</p>
</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">trimBST</span><span class="params">(TreeNode root, <span class="type">int</span> low, <span class="type">int</span> high)</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> changeTree(root,low,high);</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">//    [low,high]</span></span><br><span class="line">   <span class="keyword">public</span> TreeNode <span class="title function_">changeTree</span><span class="params">(TreeNode root,<span class="type">int</span> low, <span class="type">int</span> high)</span>&#123;</span><br><span class="line">       <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">	<span class="comment">//如果当前结点值比左区间小，删除本结点</span></span><br><span class="line">       <span class="keyword">if</span>(root.val&lt;low)&#123;</span><br><span class="line">           <span class="comment">//向本结点的右子树修剪，返回修剪后的右子树</span></span><br><span class="line">           <span class="keyword">return</span> changeTree(root.right,low,high);</span><br><span class="line">       &#125;<span class="keyword">else</span> <span class="keyword">if</span>(root.val&gt;high)&#123;</span><br><span class="line">           <span class="comment">//如果当前值比右区间大，删除本结点</span></span><br><span class="line">           <span class="comment">//向本结点的左子树修剪，返回修剪后的左子树</span></span><br><span class="line">           <span class="keyword">return</span> changeTree(root.left,low,high);</span><br><span class="line">       &#125;<span class="keyword">else</span> <span class="keyword">if</span>(root.val&gt;=low &amp;&amp; root.val&lt;=high)&#123;</span><br><span class="line">           <span class="comment">//如果有左子树，修剪左子树</span></span><br><span class="line">           <span class="keyword">if</span>(root.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">               <span class="comment">//单层递归中接住返回值，更新左子树</span></span><br><span class="line">               root.left=changeTree(root.left,low,high);</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="comment">//如果有右子树，修剪右子树</span></span><br><span class="line">           <span class="keyword">if</span>(root.right!=<span class="literal">null</span>)&#123;</span><br><span class="line">               <span class="comment">//单层递归中接住右子树，更新右子树</span></span><br><span class="line">               root.right=changeTree(root.right,low,high);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//返回修剪后的根节点</span></span><br><span class="line">       <span class="keyword">return</span> root;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></div></figure>




        <h1 id="将有序数组转换为二叉搜索树"   >
          <a href="#将有序数组转换为二叉搜索树" class="heading-link"><i class="fas fa-link"></i></a><a href="#将有序数组转换为二叉搜索树" class="headerlink" title="将有序数组转换为二叉搜索树"></a>将有序数组转换为二叉搜索树</h1>
      <p>给你一个整数数组 <code>nums</code> ，其中元素已经按 <strong>升序</strong> 排列，请你将其转换为一棵 <strong>高度平衡</strong> 二叉搜索树。</p>
<p><strong>高度平衡</strong> 二叉树是一棵满足「每个节点的左右两个子树的高度差的绝对值不超过 1 」的二叉树。</p>

        <h2 id="108-将有序数组转换为二叉搜索树"   >
          <a href="#108-将有序数组转换为二叉搜索树" class="heading-link"><i class="fas fa-link"></i></a><a href="#108-将有序数组转换为二叉搜索树" class="headerlink" title="108.将有序数组转换为二叉搜索树"></a>108.将有序数组转换为二叉搜索树</h2>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/convert-sorted-array-to-binary-search-tree/" >Leetcode.108题(easy)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-37"   >
          <a href="#第一次做-37" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-37" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;09&#x2F;07</p>

        <h4 id="第一次代码-39"   >
          <a href="#第一次代码-39" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-39" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">sortedArrayToBST</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        TreeNode root=<span class="keyword">new</span> <span class="title class_">TreeNode</span>();</span><br><span class="line">        <span class="keyword">if</span>(nums.length==<span class="number">0</span>) <span class="keyword">return</span> root;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> num=nums.length/<span class="number">2</span>;</span><br><span class="line">        root.val=nums[num];</span><br><span class="line"></span><br><span class="line">        root.left=addTree(nums,<span class="number">0</span>,num);</span><br><span class="line">        <span class="keyword">if</span>(num&lt;nums.length-<span class="number">1</span>)&#123;</span><br><span class="line">        root.right=addTree(nums,num+<span class="number">1</span>,nums.length);&#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">addTree</span><span class="params">(<span class="type">int</span>[] nums,<span class="type">int</span> start,<span class="type">int</span> end)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(start==end) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        TreeNode node=<span class="keyword">new</span> <span class="title class_">TreeNode</span>(nums[start]);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=start;i&lt;end;i++)&#123;</span><br><span class="line">            node.left=addTree(nums,start+<span class="number">1</span>,end);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交错误-7"   >
          <a href="#提交错误-7" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交错误-7" class="headerlink" title="提交错误"></a>提交错误</h5>
      <p>CASE:nums&#x3D;[-10,-3,0,5,9]，输出[0,-10,5,-3,null,9]  预期输出[0,-3,9,-10,null,5]</p>

        <h4 id="第二次代码-16"   >
          <a href="#第二次代码-16" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码-16" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">sortedArrayToBST</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        TreeNode root=<span class="keyword">new</span> <span class="title class_">TreeNode</span>();</span><br><span class="line">        <span class="keyword">if</span>(nums.length==<span class="number">0</span>) <span class="keyword">return</span> root;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> num=nums.length/<span class="number">2</span>;</span><br><span class="line">        root.val=nums[num];</span><br><span class="line"></span><br><span class="line">        root.left=addTree(nums,<span class="number">0</span>,num);</span><br><span class="line">        <span class="keyword">if</span>(num&lt;nums.length-<span class="number">1</span>)&#123;</span><br><span class="line">        root.right=addTree(nums,num+<span class="number">1</span>,nums.length);&#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">addTree</span><span class="params">(<span class="type">int</span>[] nums,<span class="type">int</span> start,<span class="type">int</span> end)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(start==end) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        TreeNode node=<span class="keyword">new</span> <span class="title class_">TreeNode</span>(nums[end-<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=end-<span class="number">1</span>;i&gt;=start;i--)&#123;</span><br><span class="line">            node.left=addTree(nums,start,end-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>




        <h5 id="提交错误-8"   >
          <a href="#提交错误-8" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交错误-8" class="headerlink" title="提交错误"></a>提交错误</h5>
      <p>CASE:root&#x3D;[0,1,2,3,4,5] ，输出[3,2,5,1,null,4,null,0]，预期输出[3,1,5,0,2,4]</p>
<p>原因：这样保证了根节点的左右子树高度差不超过1，可以其他结点的子树左右子树高度差超过了1，空子树也算高度0，不能单方向的一直接</p>

        <h4 id="第三次代码-6"   >
          <a href="#第三次代码-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#第三次代码-6" class="headerlink" title="第三次代码"></a>第三次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">sortedArrayToBST</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> addTree(nums,<span class="number">0</span>,nums.length);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">addTree</span><span class="params">(<span class="type">int</span>[] nums,<span class="type">int</span> start,<span class="type">int</span> end)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(start==end) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(end==<span class="number">0</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        TreeNode root=<span class="keyword">new</span> <span class="title class_">TreeNode</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> num=(start+end)/<span class="number">2</span>;</span><br><span class="line">        root.val=nums[num];</span><br><span class="line"></span><br><span class="line">        root.left=addTree(nums,<span class="number">0</span>,num);</span><br><span class="line">        <span class="keyword">if</span>(num&lt;end-<span class="number">1</span>)&#123;</span><br><span class="line">        root.right=addTree(nums,num+<span class="number">1</span>,end);&#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交错误-9"   >
          <a href="#提交错误-9" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交错误-9" class="headerlink" title="提交错误"></a>提交错误</h5>
      
        <h4 id="第四次代码-2"   >
          <a href="#第四次代码-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#第四次代码-2" class="headerlink" title="第四次代码"></a>第四次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">sortedArrayToBST</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> addTree(nums,<span class="number">0</span>,nums.length);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">addTree</span><span class="params">(<span class="type">int</span>[] nums,<span class="type">int</span> start,<span class="type">int</span> end)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(start==end) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(end==<span class="number">0</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        TreeNode root=<span class="keyword">new</span> <span class="title class_">TreeNode</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> num=(start+end)/<span class="number">2</span>;</span><br><span class="line">        root.val=nums[num];</span><br><span class="line">        </span><br><span class="line">        root.left=addTree(nums,start,num);</span><br><span class="line">        <span class="keyword">if</span>(num&lt;end-<span class="number">1</span>)&#123;</span><br><span class="line">        root.right=addTree(nums,num+<span class="number">1</span>,end);&#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-40"   >
          <a href="#提交成功-40" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-40" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-39"   >
          <a href="#题解-39" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-39" class="headerlink" title="题解"></a>题解</h3>
      <p>思路:构造平衡搜索二叉树，先构造根节点，然后根据关系切割数组构造左子树，切割数组构造右子树</p>
<p><strong>实现</strong></p>
<ul>
<li>递归函数的参数和返回值<ul>
<li>返回值TreeNode：构造出的二叉搜索树根节点</li>
<li>参数nums：升序数组</li>
<li>参数start：左区间</li>
<li>参数end：右区间</li>
</ul>
</li>
<li>递归函数的结束条件<ul>
<li>当start和end合法，也即start&lt;&#x3D;end；当start&#x3D;&#x3D;end时返回null</li>
</ul>
</li>
<li>单层递归的逻辑<ul>
<li>取得升序数组区间中的中间元素：mid&#x3D;(start+end)&#x2F;2</li>
<li>构造左子树：区间为[start，mid) 左闭右开构建</li>
<li>构造右子树：区间为[mid+1,end)左闭右开构建</li>
</ul>
</li>
<li>返回构建出的二叉树root</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">sortedArrayToBST</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">   	<span class="comment">//左闭右开，所以传入0和nums.length</span></span><br><span class="line">       <span class="keyword">return</span> addTree(nums,<span class="number">0</span>,nums.length);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> TreeNode <span class="title function_">addTree</span><span class="params">(<span class="type">int</span>[] nums,<span class="type">int</span> start,<span class="type">int</span> end)</span>&#123;</span><br><span class="line">       <span class="keyword">if</span>(start==end) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">       <span class="keyword">if</span>(end==<span class="number">0</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">       TreeNode root=<span class="keyword">new</span> <span class="title class_">TreeNode</span>();</span><br><span class="line"></span><br><span class="line">       <span class="type">int</span> mid=(start+end)/<span class="number">2</span>;</span><br><span class="line">       </span><br><span class="line">       root.val=nums[mid];</span><br><span class="line">       </span><br><span class="line">       <span class="comment">//构造左子树，区间在[start,mid)</span></span><br><span class="line">       root.left=addTree(nums,start,mid);</span><br><span class="line">    	<span class="comment">//构造右子树，区间在[mid+1,end)</span></span><br><span class="line">       <span class="keyword">if</span>(mid&lt;end-<span class="number">1</span>)&#123;</span><br><span class="line">       root.right=addTree(nums,mid+<span class="number">1</span>,end);&#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> root;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></div></figure>




        <h1 id="把二叉搜索树转换为累加树"   >
          <a href="#把二叉搜索树转换为累加树" class="heading-link"><i class="fas fa-link"></i></a><a href="#把二叉搜索树转换为累加树" class="headerlink" title="把二叉搜索树转换为累加树"></a>把二叉搜索树转换为累加树</h1>
      <p>给出二叉 <strong>搜索</strong> 树的根节点，该树的节点值各不相同，请你将其转换为累加树（Greater Sum Tree），使每个节点 <code>node</code> 的新值等于原树中大于或等于 <code>node.val</code> 的值之和。</p>
<p>提醒一下，二叉搜索树满足下列约束条件：</p>
<ul>
<li>节点的左子树仅包含键 <strong>小于</strong> 节点键的节点。</li>
<li>节点的右子树仅包含键 <strong>大于</strong> 节点键的节点。</li>
<li>左右子树也必须是二叉搜索树。</li>
</ul>
<p><strong>注意：</strong>本题和 1038: <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/binary-search-tree-to-greater-sum-tree/" >https://leetcode-cn.com/problems/binary-search-tree-to-greater-sum-tree/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> 相同</p>
<blockquote>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/binary-search-tree-to-greater-sum-tree/" >1038. 从二叉搜索树到更大和树</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
</blockquote>

        <h2 id="538-把二叉搜索树转换为累加树"   >
          <a href="#538-把二叉搜索树转换为累加树" class="heading-link"><i class="fas fa-link"></i></a><a href="#538-把二叉搜索树转换为累加树" class="headerlink" title="538.把二叉搜索树转换为累加树"></a>538.把二叉搜索树转换为累加树</h2>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/convert-bst-to-greater-tree/" >Leetcode.538题(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-38"   >
          <a href="#第一次做-38" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-38" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;09&#x2F;07</p>

        <h4 id="第一次代码-40"   >
          <a href="#第一次代码-40" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-40" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    TreeNode pre;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">convertBST</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        pre=<span class="literal">null</span>;</span><br><span class="line">        changeBST(root);</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">changeBST</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">        changeBST(root.left);</span><br><span class="line">        <span class="keyword">if</span>(pre!=<span class="literal">null</span>)&#123;</span><br><span class="line">            root.val=root.val+pre.val;</span><br><span class="line">        &#125;</span><br><span class="line">        pre=root;</span><br><span class="line">        changeBST(root.right);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-25"   >
          <a href="#提交失败-25" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-25" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:root&#x3D;[4,1,6,0,2,5,7,null,null,null,3,null,null,null,8]，输出[10,1,21,0,3,15,28,null,null,null,6,null,null,null,36]，预期输出[30,36,21,36,35,26,15,null,null,null,33,null,null,null,8]</p>

        <h4 id="第二次代码-17"   >
          <a href="#第二次代码-17" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码-17" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    TreeNode pre;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">convertBST</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        pre=<span class="literal">null</span>;</span><br><span class="line">        changeBST(root);</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">changeBST</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="comment">//先遍历右子树</span></span><br><span class="line">        changeBST(root.right);</span><br><span class="line">        <span class="keyword">if</span>(pre!=<span class="literal">null</span>)&#123;</span><br><span class="line">            root.val=root.val+pre.val;</span><br><span class="line">        &#125;</span><br><span class="line">        pre=root;</span><br><span class="line">        <span class="comment">//再遍历左子树</span></span><br><span class="line">        changeBST(root.left);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-41"   >
          <a href="#提交成功-41" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-41" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-40"   >
          <a href="#题解-40" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-40" class="headerlink" title="题解"></a>题解</h3>
      <p>思路：通过分析这道题的示例，我们知道这个累加数换成数组就是从后遍历然后记录和的最大值。</p>
<p>也即我们可以通过<strong>右中左的遍历顺序</strong>，来改变每个结点的数值，我们这里用<strong>双指针</strong>来实现这道题会是比较简单的</p>
<p><strong>实现</strong></p>
<blockquote>
<p>二叉搜索树是中序(左中右)是升序数组，所以我们用(右中左)就是降序数组</p>
</blockquote>
<ul>
<li><p>递归函数的参数和返回值</p>
<ul>
<li>无返回值，整个递归过程处理完逻辑</li>
<li>参数root：要用于转换的二叉树根节点</li>
</ul>
</li>
<li><p>递归函数的结束条件</p>
<p>当root为空，说明遍历到最后一个结点下的空结点，结束递归</p>
</li>
<li><p>递归函数的单层逻辑</p>
<ul>
<li>先遍历右子树</li>
<li>pre不为空的时候，root.val&#x3D;&#x3D;root.val+pre.val（当前结点数值为当前节点值+上一结点值）</li>
<li>pre&#x3D;root：移动pre指针使其保证一直在root前一个结点</li>
<li>再遍历左子树</li>
</ul>
</li>
</ul>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    TreeNode pre;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">convertBST</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">       	<span class="comment">//初始化pre</span></span><br><span class="line">        pre=<span class="literal">null</span>;</span><br><span class="line">        changeBST(root);</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">changeBST</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="comment">//先遍历右子树</span></span><br><span class="line">        changeBST(root.right);</span><br><span class="line">        <span class="comment">//pre为空说明root是第一个结点</span></span><br><span class="line">        <span class="keyword">if</span>(pre!=<span class="literal">null</span>)&#123;</span><br><span class="line">            root.val=root.val+pre.val;</span><br><span class="line">        &#125;</span><br><span class="line">        pre=root;</span><br><span class="line">        <span class="comment">//再遍历左子树</span></span><br><span class="line">        changeBST(root.left);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h1 id="总结-1"   >
          <a href="#总结-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#总结-1" class="headerlink" title="总结"></a>总结</h1>
      <p>到这里二叉树也算这部分结束了，从这篇中我们可以学习到</p>
<ul>
<li><p>二叉树的种类如<strong>二叉搜索树、完全二叉树、满二叉树、平衡二叉树</strong></p>
</li>
<li><p>二叉树的搜索方式如<strong>深度优先搜索、广度优先搜索</strong></p>
<ul>
<li>深度优先搜索<ul>
<li>递归遍历：<strong>前序遍历、中序遍历、后序遍历</strong></li>
<li>非递归遍历：<strong>迭代法</strong>遍历（统一迭代法）</li>
</ul>
</li>
<li>广度 优先搜索<ul>
<li>层序遍历</li>
</ul>
</li>
</ul>
</li>
<li><p>二叉树的特性</p>
<ul>
<li>二叉搜索树的<strong>中序遍历</strong>输出是一个有序数组</li>
<li>平衡二叉树的每一个结点高度差不能超过1</li>
<li>树的深度是从根节点往叶子结点数</li>
<li>树的高度是从叶子结点向根节点数</li>
</ul>
</li>
</ul>
<p>我们也能从中学习到<strong>回溯</strong>的思想，从搜索二叉树中学习到<strong>双指针</strong>的思路</p>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2023/08/23/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B-JUC%E7%AF%87%5B4-Atomic%5D/">深入剖析并发编程-JUC篇[4-Atomic]</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2023-08-23</span></span><span class="post-meta-item post-meta-item--wordcount"><span class="post-meta-item__icon"><i class="far fa-file-word"></i></span><span class="post-meta-item__info">字数统计</span><span class="post-meta-item__value">19.7k</span></span><span class="post-meta-item post-meta-item--readtime"><span class="post-meta-item__icon"><i class="far fa-clock"></i></span><span class="post-meta-item__info">阅读时长</span><span class="post-meta-item__value">208分</span></span></div></header><div class="post-body"><div class="post-excerpt"><p><strong>Atomic原子包</strong></p>
<hr>
<ul>
<li>第一篇是JUC并发编程基础</li>
<li>第二篇是JMM、Volatile关键字、synchronize锁详解</li>
<li>第三篇是CAS机制原理、Unsafe魔法类、LockSupport工具类、ThreadLocal线程变量</li>
<li>第四篇是Atomic原子包源码详解</li>
<li>第五篇是AQS源码以及机制详解</li>
</ul>
<hr>

        <h1 id="Atomic原子包"   >
          <a href="#Atomic原子包" class="heading-link"><i class="fas fa-link"></i></a><a href="#Atomic原子包" class="headerlink" title="Atomic原子包"></a>Atomic原子包</h1>
      <p>我们可以看到Atomic包下所有的类，在这里先做总的目录，然后再细分说各个类</p>
<blockquote>
<p>AtomicBoolean<br>AtomicInteger<br>AtomicIntegerArray<br>AtomicIntegerFieldUpdater<br>AtomicLong<br>AtomicLongArray<br>AtomicLongFieldUpdater<br>AtomicMarkableReference<br>AtomicReference<br>AtomicReferenceArray<br>AtomicReferenceFieldUpdater<br>AtomicStampedReference<br>DoubleAccumulator<br>DoubleAdder<br>LongAccumulator<br>LongAdder<br>Striped64</p>
</blockquote>
<p>我们这里分成五类原子操作类</p>
<p><strong>1</strong>.基本原子操作类(基本数据类型和引用数据类型)</p>
<p><strong>2</strong>.数组类型原子操作类</p>
<p><strong>3</strong>.属性更新原子操作类</p>
<p><strong>4</strong>.特殊标记原子操作类</p>
<p><strong>5</strong>.基于分治思想新增的原子操作类</p>

        <h2 id="基本原子操作类"   >
          <a href="#基本原子操作类" class="heading-link"><i class="fas fa-link"></i></a><a href="#基本原子操作类" class="headerlink" title="基本原子操作类"></a>基本原子操作类</h2>
      <p>我们先从Integer类型下的源码开始看起</p>
<blockquote>
<p>预览告知：</p>
<p>基本原子操作类只要看AtomicInteger即可，后序的几个都是改变了数据类型而总体没有发生变化</p>
</blockquote>

        <h3 id="AtomicInteger"   >
          <a href="#AtomicInteger" class="heading-link"><i class="fas fa-link"></i></a><a href="#AtomicInteger" class="headerlink" title="AtomicInteger"></a>AtomicInteger</h3>
      <p><strong>源码</strong></p>

        <h4 id="成员变量以及静态方法"   >
          <a href="#成员变量以及静态方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#成员变量以及静态方法" class="headerlink" title="成员变量以及静态方法"></a>成员变量以及静态方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//序列化ID</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">6214790243416807050L</span>;</span><br><span class="line"><span class="comment">//获取魔法类</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Unsafe</span> <span class="variable">unsafe</span> <span class="operator">=</span> Unsafe.getUnsafe();</span><br><span class="line"><span class="comment">//获取value地址偏移量</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> valueOffset;</span><br><span class="line"><span class="comment">//value</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">int</span> value;</span><br><span class="line">   <span class="keyword">static</span> &#123;</span><br><span class="line">       <span class="comment">//用unsafe类中的方法获取地址偏移量</span></span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           valueOffset = unsafe.objectFieldOffset</span><br><span class="line">               (AtomicInteger.class.getDeclaredField(<span class="string">&quot;value&quot;</span>));</span><br><span class="line">       &#125; <span class="keyword">catch</span> (Exception ex) &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(ex); &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></div></figure>


        <h4 id="构造方法"   >
          <a href="#构造方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#构造方法" class="headerlink" title="构造方法"></a>构造方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">有参构造，创建一个初始化数值的AtomicInteger对象</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">AtomicInteger</span><span class="params">(<span class="type">int</span> initialValue)</span> &#123;</span><br><span class="line">       value = initialValue;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 空参构造，创建一个初始化value为0的对象</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">AtomicInteger</span><span class="params">()</span> &#123;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></div></figure>


        <h4 id="get方法"   >
          <a href="#get方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#get方法" class="headerlink" title="get方法"></a>get方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//返回最新值</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//返回老值并且利用unsafe类设置最新值</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getAndSet</span><span class="params">(<span class="type">int</span> newValue)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.getAndSetInt(<span class="built_in">this</span>, valueOffset, newValue);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//返回老值并且利用unsafe类设置新值，新值为老值+1</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getAndIncrement</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.getAndAddInt(<span class="built_in">this</span>, valueOffset, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//返回老值并且利用unsafe类设置新值，新值为老值-1</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getAndDecrement</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.getAndAddInt(<span class="built_in">this</span>, valueOffset, -<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//返回老值并且利用unsafe类设置新值，新值为老值+传入参数delta</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getAndAdd</span><span class="params">(<span class="type">int</span> delta)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.getAndAddInt(<span class="built_in">this</span>, valueOffset, delta);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//返回新值，利用unsafe类设置新值，新值为老值+1</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">incrementAndGet</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.getAndAddInt(<span class="built_in">this</span>, valueOffset, <span class="number">1</span>) + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//返回新值，利用unsafe类设置新值，新值为老值-1</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">decrementAndGet</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.getAndAddInt(<span class="built_in">this</span>, valueOffset, -<span class="number">1</span>) - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//返回新值，利用unsafe类设置新值，新值为老值+参数delta</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">addAndGet</span><span class="params">(<span class="type">int</span> delta)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.getAndAddInt(<span class="built_in">this</span>, valueOffset, delta) + delta;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//返回老值，老值用get方法获取，利用函数接口设置新值。</span></span><br><span class="line"><span class="comment">//利用CAS+自旋设置新值</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getAndUpdate</span><span class="params">(IntUnaryOperator updateFunction)</span> &#123;</span><br><span class="line">        <span class="type">int</span> prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = get();</span><br><span class="line">            next = updateFunction.applyAsInt(prev);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(prev, next));</span><br><span class="line">        <span class="keyword">return</span> prev;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//返回新值，老值用get方法获取，利用函数接口设置新值。</span></span><br><span class="line"><span class="comment">//利用CAS+自旋设置新值</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">updateAndGet</span><span class="params">(IntUnaryOperator updateFunction)</span> &#123;</span><br><span class="line">        <span class="type">int</span> prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = get();</span><br><span class="line">            next = updateFunction.applyAsInt(prev);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(prev, next));</span><br><span class="line">        <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//.........省略以下函数式接口的get并且set的方法</span></span><br></pre></td></tr></table></div></figure>

<p>因此，通过我们可以知道get方法通常是利用Unsafe类的getAndInt方法，而我们在上面文章也即Unsafe类那块也提到过相关的方法，我们这里跟进</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getAndSetInt</span><span class="params">(Object var1, <span class="type">long</span> var2, <span class="type">int</span> var4)</span> &#123;</span><br><span class="line">        <span class="type">int</span> var5;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            var5 = <span class="built_in">this</span>.getIntVolatile(var1, var2);</span><br><span class="line">        &#125; <span class="keyword">while</span>(!<span class="built_in">this</span>.compareAndSwapInt(var1, var2, var5, var4));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> var5;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>

<p>因此，<strong>利用CAS+自旋完成value更新</strong>的操作</p>
<p><em>小结：</em></p>
<p>get方法通常都是利用Unsafe类完成操作，或者是直接通过CAS+自旋完成更新数据的机制</p>

        <h4 id="set方法"   >
          <a href="#set方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#set方法" class="headerlink" title="set方法"></a>set方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//直接设置新值</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(<span class="type">int</span> newValue)</span> &#123;</span><br><span class="line">        value = newValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//利用Unsafe类设置新值</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">lazySet</span><span class="params">(<span class="type">int</span> newValue)</span> &#123;</span><br><span class="line">        unsafe.putOrderedInt(<span class="built_in">this</span>, valueOffset, newValue);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>

<p>根入putOrderedInt方法</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title function_">putOrderedObject</span><span class="params">(Object var1, <span class="type">long</span> var2, Object var4)</span>;</span><br></pre></td></tr></table></div></figure>

<p>直接找到C++的源码</p>
<blockquote>
<p> unsafe.java</p>
</blockquote>
<figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> native <span class="type">void</span> <span class="title">putOrderedObject</span><span class="params">(Object o, <span class="type">long</span> offset, Object x)</span></span>;</span><br></pre></td></tr></table></div></figure>

<blockquote>
<p>unsafe.cpp</p>
</blockquote>
<figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UNSAFE_ENTRY</span>(<span class="type">void</span>, <span class="built_in">Unsafe_SetOrderedObject</span>(JNIEnv *env, jobject unsafe, jobject obj, jlong offset, jobject x_h))</span><br><span class="line">  <span class="built_in">UnsafeWrapper</span>(<span class="string">&quot;Unsafe_SetOrderedObject&quot;</span>);</span><br><span class="line">  oop x = JNIHandles::<span class="built_in">resolve</span>(x_h);</span><br><span class="line">  oop p = JNIHandles::<span class="built_in">resolve</span>(obj);</span><br><span class="line">  <span class="type">void</span>* addr = <span class="built_in">index_oop_from_field_offset_long</span>(p, offset);</span><br><span class="line">  OrderAccess::<span class="built_in">release</span>();</span><br><span class="line">  <span class="keyword">if</span> (UseCompressedOops) &#123;</span><br><span class="line">    <span class="built_in">oop_store</span>((narrowOop*)addr, x);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">oop_store</span>((oop*)addr, x);</span><br><span class="line">  &#125;</span><br><span class="line">  OrderAccess::<span class="built_in">fence</span>();</span><br><span class="line">UNSAFE_END</span><br></pre></td></tr></table></div></figure>

<p>基于内存屏障实现lazyset</p>

        <h4 id="其他方法"   >
          <a href="#其他方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#其他方法" class="headerlink" title="其他方法"></a>其他方法</h4>
      <p>对返回值做一个强制类型转换</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">intValue</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> get();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">long</span> <span class="title function_">longValue</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="type">long</span>)get();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">float</span> <span class="title function_">floatValue</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="type">float</span>)get();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">double</span> <span class="title function_">doubleValue</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="type">double</span>)get();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>



<p><strong>完整代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AtomicInteger</span> <span class="keyword">extends</span> <span class="title class_">Number</span> <span class="keyword">implements</span> <span class="title class_">java</span>.io.Serializable &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">6214790243416807050L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// setup to use Unsafe.compareAndSwapInt for updates</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Unsafe</span> <span class="variable">unsafe</span> <span class="operator">=</span> Unsafe.getUnsafe();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> valueOffset;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            valueOffset = unsafe.objectFieldOffset</span><br><span class="line">                (AtomicInteger.class.getDeclaredField(<span class="string">&quot;value&quot;</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(ex); &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">int</span> value;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AtomicInteger</span><span class="params">(<span class="type">int</span> initialValue)</span> &#123;</span><br><span class="line">        value = initialValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AtomicInteger</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(<span class="type">int</span> newValue)</span> &#123;</span><br><span class="line">        value = newValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">lazySet</span><span class="params">(<span class="type">int</span> newValue)</span> &#123;</span><br><span class="line">        unsafe.putOrderedInt(<span class="built_in">this</span>, valueOffset, newValue);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getAndSet</span><span class="params">(<span class="type">int</span> newValue)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.getAndSetInt(<span class="built_in">this</span>, valueOffset, newValue);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">compareAndSet</span><span class="params">(<span class="type">int</span> expect, <span class="type">int</span> update)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.compareAndSwapInt(<span class="built_in">this</span>, valueOffset, expect, update);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">weakCompareAndSet</span><span class="params">(<span class="type">int</span> expect, <span class="type">int</span> update)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.compareAndSwapInt(<span class="built_in">this</span>, valueOffset, expect, update);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getAndIncrement</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.getAndAddInt(<span class="built_in">this</span>, valueOffset, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getAndDecrement</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.getAndAddInt(<span class="built_in">this</span>, valueOffset, -<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getAndAdd</span><span class="params">(<span class="type">int</span> delta)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.getAndAddInt(<span class="built_in">this</span>, valueOffset, delta);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">incrementAndGet</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.getAndAddInt(<span class="built_in">this</span>, valueOffset, <span class="number">1</span>) + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">decrementAndGet</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.getAndAddInt(<span class="built_in">this</span>, valueOffset, -<span class="number">1</span>) - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">addAndGet</span><span class="params">(<span class="type">int</span> delta)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.getAndAddInt(<span class="built_in">this</span>, valueOffset, delta) + delta;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getAndUpdate</span><span class="params">(IntUnaryOperator updateFunction)</span> &#123;</span><br><span class="line">        <span class="type">int</span> prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = get();</span><br><span class="line">            next = updateFunction.applyAsInt(prev);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(prev, next));</span><br><span class="line">        <span class="keyword">return</span> prev;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">updateAndGet</span><span class="params">(IntUnaryOperator updateFunction)</span> &#123;</span><br><span class="line">        <span class="type">int</span> prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = get();</span><br><span class="line">            next = updateFunction.applyAsInt(prev);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(prev, next));</span><br><span class="line">        <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getAndAccumulate</span><span class="params">(<span class="type">int</span> x,</span></span><br><span class="line"><span class="params">                                      IntBinaryOperator accumulatorFunction)</span> &#123;</span><br><span class="line">        <span class="type">int</span> prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = get();</span><br><span class="line">            next = accumulatorFunction.applyAsInt(prev, x);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(prev, next));</span><br><span class="line">        <span class="keyword">return</span> prev;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">accumulateAndGet</span><span class="params">(<span class="type">int</span> x,</span></span><br><span class="line"><span class="params">                                      IntBinaryOperator accumulatorFunction)</span> &#123;</span><br><span class="line">        <span class="type">int</span> prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = get();</span><br><span class="line">            next = accumulatorFunction.applyAsInt(prev, x);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(prev, next));</span><br><span class="line">        <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Integer.toString(get());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">intValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">longValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">long</span>)get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">float</span> <span class="title function_">floatValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">float</span>)get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">doubleValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">double</span>)get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h3 id="AtomicBoolean"   >
          <a href="#AtomicBoolean" class="heading-link"><i class="fas fa-link"></i></a><a href="#AtomicBoolean" class="headerlink" title="AtomicBoolean"></a>AtomicBoolean</h3>
      <p><strong>源码</strong></p>

        <h4 id="成员变量以及静态方法-1"   >
          <a href="#成员变量以及静态方法-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#成员变量以及静态方法-1" class="headerlink" title="成员变量以及静态方法"></a>成员变量以及静态方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//序列化Id</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">4654671469794556979L</span>;</span><br><span class="line">   <span class="comment">//unsafe类</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Unsafe</span> <span class="variable">unsafe</span> <span class="operator">=</span> Unsafe.getUnsafe();</span><br><span class="line"><span class="comment">//value的内存偏移量</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> valueOffset;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">static</span> &#123;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="comment">//获取内存偏移量并且给valueOffset赋值</span></span><br><span class="line">           valueOffset = unsafe.objectFieldOffset</span><br><span class="line">               (AtomicBoolean.class.getDeclaredField(<span class="string">&quot;value&quot;</span>));</span><br><span class="line">       &#125; <span class="keyword">catch</span> (Exception ex) &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(ex); &#125;</span><br><span class="line">   &#125;</span><br><span class="line"><span class="comment">//变量value</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">int</span> value;</span><br></pre></td></tr></table></div></figure>


        <h4 id="构造方法-1"   >
          <a href="#构造方法-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#构造方法-1" class="headerlink" title="构造方法"></a>构造方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	有参构造，通过传入参数初始化，true则为1，false为0</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">AtomicBoolean</span><span class="params">(<span class="type">boolean</span> initialValue)</span> &#123;</span><br><span class="line">       value = initialValue ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 无参构造，初始化为false 也即为0</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">AtomicBoolean</span><span class="params">()</span> &#123;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></div></figure>


        <h4 id="get方法-1"   >
          <a href="#get方法-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#get方法-1" class="headerlink" title="get方法"></a>get方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//返回当前值，如果value为1则为true，value为0则为false</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value != <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过Unsafe的CAS设置新值</span></span><br><span class="line"><span class="comment">//如果CAS成功则返回true</span></span><br><span class="line"> 	<span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">compareAndSet</span><span class="params">(<span class="type">boolean</span> expect, <span class="type">boolean</span> update)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">e</span> <span class="operator">=</span> expect ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">u</span> <span class="operator">=</span> update ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> unsafe.compareAndSwapInt(<span class="built_in">this</span>, valueOffset, e, u);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过Unsafe的CAS设置新值</span></span><br><span class="line"><span class="comment">//如果CAS成功则返回true</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">weakCompareAndSet</span><span class="params">(<span class="type">boolean</span> expect, <span class="type">boolean</span> update)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">e</span> <span class="operator">=</span> expect ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">u</span> <span class="operator">=</span> update ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> unsafe.compareAndSwapInt(<span class="built_in">this</span>, valueOffset, e, u);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过CAS以及自旋完成设置新值操作</span></span><br><span class="line"><span class="comment">//返回老值</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">getAndSet</span><span class="params">(<span class="type">boolean</span> newValue)</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> prev;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = get();</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(prev, newValue));</span><br><span class="line">        <span class="keyword">return</span> prev;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>

<p><em>小结：</em></p>
<p>get方法通常都是利用Unsafe类完成操作，或者是直接通过CAS+自旋完成更新数据的机制</p>

        <h4 id="set方法-1"   >
          <a href="#set方法-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#set方法-1" class="headerlink" title="set方法"></a>set方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置新值</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(<span class="type">boolean</span> newValue)</span> &#123;</span><br><span class="line">       value = newValue ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//lazySet 设置新值</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">lazySet</span><span class="params">(<span class="type">boolean</span> newValue)</span> &#123;</span><br><span class="line">       <span class="type">int</span> <span class="variable">v</span> <span class="operator">=</span> newValue ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">       unsafe.putOrderedInt(<span class="built_in">this</span>, valueOffset, v);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p><strong>完整代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AtomicBoolean</span> <span class="keyword">implements</span> <span class="title class_">java</span>.io.Serializable &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">4654671469794556979L</span>;</span><br><span class="line">    <span class="comment">// setup to use Unsafe.compareAndSwapInt for updates</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Unsafe</span> <span class="variable">unsafe</span> <span class="operator">=</span> Unsafe.getUnsafe();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> valueOffset;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            valueOffset = unsafe.objectFieldOffset</span><br><span class="line">                (AtomicBoolean.class.getDeclaredField(<span class="string">&quot;value&quot;</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(ex); &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">int</span> value;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AtomicBoolean</span><span class="params">(<span class="type">boolean</span> initialValue)</span> &#123;</span><br><span class="line">        value = initialValue ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AtomicBoolean</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value != <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">compareAndSet</span><span class="params">(<span class="type">boolean</span> expect, <span class="type">boolean</span> update)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">e</span> <span class="operator">=</span> expect ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">u</span> <span class="operator">=</span> update ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> unsafe.compareAndSwapInt(<span class="built_in">this</span>, valueOffset, e, u);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">weakCompareAndSet</span><span class="params">(<span class="type">boolean</span> expect, <span class="type">boolean</span> update)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">e</span> <span class="operator">=</span> expect ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">u</span> <span class="operator">=</span> update ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> unsafe.compareAndSwapInt(<span class="built_in">this</span>, valueOffset, e, u);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(<span class="type">boolean</span> newValue)</span> &#123;</span><br><span class="line">        value = newValue ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">lazySet</span><span class="params">(<span class="type">boolean</span> newValue)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">v</span> <span class="operator">=</span> newValue ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">        unsafe.putOrderedInt(<span class="built_in">this</span>, valueOffset, v);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">getAndSet</span><span class="params">(<span class="type">boolean</span> newValue)</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> prev;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = get();</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(prev, newValue));</span><br><span class="line">        <span class="keyword">return</span> prev;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Boolean.toString(get());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>




        <h3 id="AtomicLong"   >
          <a href="#AtomicLong" class="heading-link"><i class="fas fa-link"></i></a><a href="#AtomicLong" class="headerlink" title="AtomicLong"></a>AtomicLong</h3>
      <p><strong>源码</strong></p>

        <h4 id="成员变量以及静态方法-2"   >
          <a href="#成员变量以及静态方法-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#成员变量以及静态方法-2" class="headerlink" title="成员变量以及静态方法"></a>成员变量以及静态方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">	<span class="comment">//序列化ID</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1927816293512124184L</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//unsafe类</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Unsafe</span> <span class="variable">unsafe</span> <span class="operator">=</span> Unsafe.getUnsafe();</span><br><span class="line"></span><br><span class="line"><span class="comment">//内存偏移量</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> valueOffset;</span><br><span class="line"></span><br><span class="line"><span class="comment">//标志位，虚拟机是否支持LONG类型CAS</span></span><br><span class="line">   <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="variable">VM_SUPPORTS_LONG_CAS</span> <span class="operator">=</span> VMSupportsCS8();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="type">boolean</span> <span class="title function_">VMSupportsCS8</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取偏移量并且赋值</span></span><br><span class="line">   <span class="keyword">static</span> &#123;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           valueOffset = unsafe.objectFieldOffset</span><br><span class="line">               (AtomicLong.class.getDeclaredField(<span class="string">&quot;value&quot;</span>));</span><br><span class="line">       &#125; <span class="keyword">catch</span> (Exception ex) &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(ex); &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//变量value</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">long</span> value;</span><br></pre></td></tr></table></div></figure>


        <h4 id="构造方法-2"   >
          <a href="#构造方法-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#构造方法-2" class="headerlink" title="构造方法"></a>构造方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//有参构造，初始化为传入long数据    </span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">AtomicLong</span><span class="params">(<span class="type">long</span> initialValue)</span> &#123;</span><br><span class="line">       value = initialValue;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//无参构造,初始化为0</span></span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">AtomicLong</span><span class="params">()</span> &#123;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></div></figure>


        <h4 id="get方法-2"   >
          <a href="#get方法-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#get方法-2" class="headerlink" title="get方法"></a>get方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//返回当前值</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">long</span> <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> value;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//返回老值,新值用unsafe类CAS更新</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">long</span> <span class="title function_">getAndSet</span><span class="params">(<span class="type">long</span> newValue)</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> unsafe.getAndSetLong(<span class="built_in">this</span>, valueOffset, newValue);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//返回老值，新值用unsafe更新成老值+1</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">long</span> <span class="title function_">getAndIncrement</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> unsafe.getAndAddLong(<span class="built_in">this</span>, valueOffset, <span class="number">1L</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//返回老值，新值用unsafe类更新成老值-1</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">long</span> <span class="title function_">getAndDecrement</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> unsafe.getAndAddLong(<span class="built_in">this</span>, valueOffset, -<span class="number">1L</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//返回老值，新值用unsafe类更新成老值+delta</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">long</span> <span class="title function_">getAndAdd</span><span class="params">(<span class="type">long</span> delta)</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> unsafe.getAndAddLong(<span class="built_in">this</span>, valueOffset, delta);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//......省略了一些方法，与Integer一样只是类型变成了long类型</span></span><br></pre></td></tr></table></div></figure>

<p><em>小结：</em></p>
<p>get方法通常都是利用Unsafe类完成操作，或者是直接通过CAS+自旋完成更新数据的机制</p>

        <h4 id="set方法-2"   >
          <a href="#set方法-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#set方法-2" class="headerlink" title="set方法"></a>set方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置新值</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(<span class="type">long</span> newValue)</span> &#123;</span><br><span class="line">       value = newValue;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//利用unsafe设置新值</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">lazySet</span><span class="params">(<span class="type">long</span> newValue)</span> &#123;</span><br><span class="line">       unsafe.putOrderedLong(<span class="built_in">this</span>, valueOffset, newValue);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p><strong>完整代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AtomicLong</span> <span class="keyword">extends</span> <span class="title class_">Number</span> <span class="keyword">implements</span> <span class="title class_">java</span>.io.Serializable &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1927816293512124184L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// setup to use Unsafe.compareAndSwapLong for updates</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Unsafe</span> <span class="variable">unsafe</span> <span class="operator">=</span> Unsafe.getUnsafe();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> valueOffset;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="variable">VM_SUPPORTS_LONG_CAS</span> <span class="operator">=</span> VMSupportsCS8();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="type">boolean</span> <span class="title function_">VMSupportsCS8</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            valueOffset = unsafe.objectFieldOffset</span><br><span class="line">                (AtomicLong.class.getDeclaredField(<span class="string">&quot;value&quot;</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(ex); &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">long</span> value;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AtomicLong</span><span class="params">(<span class="type">long</span> initialValue)</span> &#123;</span><br><span class="line">        value = initialValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AtomicLong</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">long</span> <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(<span class="type">long</span> newValue)</span> &#123;</span><br><span class="line">        value = newValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">lazySet</span><span class="params">(<span class="type">long</span> newValue)</span> &#123;</span><br><span class="line">        unsafe.putOrderedLong(<span class="built_in">this</span>, valueOffset, newValue);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">long</span> <span class="title function_">getAndSet</span><span class="params">(<span class="type">long</span> newValue)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.getAndSetLong(<span class="built_in">this</span>, valueOffset, newValue);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">compareAndSet</span><span class="params">(<span class="type">long</span> expect, <span class="type">long</span> update)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.compareAndSwapLong(<span class="built_in">this</span>, valueOffset, expect, update);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">weakCompareAndSet</span><span class="params">(<span class="type">long</span> expect, <span class="type">long</span> update)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.compareAndSwapLong(<span class="built_in">this</span>, valueOffset, expect, update);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">long</span> <span class="title function_">getAndIncrement</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.getAndAddLong(<span class="built_in">this</span>, valueOffset, <span class="number">1L</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">long</span> <span class="title function_">getAndDecrement</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.getAndAddLong(<span class="built_in">this</span>, valueOffset, -<span class="number">1L</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">long</span> <span class="title function_">getAndAdd</span><span class="params">(<span class="type">long</span> delta)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.getAndAddLong(<span class="built_in">this</span>, valueOffset, delta);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">long</span> <span class="title function_">incrementAndGet</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.getAndAddLong(<span class="built_in">this</span>, valueOffset, <span class="number">1L</span>) + <span class="number">1L</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">long</span> <span class="title function_">decrementAndGet</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.getAndAddLong(<span class="built_in">this</span>, valueOffset, -<span class="number">1L</span>) - <span class="number">1L</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">long</span> <span class="title function_">addAndGet</span><span class="params">(<span class="type">long</span> delta)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.getAndAddLong(<span class="built_in">this</span>, valueOffset, delta) + delta;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">long</span> <span class="title function_">getAndUpdate</span><span class="params">(LongUnaryOperator updateFunction)</span> &#123;</span><br><span class="line">        <span class="type">long</span> prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = get();</span><br><span class="line">            next = updateFunction.applyAsLong(prev);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(prev, next));</span><br><span class="line">        <span class="keyword">return</span> prev;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">long</span> <span class="title function_">updateAndGet</span><span class="params">(LongUnaryOperator updateFunction)</span> &#123;</span><br><span class="line">        <span class="type">long</span> prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = get();</span><br><span class="line">            next = updateFunction.applyAsLong(prev);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(prev, next));</span><br><span class="line">        <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">long</span> <span class="title function_">getAndAccumulate</span><span class="params">(<span class="type">long</span> x,</span></span><br><span class="line"><span class="params">                                       LongBinaryOperator accumulatorFunction)</span> &#123;</span><br><span class="line">        <span class="type">long</span> prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = get();</span><br><span class="line">            next = accumulatorFunction.applyAsLong(prev, x);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(prev, next));</span><br><span class="line">        <span class="keyword">return</span> prev;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">long</span> <span class="title function_">accumulateAndGet</span><span class="params">(<span class="type">long</span> x,</span></span><br><span class="line"><span class="params">                                       LongBinaryOperator accumulatorFunction)</span> &#123;</span><br><span class="line">        <span class="type">long</span> prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = get();</span><br><span class="line">            next = accumulatorFunction.applyAsLong(prev, x);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(prev, next));</span><br><span class="line">        <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Long.toString(get());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">intValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">int</span>)get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">longValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">float</span> <span class="title function_">floatValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">float</span>)get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">doubleValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">double</span>)get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>


        <h3 id="AtomicReference"   >
          <a href="#AtomicReference" class="heading-link"><i class="fas fa-link"></i></a><a href="#AtomicReference" class="headerlink" title="AtomicReference"></a>AtomicReference</h3>
      <p><strong>源码</strong></p>

        <h4 id="成员变量以及静态方法-3"   >
          <a href="#成员变量以及静态方法-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#成员变量以及静态方法-3" class="headerlink" title="成员变量以及静态方法"></a>成员变量以及静态方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//序列化ID</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">1848883965231344442L</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//unsafe类以及内存偏移量</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Unsafe</span> <span class="variable">unsafe</span> <span class="operator">=</span> Unsafe.getUnsafe();</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> valueOffset;</span><br><span class="line"></span><br><span class="line"><span class="comment">//静态方法获取内存偏移量并且赋值</span></span><br><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        valueOffset = unsafe.objectFieldOffset</span><br><span class="line">            (AtomicReference.class.getDeclaredField(<span class="string">&quot;value&quot;</span>));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception ex) &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(ex); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//泛型V 变量value</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> V value;</span><br></pre></td></tr></table></div></figure>


        <h4 id="构造方法-3"   >
          <a href="#构造方法-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#构造方法-3" class="headerlink" title="构造方法"></a>构造方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//有参构造，初始化数据为传入参数数值</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">AtomicReference</span><span class="params">(V initialValue)</span> &#123;</span><br><span class="line">        value = initialValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//无参构造，初始化数据为null</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">AtomicReference</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h4 id="get方法-3"   >
          <a href="#get方法-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#get方法-3" class="headerlink" title="get方法"></a>get方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//返回当前值</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> V <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">//返回老值，新值用unsafe类CAS更新</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> V <span class="title function_">getAndSet</span><span class="params">(V newValue)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (V)unsafe.getAndSetObject(<span class="built_in">this</span>, valueOffset, newValue);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//返回老值，新值用CAS+自旋更新</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> V <span class="title function_">getAndUpdate</span><span class="params">(UnaryOperator&lt;V&gt; updateFunction)</span> &#123;</span><br><span class="line">        V prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = get();</span><br><span class="line">            next = updateFunction.apply(prev);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(prev, next));</span><br><span class="line">        <span class="keyword">return</span> prev;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//....省略方法</span></span><br></pre></td></tr></table></div></figure>


        <h4 id="Set方法"   >
          <a href="#Set方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#Set方法" class="headerlink" title="Set方法"></a>Set方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置新值</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(V newValue)</span> &#123;</span><br><span class="line">       value = newValue;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//利用Unsafe设置新值</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">lazySet</span><span class="params">(V newValue)</span> &#123;</span><br><span class="line">       unsafe.putOrderedObject(<span class="built_in">this</span>, valueOffset, newValue);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//利用Unsafe类中CAS设置新值，设置成功返回true</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">compareAndSet</span><span class="params">(V expect, V update)</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> unsafe.compareAndSwapObject(<span class="built_in">this</span>, valueOffset, expect, update);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></div></figure>

<p><strong>完整代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AtomicReference</span>&lt;V&gt; <span class="keyword">implements</span> <span class="title class_">java</span>.io.Serializable &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">1848883965231344442L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Unsafe</span> <span class="variable">unsafe</span> <span class="operator">=</span> Unsafe.getUnsafe();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> valueOffset;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            valueOffset = unsafe.objectFieldOffset</span><br><span class="line">                (AtomicReference.class.getDeclaredField(<span class="string">&quot;value&quot;</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(ex); &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> V value;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AtomicReference</span><span class="params">(V initialValue)</span> &#123;</span><br><span class="line">        value = initialValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AtomicReference</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> V <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(V newValue)</span> &#123;</span><br><span class="line">        value = newValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">lazySet</span><span class="params">(V newValue)</span> &#123;</span><br><span class="line">        unsafe.putOrderedObject(<span class="built_in">this</span>, valueOffset, newValue);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">compareAndSet</span><span class="params">(V expect, V update)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.compareAndSwapObject(<span class="built_in">this</span>, valueOffset, expect, update);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">weakCompareAndSet</span><span class="params">(V expect, V update)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.compareAndSwapObject(<span class="built_in">this</span>, valueOffset, expect, update);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> V <span class="title function_">getAndSet</span><span class="params">(V newValue)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (V)unsafe.getAndSetObject(<span class="built_in">this</span>, valueOffset, newValue);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> V <span class="title function_">getAndUpdate</span><span class="params">(UnaryOperator&lt;V&gt; updateFunction)</span> &#123;</span><br><span class="line">        V prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = get();</span><br><span class="line">            next = updateFunction.apply(prev);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(prev, next));</span><br><span class="line">        <span class="keyword">return</span> prev;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> V <span class="title function_">updateAndGet</span><span class="params">(UnaryOperator&lt;V&gt; updateFunction)</span> &#123;</span><br><span class="line">        V prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = get();</span><br><span class="line">            next = updateFunction.apply(prev);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(prev, next));</span><br><span class="line">        <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> V <span class="title function_">getAndAccumulate</span><span class="params">(V x,</span></span><br><span class="line"><span class="params">                                    BinaryOperator&lt;V&gt; accumulatorFunction)</span> &#123;</span><br><span class="line">        V prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = get();</span><br><span class="line">            next = accumulatorFunction.apply(prev, x);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(prev, next));</span><br><span class="line">        <span class="keyword">return</span> prev;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> V <span class="title function_">accumulateAndGet</span><span class="params">(V x,</span></span><br><span class="line"><span class="params">                                    BinaryOperator&lt;V&gt; accumulatorFunction)</span> &#123;</span><br><span class="line">        V prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = get();</span><br><span class="line">            next = accumulatorFunction.apply(prev, x);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(prev, next));</span><br><span class="line">        <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> String.valueOf(get());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>


        <h3 id="小结"   >
          <a href="#小结" class="heading-link"><i class="fas fa-link"></i></a><a href="#小结" class="headerlink" title="小结"></a>小结</h3>
      <p>基本原子操作类中基本都是调用unsafe类完成更新以及获取数据操作</p>

        <h2 id="数组类型原子操作类"   >
          <a href="#数组类型原子操作类" class="heading-link"><i class="fas fa-link"></i></a><a href="#数组类型原子操作类" class="headerlink" title="数组类型原子操作类"></a>数组类型原子操作类</h2>
      
        <h3 id="AtomicIntegerArray"   >
          <a href="#AtomicIntegerArray" class="heading-link"><i class="fas fa-link"></i></a><a href="#AtomicIntegerArray" class="headerlink" title="AtomicIntegerArray"></a>AtomicIntegerArray</h3>
      <p><strong>源码</strong></p>

        <h4 id="成员变量以及静态方法-4"   >
          <a href="#成员变量以及静态方法-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#成员变量以及静态方法-4" class="headerlink" title="成员变量以及静态方法"></a>成员变量以及静态方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//序列化ID</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">2862133569453604235L</span>;</span><br><span class="line"><span class="comment">//unsafe类</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Unsafe</span> <span class="variable">unsafe</span> <span class="operator">=</span> Unsafe.getUnsafe();</span><br><span class="line"><span class="comment">//获取到数组中第一个位置起始位置</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">base</span> <span class="operator">=</span> unsafe.arrayBaseOffset(<span class="type">int</span>[].class);</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> shift;</span><br><span class="line"><span class="comment">//int数组</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span>[] array;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">    <span class="comment">//获取数组的偏移量（初始位置）</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">scale</span> <span class="operator">=</span> unsafe.arrayIndexScale(<span class="type">int</span>[].class);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**判断scale是否是二的幂次方</span></span><br><span class="line"><span class="comment">   		正常情况假设scale为100，则scale-1为011， 	</span></span><br><span class="line"><span class="comment">    	所以scale&amp;(scale-1)==0  </span></span><br><span class="line"><span class="comment">    	</span></span><br><span class="line"><span class="comment">    	异常情况假设scale为011，则scale-1位010</span></span><br><span class="line"><span class="comment">    	所以scale&amp;(scale-1)!=0  </span></span><br><span class="line"><span class="comment">    	</span></span><br><span class="line"><span class="comment">    	</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">if</span> ((scale &amp; (scale - <span class="number">1</span>)) != <span class="number">0</span>)</span><br><span class="line">        <span class="comment">//抛出异常说明不是2的幂次方</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;data type scale not a power of two&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//调用方法获取到数组初始为0的前置0个数</span></span><br><span class="line">    <span class="comment">//于是shift为31-（前置0个数）</span></span><br><span class="line">    shift = <span class="number">31</span> - Integer.numberOfLeadingZeros(scale);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>这里是求得前置0个数的方法</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">numberOfLeadingZeros</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="comment">// HD, Figure 5-6</span></span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">32</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (i &gt;&gt;&gt; <span class="number">16</span> == <span class="number">0</span>) &#123; n += <span class="number">16</span>; i &lt;&lt;= <span class="number">16</span>; &#125;</span><br><span class="line">        <span class="keyword">if</span> (i &gt;&gt;&gt; <span class="number">24</span> == <span class="number">0</span>) &#123; n +=  <span class="number">8</span>; i &lt;&lt;=  <span class="number">8</span>; &#125;</span><br><span class="line">        <span class="keyword">if</span> (i &gt;&gt;&gt; <span class="number">28</span> == <span class="number">0</span>) &#123; n +=  <span class="number">4</span>; i &lt;&lt;=  <span class="number">4</span>; &#125;</span><br><span class="line">        <span class="keyword">if</span> (i &gt;&gt;&gt; <span class="number">30</span> == <span class="number">0</span>) &#123; n +=  <span class="number">2</span>; i &lt;&lt;=  <span class="number">2</span>; &#125;</span><br><span class="line">        n -= i &gt;&gt;&gt; <span class="number">31</span>;</span><br><span class="line">        <span class="keyword">return</span> n;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>

<blockquote>
<p> 因为Int类型为4字节，所以我们假设scale为4也即i为4，这个方法主要是求得i的最高非0位</p>
</blockquote>
<p>如果i&#x3D;&#x3D;0则返回32，说明前面有32个0也即0000 0000 0000 0000 0000 0000 0000 0000</p>
<p>如果i不为0，也即现在情况scale为4，也即0000 0000 0000 0000 0000 0000 0000 0100</p>
<p>如果i右移16位为0说明最高非零位<strong>不在高16位中而在低16位中</strong>，也即4右移16位：</p>
<p>0000 0000 0000 0000 0000 0000 0000 0100 &#x3D;&gt; 0000 0000 0000 0000 0000 0000 0000 0000</p>
<p>所以n&#x3D;17,并将i左移16位：</p>
<p>0000 0000 0000 0000 0000 0000 0000 0100 &#x3D;&gt; 0000 0000 0000 0100 0000 0000 0000 0000</p>
<p>如果i右移24位为0说明最高非零位在<strong>低16位的低8位中</strong>，也即：</p>
<p>0000 0000 0000 0100 0000 0000 0000 0000 &#x3D;&gt; 0000 0000 0000 0000 0000 0000 0000 0000</p>
<p>所以n为25，并将i左移8位: </p>
<p>0000 0000 0000 0100 0000 0000 0000 0000 &#x3D;&gt; 0000 0100 0000 0000 0000 0000 0000 0000</p>
<p>如果i右移28位为0说明最高非零位在<strong>低16位的低8位的低4位中</strong>，也即：</p>
<p>0000 0100 0000 0000 0000 0000 0000 0000 &#x3D;&gt; 0000 0000 0000 0000 0000 0000 0000 0000</p>
<p>所以n为29,并将i左移4位：</p>
<p>0000 0100 0000 0000 0000 0000 0000 0000 &#x3D;&gt;  0100 0000 0000 0000 0000 0000 0000 0000</p>
<p>如果i右移30位不为0说明最高非零位在<strong>低16位的低8位的低4位的高2位中</strong>，也即：</p>
<p>0100 0000 0000 0000 0000 0000 0000 0000 &#x3D;&gt; 0000 0000 0000 0000 0000 0000 0000 0001</p>
<p>所以n为29</p>
<p>n-&#x3D; i&gt;&gt;&gt;31 如果在最终两位的高1位中则n为28，如果在最终两位的低1位中则最终n为29</p>
<p>在这里n -&#x3D; i &gt;&gt;&gt;31 最终的结果是<strong>29</strong>，也即scale最终前置有29位0</p>
<p><strong>利用shift以及i求得索引i对应的内存地址</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">long</span> <span class="title function_">checkedByteOffset</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">       <span class="comment">//当i小于0或者i大于数组长度则不合法抛出索引越界异常</span></span><br><span class="line">       <span class="keyword">if</span> (i &lt; <span class="number">0</span> || i &gt;= array.length)</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IndexOutOfBoundsException</span>(<span class="string">&quot;index &quot;</span> + i);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> byteOffset(i);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">long</span> <span class="title function_">byteOffset</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">   <span class="comment">//将i左移shift位置加上base(base为数组第一个元素的内存地址)</span></span><br><span class="line">       <span class="keyword">return</span> ((<span class="type">long</span>) i &lt;&lt; shift) + base;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></div></figure>




        <h4 id="构造方法-4"   >
          <a href="#构造方法-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#构造方法-4" class="headerlink" title="构造方法"></a>构造方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//有参构造，传入长度为length，将数组array初始化为长度为length的数组</span></span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">AtomicIntegerArray</span><span class="params">(<span class="type">int</span> length)</span> &#123;</span><br><span class="line">       array = <span class="keyword">new</span> <span class="title class_">int</span>[length];</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//有参构造，传入一个数组，利用clone克隆给当前数组</span></span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">AtomicIntegerArray</span><span class="params">(<span class="type">int</span>[] array)</span> &#123;</span><br><span class="line">       <span class="comment">// Visibility guaranteed by final field guarantees</span></span><br><span class="line">       <span class="built_in">this</span>.array = array.clone();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></div></figure>




        <h4 id="get方法-4"   >
          <a href="#get方法-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#get方法-4" class="headerlink" title="get方法"></a>get方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">	<span class="comment">//返回索引为i位置的当前value值</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">get</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getRaw(checkedByteOffset(i));</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//将对应下标的数值利用unsafe类获取并且返回</span></span><br><span class="line">	<span class="keyword">private</span> <span class="type">int</span> <span class="title function_">getRaw</span><span class="params">(<span class="type">long</span> offset)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.getIntVolatile(array, offset);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//返回索引为i位置的老值</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getAndIncrement</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getAndAdd(i, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//将对应下标i的偏移量利用unsafe类完成+delta操作</span></span><br><span class="line"> 	<span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getAndAdd</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> delta)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.getAndAddInt(array, checkedByteOffset(i), delta);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//返回操作后的新值</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">incrementAndGet</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getAndAdd(i, <span class="number">1</span>) + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//...省略一些方法</span></span><br></pre></td></tr></table></div></figure>

<p><strong>小结</strong></p>
<p>以上get方法都是取得索引i位置对应的内存地址，然后利用unsafe类直接操作内存地址，利用CAS机制完成。也即从Integer对应的操作一个位置变成了IntegerArray操作多个位置</p>

        <h4 id="set方法-3"   >
          <a href="#set方法-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#set方法-3" class="headerlink" title="set方法"></a>set方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置对应下标I位置的新值</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> newValue)</span> &#123;</span><br><span class="line">       unsafe.putIntVolatile(array, checkedByteOffset(i), newValue);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">lazySet</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> newValue)</span> &#123;</span><br><span class="line">       unsafe.putOrderedInt(array, checkedByteOffset(i), newValue);</span><br><span class="line">   &#125;</span><br><span class="line">  </span><br><span class="line">   <span class="comment">//CAS对应下标I位置</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">compareAndSet</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> expect, <span class="type">int</span> update)</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> compareAndSetRaw(checkedByteOffset(i), expect, update);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></div></figure>

<p><strong>完整代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AtomicIntegerArray</span> <span class="keyword">implements</span> <span class="title class_">java</span>.io.Serializable &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">2862133569453604235L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Unsafe</span> <span class="variable">unsafe</span> <span class="operator">=</span> Unsafe.getUnsafe();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">base</span> <span class="operator">=</span> unsafe.arrayBaseOffset(<span class="type">int</span>[].class);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> shift;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span>[] array;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">scale</span> <span class="operator">=</span> unsafe.arrayIndexScale(<span class="type">int</span>[].class);</span><br><span class="line">        <span class="keyword">if</span> ((scale &amp; (scale - <span class="number">1</span>)) != <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;data type scale not a power of two&quot;</span>);</span><br><span class="line">        shift = <span class="number">31</span> - Integer.numberOfLeadingZeros(scale);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> <span class="title function_">checkedByteOffset</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (i &lt; <span class="number">0</span> || i &gt;= array.length)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IndexOutOfBoundsException</span>(<span class="string">&quot;index &quot;</span> + i);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> byteOffset(i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">long</span> <span class="title function_">byteOffset</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ((<span class="type">long</span>) i &lt;&lt; shift) + base;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AtomicIntegerArray</span><span class="params">(<span class="type">int</span> length)</span> &#123;</span><br><span class="line">        array = <span class="keyword">new</span> <span class="title class_">int</span>[length];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AtomicIntegerArray</span><span class="params">(<span class="type">int</span>[] array)</span> &#123;</span><br><span class="line">        <span class="comment">// Visibility guaranteed by final field guarantees</span></span><br><span class="line">        <span class="built_in">this</span>.array = array.clone();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">length</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> array.length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">get</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getRaw(checkedByteOffset(i));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">getRaw</span><span class="params">(<span class="type">long</span> offset)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.getIntVolatile(array, offset);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> newValue)</span> &#123;</span><br><span class="line">        unsafe.putIntVolatile(array, checkedByteOffset(i), newValue);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">lazySet</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> newValue)</span> &#123;</span><br><span class="line">        unsafe.putOrderedInt(array, checkedByteOffset(i), newValue);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getAndSet</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> newValue)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.getAndSetInt(array, checkedByteOffset(i), newValue);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">compareAndSet</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> expect, <span class="type">int</span> update)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> compareAndSetRaw(checkedByteOffset(i), expect, update);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">compareAndSetRaw</span><span class="params">(<span class="type">long</span> offset, <span class="type">int</span> expect, <span class="type">int</span> update)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.compareAndSwapInt(array, offset, expect, update);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">weakCompareAndSet</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> expect, <span class="type">int</span> update)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> compareAndSet(i, expect, update);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getAndIncrement</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getAndAdd(i, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getAndDecrement</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getAndAdd(i, -<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getAndAdd</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> delta)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.getAndAddInt(array, checkedByteOffset(i), delta);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">incrementAndGet</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getAndAdd(i, <span class="number">1</span>) + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">decrementAndGet</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getAndAdd(i, -<span class="number">1</span>) - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">addAndGet</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> delta)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getAndAdd(i, delta) + delta;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getAndUpdate</span><span class="params">(<span class="type">int</span> i, IntUnaryOperator updateFunction)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">offset</span> <span class="operator">=</span> checkedByteOffset(i);</span><br><span class="line">        <span class="type">int</span> prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = getRaw(offset);</span><br><span class="line">            next = updateFunction.applyAsInt(prev);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSetRaw(offset, prev, next));</span><br><span class="line">        <span class="keyword">return</span> prev;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">updateAndGet</span><span class="params">(<span class="type">int</span> i, IntUnaryOperator updateFunction)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">offset</span> <span class="operator">=</span> checkedByteOffset(i);</span><br><span class="line">        <span class="type">int</span> prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = getRaw(offset);</span><br><span class="line">            next = updateFunction.applyAsInt(prev);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSetRaw(offset, prev, next));</span><br><span class="line">        <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getAndAccumulate</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> x,</span></span><br><span class="line"><span class="params">                                      IntBinaryOperator accumulatorFunction)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">offset</span> <span class="operator">=</span> checkedByteOffset(i);</span><br><span class="line">        <span class="type">int</span> prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = getRaw(offset);</span><br><span class="line">            next = accumulatorFunction.applyAsInt(prev, x);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSetRaw(offset, prev, next));</span><br><span class="line">        <span class="keyword">return</span> prev;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">accumulateAndGet</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> x,</span></span><br><span class="line"><span class="params">                                      IntBinaryOperator accumulatorFunction)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">offset</span> <span class="operator">=</span> checkedByteOffset(i);</span><br><span class="line">        <span class="type">int</span> prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = getRaw(offset);</span><br><span class="line">            next = accumulatorFunction.applyAsInt(prev, x);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSetRaw(offset, prev, next));</span><br><span class="line">        <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">iMax</span> <span class="operator">=</span> array.length - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (iMax == -<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;[]&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        b.append(<span class="string">&#x27;[&#x27;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; ; i++) &#123;</span><br><span class="line">            b.append(getRaw(byteOffset(i)));</span><br><span class="line">            <span class="keyword">if</span> (i == iMax)</span><br><span class="line">                <span class="keyword">return</span> b.append(<span class="string">&#x27;]&#x27;</span>).toString();</span><br><span class="line">            b.append(<span class="string">&#x27;,&#x27;</span>).append(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>


        <h3 id="AtomicLongArray"   >
          <a href="#AtomicLongArray" class="heading-link"><i class="fas fa-link"></i></a><a href="#AtomicLongArray" class="headerlink" title="AtomicLongArray"></a>AtomicLongArray</h3>
      <p><strong>源码</strong></p>

        <h4 id="成员变量以及静态方法-5"   >
          <a href="#成员变量以及静态方法-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#成员变量以及静态方法-5" class="headerlink" title="成员变量以及静态方法"></a>成员变量以及静态方法</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">//序列化ID</span><br><span class="line">private static final long serialVersionUID = -2308431214976778248L;</span><br><span class="line"></span><br><span class="line">//魔法类unsafe</span><br><span class="line">   private static final Unsafe unsafe = Unsafe.getUnsafe();</span><br><span class="line">   </span><br><span class="line">   //数组起始内存地址</span><br><span class="line">   private static final int base = unsafe.arrayBaseOffset(long[].class);</span><br><span class="line">   </span><br><span class="line">   private static final int shift;</span><br><span class="line">   </span><br><span class="line">   //数组</span><br><span class="line">   private final long[] array;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   static &#123;</span><br><span class="line">       int scale = unsafe.arrayIndexScale(long[].class);</span><br><span class="line">       if ((scale &amp; (scale - 1)) != 0)</span><br><span class="line">           throw new Error(&quot;data type scale not a power of two&quot;);</span><br><span class="line">       shift = 31 - Integer.numberOfLeadingZeros(scale);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></div></figure>

<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//对下标合法性校验</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">long</span> <span class="title function_">checkedByteOffset</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (i &lt; <span class="number">0</span> || i &gt;= array.length)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IndexOutOfBoundsException</span>(<span class="string">&quot;index &quot;</span> + i);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> byteOffset(i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取下标i的位移偏移量</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">long</span> <span class="title function_">byteOffset</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> ((<span class="type">long</span>) i &lt;&lt; shift) + base;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h4 id="构造方法-5"   >
          <a href="#构造方法-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#构造方法-5" class="headerlink" title="构造方法"></a>构造方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//有参构造，给array初始化长度为length</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">AtomicLongArray</span><span class="params">(<span class="type">int</span> length)</span> &#123;</span><br><span class="line">       array = <span class="keyword">new</span> <span class="title class_">long</span>[length];</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//有参构造，传入参数array，克隆给this.array</span></span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">AtomicLongArray</span><span class="params">(<span class="type">long</span>[] array)</span> &#123;</span><br><span class="line">       <span class="comment">// Visibility guaranteed by final field guarantees</span></span><br><span class="line">       <span class="built_in">this</span>.array = array.clone();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>




        <h4 id="get方法-5"   >
          <a href="#get方法-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#get方法-5" class="headerlink" title="get方法"></a>get方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">	<span class="comment">//返回当前值</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">final</span> <span class="type">long</span> <span class="title function_">get</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getRaw(checkedByteOffset(i));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">	<span class="comment">//通过索引下标获取值</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> <span class="title function_">getRaw</span><span class="params">(<span class="type">long</span> offset)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.getLongVolatile(array, offset);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//返回下标i位置对应的老值</span></span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">long</span> <span class="title function_">getAndIncrement</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getAndAdd(i, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//将对应下标i的偏移量利用unsafe类完成+delta操作</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">long</span> <span class="title function_">getAndAdd</span><span class="params">(<span class="type">int</span> i, <span class="type">long</span> delta)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.getAndAddLong(array, checkedByteOffset(i), delta);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//...省略部分方法</span></span><br></pre></td></tr></table></div></figure>


        <h4 id="set方法-4"   >
          <a href="#set方法-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#set方法-4" class="headerlink" title="set方法"></a>set方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">	<span class="comment">//设置新值</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(<span class="type">int</span> i, <span class="type">long</span> newValue)</span> &#123;</span><br><span class="line">        unsafe.putLongVolatile(array, checkedByteOffset(i), newValue);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//...省略部分方法</span></span><br></pre></td></tr></table></div></figure>

<p><strong>小结</strong></p>
<p>大部分方法和AtomicIntegerArray类中的方法都是一样的，只是数据类型变化了</p>
<p><strong>完整代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AtomicReferenceArray</span>&lt;E&gt; <span class="keyword">implements</span> <span class="title class_">java</span>.io.Serializable &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">6209656149925076980L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Unsafe unsafe;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> base;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> shift;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> arrayFieldOffset;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object[] array; <span class="comment">// must have exact type Object[]</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            unsafe = Unsafe.getUnsafe();</span><br><span class="line">            arrayFieldOffset = unsafe.objectFieldOffset</span><br><span class="line">                (AtomicReferenceArray.class.getDeclaredField(<span class="string">&quot;array&quot;</span>));</span><br><span class="line">            base = unsafe.arrayBaseOffset(Object[].class);</span><br><span class="line">            <span class="type">int</span> <span class="variable">scale</span> <span class="operator">=</span> unsafe.arrayIndexScale(Object[].class);</span><br><span class="line">            <span class="keyword">if</span> ((scale &amp; (scale - <span class="number">1</span>)) != <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;data type scale not a power of two&quot;</span>);</span><br><span class="line">            shift = <span class="number">31</span> - Integer.numberOfLeadingZeros(scale);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> <span class="title function_">checkedByteOffset</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (i &lt; <span class="number">0</span> || i &gt;= array.length)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IndexOutOfBoundsException</span>(<span class="string">&quot;index &quot;</span> + i);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> byteOffset(i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">long</span> <span class="title function_">byteOffset</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ((<span class="type">long</span>) i &lt;&lt; shift) + base;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AtomicReferenceArray</span><span class="params">(<span class="type">int</span> length)</span> &#123;</span><br><span class="line">        array = <span class="keyword">new</span> <span class="title class_">Object</span>[length];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AtomicReferenceArray</span><span class="params">(E[] array)</span> &#123;</span><br><span class="line">        <span class="comment">// Visibility guaranteed by final field guarantees</span></span><br><span class="line">        <span class="built_in">this</span>.array = Arrays.copyOf(array, array.length, Object[].class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">length</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> array.length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> E <span class="title function_">get</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getRaw(checkedByteOffset(i));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> E <span class="title function_">getRaw</span><span class="params">(<span class="type">long</span> offset)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (E) unsafe.getObjectVolatile(array, offset);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(<span class="type">int</span> i, E newValue)</span> &#123;</span><br><span class="line">        unsafe.putObjectVolatile(array, checkedByteOffset(i), newValue);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">lazySet</span><span class="params">(<span class="type">int</span> i, E newValue)</span> &#123;</span><br><span class="line">        unsafe.putOrderedObject(array, checkedByteOffset(i), newValue);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> E <span class="title function_">getAndSet</span><span class="params">(<span class="type">int</span> i, E newValue)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (E)unsafe.getAndSetObject(array, checkedByteOffset(i), newValue);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">compareAndSet</span><span class="params">(<span class="type">int</span> i, E expect, E update)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> compareAndSetRaw(checkedByteOffset(i), expect, update);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">compareAndSetRaw</span><span class="params">(<span class="type">long</span> offset, E expect, E update)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.compareAndSwapObject(array, offset, expect, update);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">weakCompareAndSet</span><span class="params">(<span class="type">int</span> i, E expect, E update)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> compareAndSet(i, expect, update);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> E <span class="title function_">getAndUpdate</span><span class="params">(<span class="type">int</span> i, UnaryOperator&lt;E&gt; updateFunction)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">offset</span> <span class="operator">=</span> checkedByteOffset(i);</span><br><span class="line">        E prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = getRaw(offset);</span><br><span class="line">            next = updateFunction.apply(prev);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSetRaw(offset, prev, next));</span><br><span class="line">        <span class="keyword">return</span> prev;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> E <span class="title function_">updateAndGet</span><span class="params">(<span class="type">int</span> i, UnaryOperator&lt;E&gt; updateFunction)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">offset</span> <span class="operator">=</span> checkedByteOffset(i);</span><br><span class="line">        E prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = getRaw(offset);</span><br><span class="line">            next = updateFunction.apply(prev);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSetRaw(offset, prev, next));</span><br><span class="line">        <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> E <span class="title function_">getAndAccumulate</span><span class="params">(<span class="type">int</span> i, E x,</span></span><br><span class="line"><span class="params">                                    BinaryOperator&lt;E&gt; accumulatorFunction)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">offset</span> <span class="operator">=</span> checkedByteOffset(i);</span><br><span class="line">        E prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = getRaw(offset);</span><br><span class="line">            next = accumulatorFunction.apply(prev, x);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSetRaw(offset, prev, next));</span><br><span class="line">        <span class="keyword">return</span> prev;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> E <span class="title function_">accumulateAndGet</span><span class="params">(<span class="type">int</span> i, E x,</span></span><br><span class="line"><span class="params">                                    BinaryOperator&lt;E&gt; accumulatorFunction)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">offset</span> <span class="operator">=</span> checkedByteOffset(i);</span><br><span class="line">        E prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = getRaw(offset);</span><br><span class="line">            next = accumulatorFunction.apply(prev, x);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSetRaw(offset, prev, next));</span><br><span class="line">        <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">iMax</span> <span class="operator">=</span> array.length - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (iMax == -<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;[]&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        b.append(<span class="string">&#x27;[&#x27;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; ; i++) &#123;</span><br><span class="line">            b.append(getRaw(byteOffset(i)));</span><br><span class="line">            <span class="keyword">if</span> (i == iMax)</span><br><span class="line">                <span class="keyword">return</span> b.append(<span class="string">&#x27;]&#x27;</span>).toString();</span><br><span class="line">            b.append(<span class="string">&#x27;,&#x27;</span>).append(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(java.io.ObjectInputStream s)</span></span><br><span class="line">        <span class="keyword">throws</span> java.io.IOException, ClassNotFoundException,</span><br><span class="line">        java.io.InvalidObjectException &#123;</span><br><span class="line">        <span class="comment">// Note: This must be changed if any additional fields are defined</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">a</span> <span class="operator">=</span> s.readFields().get(<span class="string">&quot;array&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">if</span> (a == <span class="literal">null</span> || !a.getClass().isArray())</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">java</span>.io.InvalidObjectException(<span class="string">&quot;Not array type&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (a.getClass() != Object[].class)</span><br><span class="line">            a = Arrays.copyOf((Object[])a, Array.getLength(a), Object[].class);</span><br><span class="line">        unsafe.putObjectVolatile(<span class="built_in">this</span>, arrayFieldOffset, a);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>




        <h3 id="AtomicReferenceArray"   >
          <a href="#AtomicReferenceArray" class="heading-link"><i class="fas fa-link"></i></a><a href="#AtomicReferenceArray" class="headerlink" title="AtomicReferenceArray"></a>AtomicReferenceArray</h3>
      <p><strong>源码</strong></p>

        <h4 id="成员变量以及静态方法-6"   >
          <a href="#成员变量以及静态方法-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#成员变量以及静态方法-6" class="headerlink" title="成员变量以及静态方法"></a>成员变量以及静态方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//序列化id</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">6209656149925076980L</span>;</span><br><span class="line"><span class="comment">//unsafe类以及起始内存地址，数组偏移量</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Unsafe unsafe;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> base;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> shift;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> arrayFieldOffset;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> Object[] array; <span class="comment">// must have exact type Object[]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//静态方法对成员变量数据赋值</span></span><br><span class="line">   <span class="keyword">static</span> &#123;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           unsafe = Unsafe.getUnsafe();</span><br><span class="line">           arrayFieldOffset = unsafe.objectFieldOffset</span><br><span class="line">               (AtomicReferenceArray.class.getDeclaredField(<span class="string">&quot;array&quot;</span>));</span><br><span class="line">           base = unsafe.arrayBaseOffset(Object[].class);</span><br><span class="line">           <span class="type">int</span> <span class="variable">scale</span> <span class="operator">=</span> unsafe.arrayIndexScale(Object[].class);</span><br><span class="line">           <span class="keyword">if</span> ((scale &amp; (scale - <span class="number">1</span>)) != <span class="number">0</span>)</span><br><span class="line">               <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;data type scale not a power of two&quot;</span>);</span><br><span class="line">           shift = <span class="number">31</span> - Integer.numberOfLeadingZeros(scale);</span><br><span class="line">       &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(e);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></div></figure>



<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//对下标i进行合法性判断</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">long</span> <span class="title function_">checkedByteOffset</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">       <span class="keyword">if</span> (i &lt; <span class="number">0</span> || i &gt;= array.length)</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IndexOutOfBoundsException</span>(<span class="string">&quot;index &quot;</span> + i);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> byteOffset(i);</span><br><span class="line">   &#125;</span><br><span class="line"><span class="comment">//获取下标i的元素内存偏移量</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">long</span> <span class="title function_">byteOffset</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> ((<span class="type">long</span>) i &lt;&lt; shift) + base;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></div></figure>




        <h4 id="构造方法-6"   >
          <a href="#构造方法-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#构造方法-6" class="headerlink" title="构造方法"></a>构造方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//有参构造，构造一个array长度为length</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">AtomicReferenceArray</span><span class="params">(<span class="type">int</span> length)</span> &#123;</span><br><span class="line">       array = <span class="keyword">new</span> <span class="title class_">Object</span>[length];</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//有参构造，利用Arrays.copyOf将传入的数组拷贝</span></span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">AtomicReferenceArray</span><span class="params">(E[] array)</span> &#123;</span><br><span class="line">       <span class="comment">// Visibility guaranteed by final field guarantees</span></span><br><span class="line">       <span class="built_in">this</span>.array = Arrays.copyOf(array, array.length, Object[].class);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></div></figure>


        <h4 id="get方法-6"   >
          <a href="#get方法-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#get方法-6" class="headerlink" title="get方法"></a>get方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">	<span class="comment">//返回老值</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">final</span> E <span class="title function_">get</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getRaw(checkedByteOffset(i));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//通过具体下标位置获取到老值</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> E <span class="title function_">getRaw</span><span class="params">(<span class="type">long</span> offset)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (E) unsafe.getObjectVolatile(array, offset);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//...其他方法省略</span></span><br></pre></td></tr></table></div></figure>


        <h4 id="set方法-5"   >
          <a href="#set方法-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#set方法-5" class="headerlink" title="set方法"></a>set方法</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">	//设置新值</span><br><span class="line">	public final void set(int i, E newValue) &#123;</span><br><span class="line">        unsafe.putObjectVolatile(array, checkedByteOffset(i), newValue);</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">//...省略其他方法</span><br></pre></td></tr></table></div></figure>

<p><strong>完整代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AtomicReferenceArray</span>&lt;E&gt; <span class="keyword">implements</span> <span class="title class_">java</span>.io.Serializable &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">6209656149925076980L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Unsafe unsafe;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> base;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> shift;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> arrayFieldOffset;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object[] array; <span class="comment">// must have exact type Object[]</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            unsafe = Unsafe.getUnsafe();</span><br><span class="line">            arrayFieldOffset = unsafe.objectFieldOffset</span><br><span class="line">                (AtomicReferenceArray.class.getDeclaredField(<span class="string">&quot;array&quot;</span>));</span><br><span class="line">            base = unsafe.arrayBaseOffset(Object[].class);</span><br><span class="line">            <span class="type">int</span> <span class="variable">scale</span> <span class="operator">=</span> unsafe.arrayIndexScale(Object[].class);</span><br><span class="line">            <span class="keyword">if</span> ((scale &amp; (scale - <span class="number">1</span>)) != <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;data type scale not a power of two&quot;</span>);</span><br><span class="line">            shift = <span class="number">31</span> - Integer.numberOfLeadingZeros(scale);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> <span class="title function_">checkedByteOffset</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (i &lt; <span class="number">0</span> || i &gt;= array.length)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IndexOutOfBoundsException</span>(<span class="string">&quot;index &quot;</span> + i);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> byteOffset(i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">long</span> <span class="title function_">byteOffset</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ((<span class="type">long</span>) i &lt;&lt; shift) + base;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AtomicReferenceArray</span><span class="params">(<span class="type">int</span> length)</span> &#123;</span><br><span class="line">        array = <span class="keyword">new</span> <span class="title class_">Object</span>[length];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AtomicReferenceArray</span><span class="params">(E[] array)</span> &#123;</span><br><span class="line">        <span class="comment">// Visibility guaranteed by final field guarantees</span></span><br><span class="line">        <span class="built_in">this</span>.array = Arrays.copyOf(array, array.length, Object[].class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">length</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> array.length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> E <span class="title function_">get</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getRaw(checkedByteOffset(i));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> E <span class="title function_">getRaw</span><span class="params">(<span class="type">long</span> offset)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (E) unsafe.getObjectVolatile(array, offset);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(<span class="type">int</span> i, E newValue)</span> &#123;</span><br><span class="line">        unsafe.putObjectVolatile(array, checkedByteOffset(i), newValue);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">lazySet</span><span class="params">(<span class="type">int</span> i, E newValue)</span> &#123;</span><br><span class="line">        unsafe.putOrderedObject(array, checkedByteOffset(i), newValue);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> E <span class="title function_">getAndSet</span><span class="params">(<span class="type">int</span> i, E newValue)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (E)unsafe.getAndSetObject(array, checkedByteOffset(i), newValue);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">compareAndSet</span><span class="params">(<span class="type">int</span> i, E expect, E update)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> compareAndSetRaw(checkedByteOffset(i), expect, update);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">compareAndSetRaw</span><span class="params">(<span class="type">long</span> offset, E expect, E update)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.compareAndSwapObject(array, offset, expect, update);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">weakCompareAndSet</span><span class="params">(<span class="type">int</span> i, E expect, E update)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> compareAndSet(i, expect, update);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> E <span class="title function_">getAndUpdate</span><span class="params">(<span class="type">int</span> i, UnaryOperator&lt;E&gt; updateFunction)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">offset</span> <span class="operator">=</span> checkedByteOffset(i);</span><br><span class="line">        E prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = getRaw(offset);</span><br><span class="line">            next = updateFunction.apply(prev);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSetRaw(offset, prev, next));</span><br><span class="line">        <span class="keyword">return</span> prev;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> E <span class="title function_">updateAndGet</span><span class="params">(<span class="type">int</span> i, UnaryOperator&lt;E&gt; updateFunction)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">offset</span> <span class="operator">=</span> checkedByteOffset(i);</span><br><span class="line">        E prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = getRaw(offset);</span><br><span class="line">            next = updateFunction.apply(prev);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSetRaw(offset, prev, next));</span><br><span class="line">        <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> E <span class="title function_">getAndAccumulate</span><span class="params">(<span class="type">int</span> i, E x,</span></span><br><span class="line"><span class="params">                                    BinaryOperator&lt;E&gt; accumulatorFunction)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">offset</span> <span class="operator">=</span> checkedByteOffset(i);</span><br><span class="line">        E prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = getRaw(offset);</span><br><span class="line">            next = accumulatorFunction.apply(prev, x);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSetRaw(offset, prev, next));</span><br><span class="line">        <span class="keyword">return</span> prev;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> E <span class="title function_">accumulateAndGet</span><span class="params">(<span class="type">int</span> i, E x,</span></span><br><span class="line"><span class="params">                                    BinaryOperator&lt;E&gt; accumulatorFunction)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">offset</span> <span class="operator">=</span> checkedByteOffset(i);</span><br><span class="line">        E prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = getRaw(offset);</span><br><span class="line">            next = accumulatorFunction.apply(prev, x);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSetRaw(offset, prev, next));</span><br><span class="line">        <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">iMax</span> <span class="operator">=</span> array.length - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (iMax == -<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;[]&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        b.append(<span class="string">&#x27;[&#x27;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; ; i++) &#123;</span><br><span class="line">            b.append(getRaw(byteOffset(i)));</span><br><span class="line">            <span class="keyword">if</span> (i == iMax)</span><br><span class="line">                <span class="keyword">return</span> b.append(<span class="string">&#x27;]&#x27;</span>).toString();</span><br><span class="line">            b.append(<span class="string">&#x27;,&#x27;</span>).append(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(java.io.ObjectInputStream s)</span></span><br><span class="line">        <span class="keyword">throws</span> java.io.IOException, ClassNotFoundException,</span><br><span class="line">        java.io.InvalidObjectException &#123;</span><br><span class="line">        <span class="comment">// Note: This must be changed if any additional fields are defined</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">a</span> <span class="operator">=</span> s.readFields().get(<span class="string">&quot;array&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">if</span> (a == <span class="literal">null</span> || !a.getClass().isArray())</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">java</span>.io.InvalidObjectException(<span class="string">&quot;Not array type&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (a.getClass() != Object[].class)</span><br><span class="line">            a = Arrays.copyOf((Object[])a, Array.getLength(a), Object[].class);</span><br><span class="line">        unsafe.putObjectVolatile(<span class="built_in">this</span>, arrayFieldOffset, a);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>


        <h3 id="小结-1"   >
          <a href="#小结-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#小结-1" class="headerlink" title="小结"></a>小结</h3>
      <p>这部分Array数组在原有的基础上只是添加了操作多个内存地址，本质上还是一样的，只是通过下标i获取到其对应下标的内存地址然后操作其数据</p>

        <h2 id="属性更新原子操作类"   >
          <a href="#属性更新原子操作类" class="heading-link"><i class="fas fa-link"></i></a><a href="#属性更新原子操作类" class="headerlink" title="属性更新原子操作类"></a>属性更新原子操作类</h2>
      
        <h3 id="AtomicIntegerFieldUpdater"   >
          <a href="#AtomicIntegerFieldUpdater" class="heading-link"><i class="fas fa-link"></i></a><a href="#AtomicIntegerFieldUpdater" class="headerlink" title="AtomicIntegerFieldUpdater"></a>AtomicIntegerFieldUpdater</h3>
      <p><strong>源码</strong></p>
<p>因为这个类是一个抽象类，里面有内部类AtomicIntegerFieldUpdaterImpl，所以我们直接看向内部继承类</p>
<p><strong>AtomicIntegerFieldUpdaterImpl</strong></p>

        <h4 id="成员变量以及静态方法-7"   >
          <a href="#成员变量以及静态方法-7" class="heading-link"><i class="fas fa-link"></i></a><a href="#成员变量以及静态方法-7" class="headerlink" title="成员变量以及静态方法"></a>成员变量以及静态方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取魔法类</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> sun.misc.<span class="type">Unsafe</span> <span class="variable">U</span> <span class="operator">=</span> sun.misc.Unsafe.getUnsafe();</span><br><span class="line">      </span><br><span class="line"><span class="comment">//偏移量</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> offset;</span><br><span class="line">     </span><br><span class="line">      <span class="keyword">private</span> <span class="keyword">final</span> Class&lt;?&gt; cclass;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">private</span> <span class="keyword">final</span> Class&lt;T&gt; tclass;</span><br></pre></td></tr></table></div></figure>




        <h4 id="构造方法-7"   >
          <a href="#构造方法-7" class="heading-link"><i class="fas fa-link"></i></a><a href="#构造方法-7" class="headerlink" title="构造方法"></a>构造方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">AtomicIntegerFieldUpdaterImpl(<span class="keyword">final</span> Class&lt;T&gt; tclass,</span><br><span class="line">                                      <span class="keyword">final</span> String fieldName,</span><br><span class="line">                                      <span class="keyword">final</span> Class&lt;?&gt; caller) &#123;</span><br><span class="line">            <span class="comment">//属性名</span></span><br><span class="line">            <span class="keyword">final</span> Field field;</span><br><span class="line">            <span class="comment">//修饰符</span></span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> modifiers;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//通过反射获取字段</span></span><br><span class="line">                field = AccessController.doPrivileged(</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">PrivilegedExceptionAction</span>&lt;Field&gt;() &#123;</span><br><span class="line">                        <span class="keyword">public</span> Field <span class="title function_">run</span><span class="params">()</span> <span class="keyword">throws</span> NoSuchFieldException &#123;</span><br><span class="line">                            <span class="keyword">return</span> tclass.getDeclaredField(fieldName);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                <span class="comment">//修饰符</span></span><br><span class="line">                modifiers = field.getModifiers();</span><br><span class="line">                sun.reflect.misc.ReflectUtil.ensureMemberAccess(</span><br><span class="line">                    caller, tclass, <span class="literal">null</span>, modifiers);</span><br><span class="line">                <span class="comment">//获取类加载器</span></span><br><span class="line">                <span class="type">ClassLoader</span> <span class="variable">cl</span> <span class="operator">=</span> tclass.getClassLoader();</span><br><span class="line">                <span class="type">ClassLoader</span> <span class="variable">ccl</span> <span class="operator">=</span> caller.getClassLoader();</span><br><span class="line">                <span class="keyword">if</span> ((ccl != <span class="literal">null</span>) &amp;&amp; (ccl != cl) &amp;&amp;</span><br><span class="line">                    ((cl == <span class="literal">null</span>) || !isAncestor(cl, ccl))) &#123;</span><br><span class="line">                    sun.reflect.misc.ReflectUtil.checkPackageAccess(tclass);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (PrivilegedActionException pae) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(pae.getException());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(ex);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">    		<span class="comment">//如果属性不是int类型则报错</span></span><br><span class="line">            <span class="keyword">if</span> (field.getType() != <span class="type">int</span>.class)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Must be integer type&quot;</span>);</span><br><span class="line"></span><br><span class="line">    		<span class="comment">//如果修饰符不是volatile修饰则报错</span></span><br><span class="line">            <span class="keyword">if</span> (!Modifier.isVolatile(modifiers))</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Must be volatile type&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="built_in">this</span>.cclass = (Modifier.isProtected(modifiers) &amp;&amp;</span><br><span class="line">                           tclass.isAssignableFrom(caller) &amp;&amp;</span><br><span class="line">                           !isSamePackage(tclass, caller))</span><br><span class="line">                          ? caller : tclass;</span><br><span class="line">            <span class="built_in">this</span>.tclass = tclass;</span><br><span class="line">            <span class="built_in">this</span>.offset = U.objectFieldOffset(field);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></div></figure>

<p><em>小结：用这个类必须是int类型的变量，并且要<strong>volatile</strong>修饰，并且访问权限允许</em></p>

        <h4 id="get方法-7"   >
          <a href="#get方法-7" class="heading-link"><i class="fas fa-link"></i></a><a href="#get方法-7" class="headerlink" title="get方法"></a>get方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">		<span class="comment">//返回数值</span></span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">get</span><span class="params">(T obj)</span> &#123;</span><br><span class="line">            accessCheck(obj);</span><br><span class="line">            <span class="keyword">return</span> U.getIntVolatile(obj, offset);</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="comment">//利用unsafe类获取老值并且设置新值</span></span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getAndSet</span><span class="params">(T obj, <span class="type">int</span> newValue)</span> &#123;</span><br><span class="line">            accessCheck(obj);</span><br><span class="line">            <span class="keyword">return</span> U.getAndSetInt(obj, offset, newValue);</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="comment">//利用unsafe类获取老值并且设置新值</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getAndAdd</span><span class="params">(T obj, <span class="type">int</span> delta)</span> &#123;</span><br><span class="line">            accessCheck(obj);</span><br><span class="line">            <span class="keyword">return</span> U.getAndAddInt(obj, offset, delta);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//...省略部分方法</span></span><br></pre></td></tr></table></div></figure>


        <h4 id="set方法-6"   >
          <a href="#set方法-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#set方法-6" class="headerlink" title="set方法"></a>set方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置新值</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(T obj, <span class="type">int</span> newValue)</span> &#123;</span><br><span class="line">          accessCheck(obj);</span><br><span class="line">          U.putIntVolatile(obj, offset, newValue);</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></div></figure>

<p><strong>完整代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AtomicIntegerFieldUpdater</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@CallerSensitive</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;U&gt; AtomicIntegerFieldUpdater&lt;U&gt; <span class="title function_">newUpdater</span><span class="params">(Class&lt;U&gt; tclass,</span></span><br><span class="line"><span class="params">                                                              String fieldName)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AtomicIntegerFieldUpdaterImpl</span>&lt;U&gt;</span><br><span class="line">            (tclass, fieldName, Reflection.getCallerClass());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="title function_">AtomicIntegerFieldUpdater</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="type">boolean</span> <span class="title function_">compareAndSet</span><span class="params">(T obj, <span class="type">int</span> expect, <span class="type">int</span> update)</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="type">boolean</span> <span class="title function_">weakCompareAndSet</span><span class="params">(T obj, <span class="type">int</span> expect, <span class="type">int</span> update)</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(T obj, <span class="type">int</span> newValue)</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">lazySet</span><span class="params">(T obj, <span class="type">int</span> newValue)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="type">int</span> <span class="title function_">get</span><span class="params">(T obj)</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAndSet</span><span class="params">(T obj, <span class="type">int</span> newValue)</span> &#123;</span><br><span class="line">        <span class="type">int</span> prev;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = get(obj);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(obj, prev, newValue));</span><br><span class="line">        <span class="keyword">return</span> prev;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAndIncrement</span><span class="params">(T obj)</span> &#123;</span><br><span class="line">        <span class="type">int</span> prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = get(obj);</span><br><span class="line">            next = prev + <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(obj, prev, next));</span><br><span class="line">        <span class="keyword">return</span> prev;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAndDecrement</span><span class="params">(T obj)</span> &#123;</span><br><span class="line">        <span class="type">int</span> prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = get(obj);</span><br><span class="line">            next = prev - <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(obj, prev, next));</span><br><span class="line">        <span class="keyword">return</span> prev;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAndAdd</span><span class="params">(T obj, <span class="type">int</span> delta)</span> &#123;</span><br><span class="line">        <span class="type">int</span> prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = get(obj);</span><br><span class="line">            next = prev + delta;</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(obj, prev, next));</span><br><span class="line">        <span class="keyword">return</span> prev;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">incrementAndGet</span><span class="params">(T obj)</span> &#123;</span><br><span class="line">        <span class="type">int</span> prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = get(obj);</span><br><span class="line">            next = prev + <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(obj, prev, next));</span><br><span class="line">        <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">decrementAndGet</span><span class="params">(T obj)</span> &#123;</span><br><span class="line">        <span class="type">int</span> prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = get(obj);</span><br><span class="line">            next = prev - <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(obj, prev, next));</span><br><span class="line">        <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">addAndGet</span><span class="params">(T obj, <span class="type">int</span> delta)</span> &#123;</span><br><span class="line">        <span class="type">int</span> prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = get(obj);</span><br><span class="line">            next = prev + delta;</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(obj, prev, next));</span><br><span class="line">        <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getAndUpdate</span><span class="params">(T obj, IntUnaryOperator updateFunction)</span> &#123;</span><br><span class="line">        <span class="type">int</span> prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = get(obj);</span><br><span class="line">            next = updateFunction.applyAsInt(prev);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(obj, prev, next));</span><br><span class="line">        <span class="keyword">return</span> prev;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">updateAndGet</span><span class="params">(T obj, IntUnaryOperator updateFunction)</span> &#123;</span><br><span class="line">        <span class="type">int</span> prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = get(obj);</span><br><span class="line">            next = updateFunction.applyAsInt(prev);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(obj, prev, next));</span><br><span class="line">        <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getAndAccumulate</span><span class="params">(T obj, <span class="type">int</span> x,</span></span><br><span class="line"><span class="params">                                      IntBinaryOperator accumulatorFunction)</span> &#123;</span><br><span class="line">        <span class="type">int</span> prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = get(obj);</span><br><span class="line">            next = accumulatorFunction.applyAsInt(prev, x);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(obj, prev, next));</span><br><span class="line">        <span class="keyword">return</span> prev;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">accumulateAndGet</span><span class="params">(T obj, <span class="type">int</span> x,</span></span><br><span class="line"><span class="params">                                      IntBinaryOperator accumulatorFunction)</span> &#123;</span><br><span class="line">        <span class="type">int</span> prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = get(obj);</span><br><span class="line">            next = accumulatorFunction.applyAsInt(prev, x);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(obj, prev, next));</span><br><span class="line">        <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">AtomicIntegerFieldUpdaterImpl</span>&lt;T&gt;</span><br><span class="line">        <span class="keyword">extends</span> <span class="title class_">AtomicIntegerFieldUpdater</span>&lt;T&gt; &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> sun.misc.<span class="type">Unsafe</span> <span class="variable">U</span> <span class="operator">=</span> sun.misc.Unsafe.getUnsafe();</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> offset;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * if field is protected, the subclass constructing updater, else</span></span><br><span class="line"><span class="comment">         * the same as tclass</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Class&lt;?&gt; cclass;</span><br><span class="line">        <span class="comment">/** class holding the field */</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Class&lt;T&gt; tclass;</span><br><span class="line"></span><br><span class="line">        AtomicIntegerFieldUpdaterImpl(<span class="keyword">final</span> Class&lt;T&gt; tclass,</span><br><span class="line">                                      <span class="keyword">final</span> String fieldName,</span><br><span class="line">                                      <span class="keyword">final</span> Class&lt;?&gt; caller) &#123;</span><br><span class="line">            <span class="keyword">final</span> Field field;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> modifiers;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                field = AccessController.doPrivileged(</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">PrivilegedExceptionAction</span>&lt;Field&gt;() &#123;</span><br><span class="line">                        <span class="keyword">public</span> Field <span class="title function_">run</span><span class="params">()</span> <span class="keyword">throws</span> NoSuchFieldException &#123;</span><br><span class="line">                            <span class="keyword">return</span> tclass.getDeclaredField(fieldName);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                modifiers = field.getModifiers();</span><br><span class="line">                sun.reflect.misc.ReflectUtil.ensureMemberAccess(</span><br><span class="line">                    caller, tclass, <span class="literal">null</span>, modifiers);</span><br><span class="line">                <span class="type">ClassLoader</span> <span class="variable">cl</span> <span class="operator">=</span> tclass.getClassLoader();</span><br><span class="line">                <span class="type">ClassLoader</span> <span class="variable">ccl</span> <span class="operator">=</span> caller.getClassLoader();</span><br><span class="line">                <span class="keyword">if</span> ((ccl != <span class="literal">null</span>) &amp;&amp; (ccl != cl) &amp;&amp;</span><br><span class="line">                    ((cl == <span class="literal">null</span>) || !isAncestor(cl, ccl))) &#123;</span><br><span class="line">                    sun.reflect.misc.ReflectUtil.checkPackageAccess(tclass);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (PrivilegedActionException pae) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(pae.getException());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(ex);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (field.getType() != <span class="type">int</span>.class)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Must be integer type&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!Modifier.isVolatile(modifiers))</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Must be volatile type&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Access to protected field members is restricted to receivers only</span></span><br><span class="line">            <span class="comment">// of the accessing class, or one of its subclasses, and the</span></span><br><span class="line">            <span class="comment">// accessing class must in turn be a subclass (or package sibling)</span></span><br><span class="line">            <span class="comment">// of the protected member&#x27;s defining class.</span></span><br><span class="line">            <span class="comment">// If the updater refers to a protected field of a declaring class</span></span><br><span class="line">            <span class="comment">// outside the current package, the receiver argument will be</span></span><br><span class="line">            <span class="comment">// narrowed to the type of the accessing class.</span></span><br><span class="line">            <span class="built_in">this</span>.cclass = (Modifier.isProtected(modifiers) &amp;&amp;</span><br><span class="line">                           tclass.isAssignableFrom(caller) &amp;&amp;</span><br><span class="line">                           !isSamePackage(tclass, caller))</span><br><span class="line">                          ? caller : tclass;</span><br><span class="line">            <span class="built_in">this</span>.tclass = tclass;</span><br><span class="line">            <span class="built_in">this</span>.offset = U.objectFieldOffset(field);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isAncestor</span><span class="params">(ClassLoader first, ClassLoader second)</span> &#123;</span><br><span class="line">            <span class="type">ClassLoader</span> <span class="variable">acl</span> <span class="operator">=</span> first;</span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                acl = acl.getParent();</span><br><span class="line">                <span class="keyword">if</span> (second == acl) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">while</span> (acl != <span class="literal">null</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isSamePackage</span><span class="params">(Class&lt;?&gt; class1, Class&lt;?&gt; class2)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> class1.getClassLoader() == class2.getClassLoader()</span><br><span class="line">                   &amp;&amp; Objects.equals(getPackageName(class1), getPackageName(class2));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">getPackageName</span><span class="params">(Class&lt;?&gt; cls)</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">cn</span> <span class="operator">=</span> cls.getName();</span><br><span class="line">            <span class="type">int</span> <span class="variable">dot</span> <span class="operator">=</span> cn.lastIndexOf(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">            <span class="keyword">return</span> (dot != -<span class="number">1</span>) ? cn.substring(<span class="number">0</span>, dot) : <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">accessCheck</span><span class="params">(T obj)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!cclass.isInstance(obj))</span><br><span class="line">                throwAccessCheckException(obj);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">throwAccessCheckException</span><span class="params">(T obj)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (cclass == tclass)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ClassCastException</span>();</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">IllegalAccessException</span>(</span><br><span class="line">                        <span class="string">&quot;Class &quot;</span> +</span><br><span class="line">                        cclass.getName() +</span><br><span class="line">                        <span class="string">&quot; can not access a protected member of class &quot;</span> +</span><br><span class="line">                        tclass.getName() +</span><br><span class="line">                        <span class="string">&quot; using an instance of &quot;</span> +</span><br><span class="line">                        obj.getClass().getName()));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">compareAndSet</span><span class="params">(T obj, <span class="type">int</span> expect, <span class="type">int</span> update)</span> &#123;</span><br><span class="line">            accessCheck(obj);</span><br><span class="line">            <span class="keyword">return</span> U.compareAndSwapInt(obj, offset, expect, update);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">weakCompareAndSet</span><span class="params">(T obj, <span class="type">int</span> expect, <span class="type">int</span> update)</span> &#123;</span><br><span class="line">            accessCheck(obj);</span><br><span class="line">            <span class="keyword">return</span> U.compareAndSwapInt(obj, offset, expect, update);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(T obj, <span class="type">int</span> newValue)</span> &#123;</span><br><span class="line">            accessCheck(obj);</span><br><span class="line">            U.putIntVolatile(obj, offset, newValue);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">lazySet</span><span class="params">(T obj, <span class="type">int</span> newValue)</span> &#123;</span><br><span class="line">            accessCheck(obj);</span><br><span class="line">            U.putOrderedInt(obj, offset, newValue);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">get</span><span class="params">(T obj)</span> &#123;</span><br><span class="line">            accessCheck(obj);</span><br><span class="line">            <span class="keyword">return</span> U.getIntVolatile(obj, offset);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getAndSet</span><span class="params">(T obj, <span class="type">int</span> newValue)</span> &#123;</span><br><span class="line">            accessCheck(obj);</span><br><span class="line">            <span class="keyword">return</span> U.getAndSetInt(obj, offset, newValue);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getAndAdd</span><span class="params">(T obj, <span class="type">int</span> delta)</span> &#123;</span><br><span class="line">            accessCheck(obj);</span><br><span class="line">            <span class="keyword">return</span> U.getAndAddInt(obj, offset, delta);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getAndIncrement</span><span class="params">(T obj)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> getAndAdd(obj, <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getAndDecrement</span><span class="params">(T obj)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> getAndAdd(obj, -<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">incrementAndGet</span><span class="params">(T obj)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> getAndAdd(obj, <span class="number">1</span>) + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">decrementAndGet</span><span class="params">(T obj)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> getAndAdd(obj, -<span class="number">1</span>) - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">addAndGet</span><span class="params">(T obj, <span class="type">int</span> delta)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> getAndAdd(obj, delta) + delta;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>




        <h3 id="AtomicLongFieldUpdater"   >
          <a href="#AtomicLongFieldUpdater" class="heading-link"><i class="fas fa-link"></i></a><a href="#AtomicLongFieldUpdater" class="headerlink" title="AtomicLongFieldUpdater"></a>AtomicLongFieldUpdater</h3>
      <p><strong>源码</strong></p>
<p>这个类也是一个抽象类，但是里面有两个内部类<strong>CASUpdater</strong>和<strong>LockedUpdater</strong>，见名知意，这必然是一个CAS更新一个是通过Lock锁更新，我们直接看向这两个内部类即可</p>

        <h4 id="成员变量以及静态方法-8"   >
          <a href="#成员变量以及静态方法-8" class="heading-link"><i class="fas fa-link"></i></a><a href="#成员变量以及静态方法-8" class="headerlink" title="成员变量以及静态方法"></a>成员变量以及静态方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//CASUpdater</span></span><br><span class="line">		<span class="comment">//unsafe类</span></span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> sun.misc.<span class="type">Unsafe</span> <span class="variable">U</span> <span class="operator">=</span> sun.misc.Unsafe.getUnsafe();</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> offset;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Class&lt;?&gt; cclass;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Class&lt;T&gt; tclass;</span><br><span class="line">        </span><br><span class="line"><span class="comment">//LockedUpdater</span></span><br><span class="line">		<span class="comment">//unsafe类</span></span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> sun.misc.<span class="type">Unsafe</span> <span class="variable">U</span> <span class="operator">=</span> sun.misc.Unsafe.getUnsafe();</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> offset;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Class&lt;?&gt; cclass;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Class&lt;T&gt; tclass;</span><br></pre></td></tr></table></div></figure>


        <h4 id="构造方法-8"   >
          <a href="#构造方法-8" class="heading-link"><i class="fas fa-link"></i></a><a href="#构造方法-8" class="headerlink" title="构造方法"></a>构造方法</h4>
      
        <h5 id="CASupdater"   >
          <a href="#CASupdater" class="heading-link"><i class="fas fa-link"></i></a><a href="#CASupdater" class="headerlink" title="CASupdater"></a>CASupdater</h5>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">CASUpdater(<span class="keyword">final</span> Class&lt;T&gt; tclass, <span class="keyword">final</span> String fieldName,</span><br><span class="line">                  <span class="keyword">final</span> Class&lt;?&gt; caller) &#123;</span><br><span class="line">           <span class="comment">//字段名</span></span><br><span class="line">    		<span class="keyword">final</span> Field field;</span><br><span class="line">    		<span class="comment">//修饰符</span></span><br><span class="line">           <span class="keyword">final</span> <span class="type">int</span> modifiers;</span><br><span class="line">           <span class="keyword">try</span> &#123;</span><br><span class="line">               field = AccessController.doPrivileged(</span><br><span class="line">                   <span class="keyword">new</span> <span class="title class_">PrivilegedExceptionAction</span>&lt;Field&gt;() &#123;</span><br><span class="line">                       <span class="keyword">public</span> Field <span class="title function_">run</span><span class="params">()</span> <span class="keyword">throws</span> NoSuchFieldException &#123;</span><br><span class="line">                           <span class="keyword">return</span> tclass.getDeclaredField(fieldName);</span><br><span class="line">                       &#125;</span><br><span class="line">                   &#125;);</span><br><span class="line">               modifiers = field.getModifiers();</span><br><span class="line">               sun.reflect.misc.ReflectUtil.ensureMemberAccess(</span><br><span class="line">                   caller, tclass, <span class="literal">null</span>, modifiers);</span><br><span class="line">               <span class="type">ClassLoader</span> <span class="variable">cl</span> <span class="operator">=</span> tclass.getClassLoader();</span><br><span class="line">               <span class="type">ClassLoader</span> <span class="variable">ccl</span> <span class="operator">=</span> caller.getClassLoader();</span><br><span class="line">               <span class="keyword">if</span> ((ccl != <span class="literal">null</span>) &amp;&amp; (ccl != cl) &amp;&amp;</span><br><span class="line">                   ((cl == <span class="literal">null</span>) || !isAncestor(cl, ccl))) &#123;</span><br><span class="line">                   sun.reflect.misc.ReflectUtil.checkPackageAccess(tclass);</span><br><span class="line">               &#125;</span><br><span class="line">           &#125; <span class="keyword">catch</span> (PrivilegedActionException pae) &#123;</span><br><span class="line">               <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(pae.getException());</span><br><span class="line">           &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">               <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(ex);</span><br><span class="line">           &#125;</span><br><span class="line">		<span class="comment">//long类型判断</span></span><br><span class="line">           <span class="keyword">if</span> (field.getType() != <span class="type">long</span>.class)</span><br><span class="line">               <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Must be long type&quot;</span>);</span><br><span class="line">		<span class="comment">//必须volatile修饰</span></span><br><span class="line">           <span class="keyword">if</span> (!Modifier.isVolatile(modifiers))</span><br><span class="line">               <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Must be volatile type&quot;</span>);</span><br><span class="line"></span><br><span class="line">           <span class="built_in">this</span>.cclass = (Modifier.isProtected(modifiers) &amp;&amp;</span><br><span class="line">                          tclass.isAssignableFrom(caller) &amp;&amp;</span><br><span class="line">                          !isSamePackage(tclass, caller))</span><br><span class="line">                         ? caller : tclass;</span><br><span class="line">           <span class="built_in">this</span>.tclass = tclass;</span><br><span class="line">           <span class="built_in">this</span>.offset = U.objectFieldOffset(field);</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="LockedUpdater"   >
          <a href="#LockedUpdater" class="heading-link"><i class="fas fa-link"></i></a><a href="#LockedUpdater" class="headerlink" title="LockedUpdater"></a>LockedUpdater</h5>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">LockedUpdater(<span class="keyword">final</span> Class&lt;T&gt; tclass, <span class="keyword">final</span> String fieldName,</span><br><span class="line">              <span class="keyword">final</span> Class&lt;?&gt; caller) &#123;</span><br><span class="line">    <span class="comment">//字段名为空</span></span><br><span class="line">    <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">//权限修饰符</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">modifiers</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        field = AccessController.doPrivileged(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">PrivilegedExceptionAction</span>&lt;Field&gt;() &#123;</span><br><span class="line">                <span class="keyword">public</span> Field <span class="title function_">run</span><span class="params">()</span> <span class="keyword">throws</span> NoSuchFieldException &#123;</span><br><span class="line">                    <span class="keyword">return</span> tclass.getDeclaredField(fieldName);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        </span><br><span class="line">        modifiers = field.getModifiers();</span><br><span class="line">        sun.reflect.misc.ReflectUtil.ensureMemberAccess(</span><br><span class="line">            caller, tclass, <span class="literal">null</span>, modifiers);</span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">cl</span> <span class="operator">=</span> tclass.getClassLoader();</span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">ccl</span> <span class="operator">=</span> caller.getClassLoader();</span><br><span class="line">        <span class="keyword">if</span> ((ccl != <span class="literal">null</span>) &amp;&amp; (ccl != cl) &amp;&amp;</span><br><span class="line">            ((cl == <span class="literal">null</span>) || !isAncestor(cl, ccl))) &#123;</span><br><span class="line">            sun.reflect.misc.ReflectUtil.checkPackageAccess(tclass);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (PrivilegedActionException pae) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(pae.getException());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(ex);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//必须是long类型</span></span><br><span class="line">    <span class="keyword">if</span> (field.getType() != <span class="type">long</span>.class)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Must be long type&quot;</span>);</span><br><span class="line">	<span class="comment">//必须是volatile</span></span><br><span class="line">    <span class="keyword">if</span> (!Modifier.isVolatile(modifiers))</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Must be volatile type&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.cclass = (Modifier.isProtected(modifiers) &amp;&amp;</span><br><span class="line">                   tclass.isAssignableFrom(caller) &amp;&amp;</span><br><span class="line">                   !isSamePackage(tclass, caller))</span><br><span class="line">                  ? caller : tclass;</span><br><span class="line">    <span class="built_in">this</span>.tclass = tclass;</span><br><span class="line">    <span class="built_in">this</span>.offset = U.objectFieldOffset(field);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h4 id="get方法-8"   >
          <a href="#get方法-8" class="heading-link"><i class="fas fa-link"></i></a><a href="#get方法-8" class="headerlink" title="get方法"></a>get方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过synchronized锁+CAS保证线程安全</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">long</span> <span class="title function_">get</span><span class="params">(T obj)</span> &#123;</span><br><span class="line">          accessCheck(obj);</span><br><span class="line">          <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">              <span class="keyword">return</span> U.getLong(obj, offset);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过CAS保证线程安全</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">long</span> <span class="title function_">get</span><span class="params">(T obj)</span> &#123;</span><br><span class="line">          accessCheck(obj);</span><br><span class="line">          <span class="keyword">return</span> U.getLongVolatile(obj, offset);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>


        <h4 id="set方法-7"   >
          <a href="#set方法-7" class="heading-link"><i class="fas fa-link"></i></a><a href="#set方法-7" class="headerlink" title="set方法"></a>set方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//利用CAS机制</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(T obj, <span class="type">long</span> newValue)</span> &#123;</span><br><span class="line">          accessCheck(obj);</span><br><span class="line">          U.putLongVolatile(obj, offset, newValue);</span><br><span class="line">      &#125;</span><br><span class="line"><span class="comment">//通过synchronized锁+CAS保证线程安全</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(T obj, <span class="type">long</span> newValue)</span> &#123;</span><br><span class="line">          accessCheck(obj);</span><br><span class="line">          <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">              U.putLong(obj, offset, newValue);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></div></figure>

<p><strong>完整代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AtomicLongFieldUpdater</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@CallerSensitive</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;U&gt; AtomicLongFieldUpdater&lt;U&gt; <span class="title function_">newUpdater</span><span class="params">(Class&lt;U&gt; tclass,</span></span><br><span class="line"><span class="params">                                                           String fieldName)</span> &#123;</span><br><span class="line">        Class&lt;?&gt; caller = Reflection.getCallerClass();</span><br><span class="line">        <span class="keyword">if</span> (AtomicLong.VM_SUPPORTS_LONG_CAS)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CASUpdater</span>&lt;U&gt;(tclass, fieldName, caller);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LockedUpdater</span>&lt;U&gt;(tclass, fieldName, caller);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="title function_">AtomicLongFieldUpdater</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="type">boolean</span> <span class="title function_">compareAndSet</span><span class="params">(T obj, <span class="type">long</span> expect, <span class="type">long</span> update)</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="type">boolean</span> <span class="title function_">weakCompareAndSet</span><span class="params">(T obj, <span class="type">long</span> expect, <span class="type">long</span> update)</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(T obj, <span class="type">long</span> newValue)</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">lazySet</span><span class="params">(T obj, <span class="type">long</span> newValue)</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="type">long</span> <span class="title function_">get</span><span class="params">(T obj)</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getAndSet</span><span class="params">(T obj, <span class="type">long</span> newValue)</span> &#123;</span><br><span class="line">        <span class="type">long</span> prev;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = get(obj);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(obj, prev, newValue));</span><br><span class="line">        <span class="keyword">return</span> prev;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getAndIncrement</span><span class="params">(T obj)</span> &#123;</span><br><span class="line">        <span class="type">long</span> prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = get(obj);</span><br><span class="line">            next = prev + <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(obj, prev, next));</span><br><span class="line">        <span class="keyword">return</span> prev;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getAndDecrement</span><span class="params">(T obj)</span> &#123;</span><br><span class="line">        <span class="type">long</span> prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = get(obj);</span><br><span class="line">            next = prev - <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(obj, prev, next));</span><br><span class="line">        <span class="keyword">return</span> prev;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getAndAdd</span><span class="params">(T obj, <span class="type">long</span> delta)</span> &#123;</span><br><span class="line">        <span class="type">long</span> prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = get(obj);</span><br><span class="line">            next = prev + delta;</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(obj, prev, next));</span><br><span class="line">        <span class="keyword">return</span> prev;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">incrementAndGet</span><span class="params">(T obj)</span> &#123;</span><br><span class="line">        <span class="type">long</span> prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = get(obj);</span><br><span class="line">            next = prev + <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(obj, prev, next));</span><br><span class="line">        <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">decrementAndGet</span><span class="params">(T obj)</span> &#123;</span><br><span class="line">        <span class="type">long</span> prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = get(obj);</span><br><span class="line">            next = prev - <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(obj, prev, next));</span><br><span class="line">        <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">addAndGet</span><span class="params">(T obj, <span class="type">long</span> delta)</span> &#123;</span><br><span class="line">        <span class="type">long</span> prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = get(obj);</span><br><span class="line">            next = prev + delta;</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(obj, prev, next));</span><br><span class="line">        <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">long</span> <span class="title function_">getAndUpdate</span><span class="params">(T obj, LongUnaryOperator updateFunction)</span> &#123;</span><br><span class="line">        <span class="type">long</span> prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = get(obj);</span><br><span class="line">            next = updateFunction.applyAsLong(prev);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(obj, prev, next));</span><br><span class="line">        <span class="keyword">return</span> prev;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">long</span> <span class="title function_">updateAndGet</span><span class="params">(T obj, LongUnaryOperator updateFunction)</span> &#123;</span><br><span class="line">        <span class="type">long</span> prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = get(obj);</span><br><span class="line">            next = updateFunction.applyAsLong(prev);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(obj, prev, next));</span><br><span class="line">        <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">long</span> <span class="title function_">getAndAccumulate</span><span class="params">(T obj, <span class="type">long</span> x,</span></span><br><span class="line"><span class="params">                                       LongBinaryOperator accumulatorFunction)</span> &#123;</span><br><span class="line">        <span class="type">long</span> prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = get(obj);</span><br><span class="line">            next = accumulatorFunction.applyAsLong(prev, x);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(obj, prev, next));</span><br><span class="line">        <span class="keyword">return</span> prev;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">long</span> <span class="title function_">accumulateAndGet</span><span class="params">(T obj, <span class="type">long</span> x,</span></span><br><span class="line"><span class="params">                                       LongBinaryOperator accumulatorFunction)</span> &#123;</span><br><span class="line">        <span class="type">long</span> prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = get(obj);</span><br><span class="line">            next = accumulatorFunction.applyAsLong(prev, x);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(obj, prev, next));</span><br><span class="line">        <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">CASUpdater</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">AtomicLongFieldUpdater</span>&lt;T&gt; &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> sun.misc.<span class="type">Unsafe</span> <span class="variable">U</span> <span class="operator">=</span> sun.misc.Unsafe.getUnsafe();</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> offset;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Class&lt;?&gt; cclass;</span><br><span class="line">        <span class="comment">/** class holding the field */</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Class&lt;T&gt; tclass;</span><br><span class="line"></span><br><span class="line">        CASUpdater(<span class="keyword">final</span> Class&lt;T&gt; tclass, <span class="keyword">final</span> String fieldName,</span><br><span class="line">                   <span class="keyword">final</span> Class&lt;?&gt; caller) &#123;</span><br><span class="line">            <span class="keyword">final</span> Field field;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> modifiers;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                field = AccessController.doPrivileged(</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">PrivilegedExceptionAction</span>&lt;Field&gt;() &#123;</span><br><span class="line">                        <span class="keyword">public</span> Field <span class="title function_">run</span><span class="params">()</span> <span class="keyword">throws</span> NoSuchFieldException &#123;</span><br><span class="line">                            <span class="keyword">return</span> tclass.getDeclaredField(fieldName);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                modifiers = field.getModifiers();</span><br><span class="line">                sun.reflect.misc.ReflectUtil.ensureMemberAccess(</span><br><span class="line">                    caller, tclass, <span class="literal">null</span>, modifiers);</span><br><span class="line">                <span class="type">ClassLoader</span> <span class="variable">cl</span> <span class="operator">=</span> tclass.getClassLoader();</span><br><span class="line">                <span class="type">ClassLoader</span> <span class="variable">ccl</span> <span class="operator">=</span> caller.getClassLoader();</span><br><span class="line">                <span class="keyword">if</span> ((ccl != <span class="literal">null</span>) &amp;&amp; (ccl != cl) &amp;&amp;</span><br><span class="line">                    ((cl == <span class="literal">null</span>) || !isAncestor(cl, ccl))) &#123;</span><br><span class="line">                    sun.reflect.misc.ReflectUtil.checkPackageAccess(tclass);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (PrivilegedActionException pae) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(pae.getException());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(ex);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (field.getType() != <span class="type">long</span>.class)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Must be long type&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!Modifier.isVolatile(modifiers))</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Must be volatile type&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Access to protected field members is restricted to receivers only</span></span><br><span class="line">            <span class="comment">// of the accessing class, or one of its subclasses, and the</span></span><br><span class="line">            <span class="comment">// accessing class must in turn be a subclass (or package sibling)</span></span><br><span class="line">            <span class="comment">// of the protected member&#x27;s defining class.</span></span><br><span class="line">            <span class="comment">// If the updater refers to a protected field of a declaring class</span></span><br><span class="line">            <span class="comment">// outside the current package, the receiver argument will be</span></span><br><span class="line">            <span class="comment">// narrowed to the type of the accessing class.</span></span><br><span class="line">            <span class="built_in">this</span>.cclass = (Modifier.isProtected(modifiers) &amp;&amp;</span><br><span class="line">                           tclass.isAssignableFrom(caller) &amp;&amp;</span><br><span class="line">                           !isSamePackage(tclass, caller))</span><br><span class="line">                          ? caller : tclass;</span><br><span class="line">            <span class="built_in">this</span>.tclass = tclass;</span><br><span class="line">            <span class="built_in">this</span>.offset = U.objectFieldOffset(field);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Checks that target argument is instance of cclass.  On</span></span><br><span class="line"><span class="comment">         * failure, throws cause.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">accessCheck</span><span class="params">(T obj)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!cclass.isInstance(obj))</span><br><span class="line">                throwAccessCheckException(obj);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">throwAccessCheckException</span><span class="params">(T obj)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (cclass == tclass)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ClassCastException</span>();</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">IllegalAccessException</span>(</span><br><span class="line">                        <span class="string">&quot;Class &quot;</span> +</span><br><span class="line">                        cclass.getName() +</span><br><span class="line">                        <span class="string">&quot; can not access a protected member of class &quot;</span> +</span><br><span class="line">                        tclass.getName() +</span><br><span class="line">                        <span class="string">&quot; using an instance of &quot;</span> +</span><br><span class="line">                        obj.getClass().getName()));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">compareAndSet</span><span class="params">(T obj, <span class="type">long</span> expect, <span class="type">long</span> update)</span> &#123;</span><br><span class="line">            accessCheck(obj);</span><br><span class="line">            <span class="keyword">return</span> U.compareAndSwapLong(obj, offset, expect, update);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">weakCompareAndSet</span><span class="params">(T obj, <span class="type">long</span> expect, <span class="type">long</span> update)</span> &#123;</span><br><span class="line">            accessCheck(obj);</span><br><span class="line">            <span class="keyword">return</span> U.compareAndSwapLong(obj, offset, expect, update);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(T obj, <span class="type">long</span> newValue)</span> &#123;</span><br><span class="line">            accessCheck(obj);</span><br><span class="line">            U.putLongVolatile(obj, offset, newValue);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">lazySet</span><span class="params">(T obj, <span class="type">long</span> newValue)</span> &#123;</span><br><span class="line">            accessCheck(obj);</span><br><span class="line">            U.putOrderedLong(obj, offset, newValue);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">long</span> <span class="title function_">get</span><span class="params">(T obj)</span> &#123;</span><br><span class="line">            accessCheck(obj);</span><br><span class="line">            <span class="keyword">return</span> U.getLongVolatile(obj, offset);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">long</span> <span class="title function_">getAndSet</span><span class="params">(T obj, <span class="type">long</span> newValue)</span> &#123;</span><br><span class="line">            accessCheck(obj);</span><br><span class="line">            <span class="keyword">return</span> U.getAndSetLong(obj, offset, newValue);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">long</span> <span class="title function_">getAndAdd</span><span class="params">(T obj, <span class="type">long</span> delta)</span> &#123;</span><br><span class="line">            accessCheck(obj);</span><br><span class="line">            <span class="keyword">return</span> U.getAndAddLong(obj, offset, delta);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">long</span> <span class="title function_">getAndIncrement</span><span class="params">(T obj)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> getAndAdd(obj, <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">long</span> <span class="title function_">getAndDecrement</span><span class="params">(T obj)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> getAndAdd(obj, -<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">long</span> <span class="title function_">incrementAndGet</span><span class="params">(T obj)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> getAndAdd(obj, <span class="number">1</span>) + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">long</span> <span class="title function_">decrementAndGet</span><span class="params">(T obj)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> getAndAdd(obj, -<span class="number">1</span>) - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">long</span> <span class="title function_">addAndGet</span><span class="params">(T obj, <span class="type">long</span> delta)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> getAndAdd(obj, delta) + delta;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">LockedUpdater</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">AtomicLongFieldUpdater</span>&lt;T&gt; &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> sun.misc.<span class="type">Unsafe</span> <span class="variable">U</span> <span class="operator">=</span> sun.misc.Unsafe.getUnsafe();</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> offset;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Class&lt;?&gt; cclass;</span><br><span class="line">        <span class="comment">/** class holding the field */</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Class&lt;T&gt; tclass;</span><br><span class="line"></span><br><span class="line">        LockedUpdater(<span class="keyword">final</span> Class&lt;T&gt; tclass, <span class="keyword">final</span> String fieldName,</span><br><span class="line">                      <span class="keyword">final</span> Class&lt;?&gt; caller) &#123;</span><br><span class="line">            <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">modifiers</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                field = AccessController.doPrivileged(</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">PrivilegedExceptionAction</span>&lt;Field&gt;() &#123;</span><br><span class="line">                        <span class="keyword">public</span> Field <span class="title function_">run</span><span class="params">()</span> <span class="keyword">throws</span> NoSuchFieldException &#123;</span><br><span class="line">                            <span class="keyword">return</span> tclass.getDeclaredField(fieldName);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                modifiers = field.getModifiers();</span><br><span class="line">                sun.reflect.misc.ReflectUtil.ensureMemberAccess(</span><br><span class="line">                    caller, tclass, <span class="literal">null</span>, modifiers);</span><br><span class="line">                <span class="type">ClassLoader</span> <span class="variable">cl</span> <span class="operator">=</span> tclass.getClassLoader();</span><br><span class="line">                <span class="type">ClassLoader</span> <span class="variable">ccl</span> <span class="operator">=</span> caller.getClassLoader();</span><br><span class="line">                <span class="keyword">if</span> ((ccl != <span class="literal">null</span>) &amp;&amp; (ccl != cl) &amp;&amp;</span><br><span class="line">                    ((cl == <span class="literal">null</span>) || !isAncestor(cl, ccl))) &#123;</span><br><span class="line">                    sun.reflect.misc.ReflectUtil.checkPackageAccess(tclass);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (PrivilegedActionException pae) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(pae.getException());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(ex);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (field.getType() != <span class="type">long</span>.class)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Must be long type&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!Modifier.isVolatile(modifiers))</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Must be volatile type&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Access to protected field members is restricted to receivers only</span></span><br><span class="line">            <span class="comment">// of the accessing class, or one of its subclasses, and the</span></span><br><span class="line">            <span class="comment">// accessing class must in turn be a subclass (or package sibling)</span></span><br><span class="line">            <span class="comment">// of the protected member&#x27;s defining class.</span></span><br><span class="line">            <span class="comment">// If the updater refers to a protected field of a declaring class</span></span><br><span class="line">            <span class="comment">// outside the current package, the receiver argument will be</span></span><br><span class="line">            <span class="comment">// narrowed to the type of the accessing class.</span></span><br><span class="line">            <span class="built_in">this</span>.cclass = (Modifier.isProtected(modifiers) &amp;&amp;</span><br><span class="line">                           tclass.isAssignableFrom(caller) &amp;&amp;</span><br><span class="line">                           !isSamePackage(tclass, caller))</span><br><span class="line">                          ? caller : tclass;</span><br><span class="line">            <span class="built_in">this</span>.tclass = tclass;</span><br><span class="line">            <span class="built_in">this</span>.offset = U.objectFieldOffset(field);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">accessCheck</span><span class="params">(T obj)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!cclass.isInstance(obj))</span><br><span class="line">                <span class="keyword">throw</span> accessCheckException(obj);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> RuntimeException <span class="title function_">accessCheckException</span><span class="params">(T obj)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (cclass == tclass)</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ClassCastException</span>();</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">IllegalAccessException</span>(</span><br><span class="line">                        <span class="string">&quot;Class &quot;</span> +</span><br><span class="line">                        cclass.getName() +</span><br><span class="line">                        <span class="string">&quot; can not access a protected member of class &quot;</span> +</span><br><span class="line">                        tclass.getName() +</span><br><span class="line">                        <span class="string">&quot; using an instance of &quot;</span> +</span><br><span class="line">                        obj.getClass().getName()));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">compareAndSet</span><span class="params">(T obj, <span class="type">long</span> expect, <span class="type">long</span> update)</span> &#123;</span><br><span class="line">            accessCheck(obj);</span><br><span class="line">            <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">                <span class="type">long</span> <span class="variable">v</span> <span class="operator">=</span> U.getLong(obj, offset);</span><br><span class="line">                <span class="keyword">if</span> (v != expect)</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                U.putLong(obj, offset, update);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">weakCompareAndSet</span><span class="params">(T obj, <span class="type">long</span> expect, <span class="type">long</span> update)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> compareAndSet(obj, expect, update);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(T obj, <span class="type">long</span> newValue)</span> &#123;</span><br><span class="line">            accessCheck(obj);</span><br><span class="line">            <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">                U.putLong(obj, offset, newValue);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">lazySet</span><span class="params">(T obj, <span class="type">long</span> newValue)</span> &#123;</span><br><span class="line">            set(obj, newValue);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">long</span> <span class="title function_">get</span><span class="params">(T obj)</span> &#123;</span><br><span class="line">            accessCheck(obj);</span><br><span class="line">            <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> U.getLong(obj, offset);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isAncestor</span><span class="params">(ClassLoader first, ClassLoader second)</span> &#123;</span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">acl</span> <span class="operator">=</span> first;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            acl = acl.getParent();</span><br><span class="line">            <span class="keyword">if</span> (second == acl) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">while</span> (acl != <span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isSamePackage</span><span class="params">(Class&lt;?&gt; class1, Class&lt;?&gt; class2)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> class1.getClassLoader() == class2.getClassLoader()</span><br><span class="line">               &amp;&amp; Objects.equals(getPackageName(class1), getPackageName(class2));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">getPackageName</span><span class="params">(Class&lt;?&gt; cls)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">cn</span> <span class="operator">=</span> cls.getName();</span><br><span class="line">        <span class="type">int</span> <span class="variable">dot</span> <span class="operator">=</span> cn.lastIndexOf(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span> (dot != -<span class="number">1</span>) ? cn.substring(<span class="number">0</span>, dot) : <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h3 id="AtomicReferenceFieldUpdater"   >
          <a href="#AtomicReferenceFieldUpdater" class="heading-link"><i class="fas fa-link"></i></a><a href="#AtomicReferenceFieldUpdater" class="headerlink" title="AtomicReferenceFieldUpdater"></a>AtomicReferenceFieldUpdater</h3>
      <p><strong>源码</strong></p>
<p>同理，看向内部类AtomicReferenceFiledUpdaterImpl</p>

        <h4 id="成员变量以及静态方法-9"   >
          <a href="#成员变量以及静态方法-9" class="heading-link"><i class="fas fa-link"></i></a><a href="#成员变量以及静态方法-9" class="headerlink" title="成员变量以及静态方法"></a>成员变量以及静态方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取unsafe类</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> sun.misc.<span class="type">Unsafe</span> <span class="variable">U</span> <span class="operator">=</span> sun.misc.Unsafe.getUnsafe();		</span><br><span class="line"><span class="comment">//获取偏移量</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> offset;</span><br><span class="line">     </span><br><span class="line">      <span class="keyword">private</span> <span class="keyword">final</span> Class&lt;?&gt; cclass;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">private</span> <span class="keyword">final</span> Class&lt;T&gt; tclass;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">private</span> <span class="keyword">final</span> Class&lt;V&gt; vclass;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>


        <h4 id="构造方法-9"   >
          <a href="#构造方法-9" class="heading-link"><i class="fas fa-link"></i></a><a href="#构造方法-9" class="headerlink" title="构造方法"></a>构造方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">AtomicReferenceFieldUpdaterImpl(<span class="keyword">final</span> Class&lt;T&gt; tclass,</span><br><span class="line">                                        <span class="keyword">final</span> Class&lt;V&gt; vclass,</span><br><span class="line">                                        <span class="keyword">final</span> String fieldName,</span><br><span class="line">                                        <span class="keyword">final</span> Class&lt;?&gt; caller) &#123;</span><br><span class="line">			<span class="comment">//字段名</span></span><br><span class="line">			<span class="keyword">final</span> Field field;</span><br><span class="line">            <span class="keyword">final</span> Class&lt;?&gt; fieldClass;</span><br><span class="line">            <span class="comment">//权限修饰符</span></span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> modifiers;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                field = AccessController.doPrivileged(</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">PrivilegedExceptionAction</span>&lt;Field&gt;() &#123;</span><br><span class="line">                        <span class="keyword">public</span> Field <span class="title function_">run</span><span class="params">()</span> <span class="keyword">throws</span> NoSuchFieldException &#123;</span><br><span class="line">                            <span class="keyword">return</span> tclass.getDeclaredField(fieldName);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                modifiers = field.getModifiers();</span><br><span class="line">                sun.reflect.misc.ReflectUtil.ensureMemberAccess(</span><br><span class="line">                    caller, tclass, <span class="literal">null</span>, modifiers);</span><br><span class="line">                <span class="type">ClassLoader</span> <span class="variable">cl</span> <span class="operator">=</span> tclass.getClassLoader();</span><br><span class="line">                <span class="type">ClassLoader</span> <span class="variable">ccl</span> <span class="operator">=</span> caller.getClassLoader();</span><br><span class="line">                <span class="keyword">if</span> ((ccl != <span class="literal">null</span>) &amp;&amp; (ccl != cl) &amp;&amp;</span><br><span class="line">                    ((cl == <span class="literal">null</span>) || !isAncestor(cl, ccl))) &#123;</span><br><span class="line">                    sun.reflect.misc.ReflectUtil.checkPackageAccess(tclass);</span><br><span class="line">                &#125;</span><br><span class="line">                fieldClass = field.getType();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (PrivilegedActionException pae) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(pae.getException());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(ex);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (vclass != fieldClass)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ClassCastException</span>();</span><br><span class="line">                </span><br><span class="line">            <span class="keyword">if</span> (vclass.isPrimitive())</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Must be reference type&quot;</span>);</span><br><span class="line">			<span class="comment">//必须是volatile修饰</span></span><br><span class="line">            <span class="keyword">if</span> (!Modifier.isVolatile(modifiers))</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Must be volatile type&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="built_in">this</span>.cclass = (Modifier.isProtected(modifiers) &amp;&amp;</span><br><span class="line">                           tclass.isAssignableFrom(caller) &amp;&amp;</span><br><span class="line">                           !isSamePackage(tclass, caller))</span><br><span class="line">                          ? caller : tclass;</span><br><span class="line">            <span class="built_in">this</span>.tclass = tclass;</span><br><span class="line">            <span class="built_in">this</span>.vclass = vclass;</span><br><span class="line">            <span class="built_in">this</span>.offset = U.objectFieldOffset(field);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></div></figure>


        <h4 id="get方法-9"   >
          <a href="#get方法-9" class="heading-link"><i class="fas fa-link"></i></a><a href="#get方法-9" class="headerlink" title="get方法"></a>get方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//利用unsafe获取老值</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> V <span class="title function_">get</span><span class="params">(T obj)</span> &#123;</span><br><span class="line">          accessCheck(obj);</span><br><span class="line">          <span class="keyword">return</span> (V)U.getObjectVolatile(obj, offset);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>




        <h4 id="set方法-8"   >
          <a href="#set方法-8" class="heading-link"><i class="fas fa-link"></i></a><a href="#set方法-8" class="headerlink" title="set方法"></a>set方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">compareAndSet</span><span class="params">(V       expectedReference,</span></span><br><span class="line"><span class="params">                               V       newReference,</span></span><br><span class="line"><span class="params">                               <span class="type">boolean</span> expectedMark,</span></span><br><span class="line"><span class="params">                               <span class="type">boolean</span> newMark)</span> &#123;</span><br><span class="line">      Pair&lt;V&gt; current = pair;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">          <span class="comment">//只有老值相等并且标记相等才会进行CAS操作</span></span><br><span class="line">          expectedReference == current.reference &amp;&amp;</span><br><span class="line">          expectedMark == current.mark &amp;&amp;</span><br><span class="line">          ((newReference == current.reference &amp;&amp;</span><br><span class="line">            newMark == current.mark) ||</span><br><span class="line">           casPair(current, Pair.of(newReference, newMark)));</span><br><span class="line">  	&#125;</span><br><span class="line"><span class="comment">//利用unsafe类的CAS操作</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">casPair</span><span class="params">(Pair&lt;V&gt; cmp, Pair&lt;V&gt; val)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> UNSAFE.compareAndSwapObject(<span class="built_in">this</span>, pairOffset, cmp, val);</span><br><span class="line"> 		&#125;</span><br></pre></td></tr></table></div></figure>

<p><strong>完整代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AtomicReferenceFieldUpdater</span>&lt;T,V&gt; &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@CallerSensitive</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;U,W&gt; AtomicReferenceFieldUpdater&lt;U,W&gt; <span class="title function_">newUpdater</span><span class="params">(Class&lt;U&gt; tclass,</span></span><br><span class="line"><span class="params">                                                                    Class&lt;W&gt; vclass,</span></span><br><span class="line"><span class="params">                                                                    String fieldName)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AtomicReferenceFieldUpdaterImpl</span>&lt;U,W&gt;</span><br><span class="line">            (tclass, vclass, fieldName, Reflection.getCallerClass());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="title function_">AtomicReferenceFieldUpdater</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="type">boolean</span> <span class="title function_">compareAndSet</span><span class="params">(T obj, V expect, V update)</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="type">boolean</span> <span class="title function_">weakCompareAndSet</span><span class="params">(T obj, V expect, V update)</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(T obj, V newValue)</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">lazySet</span><span class="params">(T obj, V newValue)</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> V <span class="title function_">get</span><span class="params">(T obj)</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> V <span class="title function_">getAndSet</span><span class="params">(T obj, V newValue)</span> &#123;</span><br><span class="line">        V prev;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = get(obj);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(obj, prev, newValue));</span><br><span class="line">        <span class="keyword">return</span> prev;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> V <span class="title function_">getAndUpdate</span><span class="params">(T obj, UnaryOperator&lt;V&gt; updateFunction)</span> &#123;</span><br><span class="line">        V prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = get(obj);</span><br><span class="line">            next = updateFunction.apply(prev);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(obj, prev, next));</span><br><span class="line">        <span class="keyword">return</span> prev;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> V <span class="title function_">updateAndGet</span><span class="params">(T obj, UnaryOperator&lt;V&gt; updateFunction)</span> &#123;</span><br><span class="line">        V prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = get(obj);</span><br><span class="line">            next = updateFunction.apply(prev);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(obj, prev, next));</span><br><span class="line">        <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> V <span class="title function_">getAndAccumulate</span><span class="params">(T obj, V x,</span></span><br><span class="line"><span class="params">                                    BinaryOperator&lt;V&gt; accumulatorFunction)</span> &#123;</span><br><span class="line">        V prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = get(obj);</span><br><span class="line">            next = accumulatorFunction.apply(prev, x);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(obj, prev, next));</span><br><span class="line">        <span class="keyword">return</span> prev;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> V <span class="title function_">accumulateAndGet</span><span class="params">(T obj, V x,</span></span><br><span class="line"><span class="params">                                    BinaryOperator&lt;V&gt; accumulatorFunction)</span> &#123;</span><br><span class="line">        V prev, next;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            prev = get(obj);</span><br><span class="line">            next = accumulatorFunction.apply(prev, x);</span><br><span class="line">        &#125; <span class="keyword">while</span> (!compareAndSet(obj, prev, next));</span><br><span class="line">        <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">AtomicReferenceFieldUpdaterImpl</span>&lt;T,V&gt;</span><br><span class="line">        <span class="keyword">extends</span> <span class="title class_">AtomicReferenceFieldUpdater</span>&lt;T,V&gt; &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> sun.misc.<span class="type">Unsafe</span> <span class="variable">U</span> <span class="operator">=</span> sun.misc.Unsafe.getUnsafe();</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> offset;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Class&lt;?&gt; cclass;</span><br><span class="line">        <span class="comment">/** class holding the field */</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Class&lt;T&gt; tclass;</span><br><span class="line">        <span class="comment">/** field value type */</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Class&lt;V&gt; vclass;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        AtomicReferenceFieldUpdaterImpl(<span class="keyword">final</span> Class&lt;T&gt; tclass,</span><br><span class="line">                                        <span class="keyword">final</span> Class&lt;V&gt; vclass,</span><br><span class="line">                                        <span class="keyword">final</span> String fieldName,</span><br><span class="line">                                        <span class="keyword">final</span> Class&lt;?&gt; caller) &#123;</span><br><span class="line">            <span class="keyword">final</span> Field field;</span><br><span class="line">            <span class="keyword">final</span> Class&lt;?&gt; fieldClass;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> modifiers;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                field = AccessController.doPrivileged(</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">PrivilegedExceptionAction</span>&lt;Field&gt;() &#123;</span><br><span class="line">                        <span class="keyword">public</span> Field <span class="title function_">run</span><span class="params">()</span> <span class="keyword">throws</span> NoSuchFieldException &#123;</span><br><span class="line">                            <span class="keyword">return</span> tclass.getDeclaredField(fieldName);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                modifiers = field.getModifiers();</span><br><span class="line">                sun.reflect.misc.ReflectUtil.ensureMemberAccess(</span><br><span class="line">                    caller, tclass, <span class="literal">null</span>, modifiers);</span><br><span class="line">                <span class="type">ClassLoader</span> <span class="variable">cl</span> <span class="operator">=</span> tclass.getClassLoader();</span><br><span class="line">                <span class="type">ClassLoader</span> <span class="variable">ccl</span> <span class="operator">=</span> caller.getClassLoader();</span><br><span class="line">                <span class="keyword">if</span> ((ccl != <span class="literal">null</span>) &amp;&amp; (ccl != cl) &amp;&amp;</span><br><span class="line">                    ((cl == <span class="literal">null</span>) || !isAncestor(cl, ccl))) &#123;</span><br><span class="line">                    sun.reflect.misc.ReflectUtil.checkPackageAccess(tclass);</span><br><span class="line">                &#125;</span><br><span class="line">                fieldClass = field.getType();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (PrivilegedActionException pae) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(pae.getException());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(ex);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (vclass != fieldClass)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ClassCastException</span>();</span><br><span class="line">            <span class="keyword">if</span> (vclass.isPrimitive())</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Must be reference type&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!Modifier.isVolatile(modifiers))</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Must be volatile type&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Access to protected field members is restricted to receivers only</span></span><br><span class="line">            <span class="comment">// of the accessing class, or one of its subclasses, and the</span></span><br><span class="line">            <span class="comment">// accessing class must in turn be a subclass (or package sibling)</span></span><br><span class="line">            <span class="comment">// of the protected member&#x27;s defining class.</span></span><br><span class="line">            <span class="comment">// If the updater refers to a protected field of a declaring class</span></span><br><span class="line">            <span class="comment">// outside the current package, the receiver argument will be</span></span><br><span class="line">            <span class="comment">// narrowed to the type of the accessing class.</span></span><br><span class="line">            <span class="built_in">this</span>.cclass = (Modifier.isProtected(modifiers) &amp;&amp;</span><br><span class="line">                           tclass.isAssignableFrom(caller) &amp;&amp;</span><br><span class="line">                           !isSamePackage(tclass, caller))</span><br><span class="line">                          ? caller : tclass;</span><br><span class="line">            <span class="built_in">this</span>.tclass = tclass;</span><br><span class="line">            <span class="built_in">this</span>.vclass = vclass;</span><br><span class="line">            <span class="built_in">this</span>.offset = U.objectFieldOffset(field);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isAncestor</span><span class="params">(ClassLoader first, ClassLoader second)</span> &#123;</span><br><span class="line">            <span class="type">ClassLoader</span> <span class="variable">acl</span> <span class="operator">=</span> first;</span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                acl = acl.getParent();</span><br><span class="line">                <span class="keyword">if</span> (second == acl) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">while</span> (acl != <span class="literal">null</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isSamePackage</span><span class="params">(Class&lt;?&gt; class1, Class&lt;?&gt; class2)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> class1.getClassLoader() == class2.getClassLoader()</span><br><span class="line">                   &amp;&amp; Objects.equals(getPackageName(class1), getPackageName(class2));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">getPackageName</span><span class="params">(Class&lt;?&gt; cls)</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">cn</span> <span class="operator">=</span> cls.getName();</span><br><span class="line">            <span class="type">int</span> <span class="variable">dot</span> <span class="operator">=</span> cn.lastIndexOf(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">            <span class="keyword">return</span> (dot != -<span class="number">1</span>) ? cn.substring(<span class="number">0</span>, dot) : <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">accessCheck</span><span class="params">(T obj)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!cclass.isInstance(obj))</span><br><span class="line">                throwAccessCheckException(obj);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">throwAccessCheckException</span><span class="params">(T obj)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (cclass == tclass)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ClassCastException</span>();</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">IllegalAccessException</span>(</span><br><span class="line">                        <span class="string">&quot;Class &quot;</span> +</span><br><span class="line">                        cclass.getName() +</span><br><span class="line">                        <span class="string">&quot; can not access a protected member of class &quot;</span> +</span><br><span class="line">                        tclass.getName() +</span><br><span class="line">                        <span class="string">&quot; using an instance of &quot;</span> +</span><br><span class="line">                        obj.getClass().getName()));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">valueCheck</span><span class="params">(V v)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (v != <span class="literal">null</span> &amp;&amp; !(vclass.isInstance(v)))</span><br><span class="line">                throwCCE();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">throwCCE</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ClassCastException</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">compareAndSet</span><span class="params">(T obj, V expect, V update)</span> &#123;</span><br><span class="line">            accessCheck(obj);</span><br><span class="line">            valueCheck(update);</span><br><span class="line">            <span class="keyword">return</span> U.compareAndSwapObject(obj, offset, expect, update);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">weakCompareAndSet</span><span class="params">(T obj, V expect, V update)</span> &#123;</span><br><span class="line">            <span class="comment">// same implementation as strong form for now</span></span><br><span class="line">            accessCheck(obj);</span><br><span class="line">            valueCheck(update);</span><br><span class="line">            <span class="keyword">return</span> U.compareAndSwapObject(obj, offset, expect, update);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(T obj, V newValue)</span> &#123;</span><br><span class="line">            accessCheck(obj);</span><br><span class="line">            valueCheck(newValue);</span><br><span class="line">            U.putObjectVolatile(obj, offset, newValue);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">lazySet</span><span class="params">(T obj, V newValue)</span> &#123;</span><br><span class="line">            accessCheck(obj);</span><br><span class="line">            valueCheck(newValue);</span><br><span class="line">            U.putOrderedObject(obj, offset, newValue);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> V <span class="title function_">get</span><span class="params">(T obj)</span> &#123;</span><br><span class="line">            accessCheck(obj);</span><br><span class="line">            <span class="keyword">return</span> (V)U.getObjectVolatile(obj, offset);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> V <span class="title function_">getAndSet</span><span class="params">(T obj, V newValue)</span> &#123;</span><br><span class="line">            accessCheck(obj);</span><br><span class="line">            valueCheck(newValue);</span><br><span class="line">            <span class="keyword">return</span> (V)U.getAndSetObject(obj, offset, newValue);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>


        <h3 id="小结-2"   >
          <a href="#小结-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#小结-2" class="headerlink" title="小结"></a>小结</h3>
      <p>这个属性更新原子类比较苛刻的要求，必须字段名要被volatile修饰，并且权限修饰符必须要允许访问，其余仍然是用ussafe类的cas机制完成更新操作</p>
<p>总体就是利用unsafe类以及反射完成操作</p>

        <h2 id="特殊标记原子操作类"   >
          <a href="#特殊标记原子操作类" class="heading-link"><i class="fas fa-link"></i></a><a href="#特殊标记原子操作类" class="headerlink" title="特殊标记原子操作类"></a>特殊标记原子操作类</h2>
      <p><strong>意义</strong>：引入特殊标记原子操作类是为了<strong>解决CAS机制的ABA问题</strong>，而特殊标记原子类中又有Mark标记以及Stamp时间戳标记两种，我们接下来看向这两种</p>

        <h3 id="AtomicMarkableReference"   >
          <a href="#AtomicMarkableReference" class="heading-link"><i class="fas fa-link"></i></a><a href="#AtomicMarkableReference" class="headerlink" title="AtomicMarkableReference"></a>AtomicMarkableReference</h3>
      <p><strong>源码</strong></p>

        <h4 id="成员变量以及内部类"   >
          <a href="#成员变量以及内部类" class="heading-link"><i class="fas fa-link"></i></a><a href="#成员变量以及内部类" class="headerlink" title="成员变量以及内部类"></a>成员变量以及内部类</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//unsafe类</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> sun.misc.<span class="type">Unsafe</span> <span class="variable">UNSAFE</span> <span class="operator">=</span> sun.misc.Unsafe.getUnsafe();</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">pairOffset</span> <span class="operator">=</span></span><br><span class="line">       objectFieldOffset(UNSAFE, <span class="string">&quot;pair&quot;</span>, AtomicMarkableReference.class);</span><br><span class="line"><span class="comment">//内部类</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Pair</span>&lt;T&gt; &#123;</span><br><span class="line">       <span class="comment">//数据</span></span><br><span class="line">       <span class="keyword">final</span> T reference;</span><br><span class="line">       <span class="comment">//标记位</span></span><br><span class="line">       <span class="keyword">final</span> <span class="type">boolean</span> mark;</span><br><span class="line">       <span class="keyword">private</span> <span class="title function_">Pair</span><span class="params">(T reference, <span class="type">boolean</span> mark)</span> &#123;</span><br><span class="line">           <span class="built_in">this</span>.reference = reference;</span><br><span class="line">           <span class="built_in">this</span>.mark = mark;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">static</span> &lt;T&gt; Pair&lt;T&gt; <span class="title function_">of</span><span class="params">(T reference, <span class="type">boolean</span> mark)</span> &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Pair</span>&lt;T&gt;(reference, mark);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></div></figure>


        <h4 id="构造方法-10"   >
          <a href="#构造方法-10" class="heading-link"><i class="fas fa-link"></i></a><a href="#构造方法-10" class="headerlink" title="构造方法"></a>构造方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//传入数据，初始化数据以及标记位mark为false</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">AtomicMarkableReference</span><span class="params">(V initialRef, <span class="type">boolean</span> initialMark)</span> &#123;</span><br><span class="line">       pair = Pair.of(initialRef, initialMark);</span><br><span class="line">  	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> &lt;T&gt; Pair&lt;T&gt; <span class="title function_">of</span><span class="params">(T reference, <span class="type">boolean</span> mark)</span> &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Pair</span>&lt;T&gt;(reference, mark);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></div></figure>


        <h4 id="get方法-10"   >
          <a href="#get方法-10" class="heading-link"><i class="fas fa-link"></i></a><a href="#get方法-10" class="headerlink" title="get方法"></a>get方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//返回当前数据</span></span><br><span class="line"><span class="keyword">public</span> V <span class="title function_">get</span><span class="params">(<span class="type">boolean</span>[] markHolder)</span> &#123;</span><br><span class="line">       Pair&lt;V&gt; pair = <span class="built_in">this</span>.pair;</span><br><span class="line">       markHolder[<span class="number">0</span>] = pair.mark;</span><br><span class="line">       <span class="keyword">return</span> pair.reference;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></div></figure>


        <h4 id="set方法-9"   >
          <a href="#set方法-9" class="heading-link"><i class="fas fa-link"></i></a><a href="#set方法-9" class="headerlink" title="set方法"></a>set方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据mark和数据来更新数据</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(V newReference, <span class="type">boolean</span> newMark)</span> &#123;</span><br><span class="line">       Pair&lt;V&gt; current = pair;</span><br><span class="line">   	<span class="comment">//判断数据和当前数据不一致或者标志位也不一致则可以更新数据。</span></span><br><span class="line">       <span class="keyword">if</span> (newReference != current.reference || newMark != current.mark)</span><br><span class="line">           <span class="built_in">this</span>.pair = Pair.of(newReference, newMark);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></div></figure>



<p><strong>完整代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AtomicMarkableReference</span>&lt;V&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Pair</span>&lt;T&gt; &#123;</span><br><span class="line">        <span class="keyword">final</span> T reference;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">boolean</span> mark;</span><br><span class="line">        <span class="keyword">private</span> <span class="title function_">Pair</span><span class="params">(T reference, <span class="type">boolean</span> mark)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.reference = reference;</span><br><span class="line">            <span class="built_in">this</span>.mark = mark;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">static</span> &lt;T&gt; Pair&lt;T&gt; <span class="title function_">of</span><span class="params">(T reference, <span class="type">boolean</span> mark)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Pair</span>&lt;T&gt;(reference, mark);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> Pair&lt;V&gt; pair;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AtomicMarkableReference</span><span class="params">(V initialRef, <span class="type">boolean</span> initialMark)</span> &#123;</span><br><span class="line">        pair = Pair.of(initialRef, initialMark);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> V <span class="title function_">getReference</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> pair.reference;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isMarked</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> pair.mark;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> V <span class="title function_">get</span><span class="params">(<span class="type">boolean</span>[] markHolder)</span> &#123;</span><br><span class="line">        Pair&lt;V&gt; pair = <span class="built_in">this</span>.pair;</span><br><span class="line">        markHolder[<span class="number">0</span>] = pair.mark;</span><br><span class="line">        <span class="keyword">return</span> pair.reference;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">weakCompareAndSet</span><span class="params">(V       expectedReference,</span></span><br><span class="line"><span class="params">                                     V       newReference,</span></span><br><span class="line"><span class="params">                                     <span class="type">boolean</span> expectedMark,</span></span><br><span class="line"><span class="params">                                     <span class="type">boolean</span> newMark)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> compareAndSet(expectedReference, newReference,</span><br><span class="line">                             expectedMark, newMark);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">compareAndSet</span><span class="params">(V       expectedReference,</span></span><br><span class="line"><span class="params">                                 V       newReference,</span></span><br><span class="line"><span class="params">                                 <span class="type">boolean</span> expectedMark,</span></span><br><span class="line"><span class="params">                                 <span class="type">boolean</span> newMark)</span> &#123;</span><br><span class="line">        Pair&lt;V&gt; current = pair;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">            expectedReference == current.reference &amp;&amp;</span><br><span class="line">            expectedMark == current.mark &amp;&amp;</span><br><span class="line">            ((newReference == current.reference &amp;&amp;</span><br><span class="line">              newMark == current.mark) ||</span><br><span class="line">             casPair(current, Pair.of(newReference, newMark)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(V newReference, <span class="type">boolean</span> newMark)</span> &#123;</span><br><span class="line">        Pair&lt;V&gt; current = pair;</span><br><span class="line">        <span class="keyword">if</span> (newReference != current.reference || newMark != current.mark)</span><br><span class="line">            <span class="built_in">this</span>.pair = Pair.of(newReference, newMark);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">attemptMark</span><span class="params">(V expectedReference, <span class="type">boolean</span> newMark)</span> &#123;</span><br><span class="line">        Pair&lt;V&gt; current = pair;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">            expectedReference == current.reference &amp;&amp;</span><br><span class="line">            (newMark == current.mark ||</span><br><span class="line">             casPair(current, Pair.of(expectedReference, newMark)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Unsafe mechanics</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> sun.misc.<span class="type">Unsafe</span> <span class="variable">UNSAFE</span> <span class="operator">=</span> sun.misc.Unsafe.getUnsafe();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">pairOffset</span> <span class="operator">=</span></span><br><span class="line">        objectFieldOffset(UNSAFE, <span class="string">&quot;pair&quot;</span>, AtomicMarkableReference.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">casPair</span><span class="params">(Pair&lt;V&gt; cmp, Pair&lt;V&gt; val)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> UNSAFE.compareAndSwapObject(<span class="built_in">this</span>, pairOffset, cmp, val);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="type">long</span> <span class="title function_">objectFieldOffset</span><span class="params">(sun.misc.Unsafe UNSAFE,</span></span><br><span class="line"><span class="params">                                  String field, Class&lt;?&gt; klazz)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> UNSAFE.objectFieldOffset(klazz.getDeclaredField(field));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">            <span class="comment">// Convert Exception to corresponding Error</span></span><br><span class="line">            <span class="type">NoSuchFieldError</span> <span class="variable">error</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NoSuchFieldError</span>(field);</span><br><span class="line">            error.initCause(e);</span><br><span class="line">            <span class="keyword">throw</span> error;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h3 id="AtomicStampedReference"   >
          <a href="#AtomicStampedReference" class="heading-link"><i class="fas fa-link"></i></a><a href="#AtomicStampedReference" class="headerlink" title="AtomicStampedReference"></a>AtomicStampedReference</h3>
      <p><strong>源码</strong></p>

        <h4 id="成员变量以及内部类-1"   >
          <a href="#成员变量以及内部类-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#成员变量以及内部类-1" class="headerlink" title="成员变量以及内部类"></a>成员变量以及内部类</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> sun.misc.<span class="type">Unsafe</span> <span class="variable">UNSAFE</span> <span class="operator">=</span> sun.misc.Unsafe.getUnsafe();</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">pairOffset</span> <span class="operator">=</span></span><br><span class="line">       objectFieldOffset(UNSAFE, <span class="string">&quot;pair&quot;</span>, AtomicStampedReference.class);</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Pair</span>&lt;T&gt; &#123;</span><br><span class="line">   	<span class="comment">//数据</span></span><br><span class="line">   	<span class="keyword">final</span> T reference;</span><br><span class="line">   	<span class="comment">//时间戳</span></span><br><span class="line">       <span class="keyword">final</span> <span class="type">int</span> stamp;</span><br><span class="line">       <span class="keyword">private</span> <span class="title function_">Pair</span><span class="params">(T reference, <span class="type">int</span> stamp)</span> &#123;</span><br><span class="line">           <span class="built_in">this</span>.reference = reference;</span><br><span class="line">           <span class="built_in">this</span>.stamp = stamp;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">static</span> &lt;T&gt; Pair&lt;T&gt; <span class="title function_">of</span><span class="params">(T reference, <span class="type">int</span> stamp)</span> &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Pair</span>&lt;T&gt;(reference, stamp);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">volatile</span> Pair&lt;V&gt; pair;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>




        <h4 id="构造方法-11"   >
          <a href="#构造方法-11" class="heading-link"><i class="fas fa-link"></i></a><a href="#构造方法-11" class="headerlink" title="构造方法"></a>构造方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//传入数据和时间戳</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">AtomicStampedReference</span><span class="params">(V initialRef, <span class="type">int</span> initialStamp)</span> &#123;</span><br><span class="line">       pair = Pair.of(initialRef, initialStamp);</span><br><span class="line">   &#125;</span><br><span class="line"><span class="keyword">static</span> &lt;T&gt; Pair&lt;T&gt; <span class="title function_">of</span><span class="params">(T reference, <span class="type">int</span> stamp)</span> &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Pair</span>&lt;T&gt;(reference, stamp);</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></div></figure>


        <h4 id="get方法-11"   >
          <a href="#get方法-11" class="heading-link"><i class="fas fa-link"></i></a><a href="#get方法-11" class="headerlink" title="get方法"></a>get方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//返回当前值</span></span><br><span class="line"><span class="keyword">public</span> V <span class="title function_">get</span><span class="params">(<span class="type">int</span>[] stampHolder)</span> &#123;</span><br><span class="line">       Pair&lt;V&gt; pair = <span class="built_in">this</span>.pair;</span><br><span class="line">       stampHolder[<span class="number">0</span>] = pair.stamp;</span><br><span class="line">       <span class="keyword">return</span> pair.reference;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></div></figure>


        <h4 id="set方法-10"   >
          <a href="#set方法-10" class="heading-link"><i class="fas fa-link"></i></a><a href="#set方法-10" class="headerlink" title="set方法"></a>set方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">compareAndSet</span><span class="params">(V   expectedReference,</span></span><br><span class="line"><span class="params">                                V   newReference,</span></span><br><span class="line"><span class="params">                                <span class="type">int</span> expectedStamp,</span></span><br><span class="line"><span class="params">                                <span class="type">int</span> newStamp)</span> &#123;</span><br><span class="line">       Pair&lt;V&gt; current = pair;</span><br><span class="line">       <span class="keyword">return</span></span><br><span class="line">       	<span class="comment">//只有时间戳和数据相等才能进行CAS设置新值</span></span><br><span class="line">           expectedReference == current.reference &amp;&amp;</span><br><span class="line">           expectedStamp == current.stamp &amp;&amp;</span><br><span class="line">           ((newReference == current.reference &amp;&amp;</span><br><span class="line">             newStamp == current.stamp) ||</span><br><span class="line">            casPair(current, Pair.of(newReference, newStamp)));</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="comment">//利用unsafe类的CAS</span></span><br><span class="line">   <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">casPair</span><span class="params">(Pair&lt;V&gt; cmp, Pair&lt;V&gt; val)</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> UNSAFE.compareAndSwapObject(<span class="built_in">this</span>, pairOffset, cmp, val);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></div></figure>

<p><strong>完整代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AtomicStampedReference</span>&lt;V&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Pair</span>&lt;T&gt; &#123;</span><br><span class="line">        <span class="keyword">final</span> T reference;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> stamp;</span><br><span class="line">        <span class="keyword">private</span> <span class="title function_">Pair</span><span class="params">(T reference, <span class="type">int</span> stamp)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.reference = reference;</span><br><span class="line">            <span class="built_in">this</span>.stamp = stamp;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">static</span> &lt;T&gt; Pair&lt;T&gt; <span class="title function_">of</span><span class="params">(T reference, <span class="type">int</span> stamp)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Pair</span>&lt;T&gt;(reference, stamp);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> Pair&lt;V&gt; pair;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AtomicStampedReference</span><span class="params">(V initialRef, <span class="type">int</span> initialStamp)</span> &#123;</span><br><span class="line">        pair = Pair.of(initialRef, initialStamp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> V <span class="title function_">getReference</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> pair.reference;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getStamp</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> pair.stamp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> V <span class="title function_">get</span><span class="params">(<span class="type">int</span>[] stampHolder)</span> &#123;</span><br><span class="line">        Pair&lt;V&gt; pair = <span class="built_in">this</span>.pair;</span><br><span class="line">        stampHolder[<span class="number">0</span>] = pair.stamp;</span><br><span class="line">        <span class="keyword">return</span> pair.reference;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">weakCompareAndSet</span><span class="params">(V   expectedReference,</span></span><br><span class="line"><span class="params">                                     V   newReference,</span></span><br><span class="line"><span class="params">                                     <span class="type">int</span> expectedStamp,</span></span><br><span class="line"><span class="params">                                     <span class="type">int</span> newStamp)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> compareAndSet(expectedReference, newReference,</span><br><span class="line">                             expectedStamp, newStamp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">compareAndSet</span><span class="params">(V   expectedReference,</span></span><br><span class="line"><span class="params">                                 V   newReference,</span></span><br><span class="line"><span class="params">                                 <span class="type">int</span> expectedStamp,</span></span><br><span class="line"><span class="params">                                 <span class="type">int</span> newStamp)</span> &#123;</span><br><span class="line">        Pair&lt;V&gt; current = pair;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">            expectedReference == current.reference &amp;&amp;</span><br><span class="line">            expectedStamp == current.stamp &amp;&amp;</span><br><span class="line">            ((newReference == current.reference &amp;&amp;</span><br><span class="line">              newStamp == current.stamp) ||</span><br><span class="line">             casPair(current, Pair.of(newReference, newStamp)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(V newReference, <span class="type">int</span> newStamp)</span> &#123;</span><br><span class="line">        Pair&lt;V&gt; current = pair;</span><br><span class="line">        <span class="keyword">if</span> (newReference != current.reference || newStamp != current.stamp)</span><br><span class="line">            <span class="built_in">this</span>.pair = Pair.of(newReference, newStamp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">attemptStamp</span><span class="params">(V expectedReference, <span class="type">int</span> newStamp)</span> &#123;</span><br><span class="line">        Pair&lt;V&gt; current = pair;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">            expectedReference == current.reference &amp;&amp;</span><br><span class="line">            (newStamp == current.stamp ||</span><br><span class="line">             casPair(current, Pair.of(expectedReference, newStamp)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Unsafe mechanics</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> sun.misc.<span class="type">Unsafe</span> <span class="variable">UNSAFE</span> <span class="operator">=</span> sun.misc.Unsafe.getUnsafe();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">pairOffset</span> <span class="operator">=</span></span><br><span class="line">        objectFieldOffset(UNSAFE, <span class="string">&quot;pair&quot;</span>, AtomicStampedReference.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">casPair</span><span class="params">(Pair&lt;V&gt; cmp, Pair&lt;V&gt; val)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> UNSAFE.compareAndSwapObject(<span class="built_in">this</span>, pairOffset, cmp, val);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="type">long</span> <span class="title function_">objectFieldOffset</span><span class="params">(sun.misc.Unsafe UNSAFE,</span></span><br><span class="line"><span class="params">                                  String field, Class&lt;?&gt; klazz)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> UNSAFE.objectFieldOffset(klazz.getDeclaredField(field));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">            <span class="comment">// Convert Exception to corresponding Error</span></span><br><span class="line">            <span class="type">NoSuchFieldError</span> <span class="variable">error</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NoSuchFieldError</span>(field);</span><br><span class="line">            error.initCause(e);</span><br><span class="line">            <span class="keyword">throw</span> error;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>


        <h3 id="小结-3"   >
          <a href="#小结-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#小结-3" class="headerlink" title="小结"></a>小结</h3>
      <p>在mark标记方法中，只有false和true两种标记，所以<strong>能减少一部分ABA问题，但是不能避免ABA问题</strong></p>
<p>而<strong>利用时间戳的方式，可以避免ABA问题出现</strong></p>
<p>两者本质上都是比较标记位以及数据是否被修改过，如果都是相同则认为没有线程修改过</p>

        <h2 id="基于分治思想新增的原子操作类"   >
          <a href="#基于分治思想新增的原子操作类" class="heading-link"><i class="fas fa-link"></i></a><a href="#基于分治思想新增的原子操作类" class="headerlink" title="基于分治思想新增的原子操作类"></a>基于分治思想新增的原子操作类</h2>
      <p>我们提及原子操作类，都是以<strong>CAS+自旋</strong>完成更新数据的操作，而CAS失败的自旋会引来CPU空转的性能丢失。因此在jdk1.8之后添加了一个基于分治思想的原子操作类，为了适应<strong>高并发</strong>的情况，减少空转</p>

        <h3 id="Striped64"   >
          <a href="#Striped64" class="heading-link"><i class="fas fa-link"></i></a><a href="#Striped64" class="headerlink" title="Striped64"></a>Striped64</h3>
      <p><strong>源码</strong></p>
<p>这个类是一个抽象类，提供了一些模板方法以及成员变量以及内部类，而基于分治思想也就从这里开始</p>

        <h4 id="成员变量以及内部类-2"   >
          <a href="#成员变量以及内部类-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#成员变量以及内部类-2" class="headerlink" title="成员变量以及内部类"></a>成员变量以及内部类</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">	<span class="comment">//NCPU表示最大核数，例如16核就代表NCPU=16</span></span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">NCPU</span> <span class="operator">=</span> Runtime.getRuntime().availableProcessors();</span><br><span class="line"></span><br><span class="line">	<span class="comment">//cell的哈希表</span></span><br><span class="line">	<span class="keyword">transient</span> <span class="keyword">volatile</span> Cell[] cells;  <span class="comment">//transient关键字表示这个成员变量不会被序列化和反序列化</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//无竞争下的变量，类似于value</span></span><br><span class="line">    <span class="keyword">transient</span> <span class="keyword">volatile</span> <span class="type">long</span> base;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//cells哈希表的持锁标志位，1代表被加锁，0代表无锁</span></span><br><span class="line">    <span class="keyword">transient</span> <span class="keyword">volatile</span> <span class="type">int</span> cellsBusy;	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//unsafe类</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> sun.misc.Unsafe UNSAFE;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> BASE;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> CELLSBUSY;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//线程标识符(哈希值)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> PROBE;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//初始化</span></span><br><span class="line">	<span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            UNSAFE = sun.misc.Unsafe.getUnsafe();</span><br><span class="line">            Class&lt;?&gt; sk = Striped64.class;</span><br><span class="line">            BASE = UNSAFE.objectFieldOffset</span><br><span class="line">                (sk.getDeclaredField(<span class="string">&quot;base&quot;</span>));</span><br><span class="line">            CELLSBUSY = UNSAFE.objectFieldOffset</span><br><span class="line">                (sk.getDeclaredField(<span class="string">&quot;cellsBusy&quot;</span>));</span><br><span class="line">            Class&lt;?&gt; tk = Thread.class;</span><br><span class="line">            PROBE = UNSAFE.objectFieldOffset</span><br><span class="line">                (tk.getDeclaredField(<span class="string">&quot;threadLocalRandomProbe&quot;</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//内部类Cell	</span></span><br><span class="line"> <span class="meta">@sun</span>.misc.Contended <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Cell</span> &#123;</span><br><span class="line">        <span class="keyword">volatile</span> <span class="type">long</span> value;</span><br><span class="line">        Cell(<span class="type">long</span> x) &#123; value = x; &#125;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">cas</span><span class="params">(<span class="type">long</span> cmp, <span class="type">long</span> val)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> UNSAFE.compareAndSwapLong(<span class="built_in">this</span>, valueOffset, cmp, val);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Unsafe mechanics</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> sun.misc.Unsafe UNSAFE;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> valueOffset;</span><br><span class="line">        <span class="keyword">static</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                UNSAFE = sun.misc.Unsafe.getUnsafe();</span><br><span class="line">                Class&lt;?&gt; ak = Cell.class;</span><br><span class="line">                valueOffset = UNSAFE.objectFieldOffset</span><br><span class="line">                    (ak.getDeclaredField(<span class="string">&quot;value&quot;</span>));</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>






        <h4 id="longAccumulate方法"   >
          <a href="#longAccumulate方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#longAccumulate方法" class="headerlink" title="longAccumulate方法"></a>longAccumulate方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//用于初始化Cells、扩容Cells，创建新的Cell，竞争Cell的情况</span></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">longAccumulate</span><span class="params">(<span class="type">long</span> x, LongBinaryOperator fn,</span></span><br><span class="line"><span class="params">                          <span class="type">boolean</span> wasUncontended)</span> &#123;</span><br><span class="line">    <span class="type">int</span> h;</span><br><span class="line">    <span class="comment">//h=getProbe()，获取当前线程的标志位</span></span><br><span class="line">    <span class="keyword">if</span> ((h = getProbe()) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">//如果h==0，说明当前线程没有进入竞争过，所以初始化threadLocalRandomProbe作为哈希值</span></span><br><span class="line">        ThreadLocalRandom.current(); <span class="comment">// force initialization</span></span><br><span class="line">        <span class="comment">//将哈希值赋值给h</span></span><br><span class="line">        h = getProbe();</span><br><span class="line">       </span><br><span class="line">        wasUncontended = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="type">boolean</span> <span class="variable">collide</span> <span class="operator">=</span> <span class="literal">false</span>;                <span class="comment">// True if last slot nonempty</span></span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        Cell[] as; Cell a; <span class="type">int</span> n; <span class="type">long</span> v;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">        进入下方if语句的条件：</span></span><br><span class="line"><span class="comment">        	当cells不为空并且cells.length&gt;0，说明初始化成功</span></span><br><span class="line"><span class="comment">        	进入语句之后as=cells,n=as.length</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="keyword">if</span> ((as = cells) != <span class="literal">null</span> &amp;&amp; (n = as.length) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//进入下方if语句，也即as[哈希值映射]为空，也即cell未被初始化，a=as[哈希值映射]</span></span><br><span class="line">            <span class="keyword">if</span> ((a = as[(n - <span class="number">1</span>) &amp; h]) == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">//初始化cell</span></span><br><span class="line">                </span><br><span class="line">                </span><br><span class="line">                <span class="comment">//如果cellsBusy==0,说明是Cells是空闲状态</span></span><br><span class="line">                <span class="keyword">if</span> (cellsBusy == <span class="number">0</span>) &#123;       <span class="comment">// Try to attach new Cell</span></span><br><span class="line">                    <span class="comment">//新建一个cell</span></span><br><span class="line">                    <span class="type">Cell</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cell</span>(x);   <span class="comment">// Optimistically create</span></span><br><span class="line">                    </span><br><span class="line">                    <span class="comment">//再判断cellsBusy是否为1，也即是否被加锁</span></span><br><span class="line">                    <span class="comment">//如果等于0，那么将casCellsBusy()将其置为1，也即加锁标志位</span></span><br><span class="line">                    <span class="keyword">if</span> (cellsBusy == <span class="number">0</span> &amp;&amp; casCellsBusy()) &#123;</span><br><span class="line">                        </span><br><span class="line">                        <span class="comment">//创建成功标志位</span></span><br><span class="line">                        <span class="type">boolean</span> <span class="variable">created</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">                        <span class="keyword">try</span> &#123;               <span class="comment">// Recheck under lock</span></span><br><span class="line">                            Cell[] rs; <span class="type">int</span> m, j;</span><br><span class="line">                            </span><br><span class="line">                            <span class="comment">//判断cells不为空并且长度大于0（完成初始化）并且哈希值对应的cell不存在，则将rs[j]=r</span></span><br><span class="line">                            <span class="keyword">if</span> ((rs = cells) != <span class="literal">null</span> &amp;&amp;</span><br><span class="line">                                (m = rs.length) &gt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">                                rs[j = (m - <span class="number">1</span>) &amp; h] == <span class="literal">null</span>) &#123;</span><br><span class="line">                                rs[j] = r;</span><br><span class="line">                                created = <span class="literal">true</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                            <span class="comment">//解锁</span></span><br><span class="line">                            cellsBusy = <span class="number">0</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">//如果创建成功则跳出循环</span></span><br><span class="line">                        <span class="keyword">if</span> (created)</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        <span class="keyword">continue</span>;           <span class="comment">// Slot is now non-empty</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                collide = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//以下else语句都是cell不为空的情况下，可能是初始化成功也可能是CAS竞争失败</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (!wasUncontended)       <span class="comment">// CAS already known to fail</span></span><br><span class="line">                <span class="comment">//cas失败，则将标志位置为true</span></span><br><span class="line">                wasUncontended = <span class="literal">true</span>;      <span class="comment">// Continue after rehash</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (a.cas(v = a.value, ((fn == <span class="literal">null</span>) ? v + x :</span><br><span class="line">                                         fn.applyAsLong(v, x))))</span><br><span class="line">            	<span class="comment">//再CAS，将调用fn更新函数,如果不为空则执行不为空的逻辑，如果为空则是加法    </span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (n &gt;= NCPU || cells != as)</span><br><span class="line">                <span class="comment">//运行到这里说明CAS再次失败，判断Cells长度是否大于等于最大线程数或者cells不为当前as</span></span><br><span class="line">                <span class="comment">//也即竞争失败，并且n达到最大cpu数量或者cells进行扩容了</span></span><br><span class="line">                <span class="comment">//将竞争标志位打为false</span></span><br><span class="line">                collide = <span class="literal">false</span>;            <span class="comment">// At max size or stale</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (!collide)</span><br><span class="line">                <span class="comment">//运行到这里cell不为空并且cas失败过，也即存在竞争</span></span><br><span class="line">                <span class="comment">//将竞争标志位打为true</span></span><br><span class="line">                collide = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (cellsBusy == <span class="number">0</span> &amp;&amp; casCellsBusy()) &#123;</span><br><span class="line">                <span class="comment">//竞争标志位为true，并且n未达到最大cpu数量，尝试进行扩容，循环条件中给cells加锁</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (cells == as) &#123;      <span class="comment">// Expand table unless stale</span></span><br><span class="line">                        <span class="comment">//新数组长度为老数组长度+1</span></span><br><span class="line">                        Cell[] rs = <span class="keyword">new</span> <span class="title class_">Cell</span>[n &lt;&lt; <span class="number">1</span>];</span><br><span class="line">                        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">                            <span class="comment">//迁移数据，直接迁移</span></span><br><span class="line">                            rs[i] = as[i];</span><br><span class="line">                        cells = rs;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    <span class="comment">//解锁</span></span><br><span class="line">                    cellsBusy = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//竞争标志位打为false</span></span><br><span class="line">                collide = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">continue</span>;                   <span class="comment">// Retry with expanded table</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//重新计算线程标记位(哈希值)</span></span><br><span class="line">            h = advanceProbe(h);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//以下是最大if语句的else情况，也即cells未能被初始化成功</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (cellsBusy == <span class="number">0</span> &amp;&amp; cells == as &amp;&amp; casCellsBusy()) &#123;</span><br><span class="line">            <span class="comment">//给cells加锁，将init标志位记录为false</span></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">init</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;                           <span class="comment">// Initialize table</span></span><br><span class="line">                <span class="comment">//判断是否是当前cells</span></span><br><span class="line">                <span class="keyword">if</span> (cells == as) &#123;</span><br><span class="line">                    <span class="comment">//新建一个长度为2的cells,将x存放到cells对应的位置中</span></span><br><span class="line">                    Cell[] rs = <span class="keyword">new</span> <span class="title class_">Cell</span>[<span class="number">2</span>];</span><br><span class="line">                    rs[h &amp; <span class="number">1</span>] = <span class="keyword">new</span> <span class="title class_">Cell</span>(x);</span><br><span class="line">                    cells = rs;</span><br><span class="line">                    init = <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="comment">//解锁</span></span><br><span class="line">                cellsBusy = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (init)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//以下是最大if语句的else情况，也即cells未被初始化，但是cellsBusy!=0说明其他线程在对Cells扩容</span></span><br><span class="line">        <span class="comment">//尝试加到Base中，如果base添加成功则break</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (casBase(v = base, ((fn == <span class="literal">null</span>) ? v + x :</span><br><span class="line">                                    fn.applyAsLong(v, x))))</span><br><span class="line">            <span class="keyword">break</span>;                          <span class="comment">// Fall back on using base</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//用于重新计算哈希值</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">advanceProbe</span><span class="params">(<span class="type">int</span> probe)</span> &#123;</span><br><span class="line">        probe ^= probe &lt;&lt; <span class="number">13</span>;   <span class="comment">// xorshift</span></span><br><span class="line">        probe ^= probe &gt;&gt;&gt; <span class="number">17</span>;</span><br><span class="line">        probe ^= probe &lt;&lt; <span class="number">5</span>;</span><br><span class="line">        UNSAFE.putInt(Thread.currentThread(), PROBE, probe);</span><br><span class="line">        <span class="keyword">return</span> probe;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>


        <h5 id="小结-4"   >
          <a href="#小结-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#小结-4" class="headerlink" title="小结"></a>小结</h5>
      <p>我们再梳理一遍死循环中的逻辑</p>
<ul>
<li><p>&#x2F;&#x2F;cells不为空并且长度大于0，说明cells初始化之后</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//cells不为空并且长度大于0，说明cells初始化之后</span></span><br><span class="line"><span class="keyword">if</span> ((as = cells) != <span class="literal">null</span> &amp;&amp; (n = as.length) &gt; <span class="number">0</span>) </span><br></pre></td></tr></table></div></figure>

<ul>
<li>进入当前if语句中，cells不为空并且长度大于0</li>
</ul>
 <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//如果哈希值对应的cell为空，则新建一个cell放到cells中</span></span><br><span class="line"><span class="keyword">if</span> ((a = as[(n - <span class="number">1</span>) &amp; h]) == <span class="literal">null</span>)&#123;...&#125;</span><br></pre></td></tr></table></div></figure>



<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//cell不为空，但是已知CAS失败</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (!wasUncontended)&#123;...&#125;</span><br></pre></td></tr></table></div></figure>



<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//cell不为空，尝试cas</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (a.cas(v = a.value, ((fn == <span class="literal">null</span>) ? v + x :fn.applyAsLong(v, x))))&#123;...&#125;</span><br></pre></td></tr></table></div></figure>



<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//CAS失败说明有竞争，判断是否达到最大线程数，或者cells被扩容了</span></span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (n &gt;= NCPU || cells != as)&#123;...&#125;</span><br></pre></td></tr></table></div></figure>



<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//尝试的cas失败，说明有竞争</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (!collide)&#123;...&#125;</span><br></pre></td></tr></table></div></figure>



<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//cell不为空，且cas失败，并且没有扩容到最大cpu数量，则尝试加锁扩容</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (cellsBusy == <span class="number">0</span> &amp;&amp; casCellsBusy())&#123;...&#125;</span><br></pre></td></tr></table></div></figure>

<ul>
<li>h&#x3D;advanceProbe(h)，重新计算哈希值</li>
</ul>
</li>
<li><p>cells为空，则尝试加锁进行初始化</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//cells为空，则尝试加锁进行初始化</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (cellsBusy == <span class="number">0</span> &amp;&amp; cells == as &amp;&amp; casCellsBusy())</span><br></pre></td></tr></table></div></figure>

<ul>
<li><p>进入当前if语句中，cells为空，但是加锁成功</p>
</li>
<li><p>初始化cells</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//初始化cells长度为2，以后扩容都是扩容成2的幂次方</span></span><br><span class="line">Cell[] rs = <span class="keyword">new</span> <span class="title class_">Cell</span>[<span class="number">2</span>];</span><br><span class="line">rs[h &amp; <span class="number">1</span>] = <span class="keyword">new</span> <span class="title class_">Cell</span>(x);</span><br><span class="line">cells = rs;</span><br><span class="line">init = <span class="literal">true</span>;</span><br></pre></td></tr></table></div></figure>

<blockquote>
<p>为什么这块代码需要一个临时的变量rs来接收new的cells，为什么不写成下面这个情况</p>
</blockquote>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Cell[] cells=<span class="keyword">new</span> <span class="title class_">Cell</span>[<span class="number">2</span>];</span><br><span class="line">cells[h &amp; <span class="number">1</span>]=<span class="keyword">new</span> <span class="title class_">Cell</span>(x);</span><br><span class="line">init=<span class="literal">true</span></span><br></pre></td></tr></table></div></figure>

<p><strong>因为一旦cells被new成功，则其他线程就可以进入if条件中的第一个情况，对cells进行操作，所以会有线程不安全的问题</strong></p>
<p>也即需要一个rs来对初始化数组并且接收数据</p>
</li>
</ul>
</li>
<li><p>cells为空并且被其他线程加锁扩容中,所以尝试直接加到base中</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//cells为空并且被其他线程加锁扩容中,所以尝试直接加到base中</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (casBase(v = base, ((fn == <span class="literal">null</span>) ? v + x : fn.applyAsLong(v, x))))</span><br></pre></td></tr></table></div></figure>

<ul>
<li><p>进入当前if语句中，cells为空，但是加锁失败，直接操作base成功</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">break</span>;<span class="comment">//结束死循环，说明操作成功  </span></span><br></pre></td></tr></table></div></figure></li>
</ul>
</li>
</ul>
<p><strong>完整代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Striped64</span> <span class="keyword">extends</span> <span class="title class_">Number</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@sun</span>.misc.Contended <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Cell</span> &#123;</span><br><span class="line">        <span class="keyword">volatile</span> <span class="type">long</span> value;</span><br><span class="line">        Cell(<span class="type">long</span> x) &#123; value = x; &#125;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">cas</span><span class="params">(<span class="type">long</span> cmp, <span class="type">long</span> val)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> UNSAFE.compareAndSwapLong(<span class="built_in">this</span>, valueOffset, cmp, val);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Unsafe mechanics</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> sun.misc.Unsafe UNSAFE;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> valueOffset;</span><br><span class="line">        <span class="keyword">static</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                UNSAFE = sun.misc.Unsafe.getUnsafe();</span><br><span class="line">                Class&lt;?&gt; ak = Cell.class;</span><br><span class="line">                valueOffset = UNSAFE.objectFieldOffset</span><br><span class="line">                    (ak.getDeclaredField(<span class="string">&quot;value&quot;</span>));</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">NCPU</span> <span class="operator">=</span> Runtime.getRuntime().availableProcessors();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">transient</span> <span class="keyword">volatile</span> Cell[] cells;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">transient</span> <span class="keyword">volatile</span> <span class="type">long</span> base;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">transient</span> <span class="keyword">volatile</span> <span class="type">int</span> cellsBusy;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Striped64() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">casBase</span><span class="params">(<span class="type">long</span> cmp, <span class="type">long</span> val)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> UNSAFE.compareAndSwapLong(<span class="built_in">this</span>, BASE, cmp, val);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">casCellsBusy</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> UNSAFE.compareAndSwapInt(<span class="built_in">this</span>, CELLSBUSY, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getProbe</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> UNSAFE.getInt(Thread.currentThread(), PROBE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">advanceProbe</span><span class="params">(<span class="type">int</span> probe)</span> &#123;</span><br><span class="line">        probe ^= probe &lt;&lt; <span class="number">13</span>;   <span class="comment">// xorshift</span></span><br><span class="line">        probe ^= probe &gt;&gt;&gt; <span class="number">17</span>;</span><br><span class="line">        probe ^= probe &lt;&lt; <span class="number">5</span>;</span><br><span class="line">        UNSAFE.putInt(Thread.currentThread(), PROBE, probe);</span><br><span class="line">        <span class="keyword">return</span> probe;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">longAccumulate</span><span class="params">(<span class="type">long</span> x, LongBinaryOperator fn,</span></span><br><span class="line"><span class="params">                              <span class="type">boolean</span> wasUncontended)</span> &#123;</span><br><span class="line">        <span class="type">int</span> h;</span><br><span class="line">        <span class="keyword">if</span> ((h = getProbe()) == <span class="number">0</span>) &#123;</span><br><span class="line">            ThreadLocalRandom.current(); <span class="comment">// force initialization</span></span><br><span class="line">            h = getProbe();</span><br><span class="line">            wasUncontended = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">collide</span> <span class="operator">=</span> <span class="literal">false</span>;                <span class="comment">// True if last slot nonempty</span></span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            Cell[] as; Cell a; <span class="type">int</span> n; <span class="type">long</span> v;</span><br><span class="line">            <span class="keyword">if</span> ((as = cells) != <span class="literal">null</span> &amp;&amp; (n = as.length) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((a = as[(n - <span class="number">1</span>) &amp; h]) == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (cellsBusy == <span class="number">0</span>) &#123;       <span class="comment">// Try to attach new Cell</span></span><br><span class="line">                        <span class="type">Cell</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cell</span>(x);   <span class="comment">// Optimistically create</span></span><br><span class="line">                        <span class="keyword">if</span> (cellsBusy == <span class="number">0</span> &amp;&amp; casCellsBusy()) &#123;</span><br><span class="line">                            <span class="type">boolean</span> <span class="variable">created</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">                            <span class="keyword">try</span> &#123;               <span class="comment">// Recheck under lock</span></span><br><span class="line">                                Cell[] rs; <span class="type">int</span> m, j;</span><br><span class="line">                                <span class="keyword">if</span> ((rs = cells) != <span class="literal">null</span> &amp;&amp;</span><br><span class="line">                                    (m = rs.length) &gt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">                                    rs[j = (m - <span class="number">1</span>) &amp; h] == <span class="literal">null</span>) &#123;</span><br><span class="line">                                    rs[j] = r;</span><br><span class="line">                                    created = <span class="literal">true</span>;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                                cellsBusy = <span class="number">0</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">if</span> (created)</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            <span class="keyword">continue</span>;           <span class="comment">// Slot is now non-empty</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    collide = <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (!wasUncontended)       <span class="comment">// CAS already known to fail</span></span><br><span class="line">                    wasUncontended = <span class="literal">true</span>;      <span class="comment">// Continue after rehash</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (a.cas(v = a.value, ((fn == <span class="literal">null</span>) ? v + x :</span><br><span class="line">                                             fn.applyAsLong(v, x))))</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (n &gt;= NCPU || cells != as)</span><br><span class="line">                    collide = <span class="literal">false</span>;            <span class="comment">// At max size or stale</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (!collide)</span><br><span class="line">                    collide = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (cellsBusy == <span class="number">0</span> &amp;&amp; casCellsBusy()) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="keyword">if</span> (cells == as) &#123;      <span class="comment">// Expand table unless stale</span></span><br><span class="line">                            Cell[] rs = <span class="keyword">new</span> <span class="title class_">Cell</span>[n &lt;&lt; <span class="number">1</span>];</span><br><span class="line">                            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">                                rs[i] = as[i];</span><br><span class="line">                            cells = rs;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                        cellsBusy = <span class="number">0</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    collide = <span class="literal">false</span>;</span><br><span class="line">                    <span class="keyword">continue</span>;                   <span class="comment">// Retry with expanded table</span></span><br><span class="line">                &#125;</span><br><span class="line">                h = advanceProbe(h);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (cellsBusy == <span class="number">0</span> &amp;&amp; cells == as &amp;&amp; casCellsBusy()) &#123;</span><br><span class="line">                <span class="type">boolean</span> <span class="variable">init</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">try</span> &#123;                           <span class="comment">// Initialize table</span></span><br><span class="line">                    <span class="keyword">if</span> (cells == as) &#123;</span><br><span class="line">                        Cell[] rs = <span class="keyword">new</span> <span class="title class_">Cell</span>[<span class="number">2</span>];</span><br><span class="line">                        rs[h &amp; <span class="number">1</span>] = <span class="keyword">new</span> <span class="title class_">Cell</span>(x);</span><br><span class="line">                        cells = rs;</span><br><span class="line">                        init = <span class="literal">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    cellsBusy = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (init)</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (casBase(v = base, ((fn == <span class="literal">null</span>) ? v + x :</span><br><span class="line">                                        fn.applyAsLong(v, x))))</span><br><span class="line">                <span class="keyword">break</span>;                          <span class="comment">// Fall back on using base</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">doubleAccumulate</span><span class="params">(<span class="type">double</span> x, DoubleBinaryOperator fn,</span></span><br><span class="line"><span class="params">                                <span class="type">boolean</span> wasUncontended)</span> &#123;</span><br><span class="line">        <span class="type">int</span> h;</span><br><span class="line">        <span class="keyword">if</span> ((h = getProbe()) == <span class="number">0</span>) &#123;</span><br><span class="line">            ThreadLocalRandom.current(); <span class="comment">// force initialization</span></span><br><span class="line">            h = getProbe();</span><br><span class="line">            wasUncontended = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">collide</span> <span class="operator">=</span> <span class="literal">false</span>;                <span class="comment">// True if last slot nonempty</span></span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            Cell[] as; Cell a; <span class="type">int</span> n; <span class="type">long</span> v;</span><br><span class="line">            <span class="keyword">if</span> ((as = cells) != <span class="literal">null</span> &amp;&amp; (n = as.length) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((a = as[(n - <span class="number">1</span>) &amp; h]) == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (cellsBusy == <span class="number">0</span>) &#123;       <span class="comment">// Try to attach new Cell</span></span><br><span class="line">                        <span class="type">Cell</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cell</span>(Double.doubleToRawLongBits(x));</span><br><span class="line">                        <span class="keyword">if</span> (cellsBusy == <span class="number">0</span> &amp;&amp; casCellsBusy()) &#123;</span><br><span class="line">                            <span class="type">boolean</span> <span class="variable">created</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">                            <span class="keyword">try</span> &#123;               <span class="comment">// Recheck under lock</span></span><br><span class="line">                                Cell[] rs; <span class="type">int</span> m, j;</span><br><span class="line">                                <span class="keyword">if</span> ((rs = cells) != <span class="literal">null</span> &amp;&amp;</span><br><span class="line">                                    (m = rs.length) &gt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">                                    rs[j = (m - <span class="number">1</span>) &amp; h] == <span class="literal">null</span>) &#123;</span><br><span class="line">                                    rs[j] = r;</span><br><span class="line">                                    created = <span class="literal">true</span>;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                                cellsBusy = <span class="number">0</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">if</span> (created)</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            <span class="keyword">continue</span>;           <span class="comment">// Slot is now non-empty</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    collide = <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (!wasUncontended)       <span class="comment">// CAS already known to fail</span></span><br><span class="line">                    wasUncontended = <span class="literal">true</span>;      <span class="comment">// Continue after rehash</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (a.cas(v = a.value,</span><br><span class="line">                               ((fn == <span class="literal">null</span>) ?</span><br><span class="line">                                Double.doubleToRawLongBits</span><br><span class="line">                                (Double.longBitsToDouble(v) + x) :</span><br><span class="line">                                Double.doubleToRawLongBits</span><br><span class="line">                                (fn.applyAsDouble</span><br><span class="line">                                 (Double.longBitsToDouble(v), x)))))</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (n &gt;= NCPU || cells != as)</span><br><span class="line">                    collide = <span class="literal">false</span>;            <span class="comment">// At max size or stale</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (!collide)</span><br><span class="line">                    collide = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (cellsBusy == <span class="number">0</span> &amp;&amp; casCellsBusy()) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="keyword">if</span> (cells == as) &#123;      <span class="comment">// Expand table unless stale</span></span><br><span class="line">                            Cell[] rs = <span class="keyword">new</span> <span class="title class_">Cell</span>[n &lt;&lt; <span class="number">1</span>];</span><br><span class="line">                            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">                                rs[i] = as[i];</span><br><span class="line">                            cells = rs;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                        cellsBusy = <span class="number">0</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    collide = <span class="literal">false</span>;</span><br><span class="line">                    <span class="keyword">continue</span>;                   <span class="comment">// Retry with expanded table</span></span><br><span class="line">                &#125;</span><br><span class="line">                h = advanceProbe(h);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (cellsBusy == <span class="number">0</span> &amp;&amp; cells == as &amp;&amp; casCellsBusy()) &#123;</span><br><span class="line">                <span class="type">boolean</span> <span class="variable">init</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">try</span> &#123;                           <span class="comment">// Initialize table</span></span><br><span class="line">                    <span class="keyword">if</span> (cells == as) &#123;</span><br><span class="line">                        Cell[] rs = <span class="keyword">new</span> <span class="title class_">Cell</span>[<span class="number">2</span>];</span><br><span class="line">                        rs[h &amp; <span class="number">1</span>] = <span class="keyword">new</span> <span class="title class_">Cell</span>(Double.doubleToRawLongBits(x));</span><br><span class="line">                        cells = rs;</span><br><span class="line">                        init = <span class="literal">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    cellsBusy = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (init)</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (casBase(v = base,</span><br><span class="line">                             ((fn == <span class="literal">null</span>) ?</span><br><span class="line">                              Double.doubleToRawLongBits</span><br><span class="line">                              (Double.longBitsToDouble(v) + x) :</span><br><span class="line">                              Double.doubleToRawLongBits</span><br><span class="line">                              (fn.applyAsDouble</span><br><span class="line">                               (Double.longBitsToDouble(v), x)))))</span><br><span class="line">                <span class="keyword">break</span>;                          <span class="comment">// Fall back on using base</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Unsafe mechanics</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> sun.misc.Unsafe UNSAFE;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> BASE;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> CELLSBUSY;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> PROBE;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            UNSAFE = sun.misc.Unsafe.getUnsafe();</span><br><span class="line">            Class&lt;?&gt; sk = Striped64.class;</span><br><span class="line">            BASE = UNSAFE.objectFieldOffset</span><br><span class="line">                (sk.getDeclaredField(<span class="string">&quot;base&quot;</span>));</span><br><span class="line">            CELLSBUSY = UNSAFE.objectFieldOffset</span><br><span class="line">                (sk.getDeclaredField(<span class="string">&quot;cellsBusy&quot;</span>));</span><br><span class="line">            Class&lt;?&gt; tk = Thread.class;</span><br><span class="line">            PROBE = UNSAFE.objectFieldOffset</span><br><span class="line">                (tk.getDeclaredField(<span class="string">&quot;threadLocalRandomProbe&quot;</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>



<p>我们主要要看他的子类，以下四个子类都是基于Striped64实现的分治思想</p>

        <h3 id="LongAdder"   >
          <a href="#LongAdder" class="heading-link"><i class="fas fa-link"></i></a><a href="#LongAdder" class="headerlink" title="LongAdder"></a>LongAdder</h3>
      <p><strong>源码</strong></p>

        <h4 id="成员变量以及内部类-3"   >
          <a href="#成员变量以及内部类-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#成员变量以及内部类-3" class="headerlink" title="成员变量以及内部类"></a>成员变量以及内部类</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">7249069246863182397L</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">SerializationProxy</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">7249069246863182397L</span>;</span><br><span class="line"></span><br><span class="line">       </span><br><span class="line">     	<span class="comment">//value为当前值总和</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> value;</span><br><span class="line"></span><br><span class="line">        SerializationProxy(LongAdder a) &#123;</span><br><span class="line">            value = a.sum();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//返回一个LongAdder对象，基础value为当前代理状态</span></span><br><span class="line">        <span class="keyword">private</span> Object <span class="title function_">readResolve</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="type">LongAdder</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LongAdder</span>();</span><br><span class="line">            a.base = value;</span><br><span class="line">            <span class="keyword">return</span> a;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>






        <h4 id="构造方法-12"   >
          <a href="#构造方法-12" class="heading-link"><i class="fas fa-link"></i></a><a href="#构造方法-12" class="headerlink" title="构造方法"></a>构造方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//空参构造，初始化构造一个sum为0的LongAdder对象</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">LongAdder</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>




        <h4 id="increment方法"   >
          <a href="#increment方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#increment方法" class="headerlink" title="increment方法"></a>increment方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//调用add方法，传入参数1L</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">()</span> &#123;</span><br><span class="line">        add(<span class="number">1L</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h4 id="decrement方法"   >
          <a href="#decrement方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#decrement方法" class="headerlink" title="decrement方法"></a>decrement方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//调用add方法，传入参数-1L</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">decrement</span><span class="params">()</span> &#123;</span><br><span class="line">        add(-<span class="number">1L</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>




        <h4 id="add方法"   >
          <a href="#add方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#add方法" class="headerlink" title="add方法"></a>add方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">long</span> x)</span> &#123;</span><br><span class="line">        Cell[] as; <span class="type">long</span> b, v; <span class="type">int</span> m; Cell a;</span><br><span class="line">    	<span class="comment">/**</span></span><br><span class="line"><span class="comment">    		进入if语句中的两个条件</span></span><br><span class="line"><span class="comment">    		1.当cells不为空，说明之前就初始化过cells数组，也即存在竞争</span></span><br><span class="line"><span class="comment">    		2.当cells为空，并且casBase失败，说明cells未被初始化但是cas直接更新Base失败，也即出现竞争</span></span><br><span class="line"><span class="comment">    		判断结束之后as=cells,b=base</span></span><br><span class="line"><span class="comment">    	*/</span></span><br><span class="line">        <span class="keyword">if</span> ((as = cells) != <span class="literal">null</span> || !casBase(b = base, b + x)) &#123;</span><br><span class="line">            <span class="comment">//竞争标志位，true为没有竞争，false为有竞争</span></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">uncontended</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">            	进入下方if语句的几个条件</span></span><br><span class="line"><span class="comment">            	1.当as==null，说明cells未被初始化</span></span><br><span class="line"><span class="comment">            	2.当as!=null但是as.length-1&lt;0 也即cells.length&lt;=0,也即cells没有完成初始化</span></span><br><span class="line"><span class="comment">           		3.当as.length&gt;0但是as[getProbe()&amp; m]==null，也即哈希值映射的cell为空</span></span><br><span class="line"><span class="comment">           		4.当Cell不为空，但是cas操作Cell失败</span></span><br><span class="line"><span class="comment">           		判断结束之后</span></span><br><span class="line"><span class="comment">           			1.当条件1进入之后as==null,则要对Cells数组初始化</span></span><br><span class="line"><span class="comment">           			2.当条件2进入之后m=as.length-1,并且要对Cells初始化</span></span><br><span class="line"><span class="comment">           			3.当条件3进入之后cell a= as[getProbe()&amp;m],对Cells哈希值对应的cell初始化</span></span><br><span class="line"><span class="comment">           			4.当条件4进入之后,uncontended=false，说明Cas失败</span></span><br><span class="line"><span class="comment">           			只有条件4进入的uncontended标志位false，说明有竞争</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">            <span class="keyword">if</span> (as == <span class="literal">null</span> || (m = as.length - <span class="number">1</span>) &lt; <span class="number">0</span> ||</span><br><span class="line">                (a = as[getProbe() &amp; m]) == <span class="literal">null</span> ||</span><br><span class="line">                !(uncontended = a.cas(v = a.value, v + x)))</span><br><span class="line">                </span><br><span class="line">                <span class="comment">//调用父类Striped64的longAccumulate方法</span></span><br><span class="line">                longAccumulate(x, <span class="literal">null</span>, uncontended);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//取得当前线程的标识符</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getProbe</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> UNSAFE.getInt(Thread.currentThread(), PROBE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//cas直接操作base</span></span><br><span class="line"><span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">casBase</span><span class="params">(<span class="type">long</span> cmp, <span class="type">long</span> val)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> UNSAFE.compareAndSwapLong(<span class="built_in">this</span>, BASE, cmp, val);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h4 id="sum方法"   >
          <a href="#sum方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#sum方法" class="headerlink" title="sum方法"></a>sum方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//返回数据总和 </span></span><br><span class="line"><span class="keyword">public</span> <span class="type">long</span> <span class="title function_">sum</span><span class="params">()</span> &#123;</span><br><span class="line">        Cell[] as = cells; Cell a;</span><br><span class="line">        <span class="type">long</span> <span class="variable">sum</span> <span class="operator">=</span> base;</span><br><span class="line">     	<span class="comment">//当cells不为空，则将sum+=每一个cell数值</span></span><br><span class="line">        <span class="keyword">if</span> (as != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; as.length; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((a = as[i]) != <span class="literal">null</span>)</span><br><span class="line">                    sum += a.value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>


        <h4 id="reset方法"   >
          <a href="#reset方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#reset方法" class="headerlink" title="reset方法"></a>reset方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//清空数据</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reset</span><span class="params">()</span> &#123;</span><br><span class="line">        Cell[] as = cells; Cell a;</span><br><span class="line">        base = <span class="number">0L</span>;</span><br><span class="line">    	<span class="comment">//当cells不为空</span></span><br><span class="line">        <span class="keyword">if</span> (as != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; as.length; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((a = as[i]) != <span class="literal">null</span>)</span><br><span class="line">                    a.value = <span class="number">0L</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>

<p><strong>完整代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LongAdder</span> <span class="keyword">extends</span> <span class="title class_">Striped64</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">7249069246863182397L</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LongAdder</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">long</span> x)</span> &#123;</span><br><span class="line">        Cell[] as; <span class="type">long</span> b, v; <span class="type">int</span> m; Cell a;</span><br><span class="line">        <span class="keyword">if</span> ((as = cells) != <span class="literal">null</span> || !casBase(b = base, b + x)) &#123;</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">uncontended</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (as == <span class="literal">null</span> || (m = as.length - <span class="number">1</span>) &lt; <span class="number">0</span> ||</span><br><span class="line">                (a = as[getProbe() &amp; m]) == <span class="literal">null</span> ||</span><br><span class="line">                !(uncontended = a.cas(v = a.value, v + x)))</span><br><span class="line">                longAccumulate(x, <span class="literal">null</span>, uncontended);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">()</span> &#123;</span><br><span class="line">        add(<span class="number">1L</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">decrement</span><span class="params">()</span> &#123;</span><br><span class="line">        add(-<span class="number">1L</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">sum</span><span class="params">()</span> &#123;</span><br><span class="line">        Cell[] as = cells; Cell a;</span><br><span class="line">        <span class="type">long</span> <span class="variable">sum</span> <span class="operator">=</span> base;</span><br><span class="line">        <span class="keyword">if</span> (as != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; as.length; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((a = as[i]) != <span class="literal">null</span>)</span><br><span class="line">                    sum += a.value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reset</span><span class="params">()</span> &#123;</span><br><span class="line">        Cell[] as = cells; Cell a;</span><br><span class="line">        base = <span class="number">0L</span>;</span><br><span class="line">        <span class="keyword">if</span> (as != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; as.length; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((a = as[i]) != <span class="literal">null</span>)</span><br><span class="line">                    a.value = <span class="number">0L</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">sumThenReset</span><span class="params">()</span> &#123;</span><br><span class="line">        Cell[] as = cells; Cell a;</span><br><span class="line">        <span class="type">long</span> <span class="variable">sum</span> <span class="operator">=</span> base;</span><br><span class="line">        base = <span class="number">0L</span>;</span><br><span class="line">        <span class="keyword">if</span> (as != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; as.length; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((a = as[i]) != <span class="literal">null</span>) &#123;</span><br><span class="line">                    sum += a.value;</span><br><span class="line">                    a.value = <span class="number">0L</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Long.toString(sum());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">longValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> sum();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">intValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">int</span>)sum();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">float</span> <span class="title function_">floatValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">float</span>)sum();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">doubleValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">double</span>)sum();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">SerializationProxy</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">7249069246863182397L</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> value;</span><br><span class="line"></span><br><span class="line">        SerializationProxy(LongAdder a) &#123;</span><br><span class="line">            value = a.sum();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">        <span class="keyword">private</span> Object <span class="title function_">readResolve</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="type">LongAdder</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LongAdder</span>();</span><br><span class="line">            a.base = value;</span><br><span class="line">            <span class="keyword">return</span> a;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Object <span class="title function_">writeReplace</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SerializationProxy</span>(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(java.io.ObjectInputStream s)</span></span><br><span class="line">        <span class="keyword">throws</span> java.io.InvalidObjectException &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">java</span>.io.InvalidObjectException(<span class="string">&quot;Proxy required&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>


        <h3 id="LongAccumulator"   >
          <a href="#LongAccumulator" class="heading-link"><i class="fas fa-link"></i></a><a href="#LongAccumulator" class="headerlink" title="LongAccumulator"></a>LongAccumulator</h3>
      <p><strong>源码</strong></p>
<p>为了解决LongAdder只能做加法，而不能做其他运算，所以引入了LongAccumulator，传入指定的函数接口，于是可以完成对具体函数的实现</p>

        <h4 id="成员变量以及内部类-4"   >
          <a href="#成员变量以及内部类-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#成员变量以及内部类-4" class="headerlink" title="成员变量以及内部类"></a>成员变量以及内部类</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">7249069246863182397L</span>;</span><br><span class="line"><span class="comment">//操作函数</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> LongBinaryOperator function;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> identity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">SerializationProxy</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">7249069246863182397L</span>;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> value;</span><br><span class="line">       </span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">final</span> LongBinaryOperator function;</span><br><span class="line">       </span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> identity;</span><br><span class="line"></span><br><span class="line">       SerializationProxy(LongAccumulator a) &#123;</span><br><span class="line">           function = a.function;</span><br><span class="line">           identity = a.identity;</span><br><span class="line">           value = a.get();</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">private</span> Object <span class="title function_">readResolve</span><span class="params">()</span> &#123;</span><br><span class="line">           <span class="type">LongAccumulator</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LongAccumulator</span>(function, identity);</span><br><span class="line">           a.base = value;</span><br><span class="line">           <span class="keyword">return</span> a;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></div></figure>


        <h4 id="accumulate方法"   >
          <a href="#accumulate方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#accumulate方法" class="headerlink" title="accumulate方法"></a>accumulate方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accumulate</span><span class="params">(<span class="type">long</span> x)</span> &#123;</span><br><span class="line">       Cell[] as; <span class="type">long</span> b, v, r; <span class="type">int</span> m; Cell a;</span><br><span class="line">       <span class="keyword">if</span> ((as = cells) != <span class="literal">null</span> ||</span><br><span class="line">           (r = function.applyAsLong(b = base, x)) != b &amp;&amp; !casBase(b, r)) &#123;</span><br><span class="line">           <span class="type">boolean</span> <span class="variable">uncontended</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">           <span class="keyword">if</span> (as == <span class="literal">null</span> || (m = as.length - <span class="number">1</span>) &lt; <span class="number">0</span> ||</span><br><span class="line">               (a = as[getProbe() &amp; m]) == <span class="literal">null</span> ||</span><br><span class="line">               !(uncontended =</span><br><span class="line">                 (r = function.applyAsLong(v = a.value, x)) == v ||</span><br><span class="line">                 a.cas(v, r)))</span><br><span class="line">               </span><br><span class="line">               <span class="comment">//说明有竞争，进入父类的竞争处理函数</span></span><br><span class="line">               longAccumulate(x, function, uncontended);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></div></figure>

<p>这部分逻辑和LongAdder逻辑一样，只不过是从加法变成了自己传入的函数接口</p>

        <h4 id="构造方法-13"   >
          <a href="#构造方法-13" class="heading-link"><i class="fas fa-link"></i></a><a href="#构造方法-13" class="headerlink" title="构造方法"></a>构造方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//传入函数以及累加器中的初始化值</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">LongAccumulator</span><span class="params">(LongBinaryOperator accumulatorFunction,</span></span><br><span class="line"><span class="params">                           <span class="type">long</span> identity)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.function = accumulatorFunction;</span><br><span class="line">     	<span class="comment">//初始化值</span></span><br><span class="line">    	base = <span class="built_in">this</span>.identity = identity;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>




        <h4 id="get方法-12"   >
          <a href="#get方法-12" class="heading-link"><i class="fas fa-link"></i></a><a href="#get方法-12" class="headerlink" title="get方法"></a>get方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//返回数据总和</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">long</span> <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">        Cell[] as = cells; Cell a;</span><br><span class="line">        <span class="type">long</span> <span class="variable">result</span> <span class="operator">=</span> base;</span><br><span class="line">     	<span class="comment">//当cells不为空</span></span><br><span class="line">    	<span class="keyword">if</span> (as != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; as.length; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((a = as[i]) != <span class="literal">null</span>)</span><br><span class="line">                    result = function.applyAsLong(result, a.value);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h4 id="reset方法-1"   >
          <a href="#reset方法-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#reset方法-1" class="headerlink" title="reset方法"></a>reset方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//重新初始化数据</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reset</span><span class="params">()</span> &#123;</span><br><span class="line">        Cell[] as = cells; Cell a;</span><br><span class="line">        base = identity;</span><br><span class="line">        <span class="keyword">if</span> (as != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; as.length; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((a = as[i]) != <span class="literal">null</span>)</span><br><span class="line">                    a.value = identity;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>

<p><strong>完整代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LongAccumulator</span> <span class="keyword">extends</span> <span class="title class_">Striped64</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">7249069246863182397L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> LongBinaryOperator function;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> identity;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LongAccumulator</span><span class="params">(LongBinaryOperator accumulatorFunction,</span></span><br><span class="line"><span class="params">                           <span class="type">long</span> identity)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.function = accumulatorFunction;</span><br><span class="line">        base = <span class="built_in">this</span>.identity = identity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accumulate</span><span class="params">(<span class="type">long</span> x)</span> &#123;</span><br><span class="line">        Cell[] as; <span class="type">long</span> b, v, r; <span class="type">int</span> m; Cell a;</span><br><span class="line">        <span class="keyword">if</span> ((as = cells) != <span class="literal">null</span> ||</span><br><span class="line">            (r = function.applyAsLong(b = base, x)) != b &amp;&amp; !casBase(b, r)) &#123;</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">uncontended</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (as == <span class="literal">null</span> || (m = as.length - <span class="number">1</span>) &lt; <span class="number">0</span> ||</span><br><span class="line">                (a = as[getProbe() &amp; m]) == <span class="literal">null</span> ||</span><br><span class="line">                !(uncontended =</span><br><span class="line">                  (r = function.applyAsLong(v = a.value, x)) == v ||</span><br><span class="line">                  a.cas(v, r)))</span><br><span class="line">                longAccumulate(x, function, uncontended);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">        Cell[] as = cells; Cell a;</span><br><span class="line">        <span class="type">long</span> <span class="variable">result</span> <span class="operator">=</span> base;</span><br><span class="line">        <span class="keyword">if</span> (as != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; as.length; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((a = as[i]) != <span class="literal">null</span>)</span><br><span class="line">                    result = function.applyAsLong(result, a.value);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reset</span><span class="params">()</span> &#123;</span><br><span class="line">        Cell[] as = cells; Cell a;</span><br><span class="line">        base = identity;</span><br><span class="line">        <span class="keyword">if</span> (as != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; as.length; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((a = as[i]) != <span class="literal">null</span>)</span><br><span class="line">                    a.value = identity;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getThenReset</span><span class="params">()</span> &#123;</span><br><span class="line">        Cell[] as = cells; Cell a;</span><br><span class="line">        <span class="type">long</span> <span class="variable">result</span> <span class="operator">=</span> base;</span><br><span class="line">        base = identity;</span><br><span class="line">        <span class="keyword">if</span> (as != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; as.length; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((a = as[i]) != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="type">long</span> <span class="variable">v</span> <span class="operator">=</span> a.value;</span><br><span class="line">                    a.value = identity;</span><br><span class="line">                    result = function.applyAsLong(result, v);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Long.toString(get());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">longValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">intValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">int</span>)get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">float</span> <span class="title function_">floatValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">float</span>)get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">doubleValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">double</span>)get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">SerializationProxy</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">7249069246863182397L</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> value;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> LongBinaryOperator function;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> identity;</span><br><span class="line"></span><br><span class="line">        SerializationProxy(LongAccumulator a) &#123;</span><br><span class="line">            function = a.function;</span><br><span class="line">            identity = a.identity;</span><br><span class="line">            value = a.get();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> Object <span class="title function_">readResolve</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="type">LongAccumulator</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LongAccumulator</span>(function, identity);</span><br><span class="line">            a.base = value;</span><br><span class="line">            <span class="keyword">return</span> a;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Object <span class="title function_">writeReplace</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SerializationProxy</span>(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(java.io.ObjectInputStream s)</span></span><br><span class="line">        <span class="keyword">throws</span> java.io.InvalidObjectException &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">java</span>.io.InvalidObjectException(<span class="string">&quot;Proxy required&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>




        <h3 id="DoubleAdder"   >
          <a href="#DoubleAdder" class="heading-link"><i class="fas fa-link"></i></a><a href="#DoubleAdder" class="headerlink" title="DoubleAdder"></a>DoubleAdder</h3>
      <p><strong>源码</strong></p>

        <h4 id="成员变量以及内部类-5"   >
          <a href="#成员变量以及内部类-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#成员变量以及内部类-5" class="headerlink" title="成员变量以及内部类"></a>成员变量以及内部类</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">7249069246863182397L</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">SerializationProxy</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">7249069246863182397L</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">double</span> value;</span><br><span class="line"></span><br><span class="line">        SerializationProxy(DoubleAdder a) &#123;</span><br><span class="line">            value = a.sum();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> Object <span class="title function_">readResolve</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="type">DoubleAdder</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DoubleAdder</span>();</span><br><span class="line">            a.base = Double.doubleToRawLongBits(value);</span><br><span class="line">            <span class="keyword">return</span> a;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>




        <h4 id="构造方法-14"   >
          <a href="#构造方法-14" class="heading-link"><i class="fas fa-link"></i></a><a href="#构造方法-14" class="headerlink" title="构造方法"></a>构造方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//无参构造，sum=0</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">DoubleAdder</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h4 id="add方法-1"   >
          <a href="#add方法-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#add方法-1" class="headerlink" title="add方法"></a>add方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">double</span> x)</span> &#123;</span><br><span class="line">        Cell[] as; <span class="type">long</span> b, v; <span class="type">int</span> m; Cell a;</span><br><span class="line">        <span class="keyword">if</span> ((as = cells) != <span class="literal">null</span> ||</span><br><span class="line">            !casBase(b = base,</span><br><span class="line">                     Double.doubleToRawLongBits</span><br><span class="line">                     (Double.longBitsToDouble(b) + x))) &#123;</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">uncontended</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (as == <span class="literal">null</span> || (m = as.length - <span class="number">1</span>) &lt; <span class="number">0</span> ||</span><br><span class="line">                (a = as[getProbe() &amp; m]) == <span class="literal">null</span> ||</span><br><span class="line">                !(uncontended = a.cas(v = a.value,</span><br><span class="line">                                      Double.doubleToRawLongBits</span><br><span class="line">                                      (Double.longBitsToDouble(v) + x))))</span><br><span class="line">       			<span class="comment">//进入父类的处理竞争</span></span><br><span class="line">                doubleAccumulate(x, <span class="literal">null</span>, uncontended);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>


        <h4 id="sum方法-1"   >
          <a href="#sum方法-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#sum方法-1" class="headerlink" title="sum方法"></a>sum方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//返回总和</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">double</span> <span class="title function_">sum</span><span class="params">()</span> &#123;</span><br><span class="line">    Cell[] as = cells; Cell a;</span><br><span class="line">    <span class="type">double</span> <span class="variable">sum</span> <span class="operator">=</span> Double.longBitsToDouble(base);</span><br><span class="line">    <span class="keyword">if</span> (as != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; as.length; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((a = as[i]) != <span class="literal">null</span>)</span><br><span class="line">                sum += Double.longBitsToDouble(a.value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h4 id="reset方法-2"   >
          <a href="#reset方法-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#reset方法-2" class="headerlink" title="reset方法"></a>reset方法</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//清零</span><br><span class="line">public void reset() &#123;</span><br><span class="line">    Cell[] as = cells; Cell a;</span><br><span class="line">    base = 0L; // relies on fact that double 0 must have same rep as long</span><br><span class="line">    if (as != null) &#123;</span><br><span class="line">        for (int i = 0; i &lt; as.length; ++i) &#123;</span><br><span class="line">            if ((a = as[i]) != null)</span><br><span class="line">                a.value = 0L;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p><strong>完整代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DoubleAdder</span> <span class="keyword">extends</span> <span class="title class_">Striped64</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">7249069246863182397L</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DoubleAdder</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">double</span> x)</span> &#123;</span><br><span class="line">        Cell[] as; <span class="type">long</span> b, v; <span class="type">int</span> m; Cell a;</span><br><span class="line">        <span class="keyword">if</span> ((as = cells) != <span class="literal">null</span> ||</span><br><span class="line">            !casBase(b = base,</span><br><span class="line">                     Double.doubleToRawLongBits</span><br><span class="line">                     (Double.longBitsToDouble(b) + x))) &#123;</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">uncontended</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (as == <span class="literal">null</span> || (m = as.length - <span class="number">1</span>) &lt; <span class="number">0</span> ||</span><br><span class="line">                (a = as[getProbe() &amp; m]) == <span class="literal">null</span> ||</span><br><span class="line">                !(uncontended = a.cas(v = a.value,</span><br><span class="line">                                      Double.doubleToRawLongBits</span><br><span class="line">                                      (Double.longBitsToDouble(v) + x))))</span><br><span class="line">                doubleAccumulate(x, <span class="literal">null</span>, uncontended);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">sum</span><span class="params">()</span> &#123;</span><br><span class="line">        Cell[] as = cells; Cell a;</span><br><span class="line">        <span class="type">double</span> <span class="variable">sum</span> <span class="operator">=</span> Double.longBitsToDouble(base);</span><br><span class="line">        <span class="keyword">if</span> (as != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; as.length; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((a = as[i]) != <span class="literal">null</span>)</span><br><span class="line">                    sum += Double.longBitsToDouble(a.value);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reset</span><span class="params">()</span> &#123;</span><br><span class="line">        Cell[] as = cells; Cell a;</span><br><span class="line">        base = <span class="number">0L</span>; <span class="comment">// relies on fact that double 0 must have same rep as long</span></span><br><span class="line">        <span class="keyword">if</span> (as != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; as.length; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((a = as[i]) != <span class="literal">null</span>)</span><br><span class="line">                    a.value = <span class="number">0L</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">sumThenReset</span><span class="params">()</span> &#123;</span><br><span class="line">        Cell[] as = cells; Cell a;</span><br><span class="line">        <span class="type">double</span> <span class="variable">sum</span> <span class="operator">=</span> Double.longBitsToDouble(base);</span><br><span class="line">        base = <span class="number">0L</span>;</span><br><span class="line">        <span class="keyword">if</span> (as != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; as.length; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((a = as[i]) != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="type">long</span> <span class="variable">v</span> <span class="operator">=</span> a.value;</span><br><span class="line">                    a.value = <span class="number">0L</span>;</span><br><span class="line">                    sum += Double.longBitsToDouble(v);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Double.toString(sum());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">doubleValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> sum();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">longValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">long</span>)sum();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">intValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">int</span>)sum();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">float</span> <span class="title function_">floatValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">float</span>)sum();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">SerializationProxy</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">7249069246863182397L</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">double</span> value;</span><br><span class="line"></span><br><span class="line">        SerializationProxy(DoubleAdder a) &#123;</span><br><span class="line">            value = a.sum();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> Object <span class="title function_">readResolve</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="type">DoubleAdder</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DoubleAdder</span>();</span><br><span class="line">            a.base = Double.doubleToRawLongBits(value);</span><br><span class="line">            <span class="keyword">return</span> a;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Object <span class="title function_">writeReplace</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SerializationProxy</span>(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(java.io.ObjectInputStream s)</span></span><br><span class="line">        <span class="keyword">throws</span> java.io.InvalidObjectException &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">java</span>.io.InvalidObjectException(<span class="string">&quot;Proxy required&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>


        <h3 id="DoubleAccumulator"   >
          <a href="#DoubleAccumulator" class="heading-link"><i class="fas fa-link"></i></a><a href="#DoubleAccumulator" class="headerlink" title="DoubleAccumulator"></a>DoubleAccumulator</h3>
      <p><strong>源码</strong></p>

        <h4 id="成员变量以及内部类-6"   >
          <a href="#成员变量以及内部类-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#成员变量以及内部类-6" class="headerlink" title="成员变量以及内部类"></a>成员变量以及内部类</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">7249069246863182397L</span>;</span><br><span class="line"><span class="comment">//传入实现函</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> DoubleBinaryOperator function;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> identity; <span class="comment">// use long representation</span></span><br><span class="line">   </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">SerializationProxy</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">7249069246863182397L</span>;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">double</span> value;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">final</span> DoubleBinaryOperator function;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> identity;</span><br><span class="line"></span><br><span class="line">       SerializationProxy(DoubleAccumulator a) &#123;</span><br><span class="line">           function = a.function;</span><br><span class="line">           identity = a.identity;</span><br><span class="line">           value = a.get();</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">     </span><br><span class="line">       <span class="keyword">private</span> Object <span class="title function_">readResolve</span><span class="params">()</span> &#123;</span><br><span class="line">           <span class="type">double</span> <span class="variable">d</span> <span class="operator">=</span> Double.longBitsToDouble(identity);</span><br><span class="line">           <span class="type">DoubleAccumulator</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DoubleAccumulator</span>(function, d);</span><br><span class="line">           a.base = Double.doubleToRawLongBits(value);</span><br><span class="line">           <span class="keyword">return</span> a;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></div></figure>


        <h4 id="构造方法-15"   >
          <a href="#构造方法-15" class="heading-link"><i class="fas fa-link"></i></a><a href="#构造方法-15" class="headerlink" title="构造方法"></a>构造方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//传入需要操作函数以及累加器初始化值 </span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">DoubleAccumulator</span><span class="params">(DoubleBinaryOperator accumulatorFunction,</span></span><br><span class="line"><span class="params">                             <span class="type">double</span> identity)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.function = accumulatorFunction;</span><br><span class="line">        base = <span class="built_in">this</span>.identity = Double.doubleToRawLongBits(identity);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>




        <h4 id="accumulate方法-1"   >
          <a href="#accumulate方法-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#accumulate方法-1" class="headerlink" title="accumulate方法"></a>accumulate方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accumulate</span><span class="params">(<span class="type">double</span> x)</span> &#123;</span><br><span class="line">       Cell[] as; <span class="type">long</span> b, v, r; <span class="type">int</span> m; Cell a;</span><br><span class="line">       <span class="keyword">if</span> ((as = cells) != <span class="literal">null</span> ||</span><br><span class="line">           (r = Double.doubleToRawLongBits</span><br><span class="line">            (function.applyAsDouble</span><br><span class="line">             (Double.longBitsToDouble(b = base), x))) != b  &amp;&amp; !casBase(b, r)) &#123;</span><br><span class="line">           <span class="type">boolean</span> <span class="variable">uncontended</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">           <span class="keyword">if</span> (as == <span class="literal">null</span> || (m = as.length - <span class="number">1</span>) &lt; <span class="number">0</span> ||</span><br><span class="line">               (a = as[getProbe() &amp; m]) == <span class="literal">null</span> ||</span><br><span class="line">               !(uncontended =</span><br><span class="line">                 (r = Double.doubleToRawLongBits</span><br><span class="line">                  (function.applyAsDouble</span><br><span class="line">                   (Double.longBitsToDouble(v = a.value), x))) == v ||</span><br><span class="line">                 a.cas(v, r)))</span><br><span class="line">               <span class="comment">//进入父类处理竞争函数</span></span><br><span class="line">               doubleAccumulate(x, function, uncontended);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>


        <h4 id="get方法-13"   >
          <a href="#get方法-13" class="heading-link"><i class="fas fa-link"></i></a><a href="#get方法-13" class="headerlink" title="get方法"></a>get方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取总和</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">double</span> <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">       Cell[] as = cells; Cell a;</span><br><span class="line">       <span class="type">double</span> <span class="variable">result</span> <span class="operator">=</span> Double.longBitsToDouble(base);</span><br><span class="line">       <span class="keyword">if</span> (as != <span class="literal">null</span>) &#123;</span><br><span class="line">           <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; as.length; ++i) &#123;</span><br><span class="line">               <span class="keyword">if</span> ((a = as[i]) != <span class="literal">null</span>)</span><br><span class="line">                   result = function.applyAsDouble</span><br><span class="line">                       (result, Double.longBitsToDouble(a.value));</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> result;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></div></figure>


        <h4 id="reset方法-3"   >
          <a href="#reset方法-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#reset方法-3" class="headerlink" title="reset方法"></a>reset方法</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reset</span><span class="params">()</span> &#123;</span><br><span class="line">        Cell[] as = cells; Cell a;</span><br><span class="line">        base = identity;</span><br><span class="line">        <span class="keyword">if</span> (as != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; as.length; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((a = as[i]) != <span class="literal">null</span>)</span><br><span class="line">                    a.value = identity;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>

<p><strong>完整代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DoubleAccumulator</span> <span class="keyword">extends</span> <span class="title class_">Striped64</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">7249069246863182397L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> DoubleBinaryOperator function;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> identity; <span class="comment">// use long representation</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DoubleAccumulator</span><span class="params">(DoubleBinaryOperator accumulatorFunction,</span></span><br><span class="line"><span class="params">                             <span class="type">double</span> identity)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.function = accumulatorFunction;</span><br><span class="line">        base = <span class="built_in">this</span>.identity = Double.doubleToRawLongBits(identity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accumulate</span><span class="params">(<span class="type">double</span> x)</span> &#123;</span><br><span class="line">        Cell[] as; <span class="type">long</span> b, v, r; <span class="type">int</span> m; Cell a;</span><br><span class="line">        <span class="keyword">if</span> ((as = cells) != <span class="literal">null</span> ||</span><br><span class="line">            (r = Double.doubleToRawLongBits</span><br><span class="line">             (function.applyAsDouble</span><br><span class="line">              (Double.longBitsToDouble(b = base), x))) != b  &amp;&amp; !casBase(b, r)) &#123;</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">uncontended</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (as == <span class="literal">null</span> || (m = as.length - <span class="number">1</span>) &lt; <span class="number">0</span> ||</span><br><span class="line">                (a = as[getProbe() &amp; m]) == <span class="literal">null</span> ||</span><br><span class="line">                !(uncontended =</span><br><span class="line">                  (r = Double.doubleToRawLongBits</span><br><span class="line">                   (function.applyAsDouble</span><br><span class="line">                    (Double.longBitsToDouble(v = a.value), x))) == v ||</span><br><span class="line">                  a.cas(v, r)))</span><br><span class="line">                doubleAccumulate(x, function, uncontended);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">        Cell[] as = cells; Cell a;</span><br><span class="line">        <span class="type">double</span> <span class="variable">result</span> <span class="operator">=</span> Double.longBitsToDouble(base);</span><br><span class="line">        <span class="keyword">if</span> (as != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; as.length; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((a = as[i]) != <span class="literal">null</span>)</span><br><span class="line">                    result = function.applyAsDouble</span><br><span class="line">                        (result, Double.longBitsToDouble(a.value));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reset</span><span class="params">()</span> &#123;</span><br><span class="line">        Cell[] as = cells; Cell a;</span><br><span class="line">        base = identity;</span><br><span class="line">        <span class="keyword">if</span> (as != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; as.length; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((a = as[i]) != <span class="literal">null</span>)</span><br><span class="line">                    a.value = identity;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getThenReset</span><span class="params">()</span> &#123;</span><br><span class="line">        Cell[] as = cells; Cell a;</span><br><span class="line">        <span class="type">double</span> <span class="variable">result</span> <span class="operator">=</span> Double.longBitsToDouble(base);</span><br><span class="line">        base = identity;</span><br><span class="line">        <span class="keyword">if</span> (as != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; as.length; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((a = as[i]) != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="type">double</span> <span class="variable">v</span> <span class="operator">=</span> Double.longBitsToDouble(a.value);</span><br><span class="line">                    a.value = identity;</span><br><span class="line">                    result = function.applyAsDouble(result, v);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Double.toString(get());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">doubleValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">longValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">long</span>)get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">intValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">int</span>)get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">float</span> <span class="title function_">floatValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">float</span>)get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">SerializationProxy</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">7249069246863182397L</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">double</span> value;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> DoubleBinaryOperator function;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> identity;</span><br><span class="line"></span><br><span class="line">        SerializationProxy(DoubleAccumulator a) &#123;</span><br><span class="line">            function = a.function;</span><br><span class="line">            identity = a.identity;</span><br><span class="line">            value = a.get();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> Object <span class="title function_">readResolve</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="type">double</span> <span class="variable">d</span> <span class="operator">=</span> Double.longBitsToDouble(identity);</span><br><span class="line">            <span class="type">DoubleAccumulator</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DoubleAccumulator</span>(function, d);</span><br><span class="line">            a.base = Double.doubleToRawLongBits(value);</span><br><span class="line">            <span class="keyword">return</span> a;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Object <span class="title function_">writeReplace</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SerializationProxy</span>(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(java.io.ObjectInputStream s)</span></span><br><span class="line">        <span class="keyword">throws</span> java.io.InvalidObjectException &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">java</span>.io.InvalidObjectException(<span class="string">&quot;Proxy required&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h3 id="小结-5"   >
          <a href="#小结-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#小结-5" class="headerlink" title="小结"></a>小结</h3>
      <p>为了解决单个的原子操作类的<strong>高并发场景下的CAS+自旋</strong>导致性能降低，进而引进了基于分治思想的原子操作类</p>
<p><strong>实际上的实现逻辑</strong></p>
<p>一个cells数组，每一个线程当有竞争的情况下操作对应哈希值映射的cell对象，这样就能在高并发情况下分别操作不同数据</p>
<p>当最后需要统计数据 时候，将base加上所有cell的数据，也即总和sum&#x3D;base+每个cell的值</p>

        <h1 id="总结"   >
          <a href="#总结" class="heading-link"><i class="fas fa-link"></i></a><a href="#总结" class="headerlink" title="总结"></a>总结</h1>
      <p>当不想加锁但又想实现线程安全可以使用原子操作类，而原子操作类主要是通过Unsafe类的CAS机制+自旋实现数据更新操作</p>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="https://images-kkblog.oss-cn-hangzhou.aliyuncs.com/image-20230927101337126.png"  alt="Atomic实现逻辑">
      </p>
<p>当只能操作一个对象的时候引入了操作数组的对象</p>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="https://images-kkblog.oss-cn-hangzhou.aliyuncs.com/image-20230927101627193.png"  alt="Atomic数组">
      </p>
<p>同时对不同数据类型进行封装，有基本数据类型<strong>Integer,Double,Long</strong>也有引用数据类型<strong>Referenc</strong>e的实现</p>
<p>又因为ABA问题，引入了特殊标记原子操作类<strong>AtomicMarkableReference和AtomicStampedReference</strong>，通过AtomicStampedReference时间戳的标记可以解决<strong>CAS的ABA问题</strong></p>
<p>而在高并发的场景下，多个线程CAS操作一个变量，CAS失败的自旋会引起CPU的空转，导致性能的降低，于是基于分治思想引入了分治的Atomic原子操作类</p>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="https://images-kkblog.oss-cn-hangzhou.aliyuncs.com/image-20230927102402120.png"  alt="基于分治思想的原子操作类">
      </p>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2023/08/20/%E6%AD%BB%E4%B9%8B%E5%89%8D%E8%A6%81%E5%81%9A%E5%AE%8C%E7%9A%84%E7%AE%97%E6%B3%95%E6%89%8B%E5%86%8C-%5B5.%E6%A0%88%E5%92%8C%E9%98%9F%E5%88%97%5D/">死之前要做完的算法手册-[5.栈和队列]</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2023-08-20</span></span><span class="post-meta-item post-meta-item--wordcount"><span class="post-meta-item__icon"><i class="far fa-file-word"></i></span><span class="post-meta-item__info">字数统计</span><span class="post-meta-item__value">6k</span></span><span class="post-meta-item post-meta-item--readtime"><span class="post-meta-item__icon"><i class="far fa-clock"></i></span><span class="post-meta-item__info">阅读时长</span><span class="post-meta-item__value">48分</span></span></div></header><div class="post-body"><div class="post-excerpt"><p><strong>栈和队列基础知识</strong></p>
<p>栈：栈是一个先进后出的数据结构也即最后一个进来的数据第一个出去(LIFO)</p>
<p>如下图所示</p>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="https://images-kkblog.oss-cn-hangzhou.aliyuncs.com/image-20230821082237006.png"  alt="栈">
      </p>
<p>队列：队列是一个先进先出的数据结构也即第一个进来的数据第一个出去(FIFO)</p>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="https://images-kkblog.oss-cn-hangzhou.aliyuncs.com/image-20230821082527464.png"  alt="队列">
      </p>
<p>我们可以用你可以使用 list 或者 deque（双端队列）来模拟一个栈或者队列</p>

        <h1 id="用栈实现队列"   >
          <a href="#用栈实现队列" class="heading-link"><i class="fas fa-link"></i></a><a href="#用栈实现队列" class="headerlink" title="用栈实现队列"></a>用栈实现队列</h1>
      <p>请你仅使用两个栈实现先入先出队列。队列应当支持一般队列支持的所有操作（<code>push</code>、<code>pop</code>、<code>peek</code>、<code>empty</code>）：</p>
<p>实现 <code>MyQueue</code> 类：</p>
<ul>
<li><code>void push(int x)</code> 将元素 x 推到队列的末尾</li>
<li><code>int pop()</code> 从队列的开头移除并返回元素</li>
<li><code>int peek()</code> 返回队列开头的元素</li>
<li><code>boolean empty()</code> 如果队列为空，返回 <code>true</code> ；否则，返回 <code>false</code></li>
</ul>

        <h2 id="232-用栈实现队列"   >
          <a href="#232-用栈实现队列" class="heading-link"><i class="fas fa-link"></i></a><a href="#232-用栈实现队列" class="headerlink" title="232.用栈实现队列"></a>232.用栈实现队列</h2>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/implement-queue-using-stacks/" >Leetcode.232题(easy)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做"   >
          <a href="#第一次做" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;08&#x2F;21</p>

        <h4 id="第一次代码"   >
          <a href="#第一次代码" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyQueue</span> &#123;</span><br><span class="line">    <span class="comment">//栈</span></span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;Integer&gt; stack;</span><br><span class="line">    <span class="comment">//第二个栈用于模拟出队的转移数据的使用</span></span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;Integer&gt; removeStack;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyQueue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//初始化</span></span><br><span class="line">        stack=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        removeStack=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//入队</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">push</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">        stack.add(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//出队</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">pop</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=stack.size()-<span class="number">1</span>;i&gt;=<span class="number">1</span>;i--)&#123;</span><br><span class="line">            removeStack.add(stack.get(i));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> result=stack.get(<span class="number">0</span>);</span><br><span class="line">        stack.clear();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=removeStack.size()-<span class="number">1</span>;i&gt;=<span class="number">0</span>;i--)&#123;</span><br><span class="line">            stack.add(removeStack.get(i));</span><br><span class="line">        &#125;</span><br><span class="line">        removeStack.clear();</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//获取队首元素</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">peek</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> stack.get(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//检验队列是否为空</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">empty</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> stack.size()==<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功"   >
          <a href="#提交成功" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解"   >
          <a href="#题解" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解" class="headerlink" title="题解"></a>题解</h3>
      <p>在模拟出队的时候，对双栈的操作不一样会导致其他方法的不一样</p>
<p><strong>辅助栈(只在出队的时候使用)</strong></p>
<p>思路：一个栈stack就认为是队列，当入队、获取队首、以及判断队列是否为空只要直接操作stack即可，而当要出队的时候，将除队首的元素以此出栈到辅助栈helpStack中，然后获取队首元素并清空stack，再将helpStack的元素以此再出栈到stack中，最后清空辅助栈helpStack</p>
<p>代码：</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyQueue</span> &#123;</span><br><span class="line">    <span class="comment">//栈</span></span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;Integer&gt; stack;</span><br><span class="line">    <span class="comment">//辅助栈(只在出队有用)</span></span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;Integer&gt; helpStack;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyQueue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//初始化</span></span><br><span class="line">        stack=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        helpStack=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">push</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">        <span class="comment">//入队</span></span><br><span class="line">        stack.add(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//出队</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">pop</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//将除队首元素以此出栈再入辅助栈中</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=stack.size()-<span class="number">1</span>;i&gt;=<span class="number">1</span>;i--)&#123;</span><br><span class="line">           helpStack.add(stack.get(i));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//获取队首元素</span></span><br><span class="line">        <span class="type">int</span> result=stack.get(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">//清空栈</span></span><br><span class="line">        stack.clear();</span><br><span class="line">        <span class="comment">//依次将辅助栈的元素入到stack栈中</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=helpStack.size()-<span class="number">1</span>;i&gt;=<span class="number">0</span>;i--)&#123;</span><br><span class="line">            stack.add(helpStack.get(i));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//清空辅助栈</span></span><br><span class="line">        helpStack.clear();</span><br><span class="line">        <span class="comment">//返回队首元素</span></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">peek</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="comment">//返回队首元素</span></span><br><span class="line">        <span class="keyword">return</span> stack.get(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">empty</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//判断队列是否为空</span></span><br><span class="line">        <span class="keyword">return</span> stack.size()==<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="https://images-kkblog.oss-cn-hangzhou.aliyuncs.com/image-20230821091110421.png"  alt="辅助栈图解">
      </p>
<p><strong>in栈和out栈(双栈分别控制入栈和出栈)</strong></p>
<p>思路：入栈数据正常入in栈，出栈出out栈数据，获取队首元素也从out栈中获取，判断队列是否为空即in栈和out栈都为空</p>
<p>代码:</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyQueue</span> &#123;</span><br><span class="line">    <span class="comment">//in栈</span></span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;Integer&gt; inStack;</span><br><span class="line">    <span class="comment">//out栈</span></span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;Integer&gt; outStack;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyQueue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//初始化</span></span><br><span class="line">        inStack=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        outStack=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//入队</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">push</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">        <span class="comment">//入in栈</span></span><br><span class="line">        inStack.add(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//出队</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">pop</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//如果out栈为空 那么将in栈中的数据全部放到out栈中，并且清空in栈</span></span><br><span class="line">        <span class="comment">//如果out栈不为空，那么直接从out栈获取数据不需要in栈操作</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//out栈为空</span></span><br><span class="line">        <span class="keyword">if</span>(outStack.size()==<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=inStack.size()-<span class="number">1</span>;i&gt;=<span class="number">0</span>;i--)&#123;</span><br><span class="line">                outStack.add(inStack.get(i));</span><br><span class="line">            &#125;</span><br><span class="line">            inStack.clear();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//获取最后一个数据 也就是栈顶的位置</span></span><br><span class="line">        <span class="type">int</span> result=outStack.get(outStack.size()-<span class="number">1</span>);</span><br><span class="line"> 		<span class="comment">//将out栈的栈顶元素弹出</span></span><br><span class="line">        outStack.remove(outStack.size()-<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">peek</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//获取栈顶元素 因为pop会出栈，所以需要将result压回outStack栈中</span></span><br><span class="line">        <span class="type">int</span> result=<span class="built_in">this</span>.pop();</span><br><span class="line">        outStack.add(result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">empty</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//当in栈为空且out栈为空说明队列为空</span></span><br><span class="line">        <span class="keyword">return</span> inStack.size()==<span class="number">0</span>&amp;&amp; outStack.size()==<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="/%E6%AD%BB%E4%B9%8B%E5%89%8D%E8%A6%81%E5%81%9A%E5%AE%8C%E7%9A%84%E7%AE%97%E6%B3%95%E6%89%8B%E5%86%8C-%5B5.%E6%A0%88%E5%92%8C%E9%98%9F%E5%88%97%5D/image-20230821093459437.png"  alt="in栈和out栈">
      </p>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="/%E6%AD%BB%E4%B9%8B%E5%89%8D%E8%A6%81%E5%81%9A%E5%AE%8C%E7%9A%84%E7%AE%97%E6%B3%95%E6%89%8B%E5%86%8C-%5B5.%E6%A0%88%E5%92%8C%E9%98%9F%E5%88%97%5D/image-20230821093715611.png"  alt="in栈和out栈(2)">
      </p>

        <h1 id="用队列实现栈"   >
          <a href="#用队列实现栈" class="heading-link"><i class="fas fa-link"></i></a><a href="#用队列实现栈" class="headerlink" title="用队列实现栈"></a>用队列实现栈</h1>
      <p>请你仅使用两个队列实现一个后入先出（LIFO）的栈，并支持普通栈的全部四种操作（<code>push</code>、<code>top</code>、<code>pop</code> 和 <code>empty</code>）。</p>
<p>实现 <code>MyStack</code> 类：</p>
<ul>
<li><code>void push(int x)</code> 将元素 x 压入栈顶。</li>
<li><code>int pop()</code> 移除并返回栈顶元素。</li>
<li><code>int top()</code> 返回栈顶元素。</li>
<li><code>boolean empty()</code> 如果栈是空的，返回 <code>true</code> ；否则，返回 <code>false</code> 。</li>
</ul>

        <h2 id="225-用队列实现栈"   >
          <a href="#225-用队列实现栈" class="heading-link"><i class="fas fa-link"></i></a><a href="#225-用队列实现栈" class="headerlink" title="225.用队列实现栈"></a>225.用队列实现栈</h2>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/implement-stack-using-queues/" >LeetCode.225题(easy)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-1"   >
          <a href="#第一次做-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-1" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;08&#x2F;21</p>

        <h4 id="第一次代码-1"   >
          <a href="#第一次代码-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-1" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyStack</span> &#123;</span><br><span class="line">    <span class="comment">//定义一个队列</span></span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;Integer&gt; list;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyStack</span><span class="params">()</span> &#123;</span><br><span class="line">        list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//入栈</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">push</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">        list.add(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//出栈</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">pop</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//出栈的逻辑我是这样实现的:</span></span><br><span class="line">        <span class="comment">//	将队首的元素以此出队然后重新以此入队</span></span><br><span class="line">        <span class="comment">//  这样保证了原来队尾的数据到了队首的位置，然后将这个队首元素获取之后出队即可</span></span><br><span class="line">        <span class="type">int</span> length=list.size();</span><br><span class="line">        <span class="type">int</span> result=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;length;i++)&#123;</span><br><span class="line">			<span class="comment">//非队尾元素重新入队</span></span><br><span class="line">            <span class="keyword">if</span>(i!=length-<span class="number">1</span>)&#123;</span><br><span class="line">               <span class="type">int</span> temp=list.get(<span class="number">0</span>);</span><br><span class="line">               list.remove(<span class="number">0</span>);</span><br><span class="line">               list.add(temp);</span><br><span class="line">               <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">           <span class="comment">//运行到这里 队首是原来队尾元素</span></span><br><span class="line">           result=list.get(<span class="number">0</span>);</span><br><span class="line">           list.remove(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">top</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//根据队列长度判断栈顶指针位置，以便直接获取栈顶元素</span></span><br><span class="line">        <span class="keyword">return</span> list.get(list.size()-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">empty</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//如果队列为空则栈为空</span></span><br><span class="line">        <span class="keyword">return</span> list.size()==<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-1"   >
          <a href="#提交成功-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-1" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-1"   >
          <a href="#题解-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-1" class="headerlink" title="题解"></a>题解</h3>
      <p>这道题的题解和我第一次自己做的代码是一致的，用<strong>一个队列来实现栈</strong></p>
<p><strong>用一个队列实现栈</strong></p>
<p>思路:入栈、获取栈顶元素、判断栈是否为空都是比较简单就能理解的，而最主要的区别在于出栈的过程，因为队列先进先出而栈是后进先出</p>
<ul>
<li>push:入队和入栈是一样的，</li>
<li>top:获取栈顶元素只要我们获取到队列的末尾元素即可</li>
<li>empty:判断队列是否为空即可</li>
<li>pop: 这里将队尾之前的数据出队再重新入队，使得原来队尾的元素排到了队首，再将这个元素出队即可</li>
</ul>
<p>代码</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyStack</span> &#123;</span><br><span class="line">    <span class="comment">//队列 用于模拟栈</span></span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;Integer&gt; queue;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyStack</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//初始化</span></span><br><span class="line">        queue=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//入栈</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">push</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">        queue.add(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//出栈</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">pop</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//获取队列的长度</span></span><br><span class="line">        <span class="type">int</span> length=queue.size();</span><br><span class="line">        <span class="type">int</span> result=<span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//将非队尾的元素以此出队之后重新入队，使其队首是原先队尾的元素</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;length;i++)&#123;</span><br><span class="line">            <span class="comment">//非队尾元素出队再重新入队</span></span><br><span class="line">            <span class="keyword">if</span>(i!=length-<span class="number">1</span>)&#123;</span><br><span class="line">               <span class="type">int</span> temp=queue.get(<span class="number">0</span>);</span><br><span class="line">               queue.remove(<span class="number">0</span>);</span><br><span class="line">               queue.add(temp);</span><br><span class="line">               <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//运行到这里队首元素是原先队尾元素  将获取其值再出队即完成出栈操作</span></span><br><span class="line">           result=queue.get(<span class="number">0</span>);</span><br><span class="line">           queue.remove(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//获取栈顶元素</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">top</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> queue.get(queue.size()-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//判断栈是否为空</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">empty</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> queue.size()==<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>


        <h1 id="有效的括号"   >
          <a href="#有效的括号" class="heading-link"><i class="fas fa-link"></i></a><a href="#有效的括号" class="headerlink" title="有效的括号"></a>有效的括号</h1>
      <p>给定一个只包括 <code>&#39;(&#39;</code>，<code>&#39;)&#39;</code>，<code>&#39;&#123;&#39;</code>，<code>&#39;&#125;&#39;</code>，<code>&#39;[&#39;</code>，<code>&#39;]&#39;</code> 的字符串 <code>s</code> ，判断字符串是否有效。</p>
<p>有效字符串需满足：</p>
<ol>
<li>左括号必须用相同类型的右括号闭合。</li>
<li>左括号必须以正确的顺序闭合。</li>
<li>每个右括号都有一个对应的相同类型的左括号。</li>
</ol>

        <h2 id="20-有效的括号"   >
          <a href="#20-有效的括号" class="heading-link"><i class="fas fa-link"></i></a><a href="#20-有效的括号" class="headerlink" title="20.有效的括号"></a>20.有效的括号</h2>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/valid-parentheses/" >Leetcode.20题(easy)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-2"   >
          <a href="#第一次做-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-2" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;08&#x2F;22</p>

        <h4 id="第一次代码-2"   >
          <a href="#第一次代码-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-2" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValid</span><span class="params">(String s)</span> &#123;</span><br><span class="line">    <span class="comment">//左括号为进栈又括号为出栈</span></span><br><span class="line">    Stack&lt;Character&gt; stack=<span class="keyword">new</span> <span class="title class_">Stack</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">char</span> c:s.toCharArray())&#123;</span><br><span class="line">        <span class="keyword">if</span>(c==<span class="string">&#x27;&#123;&#x27;</span>||c==<span class="string">&#x27;(&#x27;</span>||c==<span class="string">&#x27;[&#x27;</span>)&#123;</span><br><span class="line">            stack.push(c);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//c==&#x27;&#125;&#x27;||c==&#x27;)&#x27;||c==&#x27;]&#x27;</span></span><br><span class="line">            <span class="keyword">if</span>(stack.size()==<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(c!=stack.pop())&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(stack.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败"   >
          <a href="#提交失败" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:输入s&#x3D;”()” 输出false 预期输出true</p>

        <h5 id="原因"   >
          <a href="#原因" class="heading-link"><i class="fas fa-link"></i></a><a href="#原因" class="headerlink" title="原因"></a>原因</h5>
      <p>在pop的时候是( 而c为) 左右括号当然不相同啊，所以会返回false ，这里是逻辑上的一点点小问题</p>

        <h4 id="第二次代码"   >
          <a href="#第二次代码" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValid</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="comment">//左括号为进栈又括号为出栈</span></span><br><span class="line">        Stack&lt;Character&gt; stack=<span class="keyword">new</span> <span class="title class_">Stack</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">char</span> c:s.toCharArray())&#123;</span><br><span class="line">            <span class="keyword">if</span>(c==<span class="string">&#x27;&#123;&#x27;</span>||c==<span class="string">&#x27;(&#x27;</span>||c==<span class="string">&#x27;[&#x27;</span>)&#123;</span><br><span class="line">                stack.push(c);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//c==&#x27;&#125;&#x27;||c==&#x27;)&#x27;||c==&#x27;]&#x27;</span></span><br><span class="line">                <span class="keyword">if</span>(stack.size()==<span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                Character pop=stack.pop();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(c==<span class="string">&#x27;)&#x27;</span>&amp;&amp;pop!=<span class="string">&#x27;(&#x27;</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(c==<span class="string">&#x27;]&#x27;</span> &amp;&amp; pop!=<span class="string">&#x27;[&#x27;</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(c==<span class="string">&#x27;&#125;&#x27;</span>&amp;&amp; pop!=<span class="string">&#x27;&#123;&#x27;</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    	<span class="comment">//说明左括号没有用完 左括号数量不等于右括号数量</span></span><br><span class="line">        <span class="keyword">if</span>(stack.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-2"   >
          <a href="#提交成功-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-2" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-2"   >
          <a href="#题解-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-2" class="headerlink" title="题解"></a>题解</h3>
      <p>这道题用栈来做就是一件很简单的题目，具体思路如下</p>
<p>​	①当遇到左括号的时候就将其加入栈中</p>
<p>​	②当遇到右括号时，先判断栈是否为空</p>
<p>​				如果为空则返回false</p>
<p>​				如果不为空要对栈顶元素进行弹出并且其比较是否是对应的左括号，如果是则继续循环，如果不是则返回false</p>
<p>​	③结束循环判断栈是否为空，如果栈不为空说明左括号数量多于右括号数量 返回false</p>
<p>​	④以上都没有结束方法且栈为空说明是符合条件的字符串，返回True</p>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValid</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="comment">//左括号为进栈右括号为出栈</span></span><br><span class="line">        Stack&lt;Character&gt; stack=<span class="keyword">new</span> <span class="title class_">Stack</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">char</span> c:s.toCharArray())&#123;</span><br><span class="line">            <span class="comment">//左括号进栈</span></span><br><span class="line">            <span class="keyword">if</span>(c==<span class="string">&#x27;&#123;&#x27;</span>||c==<span class="string">&#x27;(&#x27;</span>||c==<span class="string">&#x27;[&#x27;</span>)&#123;</span><br><span class="line">                stack.push(c);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//c==&#x27;&#125;&#x27;||c==&#x27;)&#x27;||c==&#x27;]&#x27;</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment">//判断栈是否为空，如果为空且当前是右括号需要出栈则代表左括号少了</span></span><br><span class="line">                <span class="keyword">if</span>(stack.size()==<span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">					</span><br><span class="line">                <span class="comment">//栈顶元素出栈 对其类型进行比较</span></span><br><span class="line">                Character pop=stack.pop();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(c==<span class="string">&#x27;)&#x27;</span>&amp;&amp;pop!=<span class="string">&#x27;(&#x27;</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(c==<span class="string">&#x27;]&#x27;</span> &amp;&amp; pop!=<span class="string">&#x27;[&#x27;</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(c==<span class="string">&#x27;&#125;&#x27;</span>&amp;&amp; pop!=<span class="string">&#x27;&#123;&#x27;</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    	<span class="comment">//说明左括号没有用完 左括号数量不等于右括号数量</span></span><br><span class="line">        <span class="keyword">if</span>(stack.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h1 id="删除字符串中的所有相邻重复项"   >
          <a href="#删除字符串中的所有相邻重复项" class="heading-link"><i class="fas fa-link"></i></a><a href="#删除字符串中的所有相邻重复项" class="headerlink" title="删除字符串中的所有相邻重复项"></a>删除字符串中的所有相邻重复项</h1>
      <p>给出由小写字母组成的字符串 <code>S</code>，<strong>重复项删除操作</strong>会选择两个相邻且相同的字母，并删除它们。</p>
<p>在 S 上反复执行重复项删除操作，直到无法继续删除。</p>
<p>在完成所有重复项删除操作后返回最终的字符串。答案保证唯一。</p>

        <h2 id="1047-删除字符串中的所有相邻重复项"   >
          <a href="#1047-删除字符串中的所有相邻重复项" class="heading-link"><i class="fas fa-link"></i></a><a href="#1047-删除字符串中的所有相邻重复项" class="headerlink" title="1047.删除字符串中的所有相邻重复项"></a>1047.删除字符串中的所有相邻重复项</h2>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/remove-all-adjacent-duplicates-in-string/" >Leetcode.1047题(easy)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-3"   >
          <a href="#第一次做-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-3" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;08&#x2F;22</p>

        <h4 id="第一次代码-3"   >
          <a href="#第一次代码-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-3" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">removeDuplicates</span><span class="params">(String s)</span> &#123;</span><br><span class="line">    Stack&lt;Character&gt; stack=<span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">char</span> c:s.toCharArray())&#123;</span><br><span class="line">        <span class="keyword">if</span>(stack.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(stack.peek()!=c)&#123;</span><br><span class="line">                stack.push(c);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                stack.pop();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            stack.push(c);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    String str=<span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">char</span> c:stack)</span><br><span class="line">    &#123;</span><br><span class="line">        str+=c;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-3"   >
          <a href="#提交成功-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-3" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-3"   >
          <a href="#题解-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-3" class="headerlink" title="题解"></a>题解</h3>
      <p>我们可以用栈来对这个字母消除的功能，每一次添加元素的时候和栈顶元素比较，不相等则添加，相等则消除</p>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">removeDuplicates</span><span class="params">(String s)</span> &#123;</span><br><span class="line">    Stack&lt;Character&gt; stack=<span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span>(<span class="type">char</span> c:s.toCharArray())&#123;</span><br><span class="line">    	<span class="comment">//当栈不为空且栈顶元素不相同时入栈</span></span><br><span class="line">        <span class="keyword">if</span>(stack.size()!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(stack.peek()!=c)&#123;</span><br><span class="line">                stack.push(c);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            	<span class="comment">//反之相同元素，消除出栈</span></span><br><span class="line">                stack.pop();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            stack.push(c);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//拼接结果进行返回</span></span><br><span class="line">    String str=<span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">char</span> c:stack)</span><br><span class="line">    &#123;</span><br><span class="line">        str+=c;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h1 id="逆波兰表达式求值"   >
          <a href="#逆波兰表达式求值" class="heading-link"><i class="fas fa-link"></i></a><a href="#逆波兰表达式求值" class="headerlink" title="逆波兰表达式求值"></a>逆波兰表达式求值</h1>
      <p>给你一个字符串数组 <code>tokens</code> ，表示一个根据 <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E9%80%86%E6%B3%A2%E5%85%B0%E5%BC%8F/128437" >逆波兰表示法</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> 表示的算术表达式。</p>
<p>请你计算该表达式。返回一个表示表达式值的整数。</p>
<p><strong>注意：</strong></p>
<ul>
<li>有效的算符为 <code>&#39;+&#39;</code>、<code>&#39;-&#39;</code>、<code>&#39;*&#39;</code> 和 <code>&#39;/&#39;</code> 。</li>
<li>每个操作数（运算对象）都可以是一个整数或者另一个表达式。</li>
<li>两个整数之间的除法总是 <strong>向零截断</strong> 。</li>
<li>表达式中不含除零运算。</li>
<li>输入是一个根据逆波兰表示法表示的算术表达式。</li>
<li>答案及所有中间计算结果可以用 <strong>32 位</strong> 整数表示。</li>
</ul>

        <h2 id="150-逆波兰表达式求值"   >
          <a href="#150-逆波兰表达式求值" class="heading-link"><i class="fas fa-link"></i></a><a href="#150-逆波兰表达式求值" class="headerlink" title="150.逆波兰表达式求值"></a>150.逆波兰表达式求值</h2>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/evaluate-reverse-polish-notation/" >Leetcode.150(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-4"   >
          <a href="#第一次做-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-4" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;08&#x2F;23</p>

        <h4 id="第一次代码-4"   >
          <a href="#第一次代码-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-4" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">evalRPN</span><span class="params">(String[] tokens)</span> &#123;</span><br><span class="line">        Stack&lt;Integer&gt; stack =<span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(String s: tokens)&#123;</span><br><span class="line">            <span class="keyword">if</span>(s.equals(<span class="string">&quot;+&quot;</span>)||s.equals(<span class="string">&quot;-&quot;</span>)||s.equals(<span class="string">&quot;/&quot;</span>)||s.equals(<span class="string">&quot;*&quot;</span>))&#123;</span><br><span class="line">                <span class="type">int</span> a1=stack.pop();</span><br><span class="line">                <span class="type">int</span> a2=stack.pop();</span><br><span class="line">                <span class="type">int</span> result=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">if</span>(s.equals(<span class="string">&quot;+&quot;</span>))&#123;</span><br><span class="line">                    result=a1+a2;</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(s.equals(<span class="string">&quot;*&quot;</span>))&#123;</span><br><span class="line">                    result=a1*a2;</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(s.equals(<span class="string">&quot;/&quot;</span>))&#123;</span><br><span class="line">                    result=a1/a2;</span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                    result=a1-a2;</span><br><span class="line">                &#125;</span><br><span class="line">                stack.push(result);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                stack.push(Integer.parseInt(s));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> stack.pop();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-1"   >
          <a href="#提交失败-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-1" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE：tokens &#x3D;[“4”,”13”,”5”,”&#x2F;“,”+”] 输出4 预期输出6</p>
<p>原因是在做除法的时候先弹出的数应该是被除数，而我把它放在除数的位置上面了</p>

        <h4 id="第二次代码-1"   >
          <a href="#第二次代码-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码-1" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">evalRPN</span><span class="params">(String[] tokens)</span> &#123;</span><br><span class="line">        Stack&lt;Integer&gt; stack =<span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(String s: tokens)&#123;</span><br><span class="line">            <span class="keyword">if</span>(s.equals(<span class="string">&quot;+&quot;</span>)||s.equals(<span class="string">&quot;-&quot;</span>)||s.equals(<span class="string">&quot;/&quot;</span>)||s.equals(<span class="string">&quot;*&quot;</span>))&#123;</span><br><span class="line">                <span class="type">int</span> a1=stack.pop();</span><br><span class="line">                <span class="type">int</span> a2=stack.pop();</span><br><span class="line">                <span class="type">int</span> result=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">if</span>(s.equals(<span class="string">&quot;+&quot;</span>))&#123;</span><br><span class="line">                    result=a2+a1;</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(s.equals(<span class="string">&quot;*&quot;</span>))&#123;</span><br><span class="line">                    result=a2*a1;</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(s.equals(<span class="string">&quot;/&quot;</span>))&#123;</span><br><span class="line">                    result=a2/a1;</span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                    result=a2-a1;</span><br><span class="line">                &#125;</span><br><span class="line">                stack.push(result);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                stack.push(Integer.parseInt(s));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> stack.pop();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-4"   >
          <a href="#提交成功-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-4" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-4"   >
          <a href="#题解-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-4" class="headerlink" title="题解"></a>题解</h3>
      <p>这道题用栈来解决是一个非常好的，当遇见运算符的时候把栈顶的两个元素做一个运算操作再把结果存入栈中，遇到数字直接加入栈中即可</p>
<p><em>踩坑点</em>：在做减法和除法的时候要注意被除数与除数之间的关系，先弹出的应该是被除数(减数)，后弹出的应该是除数(被减数)</p>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">evalRPN</span><span class="params">(String[] tokens)</span> &#123;</span><br><span class="line">        Stack&lt;Integer&gt; stack =<span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(String s: tokens)&#123;</span><br><span class="line">            <span class="comment">//遇见运算符，将栈顶两个数字进行运算操作</span></span><br><span class="line">            <span class="keyword">if</span>(s.equals(<span class="string">&quot;+&quot;</span>)||s.equals(<span class="string">&quot;-&quot;</span>)||s.equals(<span class="string">&quot;/&quot;</span>)||s.equals(<span class="string">&quot;*&quot;</span>))&#123;</span><br><span class="line">                <span class="type">int</span> a1=stack.pop();</span><br><span class="line">                <span class="type">int</span> a2=stack.pop();</span><br><span class="line">                <span class="type">int</span> result=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">if</span>(s.equals(<span class="string">&quot;+&quot;</span>))&#123;</span><br><span class="line">                    result=a2+a1;</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(s.equals(<span class="string">&quot;*&quot;</span>))&#123;</span><br><span class="line">                    result=a2*a1;</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(s.equals(<span class="string">&quot;/&quot;</span>))&#123;</span><br><span class="line">                    result=a2/a1;</span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                    result=a2-a1;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//运算结果存入栈中</span></span><br><span class="line">                stack.push(result);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//数字直接加入栈中</span></span><br><span class="line">                stack.push(Integer.parseInt(s));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> stack.pop();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h3 id="扩展-逆波兰表达式"   >
          <a href="#扩展-逆波兰表达式" class="heading-link"><i class="fas fa-link"></i></a><a href="#扩展-逆波兰表达式" class="headerlink" title="扩展(逆波兰表达式)"></a>扩展(逆波兰表达式)</h3>
      <p>逆波兰表达式：逆波兰表达式就是运算的后缀表达式，是便于计算机对运算的一种处理</p>
<div class="table-container"><table>
<thead>
<tr>
<th>正常表达式</th>
<th>逆波兰表达式</th>
</tr>
</thead>
<tbody><tr>
<td>1+2</td>
<td>12+</td>
</tr>
<tr>
<td>(1+2)*3</td>
<td>12+3*</td>
</tr>
<tr>
<td>(1+2)*(3+4)</td>
<td>12+34+*</td>
</tr>
</tbody></table></div>
<p>我们将正常表达式转化成二叉树之后，将运算符作为父结点，数据作为叶子子结点</p>
<p>那么就如图所示</p>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="https://images-kkblog.oss-cn-hangzhou.aliyuncs.com/image-20230823094253033.png"  alt="逆波兰表达式">
      </p>
<p>所以逆波兰表达式本质上就是正常表达式二叉树的后序遍历</p>

        <h1 id="滑动窗口最大值"   >
          <a href="#滑动窗口最大值" class="heading-link"><i class="fas fa-link"></i></a><a href="#滑动窗口最大值" class="headerlink" title="滑动窗口最大值"></a>滑动窗口最大值</h1>
      <p>给你一个整数数组 <code>nums</code>，有一个大小为 <code>k</code> 的滑动窗口从数组的最左侧移动到数组的最右侧。你只可以看到在滑动窗口内的 <code>k</code> 个数字。滑动窗口每次只向右移动一位。</p>
<p>返回 <em>滑动窗口中的最大值</em> 。</p>

        <h2 id="239-滑动窗口最大值"   >
          <a href="#239-滑动窗口最大值" class="heading-link"><i class="fas fa-link"></i></a><a href="#239-滑动窗口最大值" class="headerlink" title="239.滑动窗口最大值"></a>239.滑动窗口最大值</h2>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/sliding-window-maximum/" >Leetcode.239题(hard)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-5"   >
          <a href="#第一次做-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-5" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;08&#x2F;24</p>

        <h4 id="第一次代码-5"   >
          <a href="#第一次代码-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-5" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span>[] maxSlidingWindow(<span class="type">int</span>[] nums, <span class="type">int</span> k) &#123;</span><br><span class="line">       <span class="type">int</span> i=<span class="number">0</span>;</span><br><span class="line">       <span class="type">int</span> j=<span class="number">0</span>;</span><br><span class="line">       <span class="type">int</span> length=nums.length-k+<span class="number">1</span> &lt;<span class="number">1</span>?<span class="number">1</span>:nums.length-k+<span class="number">1</span>;</span><br><span class="line">       <span class="type">int</span>[] result=<span class="keyword">new</span> <span class="title class_">int</span>[length];</span><br><span class="line">       Queue&lt;Integer&gt; queue=<span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(;j&lt;nums.length;)&#123;</span><br><span class="line">            <span class="type">int</span> len=j-i+<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(j==nums.length-<span class="number">1</span>||len==k)&#123;</span><br><span class="line">                <span class="comment">//移动到最后一个元素了</span></span><br><span class="line">                <span class="type">int</span> max=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> temp=i;temp&lt;=j;temp++)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(nums[temp]&gt;=max) max=nums[temp];</span><br><span class="line">                &#125;</span><br><span class="line">                result[i++]=max;</span><br><span class="line">                j++;</span><br><span class="line">                queue.poll();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(len&lt;k)&#123;</span><br><span class="line">                queue.add(nums[j]);</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-2"   >
          <a href="#提交失败-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-2" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE：nums&#x3D;[1,-1] k&#x3D;1 输出[1,0] 预期输出[1,-1]</p>
<p>原因在max的初始化，我初始化为0，而nums[i]是有可能小于0的</p>

        <h4 id="第二次代码-2"   >
          <a href="#第二次代码-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码-2" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span>[] maxSlidingWindow(<span class="type">int</span>[] nums, <span class="type">int</span> k) &#123;</span><br><span class="line">       <span class="type">int</span> i=<span class="number">0</span>;</span><br><span class="line">       <span class="type">int</span> j=<span class="number">0</span>;</span><br><span class="line">       <span class="type">int</span> length=nums.length-k+<span class="number">1</span> &lt;<span class="number">1</span>?<span class="number">1</span>:nums.length-k+<span class="number">1</span>;</span><br><span class="line">       <span class="type">int</span>[] result=<span class="keyword">new</span> <span class="title class_">int</span>[length];</span><br><span class="line">       Queue&lt;Integer&gt; queue=<span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(;j&lt;nums.length;)&#123;</span><br><span class="line">            <span class="type">int</span> len=j-i+<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(j==nums.length-<span class="number">1</span>||len==k)&#123;</span><br><span class="line">                <span class="comment">//移动到最后一个元素了</span></span><br><span class="line">                <span class="type">int</span> max=Integer.MAX_VALUE+<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> temp=i;temp&lt;=j;temp++)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(nums[temp]&gt;=max) max=nums[temp];</span><br><span class="line">                &#125;</span><br><span class="line">                result[i++]=max;</span><br><span class="line">                j++;</span><br><span class="line">                queue.poll();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(len&lt;k)&#123;</span><br><span class="line">                queue.add(nums[j]);</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-3"   >
          <a href="#提交失败-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-3" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>超出时间限制，测试用例耗时过长，我判断是每次获取滑动数组这块循环太浪费时间</p>

        <h4 id="第三次代码"   >
          <a href="#第三次代码" class="heading-link"><i class="fas fa-link"></i></a><a href="#第三次代码" class="headerlink" title="第三次代码"></a>第三次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span>[] maxSlidingWindow(<span class="type">int</span>[] nums, <span class="type">int</span> k) &#123;</span><br><span class="line">       <span class="type">int</span> i=<span class="number">0</span>;</span><br><span class="line">       <span class="type">int</span> j=<span class="number">0</span>;</span><br><span class="line">       <span class="type">int</span> length=nums.length-k+<span class="number">1</span> &lt;<span class="number">1</span>?<span class="number">1</span>:nums.length-k+<span class="number">1</span>;</span><br><span class="line">       <span class="type">int</span>[] result=<span class="keyword">new</span> <span class="title class_">int</span>[length];</span><br><span class="line">       Queue&lt;Integer&gt; queue=<span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(;j&lt;nums.length;)&#123;</span><br><span class="line">            <span class="type">int</span> len=j-i+<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(j==nums.length-<span class="number">1</span>||len==k)&#123;</span><br><span class="line">                queue.add(nums[j]);</span><br><span class="line">                <span class="type">int</span> max;</span><br><span class="line">                <span class="keyword">if</span>(i==<span class="number">0</span>)&#123;</span><br><span class="line">                    max=nums[<span class="number">0</span>];</span><br><span class="line">                    <span class="keyword">for</span>(<span class="type">int</span> temp=i;temp&lt;=j;temp++)&#123;</span><br><span class="line">                            <span class="keyword">if</span>(nums[temp]&gt;=max) max=nums[temp];</span><br><span class="line">                        &#125;</span><br><span class="line">                    result[i++]=max;</span><br><span class="line">                    queue.poll();</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    max=result[i-<span class="number">1</span>];</span><br><span class="line">                    <span class="keyword">if</span>(nums[j]&gt;=max)&#123;</span><br><span class="line">                        result[i++]=nums[j];</span><br><span class="line">                        queue.poll();</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        max=Integer.MAX_VALUE+<span class="number">1</span>;</span><br><span class="line">                        <span class="keyword">for</span>(<span class="type">int</span> temp=i;temp&lt;=j;temp++)&#123;</span><br><span class="line">                            <span class="keyword">if</span>(nums[temp]&gt;=max) max=nums[temp];</span><br><span class="line">                        &#125;</span><br><span class="line">                        result[i++]=max;</span><br><span class="line">                        queue.poll();  </span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(len&lt;k)&#123;</span><br><span class="line">                queue.add(nums[j]);</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-4"   >
          <a href="#提交失败-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-4" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>测试用例超出时间限制，测试是成功的提交是失败的，就是再后面最大值判断的时候超了时间</p>
<p>这道题没能在规定时间内做出来</p>

        <h3 id="题解-5"   >
          <a href="#题解-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-5" class="headerlink" title="题解"></a>题解</h3>
      <p>思路：最简单能想到的就是，当滑动到指定位置，然后遍历滑动窗口中的数据找到最大值，这就是<strong>暴力法</strong>，时间复杂度就是n*k，k为指定的元素个数，在LeetCode上面暴力法不能作为题解做出来</p>
<p><strong>单调递减队列(用队列求解)</strong></p>
<p>我们可以定义一个队列，然后自定义规则，我们只<strong>要维护可能成为最大数的数据即可</strong></p>
<p><em>也即队列中的数据一定是单调递减的，入队时要将比入队数据小的pop出去</em></p>
<p>例如在-1,3,2,5 </p>
<p>那么遍历到-1队列数据为-1 </p>
<p>而当遍历到3的时候队列就要将比3小的数据pop出去，那么队列中就是3</p>
<p>而遍历到2的时候，因为2比3小，但是在3后面所以可以正常入队 那么队列中为3 ，2</p>
<p>当遍历到5的时候，因为队列中的3,2都比5小，所以都要被pop出去，然后5入队</p>
<p>我们就主要要维护三个方法</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">getMaxValue()  </span><br><span class="line">获取队首数据，此时队列中最大数就是队首数据</span><br><span class="line"></span><br><span class="line">push(<span class="type">int</span> val)</span><br><span class="line">push数据的时候从队尾开始进行元素判断，将数值小于val的数据都出队淘汰出去</span><br><span class="line">例如 队列中为<span class="number">3</span>，-<span class="number">1</span>  入队为 <span class="number">2</span> 那么就要将小于<span class="number">2</span>的数据淘汰出去再将<span class="number">2</span>入队 最后队列数据为<span class="number">3</span>,<span class="number">2</span></span><br><span class="line">	队列中为<span class="number">3</span>   入队为<span class="number">5</span>，那么将<span class="number">3</span>淘汰，<span class="number">5</span>入队 也即队列数据为<span class="number">5</span></span><br><span class="line"></span><br><span class="line">pop(<span class="type">int</span> val)</span><br><span class="line">pop数据传入一个参数val 我们要判断队首元素与val的值</span><br><span class="line">如果队首元素值比val大 那么就什么都不做</span><br><span class="line">如果队首元素值等于val 那么就将队首元素出队</span><br></pre></td></tr></table></div></figure>



<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span>[] maxSlidingWindow(<span class="type">int</span>[] nums, <span class="type">int</span> k) &#123;</span><br><span class="line">    	<span class="comment">//用于接收结果集</span></span><br><span class="line">        <span class="type">int</span>[] result=<span class="keyword">new</span> <span class="title class_">int</span>[nums.length-k+<span class="number">1</span>];</span><br><span class="line">        MyQueue queue=<span class="keyword">new</span> <span class="title class_">MyQueue</span>();</span><br><span class="line">    	<span class="comment">//i表示滑动窗口的起始位置 j表示滑动窗口的结束位置</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>,j=<span class="number">0</span>;j&lt;nums.length;)&#123;</span><br><span class="line">            <span class="type">int</span> len=j-i+<span class="number">1</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//入队nums[j]</span></span><br><span class="line">            <span class="keyword">if</span>(len&lt;=k)&#123;</span><br><span class="line">                queue.push(nums[j]);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span>(j==nums.length-<span class="number">1</span>||len==k)&#123;</span><br><span class="line">                <span class="comment">//获取滑动窗口最大值</span></span><br><span class="line">                result[i]=queue.getMaxValue();</span><br><span class="line">            	<span class="comment">//淘汰滑动窗口起始位置的元素  如果nums[i]&lt;队首元素数据那么什么都不做</span></span><br><span class="line">                queue.pop(nums[i]);</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">            j++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">MyQueue</span>&#123;</span><br><span class="line">        ArrayDeque&lt;Integer&gt; queue;</span><br><span class="line">        MyQueue()&#123;</span><br><span class="line">            queue=<span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">pop</span><span class="params">(<span class="type">int</span> val)</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(queue.size()!=<span class="number">0</span>&amp;&amp;queue.peek()&gt;val)&#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            queue.poll();</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">push</span><span class="params">(<span class="type">int</span> val)</span>&#123;</span><br><span class="line">            <span class="keyword">while</span>(queue.size()!=<span class="number">0</span>&amp;&amp;queue.peekLast()&lt;val)&#123;</span><br><span class="line">                queue.pollLast();</span><br><span class="line">            &#125;</span><br><span class="line">            queue.add(val);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getMaxValue</span><span class="params">()</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> queue.peek();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h1 id="前-K-个高频元素"   >
          <a href="#前-K-个高频元素" class="heading-link"><i class="fas fa-link"></i></a><a href="#前-K-个高频元素" class="headerlink" title="前 K 个高频元素"></a>前 K 个高频元素</h1>
      <p>给你一个整数数组 <code>nums</code> 和一个整数 <code>k</code> ，请你返回其中出现频率前 <code>k</code> 高的元素。你可以按 <strong>任意顺序</strong> 返回答案。</p>

        <h2 id="347-前K个高频元素"   >
          <a href="#347-前K个高频元素" class="heading-link"><i class="fas fa-link"></i></a><a href="#347-前K个高频元素" class="headerlink" title="347.前K个高频元素"></a>347.前K个高频元素</h2>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://leetcode.cn/problems/top-k-frequent-elements/" >Leetcode.347题(medium)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="第一次做-6"   >
          <a href="#第一次做-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次做-6" class="headerlink" title="第一次做"></a>第一次做</h3>
      <p>第一次做于23&#x2F;08&#x2F;25</p>

        <h4 id="第一次代码-6"   >
          <a href="#第一次代码-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次代码-6" class="headerlink" title="第一次代码"></a>第一次代码</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">public int[] topKFrequent(int[] nums, int k) &#123;</span><br><span class="line">        int[] result=new int[k];</span><br><span class="line">        HashMap&lt;Integer,Integer&gt; map=new HashMap&lt;&gt;();</span><br><span class="line">        for(int i:nums)&#123;</span><br><span class="line">            map.put(i,map.getOrDefault(i,0)+1);</span><br><span class="line">        &#125;</span><br><span class="line">        int[] arr=new int[map.size()];</span><br><span class="line">        int i=0;</span><br><span class="line">        for(Map.Entry&lt;Integer,Integer&gt; entry:map.entrySet())&#123;</span><br><span class="line">            int v=entry.getValue();</span><br><span class="line">            arr[i++]=v;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Arrays.sort(arr);</span><br><span class="line">        </span><br><span class="line">        for(int j=0;j&lt;k;j++)&#123;</span><br><span class="line">            i=arr.length-j-1;</span><br><span class="line">            for(Map.Entry&lt;Integer,Integer&gt; entry:map.entrySet())&#123;</span><br><span class="line">            if(entry.getValue().equals(arr[i]))&#123;</span><br><span class="line">                result[j]=entry.getKey();</span><br><span class="line">                i--;</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交失败-5"   >
          <a href="#提交失败-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交失败-5" class="headerlink" title="提交失败"></a>提交失败</h5>
      <p>CASE:nums&#x3D;[1,2] k&#x3D;2 输出[1,1] 预期输出[1,2]</p>

        <h4 id="第二次代码-3"   >
          <a href="#第二次代码-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次代码-3" class="headerlink" title="第二次代码"></a>第二次代码</h4>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//BF</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span>[] topKFrequent(<span class="type">int</span>[] nums, <span class="type">int</span> k) &#123;</span><br><span class="line">        <span class="type">int</span>[] result=<span class="keyword">new</span> <span class="title class_">int</span>[k];</span><br><span class="line">        HashMap&lt;Integer,Integer&gt; map=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i:nums)&#123;</span><br><span class="line">            map.put(i,map.getOrDefault(i,<span class="number">0</span>)+<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span>[] arr=<span class="keyword">new</span> <span class="title class_">int</span>[map.size()];</span><br><span class="line">        <span class="type">int</span> i=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(Map.Entry&lt;Integer,Integer&gt; entry:map.entrySet())&#123;</span><br><span class="line">            <span class="type">int</span> v=entry.getValue();</span><br><span class="line">            arr[i++]=v;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Arrays.sort(arr);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;k;j++)&#123;</span><br><span class="line">            i=arr.length-j-<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span>(Map.Entry&lt;Integer,Integer&gt; entry:map.entrySet())&#123;</span><br><span class="line">            <span class="keyword">if</span>(entry.getValue().equals(arr[i]))&#123;</span><br><span class="line">                result[j]=entry.getKey();</span><br><span class="line">                map.put(result[j],<span class="number">0</span>);</span><br><span class="line">                i--;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h5 id="提交成功-5"   >
          <a href="#提交成功-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#提交成功-5" class="headerlink" title="提交成功"></a>提交成功</h5>
      
        <h3 id="题解-6"   >
          <a href="#题解-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#题解-6" class="headerlink" title="题解"></a>题解</h3>
      <p>利用<strong>优先级队列小顶堆</strong>求解</p>
<p>思路：</p>
<p>​		1.用一个HashMap来统计每个数字出现的次数</p>
<p>​		2.利用一个小顶堆，我们这里用优先级队列实现，传入比较器将由频率次数的小到大排列形成的二叉树</p>
<p>​		3.遍历数组维护一个数量为k的小顶堆，一旦数量超过k个则先传入数据按照频率维护好堆，再pop出根元素，也即最小频率元素</p>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span>[] topKFrequent(<span class="type">int</span>[] nums, <span class="type">int</span> k) &#123;</span><br><span class="line">    	<span class="comment">//遍历nums 统计每个元素出现的次数</span></span><br><span class="line">        HashMap&lt;Integer,Integer&gt; map=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i:nums)&#123;</span><br><span class="line">            map.put(i,map.getOrDefault(i,<span class="number">0</span>)+<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    	<span class="comment">//利用优先级队列维护堆，这里我们传入的比较器是我们要生成小顶堆</span></span><br><span class="line">         PriorityQueue&lt;Integer&gt; queue=<span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;(</span><br><span class="line">            (o1,o2)-&gt;&#123;</span><br><span class="line">                <span class="keyword">return</span> map.get(o1)-map.get(o2);</span><br><span class="line">            &#125;</span><br><span class="line">        );</span><br><span class="line">		<span class="comment">//遍历数组，维护数量为k的小顶堆，每次pop出根元素也即频率最小的元素</span></span><br><span class="line">        <span class="keyword">for</span>(Map.Entry&lt;Integer,Integer&gt; entry:map.entrySet())&#123;</span><br><span class="line">            <span class="keyword">if</span>(queue.size()&lt;k)&#123;</span><br><span class="line">                queue.add(entry.getKey());</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                </span><br><span class="line">                queue.add(entry.getKey());</span><br><span class="line">                queue.poll();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    	<span class="comment">//将小顶堆的数据取出输出</span></span><br><span class="line">        <span class="type">int</span>[] result=<span class="keyword">new</span> <span class="title class_">int</span>[k];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;k;j++)&#123;</span><br><span class="line">            result[j]=queue.poll();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>






        <h3 id="拓展-大顶堆和小顶堆"   >
          <a href="#拓展-大顶堆和小顶堆" class="heading-link"><i class="fas fa-link"></i></a><a href="#拓展-大顶堆和小顶堆" class="headerlink" title="拓展(大顶堆和小顶堆)"></a>拓展(大顶堆和小顶堆)</h3>
      <p>堆是一种非线性的数据结构，是<strong>基于完全二叉树</strong>的结构的一维数组</p>
<p>大顶堆：即每个结点的值都大于其左右子结点的值</p>
<p>小顶堆：即每个结点的值都小于其左右子结点的值</p>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="https://images-kkblog.oss-cn-hangzhou.aliyuncs.com/image-20230826080613631.png"  alt="大顶堆和小顶堆">
      </p>
<p>我们可以用<strong>优先级队列</strong>来维护响应的大顶堆和小顶堆</p>
<p><strong>代码</strong></p>
<p>根据比较器的规则不同可以维护不同的堆</p>
<p>大顶堆</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PriorityQueue&lt;Integer&gt; queue=<span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;(</span><br><span class="line">           (o1,o2)-&gt;&#123;</span><br><span class="line">               <span class="keyword">return</span> map.get(o2)-map.get(o1);</span><br><span class="line">           &#125;</span><br><span class="line">       );</span><br></pre></td></tr></table></div></figure>

<p>小顶堆</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PriorityQueue&lt;Integer&gt; queue=<span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;(</span><br><span class="line">           (o1,o2)-&gt;&#123;</span><br><span class="line">               <span class="keyword">return</span> map.get(o1)-map.get(o2);</span><br><span class="line">           &#125;</span><br><span class="line">       );</span><br></pre></td></tr></table></div></figure>




        <h1 id="总结"   >
          <a href="#总结" class="heading-link"><i class="fas fa-link"></i></a><a href="#总结" class="headerlink" title="总结"></a>总结</h1>
      <p>到这里队列和栈已经告一段落，从这章中我们可以复习<strong>队列和栈</strong>的数据结构，队列是FIFO的数据结构而栈是LIFO的数据结构，同时我们可以学习到<strong>优先级队列</strong>来维护<strong>大顶堆、小顶堆</strong>以及单调队列</p>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2023/08/19/%E6%AD%BB%E4%B9%8B%E5%89%8D%E8%A6%81%E5%AD%A6%E5%AE%8C%E7%9A%84%E7%AE%97%E6%B3%95-%5BKMP%E7%AE%97%E6%B3%95%5D/">死之前要学完的算法-[KMP算法]</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2023-08-19</span></span><span class="post-meta-item post-meta-item--wordcount"><span class="post-meta-item__icon"><i class="far fa-file-word"></i></span><span class="post-meta-item__info">字数统计</span><span class="post-meta-item__value">2.4k</span></span><span class="post-meta-item post-meta-item--readtime"><span class="post-meta-item__icon"><i class="far fa-clock"></i></span><span class="post-meta-item__info">阅读时长</span><span class="post-meta-item__value">18分</span></span></div></header><div class="post-body"><div class="post-excerpt"><p><strong>KMP算法</strong></p>
<p>KMP是字符串匹配算法，而还有一种算法是BF算法(Brute Force)也即暴力算法 我们先用暴力算法看看怎么匹配字符串的过程，易于理解</p>

        <h1 id="BF"   >
          <a href="#BF" class="heading-link"><i class="fas fa-link"></i></a><a href="#BF" class="headerlink" title="BF"></a>BF</h1>
      <p>假设有一个模拟字符串 s1&#x3D;”aabaaccde”和一个比较串s2&#x3D;”aac”</p>
<p>最容易想到的方法是双层循环，第一层遍历模拟串，第二层来进行匹配比较串是否是子串</p>

        <h2 id="思路"   >
          <a href="#思路" class="heading-link"><i class="fas fa-link"></i></a><a href="#思路" class="headerlink" title="思路"></a>思路</h2>
      <ul>
<li>先对s1和s2做一个判断 如果模拟串s1长度比比较串s2更短就不可能是子串</li>
</ul>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(s1.length&lt;s2.length)&#123;</span><br><span class="line">	<span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>



<ul>
<li>第一层遍历模拟串s1，用i表示正在匹配的字符是否是比较串s2中的起始位置</li>
</ul>
<p>如果s1.charAt(i)&#x3D;&#x3D;s2.charAt(0) 那么进行判断i是否是比较串的起始位置</p>
<p>如果s1.charAt(i)!&#x3D;s2.charAt(0) 那么进入下一个位置继续遍历</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>,j=<span class="number">0</span>;i&lt;s1.length();)&#123;</span><br><span class="line">	<span class="keyword">if</span>(s1.charAt(i)==s2.charAt(j))&#123;</span><br><span class="line">        <span class="comment">//第二层循环 判断是否是子串</span></span><br><span class="line">			<span class="comment">//具体判断代码....</span></span><br><span class="line">                <span class="comment">//如果是子串 则返回当前索引下标 return i;</span></span><br><span class="line">                <span class="comment">//如果不是子串 则将j置为0 等待下一次判断</span></span><br><span class="line">                <span class="comment">//i++;j=0;</span></span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(s1.charAt(i)!=s2.charAt(j))&#123;</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<ul>
<li>第二层遍历判断比较串是否在模拟串中</li>
</ul>
<p>如果每一个字符都对应的上那么就是子串，返回当前索引i</p>
<p>如果有一个字符对应不上则break，将j置为0等待下一次比较</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//第二层循环</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> index=i;j&lt;s2.length()&amp;&amp;index&lt;s1.length();)&#123;</span><br><span class="line">    <span class="comment">//判断字符是否相同</span></span><br><span class="line">   <span class="keyword">if</span>(s1.charAt(index)==s2.charAt(j))&#123;</span><br><span class="line">      <span class="comment">//如果j指向了比较串s2的最后一个位置 且字符相同</span></span><br><span class="line">       <span class="keyword">if</span>(j==s2.length()-<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> i;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//反之没有指向最后一个元素 则两个位置都++</span></span><br><span class="line">       index++;</span><br><span class="line">       j++;</span><br><span class="line"> 	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">       <span class="comment">//如果有一个字符不相同 那么就不是子串 将j置为0,i++然后跳出循环</span></span><br><span class="line">       j=<span class="number">0</span>;</span><br><span class="line">       i++;</span><br><span class="line">       <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="匹配子串流程图"   >
          <a href="#匹配子串流程图" class="heading-link"><i class="fas fa-link"></i></a><a href="#匹配子串流程图" class="headerlink" title="匹配子串流程图"></a>匹配子串流程图</h2>
      <p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="https://images-kkblog.oss-cn-hangzhou.aliyuncs.com//image-20230820035249818.png"  alt="匹配子串流程图(1)">
      </p>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="https://images-kkblog.oss-cn-hangzhou.aliyuncs.com//image-20230820035207219.png"  alt="匹配子串流程图(2)">
      </p>
<p>
        <img   class="lazyload lazyload-gif"
          src="/images/loading.svg" data-src="https://images-kkblog.oss-cn-hangzhou.aliyuncs.com//image-20230820035609512.png"  alt="匹配子串流程图(3)">
      </p>

        <h2 id="完整代码"   >
          <a href="#完整代码" class="heading-link"><i class="fas fa-link"></i></a><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">strStr</span><span class="params">(String haystack, String needle)</span> &#123;</span><br><span class="line">    <span class="type">char</span>[] arr=haystack.toCharArray();</span><br><span class="line">    <span class="type">char</span>[] Narr=needle.toCharArray();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//对s1和s2长度判断</span></span><br><span class="line">    <span class="keyword">if</span>(arr.length&lt;Narr.length)&#123;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//外层循环遍历模拟串</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>,j=<span class="number">0</span>;i&lt;arr.length;)&#123;</span><br><span class="line">        <span class="keyword">if</span>(arr[i]!=Narr[j])&#123;</span><br><span class="line">            i++;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//内层循环匹配比较串</span></span><br><span class="line">            <span class="comment">//arr[i]==Narr[j]</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> index=i;j&lt;Narr.length&amp;&amp;index&lt;arr.length;)&#123;</span><br><span class="line">                <span class="keyword">if</span>(arr[index]==Narr[j])&#123;</span><br><span class="line">                    <span class="keyword">if</span>(j==Narr.length-<span class="number">1</span>)&#123;</span><br><span class="line">                        <span class="keyword">return</span> i;</span><br><span class="line">                    &#125;</span><br><span class="line">                    index++;</span><br><span class="line">                    j++;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    j=<span class="number">0</span>;</span><br><span class="line">                    i++;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      </span><br><span class="line">    &#125;</span><br><span class="line">      <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>




        <h1 id="KMP"   >
          <a href="#KMP" class="heading-link"><i class="fas fa-link"></i></a><a href="#KMP" class="headerlink" title="KMP"></a>KMP</h1>
      <p>我们可以通过模拟子串匹配的过程发现，每一次匹配之后都会有一部分位置可以确认不会匹配上，而暴力法就浪费了这一部分的信息，</p>
<p>KMP可以通过回溯指针到最长相同前后缀位置来以便进行下一次子串的匹配</p>

        <h2 id="前缀"   >
          <a href="#前缀" class="heading-link"><i class="fas fa-link"></i></a><a href="#前缀" class="headerlink" title="前缀"></a>前缀</h2>
      <p>前缀：字符串除了最后一个字符，剩下的字符有前到后的所有组合</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">例如: 字符串&quot;aaabbbc&quot;</span><br><span class="line">那么前缀有: </span><br><span class="line">a</span><br><span class="line">aa</span><br><span class="line">aaa</span><br><span class="line">aaab</span><br><span class="line">aaabb</span><br><span class="line">aaabbb</span><br></pre></td></tr></table></div></figure>


        <h2 id="后缀"   >
          <a href="#后缀" class="heading-link"><i class="fas fa-link"></i></a><a href="#后缀" class="headerlink" title="后缀"></a>后缀</h2>
      <p>后缀：字符串除了首字符,剩下的字符由尾到前的所有组合</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">例如:字符串&quot;aaabbbc&quot;</span><br><span class="line">那么后缀有:</span><br><span class="line">c</span><br><span class="line">bc</span><br><span class="line">bbc</span><br><span class="line">bbbc</span><br><span class="line">abbbc</span><br><span class="line">aabbbc</span><br></pre></td></tr></table></div></figure>


        <h2 id="最长相同前后缀"   >
          <a href="#最长相同前后缀" class="heading-link"><i class="fas fa-link"></i></a><a href="#最长相同前后缀" class="headerlink" title="最长相同前后缀"></a>最长相同前后缀</h2>
      <p>例如:s&#x3D;”aabaa”，那么这个字符的最长公共前后缀就是”aa”</p>

        <h2 id="KMP实现思路"   >
          <a href="#KMP实现思路" class="heading-link"><i class="fas fa-link"></i></a><a href="#KMP实现思路" class="headerlink" title="KMP实现思路"></a>KMP实现思路</h2>
      <p>字符串比较思路是一样的，然后KMP相较于BF的是在<strong>失配</strong>情况下移动比较串的过程</p>
<p>当失配情况下，当前i位置不变移动比较字符串的j索引，而移动j索引则需要用到next数组，查看到当前j之前的next数组就能知道移动后比较串j的新位置</p>

        <h2 id="NEXT数组"   >
          <a href="#NEXT数组" class="heading-link"><i class="fas fa-link"></i></a><a href="#NEXT数组" class="headerlink" title="NEXT数组"></a>NEXT数组</h2>
      <p>next数组用于装比较串的每个子串的最大相同前后缀的长度</p>
<p><strong>例1</strong></p>
<p>S&#x3D;”aabaa” ,那么求得next数组就为[0,1,0,1,2]</p>
<p>具体步骤如下：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">子串a  	那么前后缀都是0 	所以next[0]==0</span><br><span class="line">子串aa 	那么有一个相同a	所以Next[1]==1</span><br><span class="line">子串aab 	所以没有相同前后缀  所以Next[2]=0</span><br><span class="line">子串aaba 	有一个相同a		 所以Next[3]==1</span><br><span class="line">子串aabaa 有两个相同aa		 所以Next[4]==2</span><br><span class="line">也即</span><br><span class="line">子串	  有几个相同</span><br><span class="line">a 		0</span><br><span class="line">aa 		1</span><br><span class="line">aab 	0</span><br><span class="line">aaba	1</span><br><span class="line">aabaa	2</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p><strong>例2</strong></p>
<p>s&#x3D;”ababa” 那么求得next数组就为[0,0,1,2,3]</p>
<p>具体步骤如下：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">子串a 	那么前后缀都是0 		next[0]==0</span><br><span class="line">子串ab 	那么没有相同前后缀 	   next[1]==0</span><br><span class="line">子串aba 	那么有一个相同前后缀a	  next[2]==1</span><br><span class="line">子串abab 	那么有两个相同前后缀ab  next[3]==2</span><br><span class="line">子串ababa 那么有三个相同前后缀aba next[4]==3</span><br><span class="line">也即</span><br><span class="line">a		0</span><br><span class="line">ab  	0</span><br><span class="line">aba 	1</span><br><span class="line">abab	2</span><br><span class="line">ababa 	3</span><br></pre></td></tr></table></div></figure>


        <h3 id="代码获取Next数组"   >
          <a href="#代码获取Next数组" class="heading-link"><i class="fas fa-link"></i></a><a href="#代码获取Next数组" class="headerlink" title="代码获取Next数组"></a>代码获取Next数组</h3>
      <p>1.定义一个i用于当前要获取的子串的位置，定义一个j用于表示最长前缀的尾部</p>
<p>2.先初始化next[0]&#x3D;0 然后j指向0的位置</p>
<p>3.当前后字符相同的时候 next[i]&#x3D;j+1;j++;i++;</p>
<p>4.当前后字符不相同的时候，循环回溯j的位置，每次都是往前查一位j&#x3D;next[j-1]</p>
<p>5.当j&#x3D;&#x3D;0的时候判断当前j字符和i字符是否相同如果相同则next[i]&#x3D;++j;</p>
<p>6.如果当前j字符和i字符不相同则next[i]&#x3D;0，表示没有相同前后缀</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取next数组</span></span><br><span class="line">   <span class="keyword">public</span> <span class="type">int</span>[] getNext(String s)&#123;</span><br><span class="line">       </span><br><span class="line">       <span class="type">char</span>[] arr=s.toCharArray();</span><br><span class="line">       <span class="type">int</span>[] next=<span class="keyword">new</span> <span class="title class_">int</span>[s.length()];</span><br><span class="line">       <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>,j=<span class="number">0</span>;i&lt;arr.length;)&#123;</span><br><span class="line">           <span class="comment">//初始化i==0的位置</span></span><br><span class="line">           <span class="keyword">if</span>(i==<span class="number">0</span>)&#123;</span><br><span class="line">               next[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">               i++;</span><br><span class="line">               <span class="keyword">continue</span>;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="comment">//当前后缀相同的时候</span></span><br><span class="line">           <span class="keyword">if</span>(arr[j]==arr[i])&#123;</span><br><span class="line">               <span class="comment">//将当前j+1放到当前索引下标  i和j都++</span></span><br><span class="line">               next[i]=j+<span class="number">1</span>;</span><br><span class="line">               j++;</span><br><span class="line">               i++;</span><br><span class="line">           &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">               <span class="comment">//当前后缀不相同的时候进行回溯</span></span><br><span class="line">               <span class="keyword">while</span>(j&gt;<span class="number">0</span>&amp;&amp;arr[j]!=arr[i])&#123;</span><br><span class="line">                   <span class="comment">//回溯要找前一个位置的下标</span></span><br><span class="line">                   j=next[j-<span class="number">1</span>];</span><br><span class="line">               &#125;</span><br><span class="line">               <span class="comment">//如果j==0 那么j已经指向最初的位置</span></span><br><span class="line">               <span class="keyword">if</span>(j==<span class="number">0</span>)&#123;</span><br><span class="line">                   <span class="comment">//判断第一个字符是否和当前字符一样</span></span><br><span class="line">                   <span class="keyword">if</span>(arr[j]==arr[i])&#123;</span><br><span class="line">                       <span class="comment">//是的话就将1赋值给当前位置</span></span><br><span class="line">                       next[i]=++j;</span><br><span class="line">                   &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                       <span class="comment">//反之则不一样下一次要从0开始找</span></span><br><span class="line">                       next[i]=<span class="number">0</span>;</span><br><span class="line">                   &#125;</span><br><span class="line">              	</span><br><span class="line">                   <span class="comment">//当前位置也判断过 所以i++</span></span><br><span class="line">                   i++;</span><br><span class="line">               &#125;</span><br><span class="line"></span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> next;    </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="匹配子串过程"   >
          <a href="#匹配子串过程" class="heading-link"><i class="fas fa-link"></i></a><a href="#匹配子串过程" class="headerlink" title="匹配子串过程"></a>匹配子串过程</h2>
      <p>1.遍历模拟串，然后比较当前位置和比较串的j位置是否相同</p>
<p>2.如果相同，那么说明这个字符是匹配上的，判断j位置是不是比较串末尾 如果是则说明找到子串，返回i-needle.length()+1，如果不是末尾，则i++,j++往后继续匹配</p>
<p>3.如果匹配字符失配了，移动比较字符数组j索引，如果j&gt;0查询next[j-1]的数据将j移动到那个数值的索引位置即可，如果j&#x3D;&#x3D;0那么说明已经从头比较了，所以直接i++</p>
<p><strong>代码</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">strStr</span><span class="params">(String haystack, String needle)</span> &#123;</span><br><span class="line">		<span class="comment">//获取next数组 用于回溯指针</span></span><br><span class="line">        <span class="type">int</span>[] next=getNext(needle);</span><br><span class="line">        <span class="comment">//获取模拟串的字符数组</span></span><br><span class="line">        <span class="type">char</span>[] arr=haystack.toCharArray();</span><br><span class="line">        <span class="comment">//获取比较串的字符数组</span></span><br><span class="line">        <span class="type">char</span>[] Narr=needle.toCharArray();</span><br><span class="line"></span><br><span class="line">    	<span class="comment">//遍历arr数组 </span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>,j=<span class="number">0</span>;i&lt;arr.length;)&#123;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//如果遍历的字符相等 则两个指针向后移动</span></span><br><span class="line">            <span class="keyword">if</span>(Narr[j]==arr[i]&amp;&amp;j&lt;Narr.length)&#123;</span><br><span class="line">                <span class="comment">//判断此时是不是比较串末尾 如果是则直接返回i-Narr.length+1</span></span><br><span class="line">                <span class="keyword">if</span>(j==Narr.length-<span class="number">1</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> i-Narr.length+<span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                j++;</span><br><span class="line">                i++;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//Narr[j]!=arr[i]</span></span><br><span class="line">                <span class="comment">//模拟串数组的滑动 本质上改变下标j的位置</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment">//找前一个位置的下标  移动到那个位置</span></span><br><span class="line">                <span class="keyword">if</span>(j&gt;<span class="number">0</span>)&#123;j=next[j-<span class="number">1</span>]; <span class="keyword">continue</span>;&#125;</span><br><span class="line">                <span class="comment">//如果j已经为0了说明要从头开始遍历</span></span><br><span class="line">                <span class="keyword">if</span>(j==<span class="number">0</span>)&#123;</span><br><span class="line">                   i++; </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>




        <h1 id="代码"   >
          <a href="#代码" class="heading-link"><i class="fas fa-link"></i></a><a href="#代码" class="headerlink" title="代码"></a>代码</h1>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">strStr</span><span class="params">(String haystack, String needle)</span> &#123;</span><br><span class="line">		<span class="comment">//获取next数组 用于回溯指针</span></span><br><span class="line">        <span class="type">int</span>[] next=getNext(needle);</span><br><span class="line">        <span class="comment">//获取比较串的字符数组</span></span><br><span class="line">        <span class="type">char</span>[] arr=haystack.toCharArray();</span><br><span class="line">        <span class="comment">//获取模拟串的字符数组</span></span><br><span class="line">        <span class="type">char</span>[] Narr=needle.toCharArray();</span><br><span class="line"></span><br><span class="line">    	<span class="comment">//遍历arr数组 </span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>,j=<span class="number">0</span>;i&lt;arr.length;)&#123;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//如果遍历的字符相等 则两个指针向后移动</span></span><br><span class="line">            <span class="keyword">if</span>(Narr[j]==arr[i]&amp;&amp;j&lt;Narr.length)&#123;</span><br><span class="line">                <span class="comment">//判断此时是不是模拟串末尾 如果是则直接返回i-Narr.length+1</span></span><br><span class="line">                <span class="keyword">if</span>(j==Narr.length-<span class="number">1</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> i-Narr.length+<span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                j++;</span><br><span class="line">                i++;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//Narr[j]!=arr[i]</span></span><br><span class="line">                <span class="comment">//模拟串数组的滑动 本质上改变下标j的位置</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment">//找前一个位置的下标  移动到那个位置</span></span><br><span class="line">                <span class="keyword">if</span>(j&gt;<span class="number">0</span>)&#123;j=next[j-<span class="number">1</span>]; <span class="keyword">continue</span>;&#125;</span><br><span class="line">                <span class="comment">//如果j已经为0了说明要从头开始遍历</span></span><br><span class="line">                <span class="keyword">if</span>(j==<span class="number">0</span>)&#123;</span><br><span class="line">                   i++; </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//获取next数组</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] getNext(String s)&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">char</span>[] arr=s.toCharArray();</span><br><span class="line">        <span class="type">int</span>[] next=<span class="keyword">new</span> <span class="title class_">int</span>[s.length()];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>,j=<span class="number">0</span>;i&lt;arr.length;)&#123;</span><br><span class="line">            <span class="comment">//初始化i==0的位置</span></span><br><span class="line">            <span class="keyword">if</span>(i==<span class="number">0</span>)&#123;</span><br><span class="line">                next[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">                i++;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//当前后缀相同的时候</span></span><br><span class="line">            <span class="keyword">if</span>(arr[j]==arr[i])&#123;</span><br><span class="line">                <span class="comment">//将当前j+1放到当前索引下标  i和j都++</span></span><br><span class="line">                next[i]=j+<span class="number">1</span>;</span><br><span class="line">                j++;</span><br><span class="line">                i++;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//当前后缀不相同的时候进行回溯</span></span><br><span class="line">                <span class="keyword">while</span>(j&gt;<span class="number">0</span>&amp;&amp;arr[j]!=arr[i])&#123;</span><br><span class="line">                    <span class="comment">//回溯要找前一个位置的下标</span></span><br><span class="line">                    j=next[j-<span class="number">1</span>];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//如果j==0 那么j已经指向最初的位置</span></span><br><span class="line">                <span class="keyword">if</span>(j==<span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="comment">//判断第一个字符是否和当前字符一样</span></span><br><span class="line">                    <span class="keyword">if</span>(arr[j]==arr[i])&#123;</span><br><span class="line">                        <span class="comment">//是的话就将1赋值给当前位置</span></span><br><span class="line">                        next[i]=++j;</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        <span class="comment">//反之则不一样下一次要从0开始找</span></span><br><span class="line">                        next[i]=<span class="number">0</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">               	</span><br><span class="line">                    <span class="comment">//当前位置也判断过 所以i++</span></span><br><span class="line">                    i++;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> next;    </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>

</div></div></article></section><nav class="paginator"><div class="paginator-inner"><span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/"><i class="fas fa-angle-right"></i></a></div></nav></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><section class="sidebar-toc hide"></section><!-- ov = overview--><section class="sidebar-ov"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="https://images-kkblog.oss-cn-hangzhou.aliyuncs.com/E7977EEC2FEF2A2B9146704271490ED2.png" alt="avatar"></div><p class="sidebar-ov-author__text">步子小也好，走得慢也好，是在往前走就好</p></div><div class="sidebar-ov-social"><a class="sidebar-ov-social-item" href="/" target="_blank" rel="noopener" data-popover="social.389081641" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-qq"></i></span></a><a class="sidebar-ov-social-item" href="https://github.com/Kkker1" target="_blank" rel="noopener" data-popover="Github" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-github"></i></span></a><a class="sidebar-ov-social-item" href="/" target="_blank" rel="noopener" data-popover="social.KKKer1An@163.com" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="far fa-envelope"></i></span></a></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">43</div><div class="sidebar-ov-state-item__name">归档</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--categories" href="/categories/"><div class="sidebar-ov-state-item__count">11</div><div class="sidebar-ov-state-item__name">分类</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--tags" href="/tags/"><div class="sidebar-ov-state-item__count">16</div><div class="sidebar-ov-state-item__name">标签</div></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="知识共享许可协议" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright © 2023</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>KkkerAn</span></div><div><span>由 <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a> 强力驱动</span><span> v6.3.0</span><span class="footer__devider">|</span><span>主题 - <a href="https://github.com/liuyib/hexo-theme-stun/" title="Stun" target="_blank" rel="noopener">Stun</a></span><span> v2.8.0</span></div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><div class="search-mask"></div><div class="search-popup"><span class="search-close"></span><div class="search-input"><input placeholder="搜索文章（支持多关键词，请用空格分隔）"></div><div class="search-results"></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lazyload@2.0.0-rc.2/lazyload.min.js"></script><script>function initSearch() {
  var isXML = true;
  var search_path = 'search.xml';

  if (!search_path) {
    search_path = 'search.xml';
  } else if (/json$/i.test(search_path)) {
    isXML = false;
  }

  var path = '/' + search_path;
  $.ajax({
    url: path,
    dataType: isXML ? 'xml' : 'json',
    async: true,
    success: function (res) {
      var datas = isXML ? $('entry', res).map(function () {
        // 将 XML 转为 JSON
        return {
          title: $('title', this).text(),
          content: $('content', this).text(),
          url: $('url', this).text()
        };
      }).get() : res;
      var $input = $('.search-input input');
      var $result = $('.search-results');
      // 搜索对象（标题、内容）的权重，影响显示顺序
      var WEIGHT = { title: 100, content: 1 };
      var searchPost = function () {
        var searchText = $input.val().toLowerCase().trim();
        // 根据空白字符分隔关键字
        var keywords = searchText.split(/[\s]+/);
        // 搜索结果
        var matchPosts = [];

        // 有多个关键字时，将原文字整个保存下来
        if (keywords.length > 1) {
          keywords.push(searchText);
        }
        // 防止未输入字符时搜索
        if (searchText.length > 0) {
          datas.forEach(function (data) {
            var isMatch  = false;
            // 没有标题的文章使用预设的 i18n 变量代替
            var title = (data.title && data.title.trim()) || '[ 文章无标题 ]';
            var titleLower = title && title.toLowerCase();
            // 删除 HTML 标签 和 所有空白字符
            var content = data.content && data.content.replace(/<[^>]+>/g, '');
            var contentLower = content && content.toLowerCase();
            // 删除重复的 /
            var postURL = data.url && decodeURI(data.url).replace(/\/{2,}/g, '/');
            // 标题中匹配到的关键词
            var titleHitSlice = [];
            // 内容中匹配到的关键词
            var contentHitSlice = [];

            keywords.forEach(function (keyword) {
              /**
              * 获取匹配的关键词的索引
              * @param {String} keyword 要匹配的关键字
              * @param {String} text 原文字
              * @param {Boolean} caseSensitive 是否区分大小写
              * @param {Number} weight 匹配对象的权重。权重大的优先显示
              * @return {Array}
              */
              function getIndexByword (word, text, caseSensitive, weight) {
                if (!word || !text) {
                  return [];
                };

                var startIndex = 0; // 每次匹配的开始索引
                var index = -1;     // 匹配到的索引值
                var result = [];    // 匹配结果

                if (!caseSensitive) {
                  word = word.toLowerCase();
                  text = text.toLowerCase();
                }

                while((index = text.indexOf(word, startIndex)) !== -1) {
                  var hasMatch = false;
                  // 索引位置相同的关键词，保留长度较长的
                  titleHitSlice.forEach(function (hit) {
                    if (hit.index === index && hit.word.length < word.length) {
                      hit.word = word;
                      hasMatch = true;
                    }
                  });
                  startIndex = index + word.length;
                  !hasMatch && result.push({ index: index, word: word, weight: weight });
                }
                return result;
              }
              titleHitSlice = titleHitSlice.concat(getIndexByword(keyword, titleLower, false, WEIGHT.title));
              contentHitSlice = contentHitSlice.concat(getIndexByword(keyword, contentLower, false, WEIGHT.content));
            });

            var hitTitle = titleHitSlice.length;
            var hitContent = contentHitSlice.length;

            if (hitTitle > 0 || hitContent > 0) {
              isMatch = true;
            }
            if (isMatch) {
              ;[titleHitSlice, contentHitSlice].forEach(function (hit) {
                // 按照匹配文字的索引的递增顺序排序
                hit.sort(function (left, right) {
                  return left.index - right.index;
                });
              });
              /**
              * 给文本中匹配到的关键词添加标记，从而进行高亮显示
              * @param {String} text 原文本
              * @param {Array} hitSlice 匹配项的索引信息
              * @param {Number} start 开始索引
              * @param {Number} end 结束索引
              * @return {String}
              */
              function highlightKeyword (text, hitSlice, start, end) {
                if (!text || !hitSlice || !hitSlice.length) {
                  return;
                }

                var result = '';
                var startIndex = start;
                var endIndex = end;
                hitSlice.forEach(function (hit) {
                  if (hit.index < startIndex) {
                    return;
                  }

                  var hitWordEnd = hit.index + hit.word.length;
                  result += text.slice(startIndex, hit.index);
                  result += '<b>' + text.slice(hit.index, hitWordEnd) + '</b>';
                  startIndex = hitWordEnd;
                });
                result += text.slice(startIndex, endIndex);
                return result;
              }

              var postData = {};
              // 文章总的搜索权重
              var postWeight = titleHitSlice.length * WEIGHT.title + contentHitSlice.length * WEIGHT.content;
              // 标记匹配关键词后的标题
              var postTitle = highlightKeyword(title, titleHitSlice, 0, title.length) || title;
              // 标记匹配关键词后的内容
              var postContent;
              // 显示内容的长度
              var SHOW_WORD_LENGTH = 200;
              // 命中关键词前的字符显示长度
              var SHOW_WORD_FRONT_LENGTH = 20;
              var SHOW_WORD_END_LENGTH = SHOW_WORD_LENGTH - SHOW_WORD_FRONT_LENGTH;

              // 截取匹配的第一个字符，前后共 200 个字符来显示
              if (contentHitSlice.length > 0) {
                var firstIndex = contentHitSlice[0].index;
                var start = firstIndex > SHOW_WORD_FRONT_LENGTH ? firstIndex - SHOW_WORD_FRONT_LENGTH : 0;
                var end = firstIndex + SHOW_WORD_END_LENGTH;
                postContent = highlightKeyword(content, contentHitSlice, start, end);
              } else { // 未匹配到内容，直接截取前 200 个字符来显示
                postContent = content.slice(0, SHOW_WORD_LENGTH);
              }
              postData.title = postTitle;
              postData.content = postContent;
              postData.url = postURL;
              postData.weight = postWeight;
              matchPosts.push(postData);
            }
          });
        }

        var resultInnerHtml = '';
        if (matchPosts.length) {
          // 按权重递增的顺序排序，使权重大的优先显示
          matchPosts.sort(function (left, right) {
            return right.weight - left.weight;
          });
          resultInnerHtml += '<ul>';
          matchPosts.forEach(function (post) {
            resultInnerHtml += '<li><a class="search-results-title" href="' + post.url + '">';
            resultInnerHtml += post.title;
            resultInnerHtml += '</a><div class="search-results-content">';
            resultInnerHtml += post.content;
            resultInnerHtml += '</div></li>';
          });
          resultInnerHtml += '</ul>';
        } else {
          resultInnerHtml += '<div class="search-results-none"><i class="far fa-meh"></i></div>';
        }
        $result.html(resultInnerHtml);
      };
      $input.on('input', searchPost);
      $input.on('keyup', function (e) {
        if (e.keyCode === Stun.utils.codeToKeyCode('Enter')) {
          searchPost();
        }
      });
    }
  });
}

function closeSearch () {
  $('body').css({ overflow: 'auto' });
  $('.search-popup').css({ display: 'none' });
  $('.search-mask').css({ display: 'none' });
}

window.addEventListener('DOMContentLoaded', function () {
  Stun.utils.pjaxReloadLocalSearch = function () {
    $('.header-nav-search').on('click', function (e) {
      e.stopPropagation();
      $('body').css('overflow', 'hidden');
      $('.search-popup')
        .velocity('stop')
        .velocity('transition.expandIn', {
          duration: 300,
          complete: function () {
            $('.search-popup input').focus();
          }
        });
      $('.search-mask')
        .velocity('stop')
        .velocity('transition.fadeIn', {
          duration: 300
        });

      initSearch();
    });
    $('.search-mask, .search-close').on('click', function () {
      closeSearch();
    });
    $(document).on('keydown', function (e) {
      // Escape <=> 27
      if (e.keyCode === Stun.utils.codeToKeyCode('Escape')) {
        closeSearch();
      }
    });
  };

  Stun.utils.pjaxReloadLocalSearch();
}, false);

function safeOpenUrl(url) {
  var newTab = window.open();
  newTab.opener = null;
  newTab.location = url;
}

function extSearch(engine) {
  var engines = {
    google: 'https://www.google.com/search?q=',
    bing: 'https://cn.bing.com/search?q=',
    baidu: 'https://www.baidu.com/s?ie=UTF-8&wd=',
  };
  var host = window.location.host;
  var query = $('.search-input input').val().toLowerCase().trim();
  var uri = engines[engine] + query + ' site:' + host;

  if (query) {
    safeOpenUrl(uri);
  } else {
    Stun.utils.popAlert('warning', '请输入字符');
  }
}

var assistSearchList = window.CONFIG.assistSearch;

if (Array.isArray(assistSearchList)) {
  assistSearchList.forEach(function (name) {
    document.querySelector('.search-btns-item--' + name).addEventListener('click', function () {
      extSearch(name);
    }, false);
  });
}</script><script src="/js/utils.js?v=2.8.0"></script><script src="/js/stun-boot.js?v=2.8.0"></script><script src="/js/scroll.js?v=2.8.0"></script><script src="/js/header.js?v=2.8.0"></script><script src="/js/sidebar.js?v=2.8.0"></script><script type="application/json" src="/search.xml"></script></body></html>